
        <!DOCTYPE html>
        <html lang="en">
        <head>
        <title>TOC</title>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <style type=text/css>pre { line-height: 125%; }
td.linenos .normal { color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px; }
span.linenos { color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px; }
td.linenos .special { color: #000000; background-color: #ffffc0; padding-left: 5px; padding-right: 5px; }
span.linenos.special { color: #000000; background-color: #ffffc0; padding-left: 5px; padding-right: 5px; }
.hll { background-color: #ffffcc }
.c { color: #408080; font-style: italic } /* Comment */
.err { border: 1px solid #FF0000 } /* Error */
.k { color: #008000; font-weight: bold } /* Keyword */
.o { color: #666666 } /* Operator */
.ch { color: #408080; font-style: italic } /* Comment.Hashbang */
.cm { color: #408080; font-style: italic } /* Comment.Multiline */
.cp { color: #BC7A00 } /* Comment.Preproc */
.cpf { color: #408080; font-style: italic } /* Comment.PreprocFile */
.c1 { color: #408080; font-style: italic } /* Comment.Single */
.cs { color: #408080; font-style: italic } /* Comment.Special */
.gd { color: #A00000 } /* Generic.Deleted */
.ge { font-style: italic } /* Generic.Emph */
.gr { color: #FF0000 } /* Generic.Error */
.gh { color: #000080; font-weight: bold } /* Generic.Heading */
.gi { color: #00A000 } /* Generic.Inserted */
.go { color: #888888 } /* Generic.Output */
.gp { color: #000080; font-weight: bold } /* Generic.Prompt */
.gs { font-weight: bold } /* Generic.Strong */
.gu { color: #800080; font-weight: bold } /* Generic.Subheading */
.gt { color: #0044DD } /* Generic.Traceback */
.kc { color: #008000; font-weight: bold } /* Keyword.Constant */
.kd { color: #008000; font-weight: bold } /* Keyword.Declaration */
.kn { color: #008000; font-weight: bold } /* Keyword.Namespace */
.kp { color: #008000 } /* Keyword.Pseudo */
.kr { color: #008000; font-weight: bold } /* Keyword.Reserved */
.kt { color: #B00040 } /* Keyword.Type */
.m { color: #666666 } /* Literal.Number */
.s { color: #BA2121 } /* Literal.String */
.na { color: #7D9029 } /* Name.Attribute */
.nb { color: #008000 } /* Name.Builtin */
.nc { color: #0000FF; font-weight: bold } /* Name.Class */
.no { color: #880000 } /* Name.Constant */
.nd { color: #AA22FF } /* Name.Decorator */
.ni { color: #999999; font-weight: bold } /* Name.Entity */
.ne { color: #D2413A; font-weight: bold } /* Name.Exception */
.nf { color: #0000FF } /* Name.Function */
.nl { color: #A0A000 } /* Name.Label */
.nn { color: #0000FF; font-weight: bold } /* Name.Namespace */
.nt { color: #008000; font-weight: bold } /* Name.Tag */
.nv { color: #19177C } /* Name.Variable */
.ow { color: #AA22FF; font-weight: bold } /* Operator.Word */
.w { color: #bbbbbb } /* Text.Whitespace */
.mb { color: #666666 } /* Literal.Number.Bin */
.mf { color: #666666 } /* Literal.Number.Float */
.mh { color: #666666 } /* Literal.Number.Hex */
.mi { color: #666666 } /* Literal.Number.Integer */
.mo { color: #666666 } /* Literal.Number.Oct */
.sa { color: #BA2121 } /* Literal.String.Affix */
.sb { color: #BA2121 } /* Literal.String.Backtick */
.sc { color: #BA2121 } /* Literal.String.Char */
.dl { color: #BA2121 } /* Literal.String.Delimiter */
.sd { color: #BA2121; font-style: italic } /* Literal.String.Doc */
.s2 { color: #BA2121 } /* Literal.String.Double */
.se { color: #BB6622; font-weight: bold } /* Literal.String.Escape */
.sh { color: #BA2121 } /* Literal.String.Heredoc */
.si { color: #BB6688; font-weight: bold } /* Literal.String.Interpol */
.sx { color: #008000 } /* Literal.String.Other */
.sr { color: #BB6688 } /* Literal.String.Regex */
.s1 { color: #BA2121 } /* Literal.String.Single */
.ss { color: #19177C } /* Literal.String.Symbol */
.bp { color: #008000 } /* Name.Builtin.Pseudo */
.fm { color: #0000FF } /* Name.Function.Magic */
.vc { color: #19177C } /* Name.Variable.Class */
.vg { color: #19177C } /* Name.Variable.Global */
.vi { color: #19177C } /* Name.Variable.Instance */
.vm { color: #19177C } /* Name.Variable.Magic */
.il { color: #666666 } /* Literal.Number.Integer.Long */
        div.example { width: 50%; background-color: lightgrey; border: 1px solid; padding-left: 10px;}
        </style>
        </head>
        <body>
        <hr>/network/netconnect.cpp<hr>
                        <details>
                        <summary>NoRandomPlacementMultiplayer</summary>
                        <p><br>  Removes Randomization of Player position in Multiplayer mode<br><br>  @param l  Lua state.</p>
                          <details>
                          <summary>/network/netconnect.cpp:1873 CclNoRandomPlacementMultiplayer</summary>
                          <p><div class="highlight"><pre><span></span><span class="k">static</span> <span class="kt">int</span> <span class="nf">CclNoRandomPlacementMultiplayer</span><span class="p">(</span><span class="n">lua_State</span> <span class="o">*</span><span class="n">l</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">LuaCheckArgs</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
	<span class="n">NoRandomPlacementMultiplayer</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</p>
                          </details>
                        </details>
                        
                        <details>
                        <summary>NetworkDiscoverServers</summary>
                        <p>/network/netconnect.cpp:1893 CclNetworkDiscoverServers</p>
                        <p><div class="highlight"><pre><span></span><span class="k">static</span> <span class="kt">int</span> <span class="nf">CclNetworkDiscoverServers</span><span class="p">(</span><span class="n">lua_State</span> <span class="o">*</span><span class="n">l</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">LuaCheckArgs</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
	<span class="kt">bool</span> <span class="n">start</span> <span class="o">=</span> <span class="n">LuaToBoolean</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>

	<span class="k">auto</span> <span class="n">callback</span><span class="o">=</span> <span class="p">[</span><span class="n">l</span><span class="p">](</span><span class="kt">char</span><span class="o">*</span> <span class="n">ip</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">auto</span> <span class="n">i</span> <span class="o">=</span> <span class="n">lua_objlen</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">-1</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>
		<span class="n">lua_pushnumber</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">i</span><span class="p">);</span>
		<span class="n">lua_pushstring</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">ip</span><span class="p">);</span>
		<span class="n">lua_settable</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">-3</span><span class="p">);</span>
	<span class="p">};</span>

	<span class="n">lua_newtable</span><span class="p">(</span><span class="n">l</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">start</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">MdnsService</span><span class="p">.</span><span class="n">QueryServers</span><span class="p">(</span><span class="n">callback</span><span class="p">);</span>
	<span class="p">}</span>

	<span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</p>
                        </details>
                        <hr>/stratagus/script.cpp<hr>
                        <details>
                        <summary>Add</summary>
                        <p><br>  Return equivalent lua table for add.<br>  {"Add", {arg1, arg2}}<br><br>  @param l  Lua state.<br><br>  @return   equivalent lua table.</p>
                          <details>
                          <summary>/stratagus/script.cpp:1568 CclAdd</summary>
                          <p><div class="highlight"><pre><span></span><span class="k">static</span> <span class="kt">int</span> <span class="nf">CclAdd</span><span class="p">(</span><span class="n">lua_State</span> <span class="o">*</span><span class="n">l</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">LuaCheckArgs</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">2</span><span class="p">);</span>
	<span class="k">return</span> <span class="n">Alias</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="s">&quot;Add&quot;</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</p>
                          </details>
                        </details>
                        
                        <details>
                        <summary>Sub</summary>
                        <p><br>  Return equivalent lua table for add.<br>  {"Div", {arg1, arg2}}<br><br>  @param l  Lua state.<br><br>  @return   equivalent lua table.</p>
                          <details>
                          <summary>/stratagus/script.cpp:1582 CclSub</summary>
                          <p><div class="highlight"><pre><span></span><span class="k">static</span> <span class="kt">int</span> <span class="nf">CclSub</span><span class="p">(</span><span class="n">lua_State</span> <span class="o">*</span><span class="n">l</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">LuaCheckArgs</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">2</span><span class="p">);</span>
	<span class="k">return</span> <span class="n">Alias</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="s">&quot;Sub&quot;</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</p>
                          </details>
                        </details>
                        
                        <details>
                        <summary>Mul</summary>
                        <p><br>  Return equivalent lua table for add.<br>  {"Mul", {arg1, arg2}}<br><br>  @param l  Lua state.<br><br>  @return   equivalent lua table.</p>
                          <details>
                          <summary>/stratagus/script.cpp:1595 CclMul</summary>
                          <p><div class="highlight"><pre><span></span><span class="k">static</span> <span class="kt">int</span> <span class="nf">CclMul</span><span class="p">(</span><span class="n">lua_State</span> <span class="o">*</span><span class="n">l</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">LuaCheckArgs</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">2</span><span class="p">);</span>
	<span class="k">return</span> <span class="n">Alias</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="s">&quot;Mul&quot;</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</p>
                          </details>
                        </details>
                        
                        <details>
                        <summary>Div</summary>
                        <p><br>  Return equivalent lua table for add.<br>  {"Div", {arg1, arg2}}<br><br>  @param l  Lua state.<br><br>  @return   equivalent lua table.</p>
                          <details>
                          <summary>/stratagus/script.cpp:1608 CclDiv</summary>
                          <p><div class="highlight"><pre><span></span><span class="k">static</span> <span class="kt">int</span> <span class="nf">CclDiv</span><span class="p">(</span><span class="n">lua_State</span> <span class="o">*</span><span class="n">l</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">LuaCheckArgs</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">2</span><span class="p">);</span>
	<span class="k">return</span> <span class="n">Alias</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="s">&quot;Div&quot;</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</p>
                          </details>
                        </details>
                        
                        <details>
                        <summary>Min</summary>
                        <p><br>  Return equivalent lua table for add.<br>  {"Min", {arg1, arg2}}<br><br>  @param l  Lua state.<br><br>  @return   equivalent lua table.</p>
                          <details>
                          <summary>/stratagus/script.cpp:1621 CclMin</summary>
                          <p><div class="highlight"><pre><span></span><span class="k">static</span> <span class="kt">int</span> <span class="nf">CclMin</span><span class="p">(</span><span class="n">lua_State</span> <span class="o">*</span><span class="n">l</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">LuaCheckArgs</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">2</span><span class="p">);</span>
	<span class="k">return</span> <span class="n">Alias</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="s">&quot;Min&quot;</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</p>
                          </details>
                        </details>
                        
                        <details>
                        <summary>Max</summary>
                        <p><br>  Return equivalent lua table for add.<br>  {"Max", {arg1, arg2, argn}}<br><br>  @param l  Lua state.<br><br>  @return   equivalent lua table.</p>
                          <details>
                          <summary>/stratagus/script.cpp:1634 CclMax</summary>
                          <p><div class="highlight"><pre><span></span><span class="k">static</span> <span class="kt">int</span> <span class="nf">CclMax</span><span class="p">(</span><span class="n">lua_State</span> <span class="o">*</span><span class="n">l</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">LuaCheckArgs</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">2</span><span class="p">);</span>
	<span class="k">return</span> <span class="n">Alias</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="s">&quot;Max&quot;</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</p>
                          </details>
                        </details>
                        
                        <details>
                        <summary>Rand</summary>
                        <p><br>  Return equivalent lua table for add.<br>  {"Rand", {arg1}}<br><br>  @param l  Lua state.<br><br>  @return   equivalent lua table.</p>
                          <details>
                          <summary>/stratagus/script.cpp:1647 CclRand</summary>
                          <p><div class="highlight"><pre><span></span><span class="k">static</span> <span class="kt">int</span> <span class="nf">CclRand</span><span class="p">(</span><span class="n">lua_State</span> <span class="o">*</span><span class="n">l</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">LuaCheckArgs</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
	<span class="k">return</span> <span class="n">Alias</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="s">&quot;Rand&quot;</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</p>
                          </details>
                        </details>
                        
                        <details>
                        <summary>GreaterThan</summary>
                        <p><br>  Return equivalent lua table for GreaterThan.<br>  {"GreaterThan", {arg1, arg2}}<br><br>  @param l  Lua state.<br><br>  @return   equivalent lua table.</p>
                          <details>
                          <summary>/stratagus/script.cpp:1660 CclGreaterThan</summary>
                          <p><div class="highlight"><pre><span></span><span class="k">static</span> <span class="kt">int</span> <span class="nf">CclGreaterThan</span><span class="p">(</span><span class="n">lua_State</span> <span class="o">*</span><span class="n">l</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">LuaCheckArgs</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">2</span><span class="p">);</span>
	<span class="k">return</span> <span class="n">Alias</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="s">&quot;GreaterThan&quot;</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</p>
                          </details>
                        </details>
                        
                        <details>
                        <summary>LessThan</summary>
                        <p><br>  Return equivalent lua table for LessThan.<br>  {"LessThan", {arg1, arg2}}<br><br>  @param l  Lua state.<br><br>  @return   equivalent lua table.</p>
                          <details>
                          <summary>/stratagus/script.cpp:1686 CclLessThan</summary>
                          <p><div class="highlight"><pre><span></span><span class="k">static</span> <span class="kt">int</span> <span class="nf">CclLessThan</span><span class="p">(</span><span class="n">lua_State</span> <span class="o">*</span><span class="n">l</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">LuaCheckArgs</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">2</span><span class="p">);</span>
	<span class="k">return</span> <span class="n">Alias</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="s">&quot;LessThan&quot;</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</p>
                          </details>
                        </details>
                        
                        <details>
                        <summary>Equal</summary>
                        <p><br>  Return equivalent lua table for Equal.<br>  {"Equal", {arg1, arg2}}<br><br>  @param l  Lua state.<br><br>  @return   equivalent lua table.</p>
                          <details>
                          <summary>/stratagus/script.cpp:1712 CclEqual</summary>
                          <p><div class="highlight"><pre><span></span><span class="k">static</span> <span class="kt">int</span> <span class="nf">CclEqual</span><span class="p">(</span><span class="n">lua_State</span> <span class="o">*</span><span class="n">l</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">LuaCheckArgs</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">2</span><span class="p">);</span>
	<span class="k">return</span> <span class="n">Alias</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="s">&quot;Equal&quot;</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</p>
                          </details>
                        </details>
                        
                        <details>
                        <summary>GreaterThanOrEq</summary>
                        <p><br>  Return equivalent lua table for GreaterThanOrEq.<br>  {"GreaterThanOrEq", {arg1, arg2}}<br><br>  @param l  Lua state.<br><br>  @return   equivalent lua table.</p>
                          <details>
                          <summary>/stratagus/script.cpp:1673 CclGreaterThanOrEq</summary>
                          <p><div class="highlight"><pre><span></span><span class="k">static</span> <span class="kt">int</span> <span class="nf">CclGreaterThanOrEq</span><span class="p">(</span><span class="n">lua_State</span> <span class="o">*</span><span class="n">l</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">LuaCheckArgs</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">2</span><span class="p">);</span>
	<span class="k">return</span> <span class="n">Alias</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="s">&quot;GreaterThanOrEq&quot;</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</p>
                          </details>
                        </details>
                        
                        <details>
                        <summary>LessThanOrEq</summary>
                        <p><br>  Return equivalent lua table for LessThanOrEq.<br>  {"LessThanOrEq", {arg1, arg2}}<br><br>  @param l  Lua state.<br><br>  @return   equivalent lua table.</p>
                          <details>
                          <summary>/stratagus/script.cpp:1699 CclLessThanOrEq</summary>
                          <p><div class="highlight"><pre><span></span><span class="k">static</span> <span class="kt">int</span> <span class="nf">CclLessThanOrEq</span><span class="p">(</span><span class="n">lua_State</span> <span class="o">*</span><span class="n">l</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">LuaCheckArgs</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">2</span><span class="p">);</span>
	<span class="k">return</span> <span class="n">Alias</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="s">&quot;LessThanOrEq&quot;</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</p>
                          </details>
                        </details>
                        
                        <details>
                        <summary>NotEqual</summary>
                        <p><br>  Return equivalent lua table for NotEqual.<br>  {"NotEqual", {arg1, arg2}}<br><br>  @param l  Lua state.<br><br>  @return   equivalent lua table.</p>
                          <details>
                          <summary>/stratagus/script.cpp:1725 CclNotEqual</summary>
                          <p><div class="highlight"><pre><span></span><span class="k">static</span> <span class="kt">int</span> <span class="nf">CclNotEqual</span><span class="p">(</span><span class="n">lua_State</span> <span class="o">*</span><span class="n">l</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">LuaCheckArgs</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">2</span><span class="p">);</span>
	<span class="k">return</span> <span class="n">Alias</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="s">&quot;NotEqual&quot;</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</p>
                          </details>
                        </details>
                        
                        <details>
                        <summary>VideoTextLength</summary>
                        <p><br>  Return equivalent lua table for VideoTextLength.<br>  {"VideoTextLength", {Text = arg1, Font = arg2}}<br><br>  @param l  Lua state.<br><br>  @return   equivalent lua table.</p>
                          <details>
                          <summary>/stratagus/script.cpp:1873 CclVideoTextLength</summary>
                          <p><div class="highlight"><pre><span></span><span class="k">static</span> <span class="kt">int</span> <span class="nf">CclVideoTextLength</span><span class="p">(</span><span class="n">lua_State</span> <span class="o">*</span><span class="n">l</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">LuaCheckArgs</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">2</span><span class="p">);</span>
	<span class="n">lua_newtable</span><span class="p">(</span><span class="n">l</span><span class="p">);</span>
	<span class="n">lua_pushnumber</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
	<span class="n">lua_pushstring</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="s">&quot;VideoTextLength&quot;</span><span class="p">);</span>
	<span class="n">lua_rawset</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">-3</span><span class="p">);</span>
	<span class="n">lua_pushnumber</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">2</span><span class="p">);</span>

	<span class="n">lua_newtable</span><span class="p">(</span><span class="n">l</span><span class="p">);</span>
	<span class="n">lua_pushstring</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="s">&quot;Font&quot;</span><span class="p">);</span>
	<span class="n">lua_pushvalue</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
	<span class="n">lua_rawset</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">-3</span><span class="p">);</span>
	<span class="n">lua_pushstring</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="s">&quot;Text&quot;</span><span class="p">);</span>
	<span class="n">lua_pushvalue</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">2</span><span class="p">);</span>
	<span class="n">lua_rawset</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">-3</span><span class="p">);</span>

	<span class="n">lua_rawset</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">-3</span><span class="p">);</span>
	<span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</p>
                          </details>
                        </details>
                        
                        <details>
                        <summary>StringFind</summary>
                        <p><br>  Return equivalent lua table for StringFind.<br>  {"StringFind", {arg1, arg2}}<br><br>  @param l  Lua state.<br><br>  @return   equivalent lua table.</p>
                          <details>
                          <summary>/stratagus/script.cpp:1887 CclStringFind</summary>
                          <p><div class="highlight"><pre><span></span><span class="k">static</span> <span class="kt">int</span> <span class="nf">CclStringFind</span><span class="p">(</span><span class="n">lua_State</span> <span class="o">*</span><span class="n">l</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">LuaCheckArgs</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">2</span><span class="p">);</span>
	<span class="k">return</span> <span class="n">Alias</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="s">&quot;StringFind&quot;</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</p>
                          </details>
                        </details>
                        
                        <details>
                        <summary>AttackerVar</summary>
                        <p><br>  Return equivalent lua table for .<br>  {"Unit", {Unit = "Attacker", Variable = arg1, Component = "Value" or arg2}}<br><br>  @param l  Lua state.<br><br>  @return   equivalent lua table.</p>
                          <details>
                          <summary>/stratagus/script.cpp:1474 CclUnitAttackerVar</summary>
                          <p><div class="highlight"><pre><span></span><span class="k">static</span> <span class="kt">int</span> <span class="nf">CclUnitAttackerVar</span><span class="p">(</span><span class="n">lua_State</span> <span class="o">*</span><span class="n">l</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">lua_gettop</span><span class="p">(</span><span class="n">l</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span> <span class="o">||</span> <span class="n">lua_gettop</span><span class="p">(</span><span class="n">l</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">3</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">LuaError</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="s">&quot;Bad number of arg for AttackerVar()</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
	<span class="p">}</span>
	<span class="k">return</span> <span class="n">AliasUnitVar</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="s">&quot;Attacker&quot;</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</p>
                          </details>
                        </details>
                        
                        <details>
                        <summary>DefenderVar</summary>
                        <p><br>  Return equivalent lua table for .<br>  {"Unit", {Unit = "Defender", Variable = arg1, Component = "Value" or arg2}}<br><br>  @param l  Lua state.<br><br>  @return   equivalent lua table.</p>
                          <details>
                          <summary>/stratagus/script.cpp:1490 CclUnitDefenderVar</summary>
                          <p><div class="highlight"><pre><span></span><span class="k">static</span> <span class="kt">int</span> <span class="nf">CclUnitDefenderVar</span><span class="p">(</span><span class="n">lua_State</span> <span class="o">*</span><span class="n">l</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">lua_gettop</span><span class="p">(</span><span class="n">l</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span> <span class="o">||</span> <span class="n">lua_gettop</span><span class="p">(</span><span class="n">l</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">3</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">LuaError</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="s">&quot;Bad number of arg for DefenderVar()</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
	<span class="p">}</span>
	<span class="k">return</span> <span class="n">AliasUnitVar</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="s">&quot;Defender&quot;</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</p>
                          </details>
                        </details>
                        
                        <details>
                        <summary>ActiveUnitVar</summary>
                        <p><br>  Return equivalent lua table for .<br>  {"Unit", {Unit = "Active", Variable = arg1, Component = "Value" or arg2}}<br><br>  @param l  Lua state.<br><br>  @return   equivalent lua table.</p>
                          <details>
                          <summary>/stratagus/script.cpp:1506 CclActiveUnitVar</summary>
                          <p><div class="highlight"><pre><span></span><span class="k">static</span> <span class="kt">int</span> <span class="nf">CclActiveUnitVar</span><span class="p">(</span><span class="n">lua_State</span> <span class="o">*</span><span class="n">l</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">lua_gettop</span><span class="p">(</span><span class="n">l</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span> <span class="o">||</span> <span class="n">lua_gettop</span><span class="p">(</span><span class="n">l</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">3</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">LuaError</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="s">&quot;Bad number of arg for ActiveUnitVar()</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
	<span class="p">}</span>
	<span class="k">return</span> <span class="n">AliasUnitVar</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="s">&quot;Active&quot;</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</p>
                          </details>
                        </details>
                        
                        <details>
                        <summary>TypeVar</summary>
                        <p><br>  Return equivalent lua table for .<br>  {"Type", {Type = "Active", Variable = arg1, Component = "Value" or arg2}}<br><br>  @param l  Lua state.<br><br>  @return   equivalent lua table.</p>
                          <details>
                          <summary>/stratagus/script.cpp:1522 CclActiveTypeVar</summary>
                          <p><div class="highlight"><pre><span></span><span class="k">static</span> <span class="kt">int</span> <span class="nf">CclActiveTypeVar</span><span class="p">(</span><span class="n">lua_State</span> <span class="o">*</span><span class="n">l</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">lua_gettop</span><span class="p">(</span><span class="n">l</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span> <span class="o">||</span> <span class="n">lua_gettop</span><span class="p">(</span><span class="n">l</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">3</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">LuaError</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="s">&quot;Bad number of arg for ActiveTypeVar()</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
	<span class="p">}</span>
	<span class="k">return</span> <span class="n">AliasTypeVar</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="s">&quot;Type&quot;</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</p>
                          </details>
                        </details>
                        
                        <details>
                        <summary>Concat</summary>
                        <p><br>  Return equivalent lua table for Concat.<br>  {"Concat", {arg1}}<br><br>  @param l  Lua state.<br><br>  @return   equivalent lua table.</p>
                          <details>
                          <summary>/stratagus/script.cpp:1743 CclConcat</summary>
                          <p><div class="highlight"><pre><span></span><span class="k">static</span> <span class="kt">int</span> <span class="nf">CclConcat</span><span class="p">(</span><span class="n">lua_State</span> <span class="o">*</span><span class="n">l</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">lua_gettop</span><span class="p">(</span><span class="n">l</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span> <span class="c1">// FIXME do extra job for 1.</span>
		<span class="n">LuaError</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="s">&quot;Bad number of arg for Concat()</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
	<span class="p">}</span>
	<span class="k">return</span> <span class="n">Alias</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="s">&quot;Concat&quot;</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</p>
                          </details>
                        </details>
                        
                        <details>
                        <summary>String</summary>
                        <p><br>  Return equivalent lua table for String.<br>  {"String", {arg1}}<br><br>  @param l  Lua state.<br><br>  @return   equivalent lua table.</p>
                          <details>
                          <summary>/stratagus/script.cpp:1757 CclString</summary>
                          <p><div class="highlight"><pre><span></span><span class="k">static</span> <span class="kt">int</span> <span class="nf">CclString</span><span class="p">(</span><span class="n">lua_State</span> <span class="o">*</span><span class="n">l</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">LuaCheckArgs</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
	<span class="k">return</span> <span class="n">Alias</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="s">&quot;String&quot;</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</p>
                          </details>
                        </details>
                        
                        <details>
                        <summary>InverseVideo</summary>
                        <p><br>  Return equivalent lua table for InverseVideo.<br>  {"InverseVideo", {arg1}}<br><br>  @param l  Lua state.<br><br>  @return   equivalent lua table.</p>
                          <details>
                          <summary>/stratagus/script.cpp:1770 CclInverseVideo</summary>
                          <p><div class="highlight"><pre><span></span><span class="k">static</span> <span class="kt">int</span> <span class="nf">CclInverseVideo</span><span class="p">(</span><span class="n">lua_State</span> <span class="o">*</span><span class="n">l</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">LuaCheckArgs</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
	<span class="k">return</span> <span class="n">Alias</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="s">&quot;InverseVideo&quot;</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</p>
                          </details>
                        </details>
                        
                        <details>
                        <summary>UnitName</summary>
                        <p><br>  Return equivalent lua table for UnitName.<br>  {"UnitName", {arg1}}<br><br>  @param l  Lua state.<br><br>  @return   equivalent lua table.</p>
                          <details>
                          <summary>/stratagus/script.cpp:1783 CclUnitName</summary>
                          <p><div class="highlight"><pre><span></span><span class="k">static</span> <span class="kt">int</span> <span class="nf">CclUnitName</span><span class="p">(</span><span class="n">lua_State</span> <span class="o">*</span><span class="n">l</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">LuaCheckArgs</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
	<span class="k">return</span> <span class="n">Alias</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="s">&quot;UnitName&quot;</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</p>
                          </details>
                        </details>
                        
                        <details>
                        <summary>SubString</summary>
                        <p><br>  Return equivalent lua table for SubString.<br>  {"SubString", {arg1, arg2, arg3}}<br><br>  @param l  Lua state.<br><br>  @return   equivalent lua table.</p>
                          <details>
                          <summary>/stratagus/script.cpp:1814 CclSubString</summary>
                          <p><div class="highlight"><pre><span></span><span class="k">static</span> <span class="kt">int</span> <span class="nf">CclSubString</span><span class="p">(</span><span class="n">lua_State</span> <span class="o">*</span><span class="n">l</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">lua_gettop</span><span class="p">(</span><span class="n">l</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">2</span> <span class="o">&amp;&amp;</span> <span class="n">lua_gettop</span><span class="p">(</span><span class="n">l</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">3</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">LuaError</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="s">&quot;Bad number of arg for SubString()</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
	<span class="p">}</span>
	<span class="k">return</span> <span class="n">Alias</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="s">&quot;SubString&quot;</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</p>
                          </details>
                        </details>
                        
                        <details>
                        <summary>Line</summary>
                        <p><br>  Return equivalent lua table for Line.<br>  {"Line", {arg1, arg2[, arg3]}}<br><br>  @param l  Lua state.<br><br>  @return   equivalent lua table.</p>
                          <details>
                          <summary>/stratagus/script.cpp:1830 CclLine</summary>
                          <p><div class="highlight"><pre><span></span><span class="k">static</span> <span class="kt">int</span> <span class="nf">CclLine</span><span class="p">(</span><span class="n">lua_State</span> <span class="o">*</span><span class="n">l</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">lua_gettop</span><span class="p">(</span><span class="n">l</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">2</span> <span class="o">||</span> <span class="n">lua_gettop</span><span class="p">(</span><span class="n">l</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">4</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">LuaError</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="s">&quot;Bad number of arg for Line()</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
	<span class="p">}</span>
	<span class="k">return</span> <span class="n">Alias</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="s">&quot;Line&quot;</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</p>
                          </details>
                        </details>
                        
                        <details>
                        <summary>GameInfo</summary>
                        <p><br>  Return equivalent lua table for Line.<br>  {"Line", "arg1"}<br><br>  @param l  Lua state.<br><br>  @return   equivalent lua table.</p>
                          <details>
                          <summary>/stratagus/script.cpp:1844 CclGameInfo</summary>
                          <p><div class="highlight"><pre><span></span><span class="k">static</span> <span class="kt">int</span> <span class="nf">CclGameInfo</span><span class="p">(</span><span class="n">lua_State</span> <span class="o">*</span><span class="n">l</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">LuaCheckArgs</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
	<span class="k">return</span> <span class="n">Alias</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="s">&quot;GameInfo&quot;</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</p>
                          </details>
                        </details>
                        
                        <details>
                        <summary>PlayerName</summary>
                        <p><br>  Return equivalent lua table for PlayerName.<br>  {"PlayerName", {arg1}}<br><br>  @param l  Lua state.<br><br>  @return   equivalent lua table.</p>
                          <details>
                          <summary>/stratagus/script.cpp:1933 CclPlayerName</summary>
                          <p><div class="highlight"><pre><span></span><span class="k">static</span> <span class="kt">int</span> <span class="nf">CclPlayerName</span><span class="p">(</span><span class="n">lua_State</span> <span class="o">*</span><span class="n">l</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">LuaCheckArgs</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
	<span class="k">return</span> <span class="n">Alias</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="s">&quot;PlayerName&quot;</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</p>
                          </details>
                        </details>
                        
                        <details>
                        <summary>PlayerData</summary>
                        <p><br>  Return equivalent lua table for PlayerData.<br>  {"PlayerData", {arg1}}<br><br>  @param l  Lua state.<br><br>  @return   equivalent lua table.</p>
                          <details>
                          <summary>/stratagus/script.cpp:1919 CclPlayerData</summary>
                          <p><div class="highlight"><pre><span></span><span class="k">static</span> <span class="kt">int</span> <span class="nf">CclPlayerData</span><span class="p">(</span><span class="n">lua_State</span> <span class="o">*</span><span class="n">l</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">lua_gettop</span><span class="p">(</span><span class="n">l</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">2</span> <span class="o">&amp;&amp;</span> <span class="n">lua_gettop</span><span class="p">(</span><span class="n">l</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">3</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">LuaError</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="s">&quot;Bad number of arg for PlayerData()</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
	<span class="p">}</span>
	<span class="k">return</span> <span class="n">Alias</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="s">&quot;PlayerData&quot;</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</p>
                          </details>
                        </details>
                        
                        <details>
                        <summary>If</summary>
                        <p><br>  Return equivalent lua table for If.<br>  {"If", {arg1}}<br><br>  @param l  Lua state.<br><br>  @return   equivalent lua table.</p>
                          <details>
                          <summary>/stratagus/script.cpp:1798 CclIf</summary>
                          <p><div class="highlight"><pre><span></span><span class="k">static</span> <span class="kt">int</span> <span class="nf">CclIf</span><span class="p">(</span><span class="n">lua_State</span> <span class="o">*</span><span class="n">l</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">lua_gettop</span><span class="p">(</span><span class="n">l</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">2</span> <span class="o">&amp;&amp;</span> <span class="n">lua_gettop</span><span class="p">(</span><span class="n">l</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">3</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">LuaError</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="s">&quot;Bad number of arg for If()</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
	<span class="p">}</span>
	<span class="k">return</span> <span class="n">Alias</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="s">&quot;If&quot;</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</p>
                          </details>
                        </details>
                        
                        <details>
                        <summary>NumIf</summary>
                        <p><br>  Return equivalent lua table for NumIf.<br>  {"NumIf", {arg1}}<br><br>  @param l  Lua state.<br><br>  @return   equivalent lua table.</p>
                          <details>
                          <summary>/stratagus/script.cpp:1903 CclNumIf</summary>
                          <p><div class="highlight"><pre><span></span><span class="k">static</span> <span class="kt">int</span> <span class="nf">CclNumIf</span><span class="p">(</span><span class="n">lua_State</span> <span class="o">*</span><span class="n">l</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">lua_gettop</span><span class="p">(</span><span class="n">l</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">2</span> <span class="o">&amp;&amp;</span> <span class="n">lua_gettop</span><span class="p">(</span><span class="n">l</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">3</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">LuaError</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="s">&quot;Bad number of arg for NumIf()</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
	<span class="p">}</span>
	<span class="k">return</span> <span class="n">Alias</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="s">&quot;NumIf&quot;</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</p>
                          </details>
                        </details>
                        
                        <details>
                        <summary>LibraryPath</summary>
                        <p><br>  Return the stratagus library path.<br><br>  @param l  Lua state.<br><br>  @return   Current libray path.</p>
                          <details>
                          <summary>/stratagus/script.cpp:1995 CclStratagusLibraryPath</summary>
                          <p><div class="highlight"><pre><span></span><span class="k">static</span> <span class="kt">int</span> <span class="nf">CclStratagusLibraryPath</span><span class="p">(</span><span class="n">lua_State</span> <span class="o">*</span><span class="n">l</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">lua_pushstring</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">StratagusLibPath</span><span class="p">.</span><span class="n">c_str</span><span class="p">());</span>
	<span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</p>
                          </details>
                        </details>
                        
                        <details>
                        <summary>ListDirectory</summary>
                        <p><br>  Return a table with the files or directories found in the subdirectory.</p>
                          <details>
                          <summary>/stratagus/script.cpp:2057 CclListDirectory</summary>
                          <p><div class="highlight"><pre><span></span><span class="k">static</span> <span class="kt">int</span> <span class="nf">CclListDirectory</span><span class="p">(</span><span class="n">lua_State</span> <span class="o">*</span><span class="n">l</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="n">CclFilteredListDirectory</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</p>
                          </details>
                        </details>
                        
                        <details>
                        <summary>ListFilesInDirectory</summary>
                        <p><br>  Return a table with the files found in the subdirectory.</p>
                          <details>
                          <summary>/stratagus/script.cpp:2065 CclListFilesInDirectory</summary>
                          <p><div class="highlight"><pre><span></span><span class="k">static</span> <span class="kt">int</span> <span class="nf">CclListFilesInDirectory</span><span class="p">(</span><span class="n">lua_State</span> <span class="o">*</span><span class="n">l</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="n">CclFilteredListDirectory</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mh">0x1</span><span class="p">,</span> <span class="mh">0x1</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</p>
                          </details>
                        </details>
                        
                        <details>
                        <summary>ListDirsInDirectory</summary>
                        <p><br>  Return a table with the files found in the subdirectory.</p>
                          <details>
                          <summary>/stratagus/script.cpp:2073 CclListDirsInDirectory</summary>
                          <p><div class="highlight"><pre><span></span><span class="k">static</span> <span class="kt">int</span> <span class="nf">CclListDirsInDirectory</span><span class="p">(</span><span class="n">lua_State</span> <span class="o">*</span><span class="n">l</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="n">CclFilteredListDirectory</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">,</span> <span class="mh">0x1</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</p>
                          </details>
                        </details>
                        
                        <details>
                        <summary>SetDamageFormula</summary>
                        <p><br>  Set damage computation method.<br><br>  @param l  Lua state.</p>
                          <details>
                          <summary>/stratagus/script.cpp:2089 CclSetDamageFormula</summary>
                          <p><div class="highlight"><pre><span></span><span class="k">static</span> <span class="kt">int</span> <span class="nf">CclSetDamageFormula</span><span class="p">(</span><span class="n">lua_State</span> <span class="o">*</span><span class="n">l</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">Assert</span><span class="p">(</span><span class="n">l</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">Damage</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">FreeNumberDesc</span><span class="p">(</span><span class="n">Damage</span><span class="p">);</span>
		<span class="k">delete</span> <span class="n">Damage</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="n">Damage</span> <span class="o">=</span> <span class="n">CclParseNumberDesc</span><span class="p">(</span><span class="n">l</span><span class="p">);</span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</p>
                          </details>
                        </details>
                        
                        <details>
                        <summary>SavePreferences</summary>
                        <p><br>  Save preferences<br><br>  @param l  Lua state.</p>
                          <details>
                          <summary>/stratagus/script.cpp:273 CclSavePreferences</summary>
                          <p><div class="highlight"><pre><span></span><span class="k">static</span> <span class="kt">int</span> <span class="nf">CclSavePreferences</span><span class="p">(</span><span class="n">lua_State</span> <span class="o">*</span><span class="n">l</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">LuaCheckArgs</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
	<span class="n">SavePreferences</span><span class="p">();</span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</p>
                          </details>
                        </details>
                        
                        <details>
                        <summary>Load</summary>
                        <p><br>  Load a file and execute it.<br><br>  @param l  Lua state.<br><br>  @return   0 in success, else exit.</p>
                          <details>
                          <summary>/stratagus/script.cpp:290 CclLoad</summary>
                          <p><div class="highlight"><pre><span></span><span class="k">static</span> <span class="kt">int</span> <span class="nf">CclLoad</span><span class="p">(</span><span class="n">lua_State</span> <span class="o">*</span><span class="n">l</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">LuaCheckArgs</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
	<span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">filename</span> <span class="o">=</span> <span class="n">LibraryFileName</span><span class="p">(</span><span class="n">LuaToString</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">1</span><span class="p">));</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">LuaLoadFile</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span> <span class="o">==</span> <span class="mi">-1</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">DebugPrint</span><span class="p">(</span><span class="s">&quot;Load failed: %s</span><span class="se">\n</span><span class="s">&quot;</span> <span class="n">_C_</span> <span class="n">filename</span><span class="p">.</span><span class="n">c_str</span><span class="p">());</span>
	<span class="p">}</span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</p>
                          </details>
                        </details>
                        
                        <details>
                        <summary>LoadBuffer</summary>
                        <p><br>  Load a file into a buffer and return it.<br><br>  @param l  Lua state.<br><br>  @return   buffer or nil on failure</p>
                          <details>
                          <summary>/stratagus/script.cpp:310 CclLoadBuffer</summary>
                          <p><div class="highlight"><pre><span></span><span class="k">static</span> <span class="kt">int</span> <span class="nf">CclLoadBuffer</span><span class="p">(</span><span class="n">lua_State</span> <span class="o">*</span><span class="n">l</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">LuaCheckArgs</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
	<span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">file</span> <span class="o">=</span> <span class="n">LibraryFileName</span><span class="p">(</span><span class="n">LuaToString</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">1</span><span class="p">));</span>
	<span class="n">DebugPrint</span><span class="p">(</span><span class="s">&quot;Loading &#39;%s&#39;</span><span class="se">\n</span><span class="s">&quot;</span> <span class="n">_C_</span> <span class="n">file</span><span class="p">.</span><span class="n">c_str</span><span class="p">());</span>
	<span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">content</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">GetFileContent</span><span class="p">(</span><span class="n">file</span><span class="p">,</span> <span class="n">content</span><span class="p">)</span> <span class="o">==</span> <span class="nb">false</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="n">lua_pushstring</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">content</span><span class="p">.</span><span class="n">c_str</span><span class="p">());</span>
	<span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</p>
                          </details>
                        </details>
                        
                        <details>
                        <summary>DebugPrint</summary>
                        <p><br>  Print debug message with info about current script name, line number and function.<br><br>  @see DebugPrint<br><br>  @param l  Lua state.</p>
                          <details>
                          <summary>/stratagus/script.cpp:2110 CclDebugPrint</summary>
                          <p><div class="highlight"><pre><span></span><span class="k">static</span> <span class="kt">int</span> <span class="nf">CclDebugPrint</span><span class="p">(</span><span class="n">lua_State</span> <span class="o">*</span><span class="n">l</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">LuaCheckArgs</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>

<span class="cp">#ifdef DEBUG</span>
	<span class="n">lua_Debug</span> <span class="n">ar</span><span class="p">;</span>
	<span class="n">lua_getstack</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">ar</span><span class="p">);</span>
	<span class="n">lua_getinfo</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="s">&quot;nSl&quot;</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">ar</span><span class="p">);</span>
	<span class="n">fprintf</span><span class="p">(</span><span class="n">stdout</span><span class="p">,</span> <span class="s">&quot;%s:%d: %s: %s&quot;</span><span class="p">,</span> <span class="n">ar</span><span class="p">.</span><span class="n">source</span><span class="p">,</span> <span class="n">ar</span><span class="p">.</span><span class="n">currentline</span><span class="p">,</span> <span class="n">ar</span><span class="p">.</span><span class="n">what</span><span class="p">,</span> <span class="n">LuaToString</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">1</span><span class="p">));</span>
<span class="cp">#endif</span>

	<span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</p>
                          </details>
                        </details>
                        <hr>/stratagus/construct.cpp<hr>
                        <details>
                        <summary>DefineConstruction</summary>
                        <p><br>  Parse the construction.<br><br>  @param l  Lua state.<br><br>  @note make this more flexible</p>
                          <details>
                          <summary>/stratagus/construct.cpp:285 CclDefineConstruction</summary>
                          <p><div class="highlight"><pre><span></span><span class="k">static</span> <span class="kt">int</span> <span class="nf">CclDefineConstruction</span><span class="p">(</span><span class="n">lua_State</span> <span class="o">*</span><span class="n">l</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">LuaCheckArgs</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">2</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">lua_istable</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span> <span class="p">{</span>
		<span class="n">LuaError</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="s">&quot;incorrect argument&quot;</span><span class="p">);</span>
	<span class="p">}</span>

	<span class="c1">// Slot identifier</span>
	<span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">str</span> <span class="o">=</span> <span class="n">LuaToString</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
	<span class="n">CConstruction</span> <span class="o">*</span><span class="n">construction</span> <span class="o">=</span> <span class="n">ConstructionByIdent</span><span class="p">(</span><span class="n">str</span><span class="p">);</span>
	<span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">CConstruction</span> <span class="o">*&gt;::</span><span class="n">iterator</span> <span class="n">i</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">construction</span> <span class="o">==</span> <span class="nb">NULL</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">construction</span> <span class="o">=</span> <span class="k">new</span> <span class="n">CConstruction</span><span class="p">;</span>
		<span class="n">Constructions</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">construction</span><span class="p">);</span>
	<span class="p">}</span> <span class="k">else</span> <span class="p">{</span> <span class="c1">// redefine completely.</span>
		<span class="n">construction</span><span class="o">-&gt;</span><span class="n">Clean</span><span class="p">();</span>
	<span class="p">}</span>
	<span class="n">construction</span><span class="o">-&gt;</span><span class="n">Ident</span> <span class="o">=</span> <span class="n">str</span><span class="p">;</span>

	<span class="c1">//  Parse the arguments, in tagged format.</span>
	<span class="n">lua_pushnil</span><span class="p">(</span><span class="n">l</span><span class="p">);</span>
	<span class="k">while</span> <span class="p">(</span><span class="n">lua_next</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span> <span class="p">{</span>
		<span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">value</span> <span class="o">=</span> <span class="n">LuaToString</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">-2</span><span class="p">);</span>
		<span class="kt">bool</span> <span class="n">files</span> <span class="o">=</span> <span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s">&quot;Files&quot;</span><span class="p">);</span>

		<span class="k">if</span> <span class="p">(</span><span class="n">files</span> <span class="o">||</span> <span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s">&quot;ShadowFiles&quot;</span><span class="p">))</span> <span class="p">{</span>
			<span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">file</span><span class="p">;</span>
			<span class="kt">int</span> <span class="n">w</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
			<span class="kt">int</span> <span class="n">h</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

			<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">lua_istable</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">-1</span><span class="p">))</span> <span class="p">{</span>
				<span class="n">LuaError</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="s">&quot;incorrect argument&quot;</span><span class="p">);</span>
			<span class="p">}</span>
			<span class="n">lua_pushnil</span><span class="p">(</span><span class="n">l</span><span class="p">);</span>
			<span class="k">while</span> <span class="p">(</span><span class="n">lua_next</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">-2</span><span class="p">))</span> <span class="p">{</span>
				<span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">value</span> <span class="o">=</span> <span class="n">LuaToString</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">-2</span><span class="p">);</span>

				<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s">&quot;File&quot;</span><span class="p">))</span> <span class="p">{</span>
					<span class="n">file</span> <span class="o">=</span> <span class="n">LuaToString</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">-1</span><span class="p">);</span>
				<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s">&quot;Size&quot;</span><span class="p">))</span> <span class="p">{</span>
					<span class="n">CclGetPos</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">w</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">h</span><span class="p">);</span>
				<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
					<span class="n">LuaError</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="s">&quot;Unsupported tag: %s&quot;</span> <span class="n">_C_</span> <span class="n">value</span><span class="p">);</span>
				<span class="p">}</span>
				<span class="n">lua_pop</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
			<span class="p">}</span>
			<span class="k">if</span> <span class="p">(</span><span class="n">files</span><span class="p">)</span> <span class="p">{</span>
				<span class="n">construction</span><span class="o">-&gt;</span><span class="n">File</span><span class="p">.</span><span class="n">File</span> <span class="o">=</span> <span class="n">file</span><span class="p">;</span>
				<span class="n">construction</span><span class="o">-&gt;</span><span class="n">File</span><span class="p">.</span><span class="n">Width</span> <span class="o">=</span> <span class="n">w</span><span class="p">;</span>
				<span class="n">construction</span><span class="o">-&gt;</span><span class="n">File</span><span class="p">.</span><span class="n">Height</span> <span class="o">=</span> <span class="n">h</span><span class="p">;</span>
			<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
				<span class="n">construction</span><span class="o">-&gt;</span><span class="n">ShadowFile</span><span class="p">.</span><span class="n">File</span> <span class="o">=</span> <span class="n">file</span><span class="p">;</span>
				<span class="n">construction</span><span class="o">-&gt;</span><span class="n">ShadowFile</span><span class="p">.</span><span class="n">Width</span> <span class="o">=</span> <span class="n">w</span><span class="p">;</span>
				<span class="n">construction</span><span class="o">-&gt;</span><span class="n">ShadowFile</span><span class="p">.</span><span class="n">Height</span> <span class="o">=</span> <span class="n">h</span><span class="p">;</span>
			<span class="p">}</span>
		<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s">&quot;Constructions&quot;</span><span class="p">))</span> <span class="p">{</span>
			<span class="k">const</span> <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">subargs</span> <span class="o">=</span> <span class="n">lua_rawlen</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">-1</span><span class="p">);</span>

			<span class="k">for</span> <span class="p">(</span><span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">k</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">k</span> <span class="o">&lt;</span> <span class="n">subargs</span><span class="p">;</span> <span class="o">++</span><span class="n">k</span><span class="p">)</span> <span class="p">{</span>
				<span class="kt">int</span> <span class="n">percent</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
				<span class="n">ConstructionFileType</span> <span class="n">file</span> <span class="o">=</span> <span class="n">ConstructionFileConstruction</span><span class="p">;</span>
				<span class="kt">int</span> <span class="n">frame</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

				<span class="n">lua_rawgeti</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">-1</span><span class="p">,</span> <span class="n">k</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>
				<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">lua_istable</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">-1</span><span class="p">))</span> <span class="p">{</span>
					<span class="n">LuaError</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="s">&quot;incorrect argument&quot;</span><span class="p">);</span>
				<span class="p">}</span>
				<span class="n">lua_pushnil</span><span class="p">(</span><span class="n">l</span><span class="p">);</span>
				<span class="k">while</span> <span class="p">(</span><span class="n">lua_next</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">-2</span><span class="p">))</span> <span class="p">{</span>
					<span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">value</span> <span class="o">=</span> <span class="n">LuaToString</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">-2</span><span class="p">);</span>

					<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s">&quot;Percent&quot;</span><span class="p">))</span> <span class="p">{</span>
						<span class="n">percent</span> <span class="o">=</span> <span class="n">LuaToNumber</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">-1</span><span class="p">);</span>
					<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s">&quot;File&quot;</span><span class="p">))</span> <span class="p">{</span>
						<span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">value</span> <span class="o">=</span> <span class="n">LuaToString</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">-1</span><span class="p">);</span>

						<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s">&quot;construction&quot;</span><span class="p">))</span> <span class="p">{</span>
							<span class="n">file</span> <span class="o">=</span> <span class="n">ConstructionFileConstruction</span><span class="p">;</span>
						<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s">&quot;main&quot;</span><span class="p">))</span> <span class="p">{</span>
							<span class="n">file</span> <span class="o">=</span> <span class="n">ConstructionFileMain</span><span class="p">;</span>
						<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
							<span class="n">LuaError</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="s">&quot;Unsupported tag: %s&quot;</span> <span class="n">_C_</span> <span class="n">value</span><span class="p">);</span>
						<span class="p">}</span>
					<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s">&quot;Frame&quot;</span><span class="p">))</span> <span class="p">{</span>
						<span class="n">frame</span> <span class="o">=</span> <span class="n">LuaToNumber</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">-1</span><span class="p">);</span>
					<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
						<span class="n">LuaError</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="s">&quot;Unsupported tag: %s&quot;</span> <span class="n">_C_</span> <span class="n">value</span><span class="p">);</span>
					<span class="p">}</span>
					<span class="n">lua_pop</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
				<span class="p">}</span>
				<span class="n">lua_pop</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
				<span class="n">CConstructionFrame</span> <span class="o">**</span><span class="n">cframe</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">construction</span><span class="o">-&gt;</span><span class="n">Frames</span><span class="p">;</span>
				<span class="k">while</span> <span class="p">(</span><span class="o">*</span><span class="n">cframe</span><span class="p">)</span> <span class="p">{</span>
					<span class="n">cframe</span> <span class="o">=</span> <span class="o">&amp;</span><span class="p">((</span><span class="o">*</span><span class="n">cframe</span><span class="p">)</span><span class="o">-&gt;</span><span class="n">Next</span><span class="p">);</span>
				<span class="p">}</span>
				<span class="p">(</span><span class="o">*</span><span class="n">cframe</span><span class="p">)</span> <span class="o">=</span> <span class="k">new</span> <span class="n">CConstructionFrame</span><span class="p">;</span>
				<span class="p">(</span><span class="o">*</span><span class="n">cframe</span><span class="p">)</span><span class="o">-&gt;</span><span class="n">Percent</span> <span class="o">=</span> <span class="n">percent</span><span class="p">;</span>
				<span class="p">(</span><span class="o">*</span><span class="n">cframe</span><span class="p">)</span><span class="o">-&gt;</span><span class="n">File</span> <span class="o">=</span> <span class="n">file</span><span class="p">;</span>
				<span class="p">(</span><span class="o">*</span><span class="n">cframe</span><span class="p">)</span><span class="o">-&gt;</span><span class="n">Frame</span> <span class="o">=</span> <span class="n">frame</span><span class="p">;</span>
				<span class="p">(</span><span class="o">*</span><span class="n">cframe</span><span class="p">)</span><span class="o">-&gt;</span><span class="n">Next</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">;</span>
			<span class="p">}</span>
		<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
			<span class="n">LuaError</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="s">&quot;Unsupported tag: %s&quot;</span> <span class="n">_C_</span> <span class="n">value</span><span class="p">);</span>
		<span class="p">}</span>
		<span class="n">lua_pop</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
	<span class="p">}</span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</p>
                          </details>
                        </details>
                        <hr>/stratagus/selection.cpp<hr>
                        <details>
                        <summary>SetGroupId</summary>
                        <p><br>  Set the current group id. (Needed for load/save)<br><br>  @param l  Lua state.</p>
                          <details>
                          <summary>/stratagus/selection.cpp:1120 CclSetGroupId</summary>
                          <p><div class="highlight"><pre><span></span><span class="k">static</span> <span class="kt">int</span> <span class="nf">CclSetGroupId</span><span class="p">(</span><span class="n">lua_State</span> <span class="o">*</span><span class="n">l</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">int</span> <span class="n">old</span><span class="p">;</span>

	<span class="n">LuaCheckArgs</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
	<span class="n">old</span> <span class="o">=</span> <span class="n">GroupId</span><span class="p">;</span>
	<span class="n">GroupId</span> <span class="o">=</span> <span class="n">LuaToNumber</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>

	<span class="n">lua_pushnumber</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">old</span><span class="p">);</span>
	<span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</p>
                          </details>
                        </details>
                        
                        <details>
                        <summary>Selection</summary>
                        <p><br>  Define the current selection.<br><br>  @param l  Lua state.</p>
                          <details>
                          <summary>/stratagus/selection.cpp:1140 CclSelection</summary>
                          <p><div class="highlight"><pre><span></span><span class="k">static</span> <span class="kt">int</span> <span class="nf">CclSelection</span><span class="p">(</span><span class="n">lua_State</span> <span class="o">*</span><span class="n">l</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">LuaCheckArgs</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">2</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">lua_istable</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span> <span class="p">{</span>
		<span class="n">LuaError</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="s">&quot;incorrect argument&quot;</span><span class="p">);</span>
	<span class="p">}</span>
	<span class="c1">//NumSelected = LuaToNumber(l, 1);</span>
	<span class="k">const</span> <span class="kt">int</span> <span class="n">args</span> <span class="o">=</span> <span class="n">lua_rawlen</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">2</span><span class="p">);</span>
	<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="n">args</span><span class="p">;</span> <span class="o">++</span><span class="n">j</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">str</span> <span class="o">=</span> <span class="n">LuaToString</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>
		<span class="n">Selected</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="o">&amp;</span><span class="n">UnitManager</span><span class="p">.</span><span class="n">GetSlotUnit</span><span class="p">(</span><span class="n">strtol</span><span class="p">(</span><span class="n">str</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="mi">16</span><span class="p">)));</span>
	<span class="p">}</span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</p>
                          </details>
                        </details>
                        <hr>/stratagus/groups.cpp<hr>
                        <details>
                        <summary>Group</summary>
                        <p><br>  Define the group.<br><br>  @param l  Lua state.</p>
                          <details>
                          <summary>/stratagus/groups.cpp:265 CclGroup</summary>
                          <p><div class="highlight"><pre><span></span><span class="k">static</span> <span class="kt">int</span> <span class="nf">CclGroup</span><span class="p">(</span><span class="n">lua_State</span> <span class="o">*</span><span class="n">l</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">LuaCheckArgs</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">3</span><span class="p">);</span>

	<span class="k">const</span> <span class="kt">int</span> <span class="n">grpNum</span> <span class="o">=</span> <span class="n">LuaToNumber</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">NUM_GROUPS</span> <span class="o">&lt;=</span> <span class="n">grpNum</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">LuaError</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="s">&quot;grpIndex out of bound&quot;</span><span class="p">);</span>
	<span class="p">}</span>
	<span class="n">CUnitGroup</span> <span class="o">&amp;</span><span class="n">grp</span> <span class="o">=</span> <span class="n">Groups</span><span class="p">[</span><span class="n">grpNum</span><span class="p">];</span>
	<span class="n">grp</span><span class="p">.</span><span class="n">init</span><span class="p">();</span>
	<span class="c1">//grp.Units.size() = LuaToNumber(l, 2);</span>
	<span class="k">const</span> <span class="kt">int</span> <span class="n">args</span> <span class="o">=</span> <span class="n">lua_rawlen</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">3</span><span class="p">);</span>
	<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="n">args</span><span class="p">;</span> <span class="o">++</span><span class="n">j</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">str</span> <span class="o">=</span> <span class="n">LuaToString</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="n">j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>
		<span class="n">grp</span><span class="p">.</span><span class="n">add</span><span class="p">(</span><span class="n">UnitManager</span><span class="p">.</span><span class="n">GetSlotUnit</span><span class="p">(</span><span class="n">strtol</span><span class="p">(</span><span class="n">str</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="mi">16</span><span class="p">)),</span> <span class="n">grpNum</span><span class="p">);</span>
	<span class="p">}</span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</p>
                          </details>
                        </details>
                        <hr>/stratagus/script_player.cpp<hr>
                        <details>
                        <summary>Player</summary>
                        <p><br>  Parse the player configuration.<br><br>  @param l  Lua state.</p>
                          <details>
                          <summary>/stratagus/script_player.cpp:90 CclPlayer</summary>
                          <p><div class="highlight"><pre><span></span><span class="k">static</span> <span class="kt">int</span> <span class="nf">CclPlayer</span><span class="p">(</span><span class="n">lua_State</span> <span class="o">*</span><span class="n">l</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="n">LuaToNumber</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>

	<span class="n">CPlayer</span> <span class="o">&amp;</span><span class="n">player</span> <span class="o">=</span> <span class="n">Players</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
	<span class="n">player</span><span class="p">.</span><span class="n">Index</span> <span class="o">=</span> <span class="n">i</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">NumPlayers</span> <span class="o">&lt;=</span> <span class="n">i</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">NumPlayers</span> <span class="o">=</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="n">player</span><span class="p">.</span><span class="n">Load</span><span class="p">(</span><span class="n">l</span><span class="p">);</span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</p>
                          </details>
                        </details>
                        
                        <details>
                        <summary>ChangeUnitsOwner</summary>
                        <p><br> <b>Description</b><br><br>  Change unit owner<br><br>  @param l  Lua state.<br><br> Example:<br><br> <div class="example"><code>-- Changes the unit owner from player 0 to player 1<br>		ChangeUnitsOwner({16, 17},{30, 32},0,1)</code></div><br></p>
                          <details>
                          <summary>/stratagus/script_player.cpp:367 CclChangeUnitsOwner</summary>
                          <p><div class="highlight"><pre><span></span><span class="k">static</span> <span class="kt">int</span> <span class="nf">CclChangeUnitsOwner</span><span class="p">(</span><span class="n">lua_State</span> <span class="o">*</span><span class="n">l</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">LuaCheckArgs</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">4</span><span class="p">);</span>

	<span class="n">Vec2i</span> <span class="n">pos1</span><span class="p">;</span>
	<span class="n">Vec2i</span> <span class="n">pos2</span><span class="p">;</span>
	<span class="n">CclGetPos</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">pos1</span><span class="p">.</span><span class="n">x</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">pos1</span><span class="p">.</span><span class="n">y</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
	<span class="n">CclGetPos</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">pos2</span><span class="p">.</span><span class="n">x</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">pos2</span><span class="p">.</span><span class="n">y</span><span class="p">,</span> <span class="mi">2</span><span class="p">);</span>
	<span class="k">const</span> <span class="kt">int</span> <span class="n">oldp</span> <span class="o">=</span> <span class="n">LuaToNumber</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">3</span><span class="p">);</span>
	<span class="k">const</span> <span class="kt">int</span> <span class="n">newp</span> <span class="o">=</span> <span class="n">LuaToNumber</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">4</span><span class="p">);</span>
	<span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">CUnit</span> <span class="o">*&gt;</span> <span class="n">table</span><span class="p">;</span>

	<span class="n">Select</span><span class="p">(</span><span class="n">pos1</span><span class="p">,</span> <span class="n">pos2</span><span class="p">,</span> <span class="n">table</span><span class="p">,</span> <span class="n">HasSamePlayerAs</span><span class="p">(</span><span class="n">Players</span><span class="p">[</span><span class="n">oldp</span><span class="p">]));</span>
	<span class="k">for</span> <span class="p">(</span><span class="kt">size_t</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">!=</span> <span class="n">table</span><span class="p">.</span><span class="n">size</span><span class="p">();</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">table</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">-&gt;</span><span class="n">ChangeOwner</span><span class="p">(</span><span class="n">Players</span><span class="p">[</span><span class="n">newp</span><span class="p">]);</span>
	<span class="p">}</span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</p>
                          </details>
                        </details>
                        
                        <details>
                        <summary>GetThisPlayer</summary>
                        <p><br> <b>Description</b><br><br>  Get ThisPlayer.<br><br>  @param l  Lua state.<br><br> Example:<br><br> <div class="example"><code>GetThisPlayer()</code></div></p>
                          <details>
                          <summary>/stratagus/script_player.cpp:389 CclGetThisPlayer</summary>
                          <p><div class="highlight"><pre><span></span><span class="k">static</span> <span class="kt">int</span> <span class="nf">CclGetThisPlayer</span><span class="p">(</span><span class="n">lua_State</span> <span class="o">*</span><span class="n">l</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">LuaCheckArgs</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">ThisPlayer</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">lua_pushnumber</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">ThisPlayer</span> <span class="o">-</span> <span class="n">Players</span><span class="p">);</span>
	<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
		<span class="n">lua_pushnumber</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
	<span class="p">}</span>
	<span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</p>
                          </details>
                        </details>
                        
                        <details>
                        <summary>SetThisPlayer</summary>
                        <p><br> <b>Description</b><br><br>  Set ThisPlayer.<br><br>  @param l  Lua state.</p>
                          <details>
                          <summary>/stratagus/script_player.cpp:406 CclSetThisPlayer</summary>
                          <p><div class="highlight"><pre><span></span><span class="k">static</span> <span class="kt">int</span> <span class="nf">CclSetThisPlayer</span><span class="p">(</span><span class="n">lua_State</span> <span class="o">*</span><span class="n">l</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">LuaCheckArgs</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
	<span class="kt">int</span> <span class="n">plynr</span> <span class="o">=</span> <span class="n">LuaToNumber</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
	<span class="n">ThisPlayer</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">Players</span><span class="p">[</span><span class="n">plynr</span><span class="p">];</span>

	<span class="n">lua_pushnumber</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">plynr</span><span class="p">);</span>
	<span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</p>
                          </details>
                        </details>
                        
                        <details>
                        <summary>SetMaxSelectable</summary>
                        <p><br> <b>Description</b><br><br>  Set the maximum amount of units that can be selected.<br><br>  @param l  Lua state.<br><br> Example:<br><br> <div class="example"><code>-- 9 units can be selected together.<br>		  SetMaxSelectable(9)<br>		  -- 18 units can be selected together.<br>		  SetMaxSelectable(18)<br>		  -- 50 units can be selected together.<br>		  SetMaxSelectable(50)</code></div></p>
                          <details>
                          <summary>/stratagus/script_player.cpp:431 CclSetMaxSelectable</summary>
                          <p><div class="highlight"><pre><span></span><span class="k">static</span> <span class="kt">int</span> <span class="nf">CclSetMaxSelectable</span><span class="p">(</span><span class="n">lua_State</span> <span class="o">*</span><span class="n">l</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">LuaCheckArgs</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
	<span class="n">MaxSelectable</span> <span class="o">=</span> <span class="n">LuaToNumber</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>

	<span class="n">lua_pushnumber</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">MaxSelectable</span><span class="p">);</span>
	<span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</p>
                          </details>
                        </details>
                        
                        <details>
                        <summary>SetAllPlayersUnitLimit</summary>
                        <p><br> <b>Description</b><br><br>  Set players units limit.<br><br>  @param l  Lua state.<br><br> Example:<br><br> <div class="example"><code>SetAllPlayersUnitLimit(200)</code></div></p>
                          <details>
                          <summary>/stratagus/script_player.cpp:453 CclSetAllPlayersUnitLimit</summary>
                          <p><div class="highlight"><pre><span></span><span class="k">static</span> <span class="kt">int</span> <span class="nf">CclSetAllPlayersUnitLimit</span><span class="p">(</span><span class="n">lua_State</span> <span class="o">*</span><span class="n">l</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">LuaCheckArgs</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
	<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">PlayerMax</span><span class="p">;</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">Players</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">UnitLimit</span> <span class="o">=</span> <span class="n">LuaToNumber</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
	<span class="p">}</span>

	<span class="n">lua_pushnumber</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">lua_tonumber</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">1</span><span class="p">));</span>
	<span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</p>
                          </details>
                        </details>
                        
                        <details>
                        <summary>SetAllPlayersBuildingLimit</summary>
                        <p><br> <b>Description</b><br><br>  Set players buildings limit.<br><br>  @param l  Lua state.<br><br> Example:<br><br> <div class="example"><code>SetAllPlayersBuildingLimit(200)</code></div></p>
                          <details>
                          <summary>/stratagus/script_player.cpp:475 CclSetAllPlayersBuildingLimit</summary>
                          <p><div class="highlight"><pre><span></span><span class="k">static</span> <span class="kt">int</span> <span class="nf">CclSetAllPlayersBuildingLimit</span><span class="p">(</span><span class="n">lua_State</span> <span class="o">*</span><span class="n">l</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">LuaCheckArgs</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
	<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">PlayerMax</span><span class="p">;</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">Players</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">BuildingLimit</span> <span class="o">=</span> <span class="n">LuaToNumber</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
	<span class="p">}</span>

	<span class="n">lua_pushnumber</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">lua_tonumber</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">1</span><span class="p">));</span>
	<span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</p>
                          </details>
                        </details>
                        
                        <details>
                        <summary>SetAllPlayersTotalUnitLimit</summary>
                        <p><br> <b>Description</b><br><br>  Set players total units limit.<br><br>  @param l  Lua state.<br><br> Example:<br><br> <div class="example"><code>SetAllPlayersTotalUnitLimit(400)</code></div></p>
                          <details>
                          <summary>/stratagus/script_player.cpp:497 CclSetAllPlayersTotalUnitLimit</summary>
                          <p><div class="highlight"><pre><span></span><span class="k">static</span> <span class="kt">int</span> <span class="nf">CclSetAllPlayersTotalUnitLimit</span><span class="p">(</span><span class="n">lua_State</span> <span class="o">*</span><span class="n">l</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">LuaCheckArgs</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
	<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">PlayerMax</span><span class="p">;</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">Players</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">TotalUnitLimit</span> <span class="o">=</span> <span class="n">LuaToNumber</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
	<span class="p">}</span>

	<span class="n">lua_pushnumber</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">lua_tonumber</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">1</span><span class="p">));</span>
	<span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</p>
                          </details>
                        </details>
                        
                        <details>
                        <summary>SetDiplomacy</summary>
                        <p><br> <b>Description</b><br><br>  Change the diplomacy from player to another player.<br><br>  @param l  Lua state.<br><br>  @return FIXME: should return old state.<br><br> Example:<br><br> <div class="example"><code>SetDiplomacy(0,"allied",1)<br>		SetDiplomacy(1,"allied",0)<br>		<br>		SetDiplomacy(0,"enemy",2)<br>		SetDiplomacy(1,"enemy",2)</code></div></p>
                          <details>
                          <summary>/stratagus/script_player.cpp:533 CclSetDiplomacy</summary>
                          <p><div class="highlight"><pre><span></span><span class="k">static</span> <span class="kt">int</span> <span class="nf">CclSetDiplomacy</span><span class="p">(</span><span class="n">lua_State</span> <span class="o">*</span><span class="n">l</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">LuaCheckArgs</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">3</span><span class="p">);</span>
	<span class="k">const</span> <span class="kt">int</span> <span class="n">base</span> <span class="o">=</span> <span class="n">LuaToNumber</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
	<span class="k">const</span> <span class="kt">int</span> <span class="n">plynr</span> <span class="o">=</span> <span class="n">LuaToNumber</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">3</span><span class="p">);</span>
	<span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">state</span> <span class="o">=</span> <span class="n">LuaToString</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">2</span><span class="p">);</span>

	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="s">&quot;allied&quot;</span><span class="p">))</span> <span class="p">{</span>
		<span class="n">SendCommandDiplomacy</span><span class="p">(</span><span class="n">base</span><span class="p">,</span> <span class="n">DiplomacyAllied</span><span class="p">,</span> <span class="n">plynr</span><span class="p">);</span>
	<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="s">&quot;neutral&quot;</span><span class="p">))</span> <span class="p">{</span>
		<span class="n">SendCommandDiplomacy</span><span class="p">(</span><span class="n">base</span><span class="p">,</span> <span class="n">DiplomacyNeutral</span><span class="p">,</span> <span class="n">plynr</span><span class="p">);</span>
	<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="s">&quot;crazy&quot;</span><span class="p">))</span> <span class="p">{</span>
		<span class="n">SendCommandDiplomacy</span><span class="p">(</span><span class="n">base</span><span class="p">,</span> <span class="n">DiplomacyCrazy</span><span class="p">,</span> <span class="n">plynr</span><span class="p">);</span>
	<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="s">&quot;enemy&quot;</span><span class="p">))</span> <span class="p">{</span>
		<span class="n">SendCommandDiplomacy</span><span class="p">(</span><span class="n">base</span><span class="p">,</span> <span class="n">DiplomacyEnemy</span><span class="p">,</span> <span class="n">plynr</span><span class="p">);</span>
	<span class="p">}</span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</p>
                          </details>
                        </details>
                        
                        <details>
                        <summary>Diplomacy</summary>
                        <p><br>  Change the diplomacy from ThisPlayer to another player.<br><br>  @param l  Lua state.</p>
                          <details>
                          <summary>/stratagus/script_player.cpp:545 CclDiplomacy</summary>
                          <p><div class="highlight"><pre><span></span><span class="k">static</span> <span class="kt">int</span> <span class="nf">CclDiplomacy</span><span class="p">(</span><span class="n">lua_State</span> <span class="o">*</span><span class="n">l</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">lua_pushnumber</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">ThisPlayer</span><span class="o">-&gt;</span><span class="n">Index</span><span class="p">);</span>
	<span class="n">lua_insert</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
	<span class="k">return</span> <span class="n">CclSetDiplomacy</span><span class="p">(</span><span class="n">l</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</p>
                          </details>
                        </details>
                        
                        <details>
                        <summary>SetSharedVision</summary>
                        <p><br> <b>Description</b><br><br>  Change the shared vision from player to another player.<br><br><br>  @param l  Lua state.<br><br>  @return FIXME: should return old state.<br><br> Example:<br><br> <div class="example"><code>SetSharedVision(0,true,1)<br>		SetSharedVision(1,true,0)<br>		<br>		SetSharedVision(0,false,2)<br>		SetSharedVision(1,false,2)</code></div></p>
                          <details>
                          <summary>/stratagus/script_player.cpp:576 CclSetSharedVision</summary>
                          <p><div class="highlight"><pre><span></span><span class="k">static</span> <span class="kt">int</span> <span class="nf">CclSetSharedVision</span><span class="p">(</span><span class="n">lua_State</span> <span class="o">*</span><span class="n">l</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">LuaCheckArgs</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">3</span><span class="p">);</span>

	<span class="k">const</span> <span class="kt">int</span> <span class="n">base</span> <span class="o">=</span> <span class="n">LuaToNumber</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
	<span class="k">const</span> <span class="kt">bool</span> <span class="n">shared</span> <span class="o">=</span> <span class="n">LuaToBoolean</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">2</span><span class="p">);</span>
	<span class="k">const</span> <span class="kt">int</span> <span class="n">plynr</span> <span class="o">=</span> <span class="n">LuaToNumber</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">3</span><span class="p">);</span>

	<span class="n">SendCommandSharedVision</span><span class="p">(</span><span class="n">base</span><span class="p">,</span> <span class="n">shared</span><span class="p">,</span> <span class="n">plynr</span><span class="p">);</span>

	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</p>
                          </details>
                        </details>
                        
                        <details>
                        <summary>SharedVision</summary>
                        <p><br>  Change the shared vision from ThisPlayer to another player.<br><br>  @param l  Lua state.</p>
                          <details>
                          <summary>/stratagus/script_player.cpp:588 CclSharedVision</summary>
                          <p><div class="highlight"><pre><span></span><span class="k">static</span> <span class="kt">int</span> <span class="nf">CclSharedVision</span><span class="p">(</span><span class="n">lua_State</span> <span class="o">*</span><span class="n">l</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">lua_pushnumber</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">ThisPlayer</span><span class="o">-&gt;</span><span class="n">Index</span><span class="p">);</span>
	<span class="n">lua_insert</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
	<span class="k">return</span> <span class="n">CclSetSharedVision</span><span class="p">(</span><span class="n">l</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</p>
                          </details>
                        </details>
                        
                        <details>
                        <summary>SetRevelationType</summary>
                        <p><br> <b>Description</b><br><br>  Change the players revelation type - reveal all units, only buidings or don't reveal anything<br><br>  @param l  Lua state.<br><br> Example:<br><br> <div class="example"><code>SetRevelationType("no-revelation")<br> 		SetRevelationType("buildings-only")<br> 		SetRevelationType("all-units")</code></div><br></p>
                          <details>
                          <summary>/stratagus/script_player.cpp:621 CclSetRevelationType</summary>
                          <p><div class="highlight"><pre><span></span><span class="k">static</span> <span class="kt">int</span> <span class="nf">CclSetRevelationType</span><span class="p">(</span><span class="n">lua_State</span> <span class="o">*</span><span class="n">l</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">LuaCheckArgs</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>

	<span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">revel_type</span> <span class="o">=</span> <span class="n">LuaToString</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">revel_type</span><span class="p">,</span> <span class="s">&quot;no-revelation&quot;</span><span class="p">))</span> <span class="p">{</span>
		<span class="n">CPlayer</span><span class="o">::</span><span class="n">SetRevelationType</span><span class="p">(</span><span class="n">RevealTypes</span><span class="o">::</span><span class="n">cNoRevelation</span><span class="p">);</span>
	<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">revel_type</span><span class="p">,</span> <span class="s">&quot;all-units&quot;</span><span class="p">))</span> <span class="p">{</span>
		<span class="n">CPlayer</span><span class="o">::</span><span class="n">SetRevelationType</span><span class="p">(</span><span class="n">RevealTypes</span><span class="o">::</span><span class="n">cAllUnits</span><span class="p">);</span>
	<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">revel_type</span><span class="p">,</span> <span class="s">&quot;buildings-only&quot;</span><span class="p">))</span> <span class="p">{</span>
		<span class="n">CPlayer</span><span class="o">::</span><span class="n">SetRevelationType</span><span class="p">(</span><span class="n">RevealTypes</span><span class="o">::</span><span class="n">cBuildingsOnly</span><span class="p">);</span>
	<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
		<span class="n">PrintFunction</span><span class="p">();</span>
		<span class="n">fprintf</span><span class="p">(</span><span class="n">stdout</span><span class="p">,</span> <span class="s">&quot;Accessible types of revelation </span><span class="se">\&quot;</span><span class="s">no-revelation</span><span class="se">\&quot;</span><span class="s">, </span><span class="se">\&quot;</span><span class="s">all-units</span><span class="se">\&quot;</span><span class="s"> and </span><span class="se">\&quot;</span><span class="s">buildings-only</span><span class="se">\&quot;</span><span class="s">.</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
		<span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</p>
                          </details>
                        </details>
                        
                        <details>
                        <summary>DefineRaceNames</summary>
                        <p><br> Define race names<br><br> @param l Lua state.</p>
                          <details>
                          <summary>/stratagus/script_player.cpp:672 CclDefineRaceNames</summary>
                          <p><div class="highlight"><pre><span></span><span class="k">static</span> <span class="kt">int</span> <span class="nf">CclDefineRaceNames</span><span class="p">(</span><span class="n">lua_State</span> <span class="o">*</span><span class="n">l</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">PlayerRaces</span><span class="p">.</span><span class="n">Clean</span><span class="p">();</span>
	<span class="k">return</span> <span class="n">CclDefineNewRaceNames</span><span class="p">(</span><span class="n">l</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</p>
                          </details>
                        </details>
                        
                        <details>
                        <summary>DefineNewRaceNames</summary>
                        <p><br> Define race names<br><br> @param l Lua state.</p>
                          <details>
                          <summary>/stratagus/script_player.cpp:672 CclDefineRaceNames</summary>
                          <p><div class="highlight"><pre><span></span><span class="k">static</span> <span class="kt">int</span> <span class="nf">CclDefineRaceNames</span><span class="p">(</span><span class="n">lua_State</span> <span class="o">*</span><span class="n">l</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">PlayerRaces</span><span class="p">.</span><span class="n">Clean</span><span class="p">();</span>
	<span class="k">return</span> <span class="n">CclDefineNewRaceNames</span><span class="p">(</span><span class="n">l</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</p>
                          </details>
                        </details>
                        
                        <details>
                        <summary>DefinePlayerColors</summary>
                        <p><br> <b>Description</b><br><br>  Define player colors<br><br>  @param l  Lua state.<br><br> Example:<br><br> <div class="example"><code>DefinePlayerColors({<br>		"red", {{164, 0, 0}, {124, 0, 0}, {92, 4, 0}, {68, 4, 0}},<br>		"blue", {{12, 72, 204}, {4, 40, 160}, {0, 20, 116}, {0, 4, 76}},<br>		"green", {{44, 180, 148}, {20, 132, 92}, {4, 84, 44}, {0, 40, 12}},<br>		"violet", {{152, 72, 176}, {116, 44, 132}, {80, 24, 88}, {44, 8, 44}},<br>		"orange", {{248, 140, 20}, {200, 96, 16}, {152, 60, 16}, {108, 32, 12}},<br>		"black", {{40, 40, 60}, {28, 28, 44}, {20, 20, 32}, {12, 12, 20}},<br>		"white", {{224, 224, 224}, {152, 152, 180}, {84, 84, 128}, {36, 40, 76}},<br>		"yellow", {{252, 252, 72}, {228, 204, 40}, {204, 160, 16}, {180, 116, 0}},<br>		"red", {{164, 0, 0}, {124, 0, 0}, {92, 4, 0}, {68, 4, 0}},<br>		"blue", {{12, 72, 204}, {4, 40, 160}, {0, 20, 116}, {0, 4, 76}},<br>		"green", {{44, 180, 148}, {20, 132, 92}, {4, 84, 44}, {0, 40, 12}},<br>		"violet", {{152, 72, 176}, {116, 44, 132}, {80, 24, 88}, {44, 8, 44}},<br>		"orange", {{248, 140, 20}, {200, 96, 16}, {152, 60, 16}, {108, 32, 12}},<br>		"black", {{40, 40, 60}, {28, 28, 44}, {20, 20, 32}, {12, 12, 20}},<br>		"white", {{224, 224, 224}, {152, 152, 180}, {84, 84, 128}, {36, 40, 76}},<br>		"yellow", {{252, 252, 72}, {228, 204, 40}, {204, 160, 16}, {180, 116, 0}},<br>	})</code></div></p>
                          <details>
                          <summary>/stratagus/script_player.cpp:729 CclDefinePlayerColors</summary>
                          <p><div class="highlight"><pre><span></span><span class="k">static</span> <span class="kt">int</span> <span class="nf">CclDefinePlayerColors</span><span class="p">(</span><span class="n">lua_State</span> <span class="o">*</span><span class="n">l</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">LuaCheckArgs</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">lua_istable</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span> <span class="p">{</span>
		<span class="n">LuaError</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="s">&quot;incorrect argument&quot;</span><span class="p">);</span>
	<span class="p">}</span>

	<span class="k">const</span> <span class="kt">int</span> <span class="n">args</span> <span class="o">=</span> <span class="n">lua_rawlen</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
	<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">args</span><span class="p">;</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">PlayerColorNames</span><span class="p">[</span><span class="n">i</span> <span class="o">/</span> <span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">LuaToString</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>
		<span class="o">++</span><span class="n">i</span><span class="p">;</span>
		<span class="n">lua_rawgeti</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>
		<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">lua_istable</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">-1</span><span class="p">))</span> <span class="p">{</span>
			<span class="n">LuaError</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="s">&quot;incorrect argument&quot;</span><span class="p">);</span>
		<span class="p">}</span>
		<span class="k">const</span> <span class="kt">int</span> <span class="n">numcolors</span> <span class="o">=</span> <span class="n">lua_rawlen</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">-1</span><span class="p">);</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">numcolors</span> <span class="o">!=</span> <span class="n">PlayerColorIndexCount</span><span class="p">)</span> <span class="p">{</span>
			<span class="n">LuaError</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="s">&quot;You should use %d colors (See DefinePlayerColorIndex())&quot;</span> <span class="n">_C_</span> <span class="n">PlayerColorIndexCount</span><span class="p">);</span>
		<span class="p">}</span>
		<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="n">numcolors</span><span class="p">;</span> <span class="o">++</span><span class="n">j</span><span class="p">)</span> <span class="p">{</span>
			<span class="n">lua_rawgeti</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">-1</span><span class="p">,</span> <span class="n">j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>
			<span class="n">PlayerColorsRGB</span><span class="p">[</span><span class="n">i</span> <span class="o">/</span> <span class="mi">2</span><span class="p">][</span><span class="n">j</span><span class="p">].</span><span class="n">Parse</span><span class="p">(</span><span class="n">l</span><span class="p">);</span>
			<span class="n">lua_pop</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
		<span class="p">}</span>
	<span class="p">}</span>

	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</p>
                          </details>
                        </details>
                        
                        <details>
                        <summary>DefinePlayerColorIndex</summary>
                        <p><br>  Define player color indexes<br><br>  @param l  Lua state.</p>
                          <details>
                          <summary>/stratagus/script_player.cpp:762 CclDefinePlayerColorIndex</summary>
                          <p><div class="highlight"><pre><span></span><span class="k">static</span> <span class="kt">int</span> <span class="nf">CclDefinePlayerColorIndex</span><span class="p">(</span><span class="n">lua_State</span> <span class="o">*</span><span class="n">l</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">LuaCheckArgs</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">2</span><span class="p">);</span>
	<span class="n">PlayerColorIndexStart</span> <span class="o">=</span> <span class="n">LuaToNumber</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
	<span class="n">PlayerColorIndexCount</span> <span class="o">=</span> <span class="n">LuaToNumber</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">2</span><span class="p">);</span>

	<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">PlayerMax</span><span class="p">;</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">PlayerColorsRGB</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">clear</span><span class="p">();</span>
		<span class="n">PlayerColorsRGB</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">resize</span><span class="p">(</span><span class="n">PlayerColorIndexCount</span><span class="p">);</span>
		<span class="n">PlayerColors</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">clear</span><span class="p">();</span>
		<span class="n">PlayerColors</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">resize</span><span class="p">(</span><span class="n">PlayerColorIndexCount</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
	<span class="p">}</span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</p>
                          </details>
                        </details>
                        
                        <details>
                        <summary>NewColors</summary>
                        <p><br>  Make new player colors<br><br>  @param l  Lua state.</p>
                          <details>
                          <summary>/stratagus/script_player.cpp:742 CclNewPlayerColors</summary>
                          <p><div class="highlight"><pre><span></span><span class="k">static</span> <span class="kt">int</span> <span class="nf">CclNewPlayerColors</span><span class="p">(</span><span class="n">lua_State</span> <span class="o">*</span><span class="n">l</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">LuaCheckArgs</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
	<span class="n">SetPlayersPalette</span><span class="p">();</span>

	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</p>
                          </details>
                        </details>
                        
                        <details>
                        <summary>GetPlayerData</summary>
                        <p><br> <b>Description</b><br><br>  Get player data.<br><br>  @param l  Lua state.<br><br> Example:<br><br> <div class="example"><code>GetPlayerData(0,"TotalNumUnits")</code></div></p>
                          <details>
                          <summary>/stratagus/script_player.cpp:925 CclGetPlayerData</summary>
                          <p><div class="highlight"><pre><span></span><span class="k">static</span> <span class="kt">int</span> <span class="nf">CclGetPlayerData</span><span class="p">(</span><span class="n">lua_State</span> <span class="o">*</span><span class="n">l</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">lua_gettop</span><span class="p">(</span><span class="n">l</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">LuaError</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="s">&quot;incorrect argument&quot;</span><span class="p">);</span>
	<span class="p">}</span>
	<span class="n">lua_pushvalue</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
	<span class="k">const</span> <span class="n">CPlayer</span> <span class="o">*</span><span class="n">p</span> <span class="o">=</span> <span class="n">CclGetPlayer</span><span class="p">(</span><span class="n">l</span><span class="p">);</span>
	<span class="n">lua_pop</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
	<span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">data</span> <span class="o">=</span> <span class="n">LuaToString</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">2</span><span class="p">);</span>

	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="s">&quot;Name&quot;</span><span class="p">))</span> <span class="p">{</span>
		<span class="n">lua_pushstring</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">p</span><span class="o">-&gt;</span><span class="n">Name</span><span class="p">.</span><span class="n">c_str</span><span class="p">());</span>
		<span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
	<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="s">&quot;RaceName&quot;</span><span class="p">))</span> <span class="p">{</span>
		<span class="n">lua_pushstring</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">PlayerRaces</span><span class="p">.</span><span class="n">Name</span><span class="p">[</span><span class="n">p</span><span class="o">-&gt;</span><span class="n">Race</span><span class="p">].</span><span class="n">c_str</span><span class="p">());</span>
		<span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
	<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="s">&quot;Resources&quot;</span><span class="p">))</span> <span class="p">{</span>
		<span class="n">LuaCheckArgs</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">3</span><span class="p">);</span>

		<span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">res</span> <span class="o">=</span> <span class="n">LuaToString</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">3</span><span class="p">);</span>
		<span class="k">const</span> <span class="kt">int</span> <span class="n">resId</span> <span class="o">=</span> <span class="n">GetResourceIdByName</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">res</span><span class="p">.</span><span class="n">c_str</span><span class="p">());</span>
		<span class="n">lua_pushnumber</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">p</span><span class="o">-&gt;</span><span class="n">Resources</span><span class="p">[</span><span class="n">resId</span><span class="p">]</span> <span class="o">+</span> <span class="n">p</span><span class="o">-&gt;</span><span class="n">StoredResources</span><span class="p">[</span><span class="n">resId</span><span class="p">]);</span>
		<span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
	<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="s">&quot;StoredResources&quot;</span><span class="p">))</span> <span class="p">{</span>
		<span class="n">LuaCheckArgs</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">3</span><span class="p">);</span>

		<span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">res</span> <span class="o">=</span> <span class="n">LuaToString</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">3</span><span class="p">);</span>
		<span class="k">const</span> <span class="kt">int</span> <span class="n">resId</span> <span class="o">=</span> <span class="n">GetResourceIdByName</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">res</span><span class="p">.</span><span class="n">c_str</span><span class="p">());</span>
		<span class="n">lua_pushnumber</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">p</span><span class="o">-&gt;</span><span class="n">StoredResources</span><span class="p">[</span><span class="n">resId</span><span class="p">]);</span>
		<span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
	<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="s">&quot;MaxResources&quot;</span><span class="p">))</span> <span class="p">{</span>
		<span class="n">LuaCheckArgs</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">3</span><span class="p">);</span>

		<span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">res</span> <span class="o">=</span> <span class="n">LuaToString</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">3</span><span class="p">);</span>
		<span class="k">const</span> <span class="kt">int</span> <span class="n">resId</span> <span class="o">=</span> <span class="n">GetResourceIdByName</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">res</span><span class="p">.</span><span class="n">c_str</span><span class="p">());</span>
		<span class="n">lua_pushnumber</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">p</span><span class="o">-&gt;</span><span class="n">MaxResources</span><span class="p">[</span><span class="n">resId</span><span class="p">]);</span>
		<span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
	<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="s">&quot;UnitTypesCount&quot;</span><span class="p">))</span> <span class="p">{</span>
		<span class="n">LuaCheckArgs</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">3</span><span class="p">);</span>
		<span class="n">CUnitType</span> <span class="o">*</span><span class="n">type</span> <span class="o">=</span> <span class="n">CclGetUnitType</span><span class="p">(</span><span class="n">l</span><span class="p">);</span>
		<span class="n">Assert</span><span class="p">(</span><span class="n">type</span><span class="p">);</span>
		<span class="n">lua_pushnumber</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">p</span><span class="o">-&gt;</span><span class="n">UnitTypesCount</span><span class="p">[</span><span class="n">type</span><span class="o">-&gt;</span><span class="n">Slot</span><span class="p">]);</span>
		<span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
	<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="s">&quot;UnitTypesAiActiveCount&quot;</span><span class="p">))</span> <span class="p">{</span>
		<span class="n">LuaCheckArgs</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">3</span><span class="p">);</span>
		<span class="n">CUnitType</span> <span class="o">*</span><span class="n">type</span> <span class="o">=</span> <span class="n">CclGetUnitType</span><span class="p">(</span><span class="n">l</span><span class="p">);</span>
		<span class="n">Assert</span><span class="p">(</span><span class="n">type</span><span class="p">);</span>
		<span class="n">lua_pushnumber</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">p</span><span class="o">-&gt;</span><span class="n">UnitTypesAiActiveCount</span><span class="p">[</span><span class="n">type</span><span class="o">-&gt;</span><span class="n">Slot</span><span class="p">]);</span>
		<span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
	<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="s">&quot;AiEnabled&quot;</span><span class="p">))</span> <span class="p">{</span>
		<span class="n">lua_pushboolean</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">p</span><span class="o">-&gt;</span><span class="n">AiEnabled</span><span class="p">);</span>
		<span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
	<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="s">&quot;TotalNumUnits&quot;</span><span class="p">))</span> <span class="p">{</span>
		<span class="n">lua_pushnumber</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">p</span><span class="o">-&gt;</span><span class="n">GetUnitCount</span><span class="p">());</span>
		<span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
	<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="s">&quot;NumBuildings&quot;</span><span class="p">))</span> <span class="p">{</span>
		<span class="n">lua_pushnumber</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">p</span><span class="o">-&gt;</span><span class="n">NumBuildings</span><span class="p">);</span>
		<span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
	<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="s">&quot;Supply&quot;</span><span class="p">))</span> <span class="p">{</span>
		<span class="n">lua_pushnumber</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">p</span><span class="o">-&gt;</span><span class="n">Supply</span><span class="p">);</span>
		<span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
	<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="s">&quot;Demand&quot;</span><span class="p">))</span> <span class="p">{</span>
		<span class="n">lua_pushnumber</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">p</span><span class="o">-&gt;</span><span class="n">Demand</span><span class="p">);</span>
		<span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
	<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="s">&quot;UnitLimit&quot;</span><span class="p">))</span> <span class="p">{</span>
		<span class="n">lua_pushnumber</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">p</span><span class="o">-&gt;</span><span class="n">UnitLimit</span><span class="p">);</span>
		<span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
	<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="s">&quot;BuildingLimit&quot;</span><span class="p">))</span> <span class="p">{</span>
		<span class="n">lua_pushnumber</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">p</span><span class="o">-&gt;</span><span class="n">BuildingLimit</span><span class="p">);</span>
		<span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
	<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="s">&quot;TotalUnitLimit&quot;</span><span class="p">))</span> <span class="p">{</span>
		<span class="n">lua_pushnumber</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">p</span><span class="o">-&gt;</span><span class="n">TotalUnitLimit</span><span class="p">);</span>
		<span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
	<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="s">&quot;Score&quot;</span><span class="p">))</span> <span class="p">{</span>
		<span class="n">lua_pushnumber</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">p</span><span class="o">-&gt;</span><span class="n">Score</span><span class="p">);</span>
		<span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
	<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="s">&quot;TotalUnits&quot;</span><span class="p">))</span> <span class="p">{</span>
		<span class="n">lua_pushnumber</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">p</span><span class="o">-&gt;</span><span class="n">TotalUnits</span><span class="p">);</span>
		<span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
	<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="s">&quot;TotalBuildings&quot;</span><span class="p">))</span> <span class="p">{</span>
		<span class="n">lua_pushnumber</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">p</span><span class="o">-&gt;</span><span class="n">TotalBuildings</span><span class="p">);</span>
		<span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
	<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="s">&quot;TotalResources&quot;</span><span class="p">))</span> <span class="p">{</span>
		<span class="n">LuaCheckArgs</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">3</span><span class="p">);</span>

		<span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">res</span> <span class="o">=</span> <span class="n">LuaToString</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">3</span><span class="p">);</span>
		<span class="k">const</span> <span class="kt">int</span> <span class="n">resId</span> <span class="o">=</span> <span class="n">GetResourceIdByName</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">res</span><span class="p">.</span><span class="n">c_str</span><span class="p">());</span>
		<span class="n">lua_pushnumber</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">p</span><span class="o">-&gt;</span><span class="n">TotalResources</span><span class="p">[</span><span class="n">resId</span><span class="p">]);</span>
		<span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
	<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="s">&quot;TotalRazings&quot;</span><span class="p">))</span> <span class="p">{</span>
		<span class="n">lua_pushnumber</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">p</span><span class="o">-&gt;</span><span class="n">TotalRazings</span><span class="p">);</span>
		<span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
	<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="s">&quot;TotalKills&quot;</span><span class="p">))</span> <span class="p">{</span>
		<span class="n">lua_pushnumber</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">p</span><span class="o">-&gt;</span><span class="n">TotalKills</span><span class="p">);</span>
		<span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
	<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="s">&quot;SpeedResourcesHarvest&quot;</span><span class="p">))</span> <span class="p">{</span>
		<span class="n">LuaCheckArgs</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">3</span><span class="p">);</span>

		<span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">res</span> <span class="o">=</span> <span class="n">LuaToString</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">3</span><span class="p">);</span>
		<span class="k">const</span> <span class="kt">int</span> <span class="n">resId</span> <span class="o">=</span> <span class="n">GetResourceIdByName</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">res</span><span class="p">.</span><span class="n">c_str</span><span class="p">());</span>
		<span class="n">lua_pushnumber</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">p</span><span class="o">-&gt;</span><span class="n">SpeedResourcesHarvest</span><span class="p">[</span><span class="n">resId</span><span class="p">]);</span>
		<span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
	<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="s">&quot;SpeedResourcesReturn&quot;</span><span class="p">))</span> <span class="p">{</span>
		<span class="n">LuaCheckArgs</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">3</span><span class="p">);</span>

		<span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">res</span> <span class="o">=</span> <span class="n">LuaToString</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">3</span><span class="p">);</span>
		<span class="k">const</span> <span class="kt">int</span> <span class="n">resId</span> <span class="o">=</span> <span class="n">GetResourceIdByName</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">res</span><span class="p">.</span><span class="n">c_str</span><span class="p">());</span>
		<span class="n">lua_pushnumber</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">p</span><span class="o">-&gt;</span><span class="n">SpeedResourcesReturn</span><span class="p">[</span><span class="n">resId</span><span class="p">]);</span>
		<span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
	<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="s">&quot;SpeedBuild&quot;</span><span class="p">))</span> <span class="p">{</span>
		<span class="n">lua_pushnumber</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">p</span><span class="o">-&gt;</span><span class="n">SpeedBuild</span><span class="p">);</span>
		<span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
	<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="s">&quot;SpeedTrain&quot;</span><span class="p">))</span> <span class="p">{</span>
		<span class="n">lua_pushnumber</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">p</span><span class="o">-&gt;</span><span class="n">SpeedTrain</span><span class="p">);</span>
		<span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
	<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="s">&quot;SpeedUpgrade&quot;</span><span class="p">))</span> <span class="p">{</span>
		<span class="n">lua_pushnumber</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">p</span><span class="o">-&gt;</span><span class="n">SpeedUpgrade</span><span class="p">);</span>
		<span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
	<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="s">&quot;SpeedResearch&quot;</span><span class="p">))</span> <span class="p">{</span>
		<span class="n">lua_pushnumber</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">p</span><span class="o">-&gt;</span><span class="n">SpeedResearch</span><span class="p">);</span>
		<span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
	<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="s">&quot;Allow&quot;</span><span class="p">))</span> <span class="p">{</span>
		<span class="n">LuaCheckArgs</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">3</span><span class="p">);</span>
		<span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">ident</span> <span class="o">=</span> <span class="n">LuaToString</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">3</span><span class="p">);</span>
		<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strncmp</span><span class="p">(</span><span class="n">ident</span><span class="p">,</span> <span class="s">&quot;unit-&quot;</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span> <span class="p">{</span>
			<span class="kt">int</span> <span class="n">id</span> <span class="o">=</span> <span class="n">UnitTypeIdByIdent</span><span class="p">(</span><span class="n">ident</span><span class="p">);</span>
			<span class="k">if</span> <span class="p">(</span><span class="n">UnitIdAllowed</span><span class="p">(</span><span class="n">Players</span><span class="p">[</span><span class="n">p</span><span class="o">-&gt;</span><span class="n">Index</span><span class="p">],</span> <span class="n">id</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
				<span class="n">lua_pushstring</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="s">&quot;A&quot;</span><span class="p">);</span>
			<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">UnitIdAllowed</span><span class="p">(</span><span class="n">Players</span><span class="p">[</span><span class="n">p</span><span class="o">-&gt;</span><span class="n">Index</span><span class="p">],</span> <span class="n">id</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
				<span class="n">lua_pushstring</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="s">&quot;F&quot;</span><span class="p">);</span>
			<span class="p">}</span>
		<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strncmp</span><span class="p">(</span><span class="n">ident</span><span class="p">,</span> <span class="s">&quot;upgrade-&quot;</span><span class="p">,</span> <span class="mi">8</span><span class="p">))</span> <span class="p">{</span>
			<span class="k">if</span> <span class="p">(</span><span class="n">UpgradeIdentAllowed</span><span class="p">(</span><span class="n">Players</span><span class="p">[</span><span class="n">p</span><span class="o">-&gt;</span><span class="n">Index</span><span class="p">],</span> <span class="n">ident</span><span class="p">)</span> <span class="o">==</span> <span class="sc">&#39;A&#39;</span><span class="p">)</span> <span class="p">{</span>
				<span class="n">lua_pushstring</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="s">&quot;A&quot;</span><span class="p">);</span>
			<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">UpgradeIdentAllowed</span><span class="p">(</span><span class="n">Players</span><span class="p">[</span><span class="n">p</span><span class="o">-&gt;</span><span class="n">Index</span><span class="p">],</span> <span class="n">ident</span><span class="p">)</span> <span class="o">==</span> <span class="sc">&#39;R&#39;</span><span class="p">)</span> <span class="p">{</span>
				<span class="n">lua_pushstring</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="s">&quot;R&quot;</span><span class="p">);</span>
			<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">UpgradeIdentAllowed</span><span class="p">(</span><span class="n">Players</span><span class="p">[</span><span class="n">p</span><span class="o">-&gt;</span><span class="n">Index</span><span class="p">],</span> <span class="n">ident</span><span class="p">)</span> <span class="o">==</span> <span class="sc">&#39;F&#39;</span><span class="p">)</span> <span class="p">{</span>
				<span class="n">lua_pushstring</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="s">&quot;F&quot;</span><span class="p">);</span>
			<span class="p">}</span>
		<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
			<span class="n">DebugPrint</span><span class="p">(</span><span class="s">&quot; wrong ident %s</span><span class="se">\n</span><span class="s">&quot;</span> <span class="n">_C_</span> <span class="n">ident</span><span class="p">);</span>
		<span class="p">}</span>
		<span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
	<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
		<span class="n">LuaError</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="s">&quot;Invalid field: %s&quot;</span> <span class="n">_C_</span> <span class="n">data</span><span class="p">);</span>
	<span class="p">}</span>

	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</p>
                          </details>
                        </details>
                        
                        <details>
                        <summary>SetPlayerData</summary>
                        <p><br> <b>Description</b><br><br>  Set player data.<br><br>  @param l  Lua state.<br><br> Example:<br><br> <div class="example"><code>SetPlayerData(0,"Name","Nation of Stromgarde")<br>		SetPlayerData(0,"RaceName","human")<br> 		SetPlayerData(0,"Resources","gold",1700)</code></div></p>
                          <details>
                          <summary>/stratagus/script_player.cpp:1041 CclSetPlayerData</summary>
                          <p><div class="highlight"><pre><span></span><span class="k">static</span> <span class="kt">int</span> <span class="nf">CclSetPlayerData</span><span class="p">(</span><span class="n">lua_State</span> <span class="o">*</span><span class="n">l</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">lua_gettop</span><span class="p">(</span><span class="n">l</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">3</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">LuaError</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="s">&quot;incorrect argument&quot;</span><span class="p">);</span>
	<span class="p">}</span>
	<span class="n">lua_pushvalue</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
	<span class="n">CPlayer</span> <span class="o">*</span><span class="n">p</span> <span class="o">=</span> <span class="n">CclGetPlayer</span><span class="p">(</span><span class="n">l</span><span class="p">);</span>
	<span class="n">lua_pop</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
	<span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">data</span> <span class="o">=</span> <span class="n">LuaToString</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">2</span><span class="p">);</span>

	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="s">&quot;Name&quot;</span><span class="p">))</span> <span class="p">{</span>
		<span class="n">p</span><span class="o">-&gt;</span><span class="n">SetName</span><span class="p">(</span><span class="n">LuaToString</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">3</span><span class="p">));</span>
	<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="s">&quot;RaceName&quot;</span><span class="p">))</span> <span class="p">{</span>
		<span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">racename</span> <span class="o">=</span> <span class="n">LuaToString</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">3</span><span class="p">);</span>
		<span class="n">p</span><span class="o">-&gt;</span><span class="n">Race</span> <span class="o">=</span> <span class="n">PlayerRaces</span><span class="p">.</span><span class="n">GetRaceIndexByName</span><span class="p">(</span><span class="n">racename</span><span class="p">);</span>

		<span class="k">if</span> <span class="p">(</span><span class="n">p</span><span class="o">-&gt;</span><span class="n">Race</span> <span class="o">==</span> <span class="mi">-1</span><span class="p">)</span> <span class="p">{</span>
			<span class="n">LuaError</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="s">&quot;invalid race name &#39;%s&#39;&quot;</span> <span class="n">_C_</span> <span class="n">racename</span><span class="p">);</span>
		<span class="p">}</span>
	<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="s">&quot;Resources&quot;</span><span class="p">))</span> <span class="p">{</span>
		<span class="n">LuaCheckArgs</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">4</span><span class="p">);</span>

		<span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">res</span> <span class="o">=</span> <span class="n">LuaToString</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">3</span><span class="p">);</span>
		<span class="k">const</span> <span class="kt">int</span> <span class="n">resId</span> <span class="o">=</span> <span class="n">GetResourceIdByName</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">res</span><span class="p">.</span><span class="n">c_str</span><span class="p">());</span>
		<span class="n">p</span><span class="o">-&gt;</span><span class="n">SetResource</span><span class="p">(</span><span class="n">resId</span><span class="p">,</span> <span class="n">LuaToNumber</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">4</span><span class="p">));</span>
	<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="s">&quot;StoredResources&quot;</span><span class="p">))</span> <span class="p">{</span>
		<span class="n">LuaCheckArgs</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">4</span><span class="p">);</span>

		<span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">res</span> <span class="o">=</span> <span class="n">LuaToString</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">3</span><span class="p">);</span>
		<span class="k">const</span> <span class="kt">int</span> <span class="n">resId</span> <span class="o">=</span> <span class="n">GetResourceIdByName</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">res</span><span class="p">.</span><span class="n">c_str</span><span class="p">());</span>
		<span class="n">p</span><span class="o">-&gt;</span><span class="n">SetResource</span><span class="p">(</span><span class="n">resId</span><span class="p">,</span> <span class="n">LuaToNumber</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">4</span><span class="p">),</span> <span class="n">STORE_BUILDING</span><span class="p">);</span>
		<span class="c1">// } else if (!strcmp(data, &quot;UnitTypesCount&quot;)) {</span>
		<span class="c1">// } else if (!strcmp(data, &quot;AiEnabled&quot;)) {</span>
		<span class="c1">// } else if (!strcmp(data, &quot;TotalNumUnits&quot;)) {</span>
		<span class="c1">// } else if (!strcmp(data, &quot;NumBuildings&quot;)) {</span>
		<span class="c1">// } else if (!strcmp(data, &quot;Supply&quot;)) {</span>
		<span class="c1">// } else if (!strcmp(data, &quot;Demand&quot;)) {</span>
	<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="s">&quot;UnitLimit&quot;</span><span class="p">))</span> <span class="p">{</span>
		<span class="n">p</span><span class="o">-&gt;</span><span class="n">UnitLimit</span> <span class="o">=</span> <span class="n">LuaToNumber</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">3</span><span class="p">);</span>
	<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="s">&quot;BuildingLimit&quot;</span><span class="p">))</span> <span class="p">{</span>
		<span class="n">p</span><span class="o">-&gt;</span><span class="n">BuildingLimit</span> <span class="o">=</span> <span class="n">LuaToNumber</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">3</span><span class="p">);</span>
	<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="s">&quot;TotalUnitLimit&quot;</span><span class="p">))</span> <span class="p">{</span>
		<span class="n">p</span><span class="o">-&gt;</span><span class="n">TotalUnitLimit</span> <span class="o">=</span> <span class="n">LuaToNumber</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">3</span><span class="p">);</span>
	<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="s">&quot;Score&quot;</span><span class="p">))</span> <span class="p">{</span>
		<span class="n">p</span><span class="o">-&gt;</span><span class="n">Score</span> <span class="o">=</span> <span class="n">LuaToNumber</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">3</span><span class="p">);</span>
	<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="s">&quot;TotalUnits&quot;</span><span class="p">))</span> <span class="p">{</span>
		<span class="n">p</span><span class="o">-&gt;</span><span class="n">TotalUnits</span> <span class="o">=</span> <span class="n">LuaToNumber</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">3</span><span class="p">);</span>
	<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="s">&quot;TotalBuildings&quot;</span><span class="p">))</span> <span class="p">{</span>
		<span class="n">p</span><span class="o">-&gt;</span><span class="n">TotalBuildings</span> <span class="o">=</span> <span class="n">LuaToNumber</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">3</span><span class="p">);</span>
	<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="s">&quot;TotalResources&quot;</span><span class="p">))</span> <span class="p">{</span>
		<span class="n">LuaCheckArgs</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">4</span><span class="p">);</span>

		<span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">res</span> <span class="o">=</span> <span class="n">LuaToString</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">3</span><span class="p">);</span>
		<span class="k">const</span> <span class="kt">int</span> <span class="n">resId</span> <span class="o">=</span> <span class="n">GetResourceIdByName</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">res</span><span class="p">.</span><span class="n">c_str</span><span class="p">());</span>
		<span class="n">p</span><span class="o">-&gt;</span><span class="n">TotalResources</span><span class="p">[</span><span class="n">resId</span><span class="p">]</span> <span class="o">=</span> <span class="n">LuaToNumber</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">4</span><span class="p">);</span>
	<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="s">&quot;TotalRazings&quot;</span><span class="p">))</span> <span class="p">{</span>
		<span class="n">p</span><span class="o">-&gt;</span><span class="n">TotalRazings</span> <span class="o">=</span> <span class="n">LuaToNumber</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">3</span><span class="p">);</span>
	<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="s">&quot;TotalKills&quot;</span><span class="p">))</span> <span class="p">{</span>
		<span class="n">p</span><span class="o">-&gt;</span><span class="n">TotalKills</span> <span class="o">=</span> <span class="n">LuaToNumber</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">3</span><span class="p">);</span>
	<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="s">&quot;SpeedResourcesHarvest&quot;</span><span class="p">))</span> <span class="p">{</span>
		<span class="n">LuaCheckArgs</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">4</span><span class="p">);</span>

		<span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">res</span> <span class="o">=</span> <span class="n">LuaToString</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">3</span><span class="p">);</span>
		<span class="k">const</span> <span class="kt">int</span> <span class="n">resId</span> <span class="o">=</span> <span class="n">GetResourceIdByName</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">res</span><span class="p">.</span><span class="n">c_str</span><span class="p">());</span>
		<span class="n">p</span><span class="o">-&gt;</span><span class="n">SpeedResourcesHarvest</span><span class="p">[</span><span class="n">resId</span><span class="p">]</span> <span class="o">=</span> <span class="n">LuaToNumber</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">4</span><span class="p">);</span>
	<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="s">&quot;SpeedResourcesReturn&quot;</span><span class="p">))</span> <span class="p">{</span>
		<span class="n">LuaCheckArgs</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">4</span><span class="p">);</span>

		<span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">res</span> <span class="o">=</span> <span class="n">LuaToString</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">3</span><span class="p">);</span>
		<span class="k">const</span> <span class="kt">int</span> <span class="n">resId</span> <span class="o">=</span> <span class="n">GetResourceIdByName</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">res</span><span class="p">.</span><span class="n">c_str</span><span class="p">());</span>
		<span class="n">p</span><span class="o">-&gt;</span><span class="n">SpeedResourcesReturn</span><span class="p">[</span><span class="n">resId</span><span class="p">]</span> <span class="o">=</span> <span class="n">LuaToNumber</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">4</span><span class="p">);</span>
	<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="s">&quot;SpeedBuild&quot;</span><span class="p">))</span> <span class="p">{</span>
		<span class="n">p</span><span class="o">-&gt;</span><span class="n">SpeedBuild</span> <span class="o">=</span> <span class="n">LuaToNumber</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">3</span><span class="p">);</span>
	<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="s">&quot;SpeedTrain&quot;</span><span class="p">))</span> <span class="p">{</span>
		<span class="n">p</span><span class="o">-&gt;</span><span class="n">SpeedTrain</span> <span class="o">=</span> <span class="n">LuaToNumber</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">3</span><span class="p">);</span>
	<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="s">&quot;SpeedUpgrade&quot;</span><span class="p">))</span> <span class="p">{</span>
		<span class="n">p</span><span class="o">-&gt;</span><span class="n">SpeedUpgrade</span> <span class="o">=</span> <span class="n">LuaToNumber</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">3</span><span class="p">);</span>
	<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="s">&quot;SpeedResearch&quot;</span><span class="p">))</span> <span class="p">{</span>
		<span class="n">p</span><span class="o">-&gt;</span><span class="n">SpeedResearch</span> <span class="o">=</span> <span class="n">LuaToNumber</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">3</span><span class="p">);</span>
	<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="s">&quot;Allow&quot;</span><span class="p">))</span> <span class="p">{</span>
		<span class="n">LuaCheckArgs</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">4</span><span class="p">);</span>
		<span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">ident</span> <span class="o">=</span> <span class="n">LuaToString</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">3</span><span class="p">);</span>
		<span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">acquire</span> <span class="o">=</span> <span class="n">LuaToString</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">4</span><span class="p">);</span>

		<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strncmp</span><span class="p">(</span><span class="n">ident</span><span class="p">,</span> <span class="s">&quot;upgrade-&quot;</span><span class="p">,</span> <span class="mi">8</span><span class="p">))</span> <span class="p">{</span>
			<span class="k">if</span> <span class="p">(</span><span class="n">acquire</span> <span class="o">==</span> <span class="s">&quot;R&quot;</span> <span class="o">&amp;&amp;</span> <span class="n">UpgradeIdentAllowed</span><span class="p">(</span><span class="o">*</span><span class="n">p</span><span class="p">,</span> <span class="n">ident</span><span class="p">)</span> <span class="o">!=</span> <span class="sc">&#39;R&#39;</span><span class="p">)</span> <span class="p">{</span>
				<span class="n">UpgradeAcquire</span><span class="p">(</span><span class="o">*</span><span class="n">p</span><span class="p">,</span> <span class="n">CUpgrade</span><span class="o">::</span><span class="n">Get</span><span class="p">(</span><span class="n">ident</span><span class="p">));</span>
			<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">acquire</span> <span class="o">==</span> <span class="s">&quot;F&quot;</span> <span class="o">||</span> <span class="n">acquire</span> <span class="o">==</span> <span class="s">&quot;A&quot;</span><span class="p">)</span> <span class="p">{</span>
				<span class="k">if</span> <span class="p">(</span><span class="n">UpgradeIdentAllowed</span><span class="p">(</span><span class="o">*</span><span class="n">p</span><span class="p">,</span> <span class="n">ident</span><span class="p">)</span> <span class="o">==</span> <span class="sc">&#39;R&#39;</span><span class="p">)</span> <span class="p">{</span>
					<span class="n">UpgradeLost</span><span class="p">(</span><span class="o">*</span><span class="n">p</span><span class="p">,</span> <span class="n">CUpgrade</span><span class="o">::</span><span class="n">Get</span><span class="p">(</span><span class="n">ident</span><span class="p">)</span><span class="o">-&gt;</span><span class="n">ID</span><span class="p">);</span>
				<span class="p">}</span>
				<span class="n">AllowUpgradeId</span><span class="p">(</span><span class="o">*</span><span class="n">p</span><span class="p">,</span> <span class="n">UpgradeIdByIdent</span><span class="p">(</span><span class="n">ident</span><span class="p">),</span> <span class="n">acquire</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span>
			<span class="p">}</span>
		<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
			<span class="n">LuaError</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="s">&quot; wrong ident %s</span><span class="se">\n</span><span class="s">&quot;</span> <span class="n">_C_</span> <span class="n">ident</span><span class="p">);</span>
		<span class="p">}</span>
	<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
		<span class="n">LuaError</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="s">&quot;Invalid field: %s&quot;</span> <span class="n">_C_</span> <span class="n">data</span><span class="p">);</span>
	<span class="p">}</span>

	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</p>
                          </details>
                        </details>
                        
                        <details>
                        <summary>SetAiType</summary>
                        <p><br> <b>Description</b> <br> <br>  Set ai player algo.<br><br>  @param l  Lua state.<br> <br> Example: <br> <br> <div class="example"> <code> -- Player 1 has a passive A.I <br>		  SetAiType(1, "Passive")</code></div></p>
                          <details>
                          <summary>/stratagus/script_player.cpp:1069 CclSetAiType</summary>
                          <p><div class="highlight"><pre><span></span><span class="k">static</span> <span class="kt">int</span> <span class="nf">CclSetAiType</span><span class="p">(</span><span class="n">lua_State</span> <span class="o">*</span><span class="n">l</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">CPlayer</span> <span class="o">*</span><span class="n">p</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">lua_gettop</span><span class="p">(</span><span class="n">l</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">LuaError</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="s">&quot;incorrect argument&quot;</span><span class="p">);</span>
	<span class="p">}</span>
	<span class="n">lua_pushvalue</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
	<span class="n">p</span> <span class="o">=</span> <span class="n">CclGetPlayer</span><span class="p">(</span><span class="n">l</span><span class="p">);</span>
	<span class="n">lua_pop</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>

	<span class="n">p</span><span class="o">-&gt;</span><span class="n">AiName</span> <span class="o">=</span> <span class="n">LuaToString</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">2</span><span class="p">);</span>

	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</p>
                          </details>
                        </details>
                        <hr>/map/script_map.cpp<hr>
                        <details>
                        <summary>StratagusMap</summary>
                        <p><br>  Parse a map.<br><br>  @param l  Lua state.</p>
                          <details>
                          <summary>/map/script_map.cpp:135 CclStratagusMap</summary>
                          <p><div class="highlight"><pre><span></span><span class="k">static</span> <span class="kt">int</span> <span class="nf">CclStratagusMap</span><span class="p">(</span><span class="n">lua_State</span> <span class="o">*</span><span class="n">l</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">int</span> <span class="n">args</span> <span class="o">=</span> <span class="n">lua_gettop</span><span class="p">(</span><span class="n">l</span><span class="p">);</span>
	<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="n">args</span><span class="p">;</span> <span class="o">++</span><span class="n">j</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">value</span> <span class="o">=</span> <span class="n">LuaToString</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>
		<span class="o">++</span><span class="n">j</span><span class="p">;</span>

		<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s">&quot;version&quot;</span><span class="p">))</span> <span class="p">{</span>
			<span class="kt">char</span> <span class="n">buf</span><span class="p">[</span><span class="mi">32</span><span class="p">];</span>

			<span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">version</span> <span class="o">=</span> <span class="n">LuaToString</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>
			<span class="n">strncpy</span><span class="p">(</span><span class="n">buf</span><span class="p">,</span> <span class="n">VERSION</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">buf</span><span class="p">));</span>
			<span class="k">if</span> <span class="p">(</span><span class="n">strcmp</span><span class="p">(</span><span class="n">buf</span><span class="p">,</span> <span class="n">version</span><span class="p">))</span> <span class="p">{</span>
				<span class="n">fprintf</span><span class="p">(</span><span class="n">stderr</span><span class="p">,</span> <span class="s">&quot;Warning not saved with this version.</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
			<span class="p">}</span>
		<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s">&quot;uid&quot;</span><span class="p">))</span> <span class="p">{</span>
			<span class="n">Map</span><span class="p">.</span><span class="n">Info</span><span class="p">.</span><span class="n">MapUID</span> <span class="o">=</span> <span class="n">LuaToNumber</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>
		<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s">&quot;description&quot;</span><span class="p">))</span> <span class="p">{</span>
			<span class="n">Map</span><span class="p">.</span><span class="n">Info</span><span class="p">.</span><span class="n">Description</span> <span class="o">=</span> <span class="n">LuaToString</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>
		<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s">&quot;the-map&quot;</span><span class="p">))</span> <span class="p">{</span>
			<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">lua_istable</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span> <span class="p">{</span>
				<span class="n">LuaError</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="s">&quot;incorrect argument&quot;</span><span class="p">);</span>
			<span class="p">}</span>
			<span class="kt">int</span> <span class="n">subargs</span> <span class="o">=</span> <span class="n">lua_rawlen</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>
			<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">k</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">k</span> <span class="o">&lt;</span> <span class="n">subargs</span><span class="p">;</span> <span class="o">++</span><span class="n">k</span><span class="p">)</span> <span class="p">{</span>
				<span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">value</span> <span class="o">=</span> <span class="n">LuaToString</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">k</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>
				<span class="o">++</span><span class="n">k</span><span class="p">;</span>

				<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s">&quot;size&quot;</span><span class="p">))</span> <span class="p">{</span>
					<span class="n">lua_rawgeti</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">k</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>
					<span class="n">CclGetPos</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">Map</span><span class="p">.</span><span class="n">Info</span><span class="p">.</span><span class="n">MapWidth</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">Map</span><span class="p">.</span><span class="n">Info</span><span class="p">.</span><span class="n">MapHeight</span><span class="p">);</span>
					<span class="n">lua_pop</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>

					<span class="k">delete</span><span class="p">[]</span> <span class="n">Map</span><span class="p">.</span><span class="n">Fields</span><span class="p">;</span>
					<span class="n">Map</span><span class="p">.</span><span class="n">Fields</span> <span class="o">=</span> <span class="k">new</span> <span class="n">CMapField</span><span class="p">[</span><span class="n">Map</span><span class="p">.</span><span class="n">Info</span><span class="p">.</span><span class="n">MapWidth</span> <span class="o">*</span> <span class="n">Map</span><span class="p">.</span><span class="n">Info</span><span class="p">.</span><span class="n">MapHeight</span><span class="p">];</span>
					<span class="c1">// FIXME: this should be CreateMap or InitMap?</span>
				<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s">&quot;fog-of-war&quot;</span><span class="p">))</span> <span class="p">{</span>
					<span class="n">Map</span><span class="p">.</span><span class="n">NoFogOfWar</span> <span class="o">=</span> <span class="nb">false</span><span class="p">;</span>
					<span class="o">--</span><span class="n">k</span><span class="p">;</span>
				<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s">&quot;no-fog-of-war&quot;</span><span class="p">))</span> <span class="p">{</span>
					<span class="n">Map</span><span class="p">.</span><span class="n">NoFogOfWar</span> <span class="o">=</span> <span class="nb">true</span><span class="p">;</span>
					<span class="o">--</span><span class="n">k</span><span class="p">;</span>
				<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s">&quot;filename&quot;</span><span class="p">))</span> <span class="p">{</span>
					<span class="n">Map</span><span class="p">.</span><span class="n">Info</span><span class="p">.</span><span class="n">Filename</span> <span class="o">=</span> <span class="n">LuaToString</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">k</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>
				<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s">&quot;map-fields&quot;</span><span class="p">))</span> <span class="p">{</span>
					<span class="n">lua_rawgeti</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">k</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>
					<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">lua_istable</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">-1</span><span class="p">))</span> <span class="p">{</span>
						<span class="n">LuaError</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="s">&quot;incorrect argument&quot;</span><span class="p">);</span>
					<span class="p">}</span>
					<span class="k">const</span> <span class="kt">int</span> <span class="n">subsubargs</span> <span class="o">=</span> <span class="n">lua_rawlen</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">-1</span><span class="p">);</span>
					<span class="k">if</span> <span class="p">(</span><span class="n">subsubargs</span> <span class="o">!=</span> <span class="n">Map</span><span class="p">.</span><span class="n">Info</span><span class="p">.</span><span class="n">MapWidth</span> <span class="o">*</span> <span class="n">Map</span><span class="p">.</span><span class="n">Info</span><span class="p">.</span><span class="n">MapHeight</span><span class="p">)</span> <span class="p">{</span>
						<span class="n">fprintf</span><span class="p">(</span><span class="n">stderr</span><span class="p">,</span> <span class="s">&quot;Wrong tile table length: %d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">subsubargs</span><span class="p">);</span>
					<span class="p">}</span>
					<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">subsubargs</span><span class="p">;</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span> <span class="p">{</span>
						<span class="n">lua_rawgeti</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">-1</span><span class="p">,</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>
						<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">lua_istable</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">-1</span><span class="p">))</span> <span class="p">{</span>
							<span class="n">LuaError</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="s">&quot;incorrect argument&quot;</span><span class="p">);</span>
						<span class="p">}</span>
						<span class="n">Map</span><span class="p">.</span><span class="n">Fields</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">parse</span><span class="p">(</span><span class="n">l</span><span class="p">);</span>
						<span class="n">lua_pop</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
					<span class="p">}</span>
					<span class="n">lua_pop</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
				<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
					<span class="n">LuaError</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="s">&quot;Unsupported tag: %s&quot;</span> <span class="n">_C_</span> <span class="n">value</span><span class="p">);</span>
				<span class="p">}</span>
			<span class="p">}</span>
		<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
			<span class="n">LuaError</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="s">&quot;Unsupported tag: %s&quot;</span> <span class="n">_C_</span> <span class="n">value</span><span class="p">);</span>
		<span class="p">}</span>
	<span class="p">}</span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</p>
                          </details>
                        </details>
                        
                        <details>
                        <summary>RevealMap</summary>
                        <p><br>  Reveal the complete map.<br><br>  @param l  Lua state.</p>
                          <details>
                          <summary>/map/script_map.cpp:151 CclRevealMap</summary>
                          <p><div class="highlight"><pre><span></span><span class="k">static</span> <span class="kt">int</span> <span class="nf">CclRevealMap</span><span class="p">(</span><span class="n">lua_State</span> <span class="o">*</span><span class="n">l</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">LuaCheckArgs</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">CclInConfigFile</span> <span class="o">||</span> <span class="o">!</span><span class="n">Map</span><span class="p">.</span><span class="n">Fields</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">FlagRevealMap</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
	<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
		<span class="n">Map</span><span class="p">.</span><span class="n">Reveal</span><span class="p">();</span>
	<span class="p">}</span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</p>
                          </details>
                        </details>
                        
                        <details>
                        <summary>CenterMap</summary>
                        <p><br> <b>Description</b><br><br>  Center the map.<br><br>  @param l  Lua state.<br><br> Example:<br><br> <div class="example"><code>-- Center the view at position x=11 and y=1.<br>		  <strong>CenterMap</strong>(11, 1)</code></div></p>
                          <details>
                          <summary>/map/script_map.cpp:172 CclCenterMap</summary>
                          <p><div class="highlight"><pre><span></span><span class="k">static</span> <span class="kt">int</span> <span class="nf">CclCenterMap</span><span class="p">(</span><span class="n">lua_State</span> <span class="o">*</span><span class="n">l</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">LuaCheckArgs</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">2</span><span class="p">);</span>
	<span class="k">const</span> <span class="n">Vec2i</span> <span class="n">pos</span><span class="p">(</span><span class="n">LuaToNumber</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">LuaToNumber</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">2</span><span class="p">));</span>

	<span class="n">UI</span><span class="p">.</span><span class="n">SelectedViewport</span><span class="o">-&gt;</span><span class="n">Center</span><span class="p">(</span><span class="n">Map</span><span class="p">.</span><span class="n">TilePosToMapPixelPos_Center</span><span class="p">(</span><span class="n">pos</span><span class="p">));</span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</p>
                          </details>
                        </details>
                        
                        <details>
                        <summary>SetStartView</summary>
                        <p><br> <b>Description</b><br><br>  Define the starting viewpoint for a given player.<br><br>  @param l  Lua state.<br><br> Example:<br><br> <div class="example"><code>-- Start view for player 0.<br>		  <strong>SetStartView</strong>(0, 25, 12)<br>		  -- Start view for player 1.<br>		  <strong>SetStartView</strong>(1, 71, 38)</code></div></p>
                          <details>
                          <summary>/map/script_map.cpp:197 CclSetStartView</summary>
                          <p><div class="highlight"><pre><span></span><span class="k">static</span> <span class="kt">int</span> <span class="nf">CclSetStartView</span><span class="p">(</span><span class="n">lua_State</span> <span class="o">*</span><span class="n">l</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">LuaCheckArgs</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">3</span><span class="p">);</span>

	<span class="k">const</span> <span class="kt">int</span> <span class="n">p</span> <span class="o">=</span> <span class="n">LuaToNumber</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
	<span class="n">Players</span><span class="p">[</span><span class="n">p</span><span class="p">].</span><span class="n">StartPos</span><span class="p">.</span><span class="n">x</span> <span class="o">=</span> <span class="n">LuaToNumber</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">2</span><span class="p">);</span>
	<span class="n">Players</span><span class="p">[</span><span class="n">p</span><span class="p">].</span><span class="n">StartPos</span><span class="p">.</span><span class="n">y</span> <span class="o">=</span> <span class="n">LuaToNumber</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">3</span><span class="p">);</span>

	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</p>
                          </details>
                        </details>
                        
                        <details>
                        <summary>ShowMapLocation</summary>
                        <p><br>  Show Map Location<br><br>  @param l  Lua state.</p>
                          <details>
                          <summary>/map/script_map.cpp:228 CclShowMapLocation</summary>
                          <p><div class="highlight"><pre><span></span><span class="k">static</span> <span class="kt">int</span> <span class="nf">CclShowMapLocation</span><span class="p">(</span><span class="n">lua_State</span> <span class="o">*</span><span class="n">l</span><span class="p">)</span>
<span class="p">{</span>
	<span class="c1">// Put a unit on map, use its properties, except for</span>
	<span class="c1">// what is listed below</span>

	<span class="n">LuaCheckArgs</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">5</span><span class="p">);</span>
	<span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">unitname</span> <span class="o">=</span> <span class="n">LuaToString</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">5</span><span class="p">);</span>
	<span class="n">CUnitType</span> <span class="o">*</span><span class="n">unitType</span> <span class="o">=</span> <span class="n">UnitTypeByIdent</span><span class="p">(</span><span class="n">unitname</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">unitType</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">DebugPrint</span><span class="p">(</span><span class="s">&quot;Unable to find UnitType &#39;%s&#39;&quot;</span> <span class="n">_C_</span> <span class="n">unitname</span><span class="p">);</span>
		<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="n">CUnit</span> <span class="o">*</span><span class="n">target</span> <span class="o">=</span> <span class="n">MakeUnit</span><span class="p">(</span><span class="o">*</span><span class="n">unitType</span><span class="p">,</span> <span class="n">ThisPlayer</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">target</span> <span class="o">!=</span> <span class="nb">NULL</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">target</span><span class="o">-&gt;</span><span class="n">Variable</span><span class="p">[</span><span class="n">HP_INDEX</span><span class="p">].</span><span class="n">Value</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
		<span class="n">target</span><span class="o">-&gt;</span><span class="n">tilePos</span><span class="p">.</span><span class="n">x</span> <span class="o">=</span> <span class="n">LuaToNumber</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
		<span class="n">target</span><span class="o">-&gt;</span><span class="n">tilePos</span><span class="p">.</span><span class="n">y</span> <span class="o">=</span> <span class="n">LuaToNumber</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">2</span><span class="p">);</span>
		<span class="n">target</span><span class="o">-&gt;</span><span class="n">TTL</span> <span class="o">=</span> <span class="n">GameCycle</span> <span class="o">+</span> <span class="n">LuaToNumber</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">4</span><span class="p">);</span>
		<span class="n">target</span><span class="o">-&gt;</span><span class="n">CurrentSightRange</span> <span class="o">=</span> <span class="n">LuaToNumber</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">3</span><span class="p">);</span>
		<span class="n">MapMarkUnitSight</span><span class="p">(</span><span class="o">*</span><span class="n">target</span><span class="p">);</span>
	<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
		<span class="n">DebugPrint</span><span class="p">(</span><span class="s">&quot;Unable to allocate Unit&quot;</span><span class="p">);</span>
	<span class="p">}</span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</p>
                          </details>
                        </details>
                        
                        <details>
                        <summary>SetTileSize</summary>
                        <p><br>  Define size in pixels (x,y) of a tile in this game<br><br>  @param l  Lua state.</p>
                          <details>
                          <summary>/map/script_map.cpp:654 CclSetTileSize</summary>
                          <p><div class="highlight"><pre><span></span><span class="k">static</span> <span class="kt">int</span> <span class="nf">CclSetTileSize</span><span class="p">(</span><span class="n">lua_State</span> <span class="o">*</span><span class="n">l</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">LuaCheckArgs</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">2</span><span class="p">);</span>
	<span class="n">PixelTileSize</span><span class="p">.</span><span class="n">x</span> <span class="o">=</span> <span class="n">LuaToNumber</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
	<span class="n">PixelTileSize</span><span class="p">.</span><span class="n">y</span> <span class="o">=</span> <span class="n">LuaToNumber</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">2</span><span class="p">);</span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</p>
                          </details>
                        </details>
                        
                        <details>
                        <summary>SetFogOfWar</summary>
                        <p><br> <b>Description</b><br><br>  Set fog of war on/off.<br><br> Example:<br><br> <div class="example"><code><strong>SetFogOfWar</strong>(true)</code></div><br><br>  @param l  Lua state.</p>
                          <details>
                          <summary>/map/script_map.cpp:251 CclSetFogOfWar</summary>
                          <p><div class="highlight"><pre><span></span><span class="k">static</span> <span class="kt">int</span> <span class="nf">CclSetFogOfWar</span><span class="p">(</span><span class="n">lua_State</span> <span class="o">*</span><span class="n">l</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">LuaCheckArgs</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
	<span class="n">Map</span><span class="p">.</span><span class="n">NoFogOfWar</span> <span class="o">=</span> <span class="o">!</span><span class="n">LuaToBoolean</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">CclInConfigFile</span> <span class="o">&amp;&amp;</span> <span class="n">Map</span><span class="p">.</span><span class="n">Fields</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">UpdateFogOfWarChange</span><span class="p">();</span>
		<span class="c1">// FIXME: save setting in replay log</span>
		<span class="c1">//CommandLog(&quot;input&quot;, NoUnitP, FlushCommands, -1, -1, NoUnitP, &quot;fow off&quot;, -1);</span>
	<span class="p">}</span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</p>
                          </details>
                        </details>
                        
                        <details>
                        <summary>GetFogOfWar</summary>
                        <p>/map/script_map.cpp:258 CclGetFogOfWar</p>
                        <p><div class="highlight"><pre><span></span><span class="k">static</span> <span class="kt">int</span> <span class="nf">CclGetFogOfWar</span><span class="p">(</span><span class="n">lua_State</span> <span class="o">*</span><span class="n">l</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">LuaCheckArgs</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
	<span class="n">lua_pushboolean</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="o">!</span><span class="n">Map</span><span class="p">.</span><span class="n">NoFogOfWar</span><span class="p">);</span>
	<span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</p>
                        </details>
                        
                        <details>
                        <summary>SetMinimapTerrain</summary>
                        <p><br>  Enable display of terrain in minimap.<br><br>  @param l  Lua state.</p>
                          <details>
                          <summary>/map/script_map.cpp:270 CclSetMinimapTerrain</summary>
                          <p><div class="highlight"><pre><span></span><span class="k">static</span> <span class="kt">int</span> <span class="nf">CclSetMinimapTerrain</span><span class="p">(</span><span class="n">lua_State</span> <span class="o">*</span><span class="n">l</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">LuaCheckArgs</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
	<span class="n">UI</span><span class="p">.</span><span class="n">Minimap</span><span class="p">.</span><span class="n">WithTerrain</span> <span class="o">=</span> <span class="n">LuaToBoolean</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</p>
                          </details>
                        </details>
                        
                        <details>
                        <summary>SetEnableMapGrid</summary>
                        <p><br>  Activate map grid  (true|false)<br><br>  @param l  Lua state.<br><br>  @return   0 for success, 1 for wrong type;</p>
                          <details>
                          <summary>/map/script_map.cpp:284 CclSetEnableMapGrid</summary>
                          <p><div class="highlight"><pre><span></span><span class="k">static</span> <span class="kt">int</span> <span class="nf">CclSetEnableMapGrid</span><span class="p">(</span><span class="n">lua_State</span> <span class="o">*</span><span class="n">l</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">LuaCheckArgs</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
	<span class="n">CViewport</span><span class="o">::</span><span class="n">EnableGrid</span><span class="p">(</span><span class="n">LuaToBoolean</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">1</span><span class="p">));</span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</p>
                          </details>
                        </details>
                        
                        <details>
                        <summary>GetIsMapGridEnabled</summary>
                        <p><br>  Check if map grid is enabled</p>
                          <details>
                          <summary>/map/script_map.cpp:294 CclGetIsMapGridEnabled</summary>
                          <p><div class="highlight"><pre><span></span><span class="k">static</span> <span class="kt">int</span> <span class="nf">CclGetIsMapGridEnabled</span><span class="p">(</span><span class="n">lua_State</span> <span class="o">*</span><span class="n">l</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">LuaCheckArgs</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
	<span class="n">lua_pushboolean</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">CViewport</span><span class="o">::</span><span class="n">isGridEnabled</span><span class="p">());</span>
	<span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</p>
                          </details>
                        </details>
                        
                        <details>
                        <summary>SetFieldOfViewType</summary>
                        <p><br>  Select unit's field of view algorithm -  ShadowCasting or SimpleRadial<br><br>  @param l  Lua state.<br><br>  @return   0 for success, 1 for wrong type;</p>
                          <details>
                          <summary>/map/script_map.cpp:328 CclSetFieldOfViewType</summary>
                          <p><div class="highlight"><pre><span></span><span class="k">static</span> <span class="kt">int</span> <span class="nf">CclSetFieldOfViewType</span><span class="p">(</span><span class="n">lua_State</span> <span class="o">*</span><span class="n">l</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">LuaCheckArgs</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>

	<span class="n">FieldOfViewTypes</span> <span class="n">new_type</span><span class="p">;</span>
	<span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">type_name</span> <span class="o">=</span> <span class="n">LuaToString</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">type_name</span><span class="p">,</span> <span class="s">&quot;shadow-casting&quot;</span><span class="p">))</span> <span class="p">{</span>
		<span class="n">new_type</span> <span class="o">=</span> <span class="n">FieldOfViewTypes</span><span class="o">::</span><span class="n">cShadowCasting</span><span class="p">;</span>
		<span class="c1">/// Legacy type of FOW doesn&#39;t work with shadow casting</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">FogOfWar</span><span class="p">.</span><span class="n">GetType</span><span class="p">()</span> <span class="o">==</span> <span class="n">FogOfWarTypes</span><span class="o">::</span><span class="n">cLegacy</span><span class="p">)</span> <span class="p">{</span>
			<span class="n">FogOfWar</span><span class="p">.</span><span class="n">SetType</span><span class="p">(</span><span class="n">FogOfWarTypes</span><span class="o">::</span><span class="n">cEnhanced</span><span class="p">);</span>
		<span class="p">}</span>	
	<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">type_name</span><span class="p">,</span> <span class="s">&quot;simple-radial&quot;</span><span class="p">))</span> <span class="p">{</span>
		<span class="n">new_type</span> <span class="o">=</span> <span class="n">FieldOfViewTypes</span><span class="o">::</span><span class="n">cSimpleRadial</span><span class="p">;</span>
	<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
		<span class="n">PrintFunction</span><span class="p">();</span>
		<span class="n">fprintf</span><span class="p">(</span><span class="n">stdout</span><span class="p">,</span> <span class="s">&quot;Accessible Field of View types: </span><span class="se">\&quot;</span><span class="s">shadow-casting</span><span class="se">\&quot;</span><span class="s">, </span><span class="se">\&quot;</span><span class="s">simple-radial</span><span class="se">\&quot;</span><span class="s">.</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
		<span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">IsNetworkGame</span><span class="p">())</span> <span class="p">{</span>
		<span class="n">FieldOfView</span><span class="p">.</span><span class="n">SetType</span><span class="p">(</span><span class="n">new_type</span><span class="p">);</span>
	<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
		<span class="n">NetworkSendExtendedCommand</span><span class="p">(</span><span class="n">ExtendedMessageFieldOfViewDB</span><span class="p">,</span> <span class="kt">int</span><span class="p">(</span><span class="n">new_type</span><span class="p">),</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
	<span class="p">}</span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</p>
                          </details>
                        </details>
                        
                        <details>
                        <summary>GetFieldOfViewType</summary>
                        <p><br>  Get unit's field of view type -  ShadowCasting or SimpleRadial</p>
                          <details>
                          <summary>/map/script_map.cpp:338 CclGetFieldOfViewType</summary>
                          <p><div class="highlight"><pre><span></span><span class="k">static</span> <span class="kt">int</span> <span class="nf">CclGetFieldOfViewType</span><span class="p">(</span><span class="n">lua_State</span> <span class="o">*</span><span class="n">l</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">LuaCheckArgs</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
	<span class="n">lua_pushinteger</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="kt">int</span><span class="p">(</span><span class="n">FieldOfView</span><span class="p">.</span><span class="n">GetType</span><span class="p">()));</span>
	<span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</p>
                          </details>
                        </details>
                        
                        <details>
                        <summary>SetOpaqueFor</summary>
                        <p><br>  Set opaque for the tile's terrain.<br><br>  @param l  Lua state.<br><br>  @return   0 for success, 1 for wrong tile's terrain;</p>
                          <details>
                          <summary>/map/script_map.cpp:376 CclSetOpaqueFor</summary>
                          <p><div class="highlight"><pre><span></span><span class="k">static</span> <span class="kt">int</span> <span class="nf">CclSetOpaqueFor</span><span class="p">(</span><span class="n">lua_State</span> <span class="o">*</span><span class="n">l</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">uint16_t</span> <span class="n">new_flag</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="k">const</span> <span class="kt">int</span> <span class="n">args</span> <span class="o">=</span> <span class="n">lua_gettop</span><span class="p">(</span><span class="n">l</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">args</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">LuaError</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="s">&quot;argument missed&quot;</span><span class="p">);</span>
		<span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">arg</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">arg</span> <span class="o">&lt;</span> <span class="n">args</span><span class="p">;</span> <span class="o">++</span><span class="n">arg</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">flag_name</span> <span class="o">=</span> <span class="n">LuaToString</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">arg</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>
		<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">flag_name</span><span class="p">,</span> <span class="s">&quot;wall&quot;</span><span class="p">))</span> <span class="p">{</span>
			<span class="n">new_flag</span> <span class="o">|=</span> <span class="n">MapFieldWall</span><span class="p">;</span>
		<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">flag_name</span><span class="p">,</span> <span class="s">&quot;rock&quot;</span><span class="p">))</span> <span class="p">{</span>
			<span class="n">new_flag</span> <span class="o">|=</span> <span class="n">MapFieldRocks</span><span class="p">;</span>
		<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">flag_name</span><span class="p">,</span> <span class="s">&quot;forest&quot;</span><span class="p">))</span> <span class="p">{</span>
			<span class="n">new_flag</span> <span class="o">|=</span> <span class="n">MapFieldForest</span><span class="p">;</span>
		<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
			<span class="n">PrintFunction</span><span class="p">();</span>
			<span class="n">fprintf</span><span class="p">(</span><span class="n">stdout</span><span class="p">,</span> <span class="s">&quot;Opaque can only be set for </span><span class="se">\&quot;</span><span class="s">wall</span><span class="se">\&quot;</span><span class="s">, </span><span class="se">\&quot;</span><span class="s">rock</span><span class="se">\&quot;</span><span class="s"> or </span><span class="se">\&quot;</span><span class="s">forest</span><span class="se">\&quot;</span><span class="s">. </span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
			<span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
		<span class="p">}</span>
	<span class="p">}</span>
	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">IsNetworkGame</span><span class="p">())</span> <span class="p">{</span>
		<span class="n">FieldOfView</span><span class="p">.</span><span class="n">SetOpaqueFields</span><span class="p">(</span><span class="n">FieldOfView</span><span class="p">.</span><span class="n">GetOpaqueFields</span><span class="p">()</span> <span class="o">|</span> <span class="n">new_flag</span><span class="p">);</span>
	<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
		<span class="n">NetworkSendExtendedCommand</span><span class="p">(</span><span class="n">ExtendedMessageMapFieldsOpacityDB</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>
								   <span class="n">FieldOfView</span><span class="p">.</span><span class="n">GetOpaqueFields</span><span class="p">()</span> <span class="o">|</span> <span class="n">new_flag</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
	<span class="p">}</span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</p>
                          </details>
                        </details>
                        
                        <details>
                        <summary>RemoveOpaqueFor</summary>
                        <p>/map/script_map.cpp:433 CclRemoveOpaqueFor</p>
                        <p><div class="highlight"><pre><span></span><span class="k">static</span> <span class="kt">int</span> <span class="nf">CclRemoveOpaqueFor</span><span class="p">(</span><span class="n">lua_State</span> <span class="o">*</span><span class="n">l</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">new_flag</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="k">const</span> <span class="kt">int</span> <span class="n">args</span> <span class="o">=</span> <span class="n">lua_gettop</span><span class="p">(</span><span class="n">l</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">args</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">LuaError</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="s">&quot;argument missed&quot;</span><span class="p">);</span>
		<span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">arg</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">arg</span> <span class="o">&lt;</span> <span class="n">args</span><span class="p">;</span> <span class="o">++</span><span class="n">arg</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">flag_name</span> <span class="o">=</span> <span class="n">LuaToString</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">arg</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>
		<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">flag_name</span><span class="p">,</span> <span class="s">&quot;wall&quot;</span><span class="p">))</span> <span class="p">{</span>
			<span class="n">new_flag</span> <span class="o">|=</span> <span class="n">MapFieldWall</span><span class="p">;</span>
		<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">flag_name</span><span class="p">,</span> <span class="s">&quot;rock&quot;</span><span class="p">))</span> <span class="p">{</span>
			<span class="n">new_flag</span> <span class="o">|=</span> <span class="n">MapFieldRocks</span><span class="p">;</span>
		<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">flag_name</span><span class="p">,</span> <span class="s">&quot;forest&quot;</span><span class="p">))</span> <span class="p">{</span>
			<span class="n">new_flag</span> <span class="o">|=</span> <span class="n">MapFieldForest</span><span class="p">;</span>
		<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
			<span class="n">PrintFunction</span><span class="p">();</span>
			<span class="n">fprintf</span><span class="p">(</span><span class="n">stdout</span><span class="p">,</span> <span class="s">&quot;Opaque can only be removed for </span><span class="se">\&quot;</span><span class="s">wall</span><span class="se">\&quot;</span><span class="s">, </span><span class="se">\&quot;</span><span class="s">rock</span><span class="se">\&quot;</span><span class="s"> or </span><span class="se">\&quot;</span><span class="s">forest</span><span class="se">\&quot;</span><span class="s">. </span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
			<span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
		<span class="p">}</span>
	<span class="p">}</span>
	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">IsNetworkGame</span><span class="p">())</span> <span class="p">{</span>
		<span class="n">FieldOfView</span><span class="p">.</span><span class="n">SetOpaqueFields</span><span class="p">(</span><span class="n">FieldOfView</span><span class="p">.</span><span class="n">GetOpaqueFields</span><span class="p">()</span> <span class="o">&amp;</span> <span class="o">~</span><span class="n">new_flag</span><span class="p">);</span>
	<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
		<span class="n">NetworkSendExtendedCommand</span><span class="p">(</span><span class="n">ExtendedMessageMapFieldsOpacityDB</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>
								   <span class="n">FieldOfView</span><span class="p">.</span><span class="n">GetOpaqueFields</span><span class="p">()</span> <span class="o">&amp;</span> <span class="o">~</span><span class="n">new_flag</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
	<span class="p">}</span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</p>
                        </details>
                        
                        <details>
                        <summary>GetIsOpaqueFor</summary>
                        <p><br>  Check opacity for the tile's terrain.<br><br>  @param l  Lua state.<br></p>
                          <details>
                          <summary>/map/script_map.cpp:402 CclGetIsOpaqueFor</summary>
                          <p><div class="highlight"><pre><span></span><span class="k">static</span> <span class="kt">int</span> <span class="nf">CclGetIsOpaqueFor</span><span class="p">(</span><span class="n">lua_State</span> <span class="o">*</span><span class="n">l</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">LuaCheckArgs</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>

	<span class="kt">uint16_t</span> <span class="n">flagToCheck</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">flag_name</span> <span class="o">=</span> <span class="n">LuaToString</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">flag_name</span><span class="p">,</span> <span class="s">&quot;wall&quot;</span><span class="p">))</span> <span class="p">{</span>
		<span class="n">flagToCheck</span> <span class="o">=</span> <span class="n">MapFieldWall</span><span class="p">;</span>
	<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">flag_name</span><span class="p">,</span> <span class="s">&quot;rock&quot;</span><span class="p">))</span> <span class="p">{</span>
		<span class="n">flagToCheck</span> <span class="o">=</span> <span class="n">MapFieldRocks</span><span class="p">;</span>
	<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">flag_name</span><span class="p">,</span> <span class="s">&quot;forest&quot;</span><span class="p">))</span> <span class="p">{</span>
		<span class="n">flagToCheck</span> <span class="o">=</span> <span class="n">MapFieldForest</span><span class="p">;</span>
	<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
		<span class="n">PrintFunction</span><span class="p">();</span>
		<span class="n">fprintf</span><span class="p">(</span><span class="n">stdout</span><span class="p">,</span> <span class="s">&quot;Opaque can only be checked for </span><span class="se">\&quot;</span><span class="s">wall</span><span class="se">\&quot;</span><span class="s">, </span><span class="se">\&quot;</span><span class="s">rock</span><span class="se">\&quot;</span><span class="s"> or </span><span class="se">\&quot;</span><span class="s">forest</span><span class="se">\&quot;</span><span class="s">. </span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
	<span class="p">}</span>

	<span class="n">lua_pushboolean</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">FieldOfView</span><span class="p">.</span><span class="n">GetOpaqueFields</span><span class="p">()</span> <span class="o">&amp;</span> <span class="n">flagToCheck</span><span class="p">);</span>
	<span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</p>
                          </details>
                        </details>
                        
                        <details>
                        <summary>SetFogOfWarType</summary>
                        <p><br>  Select which type of Fog of War to use<br><br>  @param l  Lua state.<br><br>  @return   0 for success, 1 for wrong type;</p>
                          <details>
                          <summary>/map/script_map.cpp:469 CclSetFogOfWarType</summary>
                          <p><div class="highlight"><pre><span></span><span class="k">static</span> <span class="kt">int</span> <span class="nf">CclSetFogOfWarType</span><span class="p">(</span><span class="n">lua_State</span> <span class="o">*</span><span class="n">l</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">LuaCheckArgs</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
	
	<span class="n">FogOfWarTypes</span> <span class="n">new_type</span><span class="p">;</span>
	<span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">type_name</span> <span class="o">=</span> <span class="n">LuaToString</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">type_name</span><span class="p">,</span> <span class="s">&quot;legacy&quot;</span><span class="p">))</span> <span class="p">{</span>
		<span class="n">new_type</span> <span class="o">=</span> <span class="n">FogOfWarTypes</span><span class="o">::</span><span class="n">cLegacy</span><span class="p">;</span>
		<span class="c1">/// Legacy type of FOW doesn&#39;t work with shadow casting</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">FieldOfView</span><span class="p">.</span><span class="n">GetType</span><span class="p">()</span> <span class="o">==</span> <span class="n">FieldOfViewTypes</span><span class="o">::</span><span class="n">cShadowCasting</span><span class="p">)</span> <span class="p">{</span>
			<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">IsNetworkGame</span><span class="p">())</span> <span class="p">{</span>
				<span class="n">FieldOfView</span><span class="p">.</span><span class="n">SetType</span><span class="p">(</span><span class="n">FieldOfViewTypes</span><span class="o">::</span><span class="n">cSimpleRadial</span><span class="p">);</span>
			<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
				<span class="n">NetworkSendExtendedCommand</span><span class="p">(</span><span class="n">ExtendedMessageFieldOfViewDB</span><span class="p">,</span> 
										   <span class="kt">int</span><span class="p">(</span><span class="n">FieldOfViewTypes</span><span class="o">::</span><span class="n">cSimpleRadial</span><span class="p">),</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
			<span class="p">}</span>
		<span class="p">}</span>
	<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">type_name</span><span class="p">,</span> <span class="s">&quot;enhanced&quot;</span><span class="p">))</span> <span class="p">{</span>
		<span class="n">new_type</span> <span class="o">=</span> <span class="n">FogOfWarTypes</span><span class="o">::</span><span class="n">cEnhanced</span><span class="p">;</span>
	<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
		<span class="n">PrintFunction</span><span class="p">();</span>
		<span class="n">fprintf</span><span class="p">(</span><span class="n">stdout</span><span class="p">,</span> <span class="s">&quot;Accessible Fog of War types: </span><span class="se">\&quot;</span><span class="s">legacy</span><span class="se">\&quot;</span><span class="s">, </span><span class="se">\&quot;</span><span class="s">enhanced</span><span class="se">\&quot;</span><span class="s">.</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
		<span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="n">FogOfWar</span><span class="p">.</span><span class="n">SetType</span><span class="p">(</span><span class="n">new_type</span><span class="p">);</span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</p>
                          </details>
                        </details>
                        
                        <details>
                        <summary>GetFogOfWarType</summary>
                        <p><br>  Get Fog of War type - legacy or enhanced</p>
                          <details>
                          <summary>/map/script_map.cpp:479 CclGetFogOfWarType</summary>
                          <p><div class="highlight"><pre><span></span><span class="k">static</span> <span class="kt">int</span> <span class="nf">CclGetFogOfWarType</span><span class="p">(</span><span class="n">lua_State</span> <span class="o">*</span><span class="n">l</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">LuaCheckArgs</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
	<span class="n">lua_pushinteger</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="kt">int</span><span class="p">(</span><span class="n">FogOfWar</span><span class="p">.</span><span class="n">GetType</span><span class="p">()));</span>
	<span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</p>
                          </details>
                        </details>
                        
                        <details>
                        <summary>SetFogOfWarBlur</summary>
                        <p><br>  Set parameters for FOW blurer (radiuses and number of iterations)<br><br>  @param l  Lua state.<br><br>  @return   0 for success, 1 for wrong type;</p>
                          <details>
                          <summary>/map/script_map.cpp:512 CclSetFogOfWarBlur</summary>
                          <p><div class="highlight"><pre><span></span><span class="k">static</span> <span class="kt">int</span> <span class="nf">CclSetFogOfWarBlur</span><span class="p">(</span><span class="n">lua_State</span> <span class="o">*</span><span class="n">l</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">LuaCheckArgs</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">3</span><span class="p">);</span>

	<span class="kt">float</span> <span class="n">radiusSimple</span> <span class="o">=</span> <span class="n">LuaToFloat</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">radiusSimple</span> <span class="o">&lt;=</span> <span class="mi">0</span> <span class="p">)</span> <span class="p">{</span>
		<span class="n">PrintFunction</span><span class="p">();</span>
		<span class="n">fprintf</span><span class="p">(</span><span class="n">stdout</span><span class="p">,</span> <span class="s">&quot;Radius should be a positive float number. Blur is disabled.</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
	<span class="p">}</span>

	<span class="kt">float</span> <span class="n">radiusBilinear</span> <span class="o">=</span> <span class="n">LuaToFloat</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">2</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">radiusBilinear</span> <span class="o">&lt;=</span> <span class="mi">0</span> <span class="p">)</span> <span class="p">{</span>
		<span class="n">PrintFunction</span><span class="p">();</span>
		<span class="n">fprintf</span><span class="p">(</span><span class="n">stdout</span><span class="p">,</span> <span class="s">&quot;Radius should be a positive float number. Blur is disabled.</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
	<span class="p">}</span>

	<span class="kt">int</span> <span class="n">iterations</span> <span class="o">=</span> <span class="n">LuaToNumber</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">3</span><span class="p">);</span>	
	<span class="k">if</span> <span class="p">(</span><span class="n">iterations</span> <span class="o">&lt;=</span> <span class="mi">0</span> <span class="p">)</span> <span class="p">{</span>
		<span class="n">PrintFunction</span><span class="p">();</span>
		<span class="n">fprintf</span><span class="p">(</span><span class="n">stdout</span><span class="p">,</span> <span class="s">&quot;Number of box blur iterations should be greater than 0. Blur is disabled.</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
	<span class="p">}</span>
	<span class="n">FogOfWar</span><span class="p">.</span><span class="n">InitBlurer</span><span class="p">(</span><span class="n">radiusSimple</span><span class="p">,</span> <span class="n">radiusBilinear</span><span class="p">,</span> <span class="n">iterations</span><span class="p">);</span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</p>
                          </details>
                        </details>
                        
                        <details>
                        <summary>SetFogOfWarBilinear</summary>
                        <p><br>  Activate FOW bilinear upscaling type  (true|false)<br><br>  @param l  Lua state.<br><br>  @return   0 for success, 1 for wrong type;</p>
                          <details>
                          <summary>/map/script_map.cpp:526 CclSetFogOfWarBilinear</summary>
                          <p><div class="highlight"><pre><span></span><span class="k">static</span> <span class="kt">int</span> <span class="nf">CclSetFogOfWarBilinear</span><span class="p">(</span><span class="n">lua_State</span> <span class="o">*</span><span class="n">l</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">LuaCheckArgs</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
	<span class="n">FogOfWar</span><span class="p">.</span><span class="n">EnableBilinearUpscale</span><span class="p">(</span><span class="n">LuaToBoolean</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">1</span><span class="p">));</span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</p>
                          </details>
                        </details>
                        
                        <details>
                        <summary>GetIsFogOfWarBilinear</summary>
                        <p><br>  Check if FOW bilinear upscaling enabled</p>
                          <details>
                          <summary>/map/script_map.cpp:536 CclGetIsFogOfWarBilinear</summary>
                          <p><div class="highlight"><pre><span></span><span class="k">static</span> <span class="kt">int</span> <span class="nf">CclGetIsFogOfWarBilinear</span><span class="p">(</span><span class="n">lua_State</span> <span class="o">*</span><span class="n">l</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">LuaCheckArgs</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
	<span class="n">lua_pushboolean</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">FogOfWar</span><span class="p">.</span><span class="n">IsBilinearUpscaleEnabled</span><span class="p">());</span>
	<span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</p>
                          </details>
                        </details>
                        
                        <details>
                        <summary>SetFogOfWarGraphics</summary>
                        <p><br>  Define Fog graphics<br><br>  @param l  Lua state.</p>
                          <details>
                          <summary>/map/script_map.cpp:641 CclSetFogOfWarGraphics</summary>
                          <p><div class="highlight"><pre><span></span><span class="k">static</span> <span class="kt">int</span> <span class="nf">CclSetFogOfWarGraphics</span><span class="p">(</span><span class="n">lua_State</span> <span class="o">*</span><span class="n">l</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">FogGraphicFile</span><span class="p">;</span>

	<span class="n">LuaCheckArgs</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
	<span class="n">FogGraphicFile</span> <span class="o">=</span> <span class="n">LuaToString</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">CMap</span><span class="o">::</span><span class="n">LegacyFogGraphic</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">CGraphic</span><span class="o">::</span><span class="n">Free</span><span class="p">(</span><span class="n">CMap</span><span class="o">::</span><span class="n">LegacyFogGraphic</span><span class="p">);</span>
	<span class="p">}</span>
	<span class="n">CMap</span><span class="o">::</span><span class="n">LegacyFogGraphic</span> <span class="o">=</span> <span class="n">CGraphic</span><span class="o">::</span><span class="n">New</span><span class="p">(</span><span class="n">FogGraphicFile</span><span class="p">,</span> <span class="n">PixelTileSize</span><span class="p">.</span><span class="n">x</span><span class="p">,</span> <span class="n">PixelTileSize</span><span class="p">.</span><span class="n">y</span><span class="p">);</span>

	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</p>
                          </details>
                        </details>
                        
                        <details>
                        <summary>SetFogOfWarOpacity</summary>
                        <p><br>  Fog of war opacity.<br><br>  @param l  Lua state.</p>
                          <details>
                          <summary>/map/script_map.cpp:558 CclSetFogOfWarOpacity</summary>
                          <p><div class="highlight"><pre><span></span><span class="k">static</span> <span class="kt">int</span> <span class="nf">CclSetFogOfWarOpacity</span><span class="p">(</span><span class="n">lua_State</span> <span class="o">*</span><span class="n">l</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">LuaCheckArgs</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
	<span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="n">LuaToNumber</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">i</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="o">||</span> <span class="n">i</span> <span class="o">&gt;</span> <span class="mi">255</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">PrintFunction</span><span class="p">();</span>
		<span class="n">fprintf</span><span class="p">(</span><span class="n">stdout</span><span class="p">,</span> <span class="s">&quot;Opacity should be 0 - 256</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
		<span class="n">i</span> <span class="o">=</span> <span class="mi">100</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="n">FogOfWarOpacity</span> <span class="o">=</span> <span class="n">i</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">CclInConfigFile</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">Map</span><span class="p">.</span><span class="n">Init</span><span class="p">();</span>
	<span class="p">}</span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</p>
                          </details>
                        </details>
                        
                        <details>
                        <summary>SetFogOfWarColor</summary>
                        <p><br>  Set Fog color.<br><br>  @param l  Lua state.</p>
                          <details>
                          <summary>/map/script_map.cpp:622 CclSetFogOfWarColor</summary>
                          <p><div class="highlight"><pre><span></span><span class="k">static</span> <span class="kt">int</span> <span class="nf">CclSetFogOfWarColor</span><span class="p">(</span><span class="n">lua_State</span> <span class="o">*</span><span class="n">l</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">LuaCheckArgs</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">3</span><span class="p">);</span>
	<span class="kt">int</span> <span class="n">r</span> <span class="o">=</span> <span class="n">LuaToNumber</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
	<span class="kt">int</span> <span class="n">g</span> <span class="o">=</span> <span class="n">LuaToNumber</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">2</span><span class="p">);</span>
	<span class="kt">int</span> <span class="n">b</span> <span class="o">=</span> <span class="n">LuaToNumber</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">3</span><span class="p">);</span>

	<span class="k">if</span> <span class="p">((</span><span class="n">r</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="o">||</span> <span class="n">r</span> <span class="o">&gt;</span> <span class="mi">255</span><span class="p">)</span> <span class="o">||</span>
		<span class="p">(</span><span class="n">g</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="o">||</span> <span class="n">g</span> <span class="o">&gt;</span> <span class="mi">255</span><span class="p">)</span> <span class="o">||</span>
		<span class="p">(</span><span class="n">b</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="o">||</span> <span class="n">b</span> <span class="o">&gt;</span> <span class="mi">255</span><span class="p">))</span> <span class="p">{</span>
		<span class="n">LuaError</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="s">&quot;Arguments must be in the range 0-255&quot;</span><span class="p">);</span>
	<span class="p">}</span>
	<span class="n">FogOfWarColor</span><span class="p">.</span><span class="n">R</span> <span class="o">=</span> <span class="n">r</span><span class="p">;</span>
	<span class="n">FogOfWarColor</span><span class="p">.</span><span class="n">G</span> <span class="o">=</span> <span class="n">g</span><span class="p">;</span>
	<span class="n">FogOfWarColor</span><span class="p">.</span><span class="n">B</span> <span class="o">=</span> <span class="n">b</span><span class="p">;</span>

	<span class="n">FogOfWar</span><span class="p">.</span><span class="n">SetFogColor</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="n">g</span><span class="p">,</span> <span class="n">b</span><span class="p">);</span>

	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</p>
                          </details>
                        </details>
                        
                        <details>
                        <summary>SetForestRegeneration</summary>
                        <p><br> <b>Description</b><br><br>  Set forest regeneration speed.<br><br>  @param l  Lua state.<br><br>  @return   Old speed<br><br> Example:<br><br> <div class="example"><code>-- No regeneration.<br>		  <strong>SetForestRegeneration</strong>(0)<br>		  -- Slow regeneration every 50 seconds<br>		  <strong>SetForestRegeneration</strong>(50)<br>		  -- Extremely slow regeneration every 1h of game time<br>		  <strong>SetForestRegeneration</strong>(3600)</code></div></p>
                          <details>
                          <summary>/map/script_map.cpp:596 CclSetForestRegeneration</summary>
                          <p><div class="highlight"><pre><span></span><span class="k">static</span> <span class="kt">int</span> <span class="nf">CclSetForestRegeneration</span><span class="p">(</span><span class="n">lua_State</span> <span class="o">*</span><span class="n">l</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">LuaCheckArgs</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
	<span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="n">LuaToNumber</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
	<span class="kt">int</span> <span class="n">frequency</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">i</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">LuaError</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="s">&quot;Regeneration speed should be &gt;= 0</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
	<span class="p">}</span>
	<span class="k">while</span> <span class="p">(</span><span class="n">i</span> <span class="o">/</span> <span class="n">frequency</span> <span class="o">&gt;</span> <span class="mi">255</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">frequency</span><span class="o">++</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="n">i</span> <span class="o">=</span> <span class="n">i</span> <span class="o">/</span> <span class="n">frequency</span><span class="p">;</span>
	<span class="k">const</span> <span class="kt">int</span> <span class="n">old</span> <span class="o">=</span> <span class="n">ForestRegeneration</span> <span class="o">*</span> <span class="n">ForestRegenerationFrequency</span><span class="p">;</span>
	<span class="n">ForestRegeneration</span> <span class="o">=</span> <span class="n">i</span><span class="p">;</span>
	<span class="n">ForestRegenerationFrequency</span> <span class="o">=</span> <span class="n">frequency</span><span class="p">;</span>

	<span class="n">lua_pushnumber</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">old</span><span class="p">);</span>
	<span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</p>
                          </details>
                        </details>
                        
                        <details>
                        <summary>LoadTileModels</summary>
                        <p><br> Load the lua file which will define the tile models<br><br>  @param l  Lua state.</p>
                          <details>
                          <summary>/map/script_map.cpp:744 CclLoadTileModels</summary>
                          <p><div class="highlight"><pre><span></span><span class="k">static</span> <span class="kt">int</span> <span class="nf">CclLoadTileModels</span><span class="p">(</span><span class="n">lua_State</span> <span class="o">*</span><span class="n">l</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">lua_gettop</span><span class="p">(</span><span class="n">l</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">LuaError</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="s">&quot;incorrect argument&quot;</span><span class="p">);</span>
	<span class="p">}</span>
	<span class="n">Map</span><span class="p">.</span><span class="n">TileModelsFileName</span> <span class="o">=</span> <span class="n">LuaToString</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
	<span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">filename</span> <span class="o">=</span> <span class="n">LibraryFileName</span><span class="p">(</span><span class="n">Map</span><span class="p">.</span><span class="n">TileModelsFileName</span><span class="p">.</span><span class="n">c_str</span><span class="p">());</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">LuaLoadFile</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span> <span class="o">==</span> <span class="mi">-1</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">DebugPrint</span><span class="p">(</span><span class="s">&quot;Load failed: %s</span><span class="se">\n</span><span class="s">&quot;</span> <span class="n">_C_</span> <span class="n">filename</span><span class="p">.</span><span class="n">c_str</span><span class="p">());</span>
	<span class="p">}</span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</p>
                          </details>
                        </details>
                        
                        <details>
                        <summary>DefinePlayerTypes</summary>
                        <p><br>  Define the type of each player available for the map<br><br>  @param l  Lua state.</p>
                          <details>
                          <summary>/map/script_map.cpp:726 CclDefinePlayerTypes</summary>
                          <p><div class="highlight"><pre><span></span><span class="k">static</span> <span class="kt">int</span> <span class="nf">CclDefinePlayerTypes</span><span class="p">(</span><span class="n">lua_State</span> <span class="o">*</span><span class="n">l</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">int</span> <span class="n">numplayers</span> <span class="o">=</span> <span class="n">lua_gettop</span><span class="p">(</span><span class="n">l</span><span class="p">);</span> <span class="cm">/* Number of players == number of arguments */</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">numplayers</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">LuaError</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="s">&quot;Not enough players&quot;</span><span class="p">);</span>
	<span class="p">}</span>

	<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">numplayers</span> <span class="o">&amp;&amp;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">PlayerMax</span><span class="p">;</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">lua_isnil</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span> <span class="p">{</span>
			<span class="n">numplayers</span> <span class="o">=</span> <span class="n">i</span><span class="p">;</span>
			<span class="k">break</span><span class="p">;</span>
		<span class="p">}</span>
		<span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">type</span> <span class="o">=</span> <span class="n">LuaToString</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>
		<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">type</span><span class="p">,</span> <span class="s">&quot;neutral&quot;</span><span class="p">))</span> <span class="p">{</span>
			<span class="n">Map</span><span class="p">.</span><span class="n">Info</span><span class="p">.</span><span class="n">PlayerType</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">PlayerNeutral</span><span class="p">;</span>
		<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">type</span><span class="p">,</span> <span class="s">&quot;nobody&quot;</span><span class="p">))</span> <span class="p">{</span>
			<span class="n">Map</span><span class="p">.</span><span class="n">Info</span><span class="p">.</span><span class="n">PlayerType</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">PlayerNobody</span><span class="p">;</span>
		<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">type</span><span class="p">,</span> <span class="s">&quot;computer&quot;</span><span class="p">))</span> <span class="p">{</span>
			<span class="n">Map</span><span class="p">.</span><span class="n">Info</span><span class="p">.</span><span class="n">PlayerType</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">PlayerComputer</span><span class="p">;</span>
		<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">type</span><span class="p">,</span> <span class="s">&quot;person&quot;</span><span class="p">))</span> <span class="p">{</span>
			<span class="n">Map</span><span class="p">.</span><span class="n">Info</span><span class="p">.</span><span class="n">PlayerType</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">PlayerPerson</span><span class="p">;</span>
		<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">type</span><span class="p">,</span> <span class="s">&quot;rescue-passive&quot;</span><span class="p">))</span> <span class="p">{</span>
			<span class="n">Map</span><span class="p">.</span><span class="n">Info</span><span class="p">.</span><span class="n">PlayerType</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">PlayerRescuePassive</span><span class="p">;</span>
		<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">type</span><span class="p">,</span> <span class="s">&quot;rescue-active&quot;</span><span class="p">))</span> <span class="p">{</span>
			<span class="n">Map</span><span class="p">.</span><span class="n">Info</span><span class="p">.</span><span class="n">PlayerType</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">PlayerRescueActive</span><span class="p">;</span>
		<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
			<span class="n">LuaError</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="s">&quot;Unsupported tag: %s&quot;</span> <span class="n">_C_</span> <span class="n">type</span><span class="p">);</span>
		<span class="p">}</span>
	<span class="p">}</span>
	<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="n">numplayers</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">PlayerMax</span> <span class="o">-</span> <span class="mi">1</span><span class="p">;</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">Map</span><span class="p">.</span><span class="n">Info</span><span class="p">.</span><span class="n">PlayerType</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">PlayerNobody</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">numplayers</span> <span class="o">&lt;</span> <span class="n">PlayerMax</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">Map</span><span class="p">.</span><span class="n">Info</span><span class="p">.</span><span class="n">PlayerType</span><span class="p">[</span><span class="n">PlayerMax</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">PlayerNeutral</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</p>
                          </details>
                        </details>
                        
                        <details>
                        <summary>DefineTileset</summary>
                        <p><br>  Define tileset<br><br>  @param l  Lua state.</p>
                          <details>
                          <summary>/map/script_map.cpp:762 CclDefineTileset</summary>
                          <p><div class="highlight"><pre><span></span><span class="k">static</span> <span class="kt">int</span> <span class="nf">CclDefineTileset</span><span class="p">(</span><span class="n">lua_State</span> <span class="o">*</span><span class="n">l</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">Map</span><span class="p">.</span><span class="n">Tileset</span><span class="o">-&gt;</span><span class="n">parse</span><span class="p">(</span><span class="n">l</span><span class="p">);</span>

	<span class="c1">//  Load and prepare the tileset</span>
	<span class="n">PixelTileSize</span> <span class="o">=</span> <span class="n">Map</span><span class="p">.</span><span class="n">Tileset</span><span class="o">-&gt;</span><span class="n">getPixelTileSize</span><span class="p">();</span>

	<span class="n">ShowLoadProgress</span><span class="p">(</span><span class="n">_</span><span class="p">(</span><span class="s">&quot;Tileset &#39;%s&#39;&quot;</span><span class="p">),</span> <span class="n">Map</span><span class="p">.</span><span class="n">Tileset</span><span class="o">-&gt;</span><span class="n">ImageFile</span><span class="p">.</span><span class="n">c_str</span><span class="p">());</span>
	<span class="n">Map</span><span class="p">.</span><span class="n">TileGraphic</span> <span class="o">=</span> <span class="n">CGraphic</span><span class="o">::</span><span class="n">New</span><span class="p">(</span><span class="n">Map</span><span class="p">.</span><span class="n">Tileset</span><span class="o">-&gt;</span><span class="n">ImageFile</span><span class="p">,</span> <span class="n">PixelTileSize</span><span class="p">.</span><span class="n">x</span><span class="p">,</span> <span class="n">PixelTileSize</span><span class="p">.</span><span class="n">y</span><span class="p">);</span>
	<span class="n">Map</span><span class="p">.</span><span class="n">TileGraphic</span><span class="o">-&gt;</span><span class="n">Load</span><span class="p">();</span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</p>
                          </details>
                        </details>
                        
                        <details>
                        <summary>SetTileFlags</summary>
                        <p><br>  Set the flags like "water" for a tile of a tileset<br><br>  @param l  Lua state.</p>
                          <details>
                          <summary>/map/script_map.cpp:801 CclSetTileFlags</summary>
                          <p><div class="highlight"><pre><span></span><span class="k">static</span> <span class="kt">int</span> <span class="nf">CclSetTileFlags</span><span class="p">(</span><span class="n">lua_State</span> <span class="o">*</span><span class="n">l</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">lua_gettop</span><span class="p">(</span><span class="n">l</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">LuaError</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="s">&quot;No flags defined&quot;</span><span class="p">);</span>
	<span class="p">}</span>
	<span class="k">const</span> <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">tilenumber</span> <span class="o">=</span> <span class="n">LuaToNumber</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">tilenumber</span> <span class="o">&gt;=</span> <span class="n">Map</span><span class="p">.</span><span class="n">Tileset</span><span class="o">-&gt;</span><span class="n">tiles</span><span class="p">.</span><span class="n">size</span><span class="p">())</span> <span class="p">{</span>
		<span class="n">LuaError</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="s">&quot;Accessed a tile that&#39;s not defined&quot;</span><span class="p">);</span>
	<span class="p">}</span>
	<span class="kt">int</span> <span class="n">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">flags</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

	<span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">newBase</span> <span class="o">=</span> <span class="n">Map</span><span class="p">.</span><span class="n">Tileset</span><span class="o">-&gt;</span><span class="n">parseTilesetTileFlags</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">flags</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">j</span><span class="p">);</span>
	<span class="n">Map</span><span class="p">.</span><span class="n">Tileset</span><span class="o">-&gt;</span><span class="n">tiles</span><span class="p">[</span><span class="n">tilenumber</span><span class="p">].</span><span class="n">flag</span> <span class="o">=</span> <span class="n">flags</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">newBase</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">Map</span><span class="p">.</span><span class="n">Tileset</span><span class="o">-&gt;</span><span class="n">tiles</span><span class="p">[</span><span class="n">tilenumber</span><span class="p">].</span><span class="n">tileinfo</span><span class="p">.</span><span class="n">BaseTerrain</span> <span class="o">=</span> <span class="n">newBase</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</p>
                          </details>
                        </details>
                        
                        <details>
                        <summary>BuildTilesetTables</summary>
                        <p><br> Build tileset tables like humanWallTable or mixedLookupTable<br><br> Called after DefineTileset and only for tilesets that have wall,<br> trees and rocks. This function will be deleted when removing<br> support of walls and alike in the tileset.</p>
                          <details>
                          <summary>/map/script_map.cpp:776 CclBuildTilesetTables</summary>
                          <p><div class="highlight"><pre><span></span><span class="k">static</span> <span class="kt">int</span> <span class="nf">CclBuildTilesetTables</span><span class="p">(</span><span class="n">lua_State</span> <span class="o">*</span><span class="n">l</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">LuaCheckArgs</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>

	<span class="n">Map</span><span class="p">.</span><span class="n">Tileset</span><span class="o">-&gt;</span><span class="n">buildTable</span><span class="p">(</span><span class="n">l</span><span class="p">);</span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</p>
                          </details>
                        </details>
                        
                        <details>
                        <summary>GetTileTerrainName</summary>
                        <p><br>  Get the name of the terrain of the tile.<br><br>  @param l  Lua state.<br><br>  @return   The name of the terrain of the tile.</p>
                          <details>
                          <summary>/map/script_map.cpp:824 CclGetTileTerrainName</summary>
                          <p><div class="highlight"><pre><span></span><span class="k">static</span> <span class="kt">int</span> <span class="nf">CclGetTileTerrainName</span><span class="p">(</span><span class="n">lua_State</span> <span class="o">*</span><span class="n">l</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">LuaCheckArgs</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">2</span><span class="p">);</span>

	<span class="k">const</span> <span class="n">Vec2i</span> <span class="n">pos</span><span class="p">(</span><span class="n">LuaToNumber</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">LuaToNumber</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">2</span><span class="p">));</span>

	<span class="k">const</span> <span class="n">CMapField</span> <span class="o">&amp;</span><span class="n">mf</span> <span class="o">=</span> <span class="o">*</span><span class="n">Map</span><span class="p">.</span><span class="n">Field</span><span class="p">(</span><span class="n">pos</span><span class="p">);</span>
	<span class="k">const</span> <span class="n">CTileset</span> <span class="o">&amp;</span><span class="n">tileset</span> <span class="o">=</span> <span class="o">*</span><span class="n">Map</span><span class="p">.</span><span class="n">Tileset</span><span class="p">;</span>
	<span class="k">const</span> <span class="kt">int</span> <span class="n">index</span> <span class="o">=</span> <span class="n">tileset</span><span class="p">.</span><span class="n">findTileIndexByTile</span><span class="p">(</span><span class="n">mf</span><span class="p">.</span><span class="n">getGraphicTile</span><span class="p">());</span>
	<span class="n">Assert</span><span class="p">(</span><span class="n">index</span> <span class="o">!=</span> <span class="mi">-1</span><span class="p">);</span>
	<span class="k">const</span> <span class="kt">int</span> <span class="n">baseTerrainIdx</span> <span class="o">=</span> <span class="n">tileset</span><span class="p">.</span><span class="n">tiles</span><span class="p">[</span><span class="n">index</span><span class="p">].</span><span class="n">tileinfo</span><span class="p">.</span><span class="n">BaseTerrain</span><span class="p">;</span>

	<span class="n">lua_pushstring</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">tileset</span><span class="p">.</span><span class="n">getTerrainName</span><span class="p">(</span><span class="n">baseTerrainIdx</span><span class="p">).</span><span class="n">c_str</span><span class="p">());</span>
	<span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</p>
                          </details>
                        </details>
                        
                        <details>
                        <summary>GetTileTerrainHasFlag</summary>
                        <p><br>  Check if the tile's terrain has a particular flag.<br><br>  @param l  Lua state.<br><br>  @return   True if has the flag, false if not.</p>
                          <details>
                          <summary>/map/script_map.cpp:870 CclGetTileTerrainHasFlag</summary>
                          <p><div class="highlight"><pre><span></span><span class="k">static</span> <span class="kt">int</span> <span class="nf">CclGetTileTerrainHasFlag</span><span class="p">(</span><span class="n">lua_State</span> <span class="o">*</span><span class="n">l</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">LuaCheckArgs</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">3</span><span class="p">);</span>

	<span class="k">const</span> <span class="n">Vec2i</span> <span class="n">pos</span><span class="p">(</span><span class="n">LuaToNumber</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">LuaToNumber</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">2</span><span class="p">));</span>

	<span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">flag</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">flag_name</span> <span class="o">=</span> <span class="n">LuaToString</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">3</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">flag_name</span><span class="p">,</span> <span class="s">&quot;opaque&quot;</span><span class="p">))</span> <span class="p">{</span>
		<span class="n">flag</span> <span class="o">=</span> <span class="n">MapFieldOpaque</span><span class="p">;</span>
	<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">flag_name</span><span class="p">,</span> <span class="s">&quot;water&quot;</span><span class="p">))</span> <span class="p">{</span>
		<span class="n">flag</span> <span class="o">=</span> <span class="n">MapFieldWaterAllowed</span><span class="p">;</span>
	<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">flag_name</span><span class="p">,</span> <span class="s">&quot;land&quot;</span><span class="p">))</span> <span class="p">{</span>
		<span class="n">flag</span> <span class="o">=</span> <span class="n">MapFieldLandAllowed</span><span class="p">;</span>
	<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">flag_name</span><span class="p">,</span> <span class="s">&quot;coast&quot;</span><span class="p">))</span> <span class="p">{</span>
		<span class="n">flag</span> <span class="o">=</span> <span class="n">MapFieldCoastAllowed</span><span class="p">;</span>
	<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">flag_name</span><span class="p">,</span> <span class="s">&quot;no-building&quot;</span><span class="p">))</span> <span class="p">{</span>
		<span class="n">flag</span> <span class="o">=</span> <span class="n">MapFieldNoBuilding</span><span class="p">;</span>
	<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">flag_name</span><span class="p">,</span> <span class="s">&quot;unpassable&quot;</span><span class="p">))</span> <span class="p">{</span>
		<span class="n">flag</span> <span class="o">=</span> <span class="n">MapFieldUnpassable</span><span class="p">;</span>
	<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">flag_name</span><span class="p">,</span> <span class="s">&quot;wall&quot;</span><span class="p">))</span> <span class="p">{</span>
		<span class="n">flag</span> <span class="o">=</span> <span class="n">MapFieldWall</span><span class="p">;</span>
	<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">flag_name</span><span class="p">,</span> <span class="s">&quot;rock&quot;</span><span class="p">))</span> <span class="p">{</span>
		<span class="n">flag</span> <span class="o">=</span> <span class="n">MapFieldRocks</span><span class="p">;</span>
	<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">flag_name</span><span class="p">,</span> <span class="s">&quot;forest&quot;</span><span class="p">))</span> <span class="p">{</span>
		<span class="n">flag</span> <span class="o">=</span> <span class="n">MapFieldForest</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="k">const</span> <span class="n">CMapField</span> <span class="o">&amp;</span><span class="n">mf</span> <span class="o">=</span> <span class="o">*</span><span class="n">Map</span><span class="p">.</span><span class="n">Field</span><span class="p">(</span><span class="n">pos</span><span class="p">);</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">mf</span><span class="p">.</span><span class="n">getFlag</span><span class="p">()</span> <span class="o">&amp;</span> <span class="n">flag</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">lua_pushboolean</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
	<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
		<span class="n">lua_pushboolean</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
	<span class="p">}</span>

	<span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</p>
                          </details>
                        </details>
                        
                        <details>
                        <summary>SetEnableWallsForSP</summary>
                        <p><br>  Enable walls enabled for single player games (for debug purposes)<br><br>  @param l  Lua state.<br><br>  @return   0 for success, 1 for wrong type;</p>
                          <details>
                          <summary>/map/script_map.cpp:884 CclSetEnableWallsForSP</summary>
                          <p><div class="highlight"><pre><span></span><span class="k">static</span> <span class="kt">int</span> <span class="nf">CclSetEnableWallsForSP</span><span class="p">(</span><span class="n">lua_State</span> <span class="o">*</span><span class="n">l</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">LuaCheckArgs</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
	<span class="n">EnableWallsInSinglePlayer</span> <span class="o">=</span> <span class="n">LuaToBoolean</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</p>
                          </details>
                        </details>
                        
                        <details>
                        <summary>GetIsWallsEnabledForSP</summary>
                        <p><br>  Check if walls enabled for single player games (for debug purposes)</p>
                          <details>
                          <summary>/map/script_map.cpp:894 CclIsWallsEnabledForSP</summary>
                          <p><div class="highlight"><pre><span></span><span class="k">static</span> <span class="kt">int</span> <span class="nf">CclIsWallsEnabledForSP</span><span class="p">(</span><span class="n">lua_State</span> <span class="o">*</span><span class="n">l</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">LuaCheckArgs</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
	<span class="n">lua_pushboolean</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">EnableWallsInSinglePlayer</span><span class="p">);</span>
	<span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</p>
                          </details>
                        </details>
                        
                        <details>
                        <summary>GetIsGameHoster</summary>
                        <p><br>  Check if network game was created on this PC</p>
                          <details>
                          <summary>/map/script_map.cpp:904 CclGetIsGameHoster</summary>
                          <p><div class="highlight"><pre><span></span><span class="k">static</span> <span class="kt">int</span> <span class="nf">CclGetIsGameHoster</span><span class="p">(</span><span class="n">lua_State</span> <span class="o">*</span><span class="n">l</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">LuaCheckArgs</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
	<span class="n">lua_pushboolean</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="p">(</span><span class="n">ThisPlayer</span><span class="o">-&gt;</span><span class="n">Index</span> <span class="o">==</span> <span class="n">Hosts</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">PlyNr</span><span class="p">)</span> <span class="o">?</span> <span class="nb">true</span> <span class="o">:</span> <span class="nb">false</span><span class="p">);</span>
	<span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</p>
                          </details>
                        </details>
                        <hr>/video/video.cpp<hr>
                        <details>
                        <summary>SetVideoSyncSpeed</summary>
                        <p><br>  Set the video sync speed<br><br>  @param l  Lua state.</p>
                          <details>
                          <summary>/video/video.cpp:353 CclSetVideoSyncSpeed</summary>
                          <p><div class="highlight"><pre><span></span><span class="k">static</span> <span class="kt">int</span> <span class="nf">CclSetVideoSyncSpeed</span><span class="p">(</span><span class="n">lua_State</span> <span class="o">*</span><span class="n">l</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">LuaCheckArgs</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
	<span class="n">VideoSyncSpeed</span> <span class="o">=</span> <span class="n">LuaToNumber</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</p>
                          </details>
                        </details>
                        <hr>/video/shaders.cpp<hr>
                        <details>
                        <summary>GetShaderNames</summary>
                        <p>/video/shaders.cpp:445 CclGetShaderNames</p>
                        <p><div class="highlight"><pre><span></span><span class="k">static</span> <span class="kt">int</span> <span class="nf">CclGetShaderNames</span><span class="p">(</span><span class="n">lua_State</span> <span class="o">*</span><span class="n">l</span><span class="p">)</span> <span class="p">{</span>
	<span class="n">LuaCheckArgs</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
	<span class="n">lua_newtable</span><span class="p">(</span><span class="n">l</span><span class="p">);</span>
	<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">shaderNames</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">!=</span> <span class="nb">NULL</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">lua_pushstring</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">shaderNames</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span>
		<span class="n">lua_rawseti</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">-2</span><span class="p">,</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>
	<span class="p">}</span>
	<span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</p>
                        </details>
                        
                        <details>
                        <summary>GetShader</summary>
                        <p>/video/shaders.cpp:414 CclGetShader</p>
                        <p><div class="highlight"><pre><span></span><span class="k">static</span> <span class="kt">int</span> <span class="nf">CclGetShader</span><span class="p">(</span><span class="n">lua_State</span> <span class="o">*</span><span class="n">l</span><span class="p">)</span> <span class="p">{</span>
	<span class="n">LuaCheckArgs</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
	<span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">shaderName</span> <span class="o">=</span> <span class="n">shaderNames</span><span class="p">[</span><span class="n">currentShaderIdx</span><span class="p">];</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">shaderName</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">lua_pushstring</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">shaderName</span><span class="p">);</span>
	<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
		<span class="n">lua_pushnil</span><span class="p">(</span><span class="n">l</span><span class="p">);</span>
	<span class="p">}</span>
	<span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</p>
                        </details>
                        
                        <details>
                        <summary>SetShader</summary>
                        <p>/video/shaders.cpp:435 CclSetShader</p>
                        <p><div class="highlight"><pre><span></span><span class="k">static</span> <span class="kt">int</span> <span class="nf">CclSetShader</span><span class="p">(</span><span class="n">lua_State</span> <span class="o">*</span><span class="n">l</span><span class="p">)</span> <span class="p">{</span>
	<span class="n">LuaCheckArgs</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
	<span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">shaderName</span> <span class="o">=</span> <span class="n">LuaToString</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
	<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">MAX_SHADERS</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">n</span> <span class="o">=</span> <span class="n">shaderNames</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">n</span><span class="p">)</span> <span class="p">{</span>
			<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">shaderName</span><span class="p">))</span> <span class="p">{</span>
				<span class="n">currentShaderIdx</span> <span class="o">=</span> <span class="n">i</span><span class="p">;</span>
				<span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;SetShader: &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">shaderNames</span><span class="p">[</span><span class="n">currentShaderIdx</span><span class="p">]</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
				<span class="n">lua_pushboolean</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
				<span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
			<span class="p">}</span>
		<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
			<span class="k">break</span><span class="p">;</span>
		<span class="p">}</span>
	<span class="p">}</span>
	<span class="n">currentShaderIdx</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="n">lua_pushboolean</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
	<span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</p>
                        </details>
                        <hr>/video/cursor.cpp<hr>
                        <details>
                        <summary>DefineCursor</summary>
                        <p><br>  Define a cursor.<br><br>  @param l  Lua state.</p>
                          <details>
                          <summary>/video/cursor.cpp:423 CclDefineCursor</summary>
                          <p><div class="highlight"><pre><span></span><span class="k">static</span> <span class="kt">int</span> <span class="nf">CclDefineCursor</span><span class="p">(</span><span class="n">lua_State</span> <span class="o">*</span><span class="n">l</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">name</span><span class="p">;</span>
	<span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">race</span><span class="p">;</span>
	<span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">file</span><span class="p">;</span>
	<span class="n">PixelPos</span> <span class="n">hotpos</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
	<span class="kt">int</span> <span class="n">w</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">h</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">rate</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

	<span class="n">LuaCheckArgs</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">lua_istable</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span> <span class="p">{</span>
		<span class="n">LuaError</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="s">&quot;incorrect argument&quot;</span><span class="p">);</span>
	<span class="p">}</span>
	<span class="n">lua_pushnil</span><span class="p">(</span><span class="n">l</span><span class="p">);</span>
	<span class="k">while</span> <span class="p">(</span><span class="n">lua_next</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span> <span class="p">{</span>
		<span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">value</span> <span class="o">=</span> <span class="n">LuaToString</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">-2</span><span class="p">);</span>
		<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s">&quot;Name&quot;</span><span class="p">))</span> <span class="p">{</span>
			<span class="n">name</span> <span class="o">=</span> <span class="n">LuaToString</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">-1</span><span class="p">);</span>
		<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s">&quot;Race&quot;</span><span class="p">))</span> <span class="p">{</span>
			<span class="n">race</span> <span class="o">=</span> <span class="n">LuaToString</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">-1</span><span class="p">);</span>
		<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s">&quot;File&quot;</span><span class="p">))</span> <span class="p">{</span>
			<span class="n">file</span> <span class="o">=</span> <span class="n">LuaToString</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">-1</span><span class="p">);</span>
		<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s">&quot;HotSpot&quot;</span><span class="p">))</span> <span class="p">{</span>
			<span class="n">CclGetPos</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">hotpos</span><span class="p">.</span><span class="n">x</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">hotpos</span><span class="p">.</span><span class="n">y</span><span class="p">);</span>
		<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s">&quot;Size&quot;</span><span class="p">))</span> <span class="p">{</span>
			<span class="n">CclGetPos</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">w</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">h</span><span class="p">);</span>
		<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s">&quot;Rate&quot;</span><span class="p">))</span> <span class="p">{</span>
			<span class="n">rate</span> <span class="o">=</span> <span class="n">LuaToNumber</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">-1</span><span class="p">);</span>
		<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
			<span class="n">LuaError</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="s">&quot;Unsupported tag: %s&quot;</span> <span class="n">_C_</span> <span class="n">value</span><span class="p">);</span>
		<span class="p">}</span>
		<span class="n">lua_pop</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
	<span class="p">}</span>

	<span class="n">Assert</span><span class="p">(</span><span class="o">!</span><span class="n">name</span><span class="p">.</span><span class="n">empty</span><span class="p">()</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="n">file</span><span class="p">.</span><span class="n">empty</span><span class="p">()</span> <span class="o">&amp;&amp;</span> <span class="n">w</span> <span class="o">&amp;&amp;</span> <span class="n">h</span><span class="p">);</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">race</span> <span class="o">==</span> <span class="s">&quot;any&quot;</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">race</span><span class="p">.</span><span class="n">clear</span><span class="p">();</span>
	<span class="p">}</span>

	<span class="c1">//</span>
	<span class="c1">//  Look if this kind of cursor already exists.</span>
	<span class="c1">//</span>
	<span class="n">CCursor</span> <span class="o">*</span><span class="n">ct</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">;</span>
	<span class="k">for</span> <span class="p">(</span><span class="kt">size_t</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">AllCursors</span><span class="p">.</span><span class="n">size</span><span class="p">();</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span> <span class="p">{</span>
		<span class="c1">//  Race not same, not found.</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">AllCursors</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">-&gt;</span><span class="n">Race</span> <span class="o">!=</span> <span class="n">race</span><span class="p">)</span> <span class="p">{</span>
			<span class="k">continue</span><span class="p">;</span>
		<span class="p">}</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">AllCursors</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">-&gt;</span><span class="n">Ident</span> <span class="o">==</span> <span class="n">name</span><span class="p">)</span> <span class="p">{</span>
			<span class="n">ct</span> <span class="o">=</span> <span class="n">AllCursors</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
			<span class="k">break</span><span class="p">;</span>
		<span class="p">}</span>
	<span class="p">}</span>

	<span class="c1">//</span>
	<span class="c1">//  Not found, make a new slot.</span>
	<span class="c1">//</span>
	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">ct</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">ct</span> <span class="o">=</span> <span class="k">new</span> <span class="n">CCursor</span><span class="p">();</span>
		<span class="n">AllCursors</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">ct</span><span class="p">);</span>
		<span class="n">ct</span><span class="o">-&gt;</span><span class="n">Ident</span> <span class="o">=</span> <span class="n">name</span><span class="p">;</span>
		<span class="n">ct</span><span class="o">-&gt;</span><span class="n">Race</span> <span class="o">=</span> <span class="n">race</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="n">ct</span><span class="o">-&gt;</span><span class="n">G</span> <span class="o">=</span> <span class="n">CGraphic</span><span class="o">::</span><span class="n">New</span><span class="p">(</span><span class="n">file</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="n">h</span><span class="p">);</span>
	<span class="n">ct</span><span class="o">-&gt;</span><span class="n">HotPos</span> <span class="o">=</span> <span class="n">hotpos</span><span class="p">;</span>
	<span class="n">ct</span><span class="o">-&gt;</span><span class="n">FrameRate</span> <span class="o">=</span> <span class="n">rate</span><span class="p">;</span>

	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</p>
                          </details>
                        </details>
                        
                        <details>
                        <summary>SetGameCursor</summary>
                        <p><br>  Set the current game cursor.<br><br>  @param l  Lua state.</p>
                          <details>
                          <summary>/video/cursor.cpp:435 CclSetGameCursor</summary>
                          <p><div class="highlight"><pre><span></span><span class="k">static</span> <span class="kt">int</span> <span class="nf">CclSetGameCursor</span><span class="p">(</span><span class="n">lua_State</span> <span class="o">*</span><span class="n">l</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">LuaCheckArgs</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
	<span class="n">GameCursor</span> <span class="o">=</span> <span class="n">CursorByIdent</span><span class="p">(</span><span class="n">LuaToString</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">1</span><span class="p">));</span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</p>
                          </details>
                        </details>
                        <hr>/spell/script_spell.cpp<hr>
                        <details>
                        <summary>DefineSpell</summary>
                        <p><br>  Parse Spell.<br><br>  @param l  Lua state.</p>
                          <details>
                          <summary>/spell/script_spell.cpp:419 CclDefineSpell</summary>
                          <p><div class="highlight"><pre><span></span><span class="k">static</span> <span class="kt">int</span> <span class="nf">CclDefineSpell</span><span class="p">(</span><span class="n">lua_State</span> <span class="o">*</span><span class="n">l</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">const</span> <span class="kt">int</span> <span class="n">args</span> <span class="o">=</span> <span class="n">lua_gettop</span><span class="p">(</span><span class="n">l</span><span class="p">);</span>
	<span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">identname</span> <span class="o">=</span> <span class="n">LuaToString</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
	<span class="n">SpellType</span> <span class="o">*</span><span class="n">spell</span> <span class="o">=</span> <span class="n">SpellTypeByIdent</span><span class="p">(</span><span class="n">identname</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">spell</span> <span class="o">!=</span> <span class="nb">NULL</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">DebugPrint</span><span class="p">(</span><span class="s">&quot;Redefining spell-type &#39;%s&#39;</span><span class="se">\n</span><span class="s">&quot;</span> <span class="n">_C_</span> <span class="n">identname</span><span class="p">.</span><span class="n">c_str</span><span class="p">());</span>
	<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
		<span class="n">spell</span> <span class="o">=</span> <span class="k">new</span> <span class="n">SpellType</span><span class="p">(</span><span class="n">SpellTypeTable</span><span class="p">.</span><span class="n">size</span><span class="p">(),</span> <span class="n">identname</span><span class="p">);</span>
		<span class="k">for</span> <span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">CUnitType</span> <span class="o">*&gt;::</span><span class="n">size_type</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">UnitTypes</span><span class="p">.</span><span class="n">size</span><span class="p">();</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span> <span class="p">{</span> <span class="c1">// adjust array for caster already defined</span>
			<span class="k">if</span> <span class="p">(</span><span class="n">UnitTypes</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">-&gt;</span><span class="n">CanCastSpell</span><span class="p">)</span> <span class="p">{</span>
				<span class="kt">char</span> <span class="o">*</span><span class="n">newc</span> <span class="o">=</span> <span class="k">new</span> <span class="kt">char</span><span class="p">[(</span><span class="n">SpellTypeTable</span><span class="p">.</span><span class="n">size</span><span class="p">()</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="k">sizeof</span><span class="p">(</span><span class="kt">char</span><span class="p">)];</span>
				<span class="n">memcpy</span><span class="p">(</span><span class="n">newc</span><span class="p">,</span> <span class="n">UnitTypes</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">-&gt;</span><span class="n">CanCastSpell</span><span class="p">,</span> <span class="n">SpellTypeTable</span><span class="p">.</span><span class="n">size</span><span class="p">()</span> <span class="o">*</span> <span class="k">sizeof</span><span class="p">(</span><span class="kt">char</span><span class="p">));</span>
				<span class="k">delete</span><span class="p">[]</span> <span class="n">UnitTypes</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">-&gt;</span><span class="n">CanCastSpell</span><span class="p">;</span>
				<span class="n">UnitTypes</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">-&gt;</span><span class="n">CanCastSpell</span> <span class="o">=</span> <span class="n">newc</span><span class="p">;</span>
				<span class="n">UnitTypes</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">-&gt;</span><span class="n">CanCastSpell</span><span class="p">[</span><span class="n">SpellTypeTable</span><span class="p">.</span><span class="n">size</span><span class="p">()]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
			<span class="p">}</span>
			<span class="k">if</span> <span class="p">(</span><span class="n">UnitTypes</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">-&gt;</span><span class="n">AutoCastActive</span><span class="p">)</span> <span class="p">{</span>
				<span class="kt">char</span> <span class="o">*</span><span class="n">newc</span> <span class="o">=</span> <span class="k">new</span> <span class="kt">char</span><span class="p">[(</span><span class="n">SpellTypeTable</span><span class="p">.</span><span class="n">size</span><span class="p">()</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="k">sizeof</span><span class="p">(</span><span class="kt">char</span><span class="p">)];</span>
				<span class="n">memcpy</span><span class="p">(</span><span class="n">newc</span><span class="p">,</span> <span class="n">UnitTypes</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">-&gt;</span><span class="n">AutoCastActive</span><span class="p">,</span> <span class="n">SpellTypeTable</span><span class="p">.</span><span class="n">size</span><span class="p">()</span> <span class="o">*</span> <span class="k">sizeof</span><span class="p">(</span><span class="kt">char</span><span class="p">));</span>
				<span class="k">delete</span><span class="p">[]</span> <span class="n">UnitTypes</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">-&gt;</span><span class="n">AutoCastActive</span><span class="p">;</span>
				<span class="n">UnitTypes</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">-&gt;</span><span class="n">AutoCastActive</span> <span class="o">=</span> <span class="n">newc</span><span class="p">;</span>
				<span class="n">UnitTypes</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">-&gt;</span><span class="n">AutoCastActive</span><span class="p">[</span><span class="n">SpellTypeTable</span><span class="p">.</span><span class="n">size</span><span class="p">()]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
			<span class="p">}</span>
		<span class="p">}</span>
		<span class="n">SpellTypeTable</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">spell</span><span class="p">);</span>
	<span class="p">}</span>
	<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">args</span><span class="p">;</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">value</span> <span class="o">=</span> <span class="n">LuaToString</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>
		<span class="o">++</span><span class="n">i</span><span class="p">;</span>
		<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s">&quot;showname&quot;</span><span class="p">))</span> <span class="p">{</span>
			<span class="n">spell</span><span class="o">-&gt;</span><span class="n">Name</span> <span class="o">=</span> <span class="n">LuaToString</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>
		<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s">&quot;manacost&quot;</span><span class="p">))</span> <span class="p">{</span>
			<span class="n">spell</span><span class="o">-&gt;</span><span class="n">ManaCost</span> <span class="o">=</span> <span class="n">LuaToNumber</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>
		<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s">&quot;cooldown&quot;</span><span class="p">))</span> <span class="p">{</span>
			<span class="n">spell</span><span class="o">-&gt;</span><span class="n">CoolDown</span> <span class="o">=</span> <span class="n">LuaToNumber</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>
		<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s">&quot;res-cost&quot;</span><span class="p">))</span> <span class="p">{</span>
			<span class="n">lua_pushvalue</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>
			<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">lua_istable</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">-1</span><span class="p">))</span> <span class="p">{</span>
				<span class="n">LuaError</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="s">&quot;incorrect argument&quot;</span><span class="p">);</span>
			<span class="p">}</span>
			<span class="k">const</span> <span class="kt">int</span> <span class="n">len</span> <span class="o">=</span> <span class="n">lua_rawlen</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">-1</span><span class="p">);</span>
			<span class="k">if</span> <span class="p">(</span><span class="n">len</span> <span class="o">!=</span> <span class="n">MaxCosts</span><span class="p">)</span> <span class="p">{</span>
				<span class="n">LuaError</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="s">&quot;resource table size isn&#39;t correct&quot;</span><span class="p">);</span>
			<span class="p">}</span>
			<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">j</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="n">len</span><span class="p">;</span> <span class="o">++</span><span class="n">j</span><span class="p">)</span> <span class="p">{</span> <span class="c1">// exclude the time</span>
				<span class="n">spell</span><span class="o">-&gt;</span><span class="n">Costs</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">LuaToNumber</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">-1</span><span class="p">,</span> <span class="n">j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>
			<span class="p">}</span>
			<span class="n">lua_pop</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
		<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s">&quot;range&quot;</span><span class="p">))</span> <span class="p">{</span>
			<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">lua_isstring</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="n">lua_isnumber</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span> <span class="p">{</span>
				<span class="n">LuaError</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="s">&quot;incorrect argument&quot;</span><span class="p">);</span>
			<span class="p">}</span>
			<span class="k">if</span> <span class="p">(</span><span class="n">lua_isstring</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">lua_tostring</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span> <span class="s">&quot;infinite&quot;</span><span class="p">))</span> <span class="p">{</span>
				<span class="n">spell</span><span class="o">-&gt;</span><span class="n">Range</span> <span class="o">=</span> <span class="n">INFINITE_RANGE</span><span class="p">;</span>
			<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">lua_isnumber</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span> <span class="p">{</span>
				<span class="n">spell</span><span class="o">-&gt;</span><span class="n">Range</span> <span class="o">=</span> <span class="k">static_cast</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="p">(</span><span class="n">lua_tonumber</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">));</span>
			<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
				<span class="n">LuaError</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="s">&quot;Invalid range&quot;</span><span class="p">);</span>
			<span class="p">}</span>
		<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s">&quot;repeat-cast&quot;</span><span class="p">))</span> <span class="p">{</span>
			<span class="n">spell</span><span class="o">-&gt;</span><span class="n">RepeatCast</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
			<span class="o">--</span><span class="n">i</span><span class="p">;</span>
		<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s">&quot;force-use-animation&quot;</span><span class="p">))</span> <span class="p">{</span>
			<span class="n">spell</span><span class="o">-&gt;</span><span class="n">ForceUseAnimation</span> <span class="o">=</span> <span class="nb">true</span><span class="p">;</span>
			<span class="o">--</span><span class="n">i</span><span class="p">;</span>
		<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s">&quot;target&quot;</span><span class="p">))</span> <span class="p">{</span>
			<span class="n">value</span> <span class="o">=</span> <span class="n">LuaToString</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>
			<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s">&quot;self&quot;</span><span class="p">))</span> <span class="p">{</span>
				<span class="n">spell</span><span class="o">-&gt;</span><span class="n">Target</span> <span class="o">=</span> <span class="n">TargetSelf</span><span class="p">;</span>
			<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s">&quot;unit&quot;</span><span class="p">))</span> <span class="p">{</span>
				<span class="n">spell</span><span class="o">-&gt;</span><span class="n">Target</span> <span class="o">=</span> <span class="n">TargetUnit</span><span class="p">;</span>
			<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s">&quot;position&quot;</span><span class="p">))</span> <span class="p">{</span>
				<span class="n">spell</span><span class="o">-&gt;</span><span class="n">Target</span> <span class="o">=</span> <span class="n">TargetPosition</span><span class="p">;</span>
			<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
				<span class="n">LuaError</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="s">&quot;Unsupported spell target type tag: %s&quot;</span> <span class="n">_C_</span> <span class="n">value</span><span class="p">);</span>
			<span class="p">}</span>
		<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s">&quot;action&quot;</span><span class="p">))</span> <span class="p">{</span>
			<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">lua_istable</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span> <span class="p">{</span>
				<span class="n">LuaError</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="s">&quot;incorrect argument&quot;</span><span class="p">);</span>
			<span class="p">}</span>
			<span class="k">const</span> <span class="kt">int</span> <span class="n">subargs</span> <span class="o">=</span> <span class="n">lua_rawlen</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>
			<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">k</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">k</span> <span class="o">&lt;</span> <span class="n">subargs</span><span class="p">;</span> <span class="o">++</span><span class="n">k</span><span class="p">)</span> <span class="p">{</span>
				<span class="n">lua_rawgeti</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">k</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>
				<span class="n">spell</span><span class="o">-&gt;</span><span class="n">Action</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">CclSpellAction</span><span class="p">(</span><span class="n">l</span><span class="p">));</span>
				<span class="n">lua_pop</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
			<span class="p">}</span>
		<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s">&quot;condition&quot;</span><span class="p">))</span> <span class="p">{</span>
			<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">spell</span><span class="o">-&gt;</span><span class="n">Condition</span><span class="p">)</span> <span class="p">{</span>
				<span class="n">spell</span><span class="o">-&gt;</span><span class="n">Condition</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ConditionInfo</span><span class="p">;</span>
			<span class="p">}</span>
			<span class="n">lua_pushvalue</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>
			<span class="n">CclSpellCondition</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">spell</span><span class="o">-&gt;</span><span class="n">Condition</span><span class="p">);</span>
			<span class="n">lua_pop</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
		<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s">&quot;autocast&quot;</span><span class="p">))</span> <span class="p">{</span>
			<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">spell</span><span class="o">-&gt;</span><span class="n">AutoCast</span><span class="p">)</span> <span class="p">{</span>
				<span class="n">spell</span><span class="o">-&gt;</span><span class="n">AutoCast</span> <span class="o">=</span> <span class="k">new</span> <span class="n">AutoCastInfo</span><span class="p">();</span>
			<span class="p">}</span>
			<span class="n">lua_pushvalue</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>
			<span class="n">CclSpellAutocast</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">spell</span><span class="o">-&gt;</span><span class="n">AutoCast</span><span class="p">);</span>
			<span class="n">lua_pop</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
		<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s">&quot;ai-cast&quot;</span><span class="p">))</span> <span class="p">{</span>
			<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">spell</span><span class="o">-&gt;</span><span class="n">AICast</span><span class="p">)</span> <span class="p">{</span>
				<span class="n">spell</span><span class="o">-&gt;</span><span class="n">AICast</span> <span class="o">=</span> <span class="k">new</span> <span class="n">AutoCastInfo</span><span class="p">();</span>
			<span class="p">}</span>
			<span class="n">lua_pushvalue</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>
			<span class="n">CclSpellAutocast</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">spell</span><span class="o">-&gt;</span><span class="n">AICast</span><span class="p">);</span>
			<span class="n">lua_pop</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
		<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s">&quot;sound-when-cast&quot;</span><span class="p">))</span> <span class="p">{</span>
			<span class="c1">//  Free the old name, get the new one</span>
			<span class="n">spell</span><span class="o">-&gt;</span><span class="n">SoundWhenCast</span><span class="p">.</span><span class="n">Name</span> <span class="o">=</span> <span class="n">LuaToString</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>
			<span class="n">spell</span><span class="o">-&gt;</span><span class="n">SoundWhenCast</span><span class="p">.</span><span class="n">MapSound</span><span class="p">();</span>
			<span class="c1">//  Check for sound.</span>
			<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">spell</span><span class="o">-&gt;</span><span class="n">SoundWhenCast</span><span class="p">.</span><span class="n">Sound</span><span class="p">)</span> <span class="p">{</span>
				<span class="n">spell</span><span class="o">-&gt;</span><span class="n">SoundWhenCast</span><span class="p">.</span><span class="n">Name</span><span class="p">.</span><span class="n">clear</span><span class="p">();</span>
			<span class="p">}</span>
		<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s">&quot;depend-upgrade&quot;</span><span class="p">))</span> <span class="p">{</span>
			<span class="n">value</span> <span class="o">=</span> <span class="n">LuaToString</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>
			<span class="n">spell</span><span class="o">-&gt;</span><span class="n">DependencyId</span> <span class="o">=</span> <span class="n">UpgradeIdByIdent</span><span class="p">(</span><span class="n">value</span><span class="p">);</span>
			<span class="k">if</span> <span class="p">(</span><span class="n">spell</span><span class="o">-&gt;</span><span class="n">DependencyId</span> <span class="o">==</span> <span class="mi">-1</span><span class="p">)</span> <span class="p">{</span>
				<span class="n">lua_pushfstring</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="s">&quot;Bad upgrade name: %s&quot;</span><span class="p">,</span> <span class="n">value</span><span class="p">);</span>
			<span class="p">}</span>
		<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
			<span class="n">LuaError</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="s">&quot;Unsupported tag: %s&quot;</span> <span class="n">_C_</span> <span class="n">value</span><span class="p">);</span>
		<span class="p">}</span>
	<span class="p">}</span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</p>
                          </details>
                        </details>
                        <hr>/sound/script_sound.cpp<hr>
                        <details>
                        <summary>SetGlobalSoundRange</summary>
                        <p><br> <b>Description</b><br><br>  Set the cut off distance.<br><br>  @param l  Lua state.<br><br> Example:<br><br> <div class="example"><code><strong>SetGlobalSoundRange</strong>(200)</code></div></p>
                          <details>
                          <summary>/sound/script_sound.cpp:338 CclSetGlobalSoundRange</summary>
                          <p><div class="highlight"><pre><span></span><span class="k">static</span> <span class="kt">int</span> <span class="nf">CclSetGlobalSoundRange</span><span class="p">(</span><span class="n">lua_State</span> <span class="o">*</span><span class="n">l</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">LuaCheckArgs</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>

	<span class="c1">// FIXME: check for errors</span>
	<span class="kt">int</span> <span class="n">d</span> <span class="o">=</span> <span class="n">LuaToNumber</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">d</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">DistanceSilent</span> <span class="o">=</span> <span class="n">d</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</p>
                          </details>
                        </details>
                        
                        <details>
                        <summary>DefineGameSounds</summary>
                        <p><br>  Glue between c and scheme. Allows to specify some global game sounds<br>  in a ccl file.<br><br>  @param l  Lua state.</p>
                          <details>
                          <summary>/sound/script_sound.cpp:315 CclDefineGameSounds</summary>
                          <p><div class="highlight"><pre><span></span><span class="k">static</span> <span class="kt">int</span> <span class="nf">CclDefineGameSounds</span><span class="p">(</span><span class="n">lua_State</span> <span class="o">*</span><span class="n">l</span><span class="p">)</span>
<span class="p">{</span>
	<span class="c1">//FIXME: should allow to define ALL the game sounds</span>

	<span class="k">const</span> <span class="kt">int</span> <span class="n">args</span> <span class="o">=</span> <span class="n">lua_gettop</span><span class="p">(</span><span class="n">l</span><span class="p">);</span>
	<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="n">args</span><span class="p">;</span> <span class="o">++</span><span class="n">j</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">value</span> <span class="o">=</span> <span class="n">LuaToString</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>
		<span class="o">++</span><span class="n">j</span><span class="p">;</span>

		<span class="n">LuaUserData</span> <span class="o">*</span><span class="n">data</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">;</span>

		<span class="c1">// let&#39;s handle now the different cases</span>
		<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s">&quot;click&quot;</span><span class="p">))</span> <span class="p">{</span>
			<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">lua_isuserdata</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
				<span class="o">||</span> <span class="p">(</span><span class="n">data</span> <span class="o">=</span> <span class="p">(</span><span class="n">LuaUserData</span> <span class="o">*</span><span class="p">)</span><span class="n">lua_touserdata</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span><span class="o">-&gt;</span><span class="n">Type</span> <span class="o">!=</span> <span class="n">LuaSoundType</span><span class="p">)</span> <span class="p">{</span>
				<span class="n">LuaError</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="s">&quot;Sound id expected&quot;</span><span class="p">);</span>
			<span class="p">}</span>
			<span class="n">GameSounds</span><span class="p">.</span><span class="n">Click</span><span class="p">.</span><span class="n">Sound</span> <span class="o">=</span> <span class="p">(</span><span class="n">CSound</span> <span class="o">*</span><span class="p">)</span><span class="n">data</span><span class="o">-&gt;</span><span class="n">Data</span><span class="p">;</span>
		<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s">&quot;transport-docking&quot;</span><span class="p">))</span> <span class="p">{</span>
			<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">lua_isuserdata</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
				<span class="o">||</span> <span class="p">(</span><span class="n">data</span> <span class="o">=</span> <span class="p">(</span><span class="n">LuaUserData</span> <span class="o">*</span><span class="p">)</span><span class="n">lua_touserdata</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span><span class="o">-&gt;</span><span class="n">Type</span> <span class="o">!=</span> <span class="n">LuaSoundType</span><span class="p">)</span> <span class="p">{</span>
				<span class="n">LuaError</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="s">&quot;Sound id expected&quot;</span><span class="p">);</span>
			<span class="p">}</span>
			<span class="n">GameSounds</span><span class="p">.</span><span class="n">Docking</span><span class="p">.</span><span class="n">Sound</span> <span class="o">=</span> <span class="p">(</span><span class="n">CSound</span> <span class="o">*</span><span class="p">)</span><span class="n">data</span><span class="o">-&gt;</span><span class="n">Data</span><span class="p">;</span>
		<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s">&quot;placement-error&quot;</span><span class="p">))</span> <span class="p">{</span>
			<span class="n">SetSoundConfigRace</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">GameSounds</span><span class="p">.</span><span class="n">PlacementError</span><span class="p">);</span>
		<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s">&quot;placement-success&quot;</span><span class="p">))</span> <span class="p">{</span>
			<span class="n">SetSoundConfigRace</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">GameSounds</span><span class="p">.</span><span class="n">PlacementSuccess</span><span class="p">);</span>
		<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s">&quot;work-complete&quot;</span><span class="p">))</span> <span class="p">{</span>
			<span class="n">SetSoundConfigRace</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">GameSounds</span><span class="p">.</span><span class="n">WorkComplete</span><span class="p">);</span>
		<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s">&quot;research-complete&quot;</span><span class="p">))</span> <span class="p">{</span>
			<span class="n">SetSoundConfigRace</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">GameSounds</span><span class="p">.</span><span class="n">ResearchComplete</span><span class="p">);</span>
		<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s">&quot;not-enough-res&quot;</span><span class="p">))</span> <span class="p">{</span>
			<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">lua_istable</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">||</span> <span class="n">lua_rawlen</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">3</span><span class="p">)</span> <span class="p">{</span>
				<span class="n">LuaError</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="s">&quot;incorrect argument&quot;</span><span class="p">);</span>
			<span class="p">}</span>
			<span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">resName</span> <span class="o">=</span> <span class="n">LuaToString</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
			<span class="k">const</span> <span class="kt">int</span> <span class="n">resId</span> <span class="o">=</span> <span class="n">GetResourceIdByName</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">resName</span><span class="p">);</span>
			<span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">raceName</span> <span class="o">=</span> <span class="n">LuaToString</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">);</span>
			<span class="k">const</span> <span class="kt">int</span> <span class="n">raceIndex</span> <span class="o">=</span> <span class="n">PlayerRaces</span><span class="p">.</span><span class="n">GetRaceIndexByName</span><span class="p">(</span><span class="n">raceName</span><span class="p">);</span>
			<span class="k">if</span> <span class="p">(</span><span class="n">raceIndex</span> <span class="o">==</span> <span class="mi">-1</span><span class="p">)</span> <span class="p">{</span>
				<span class="n">LuaError</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="s">&quot;Unknown race: %s&quot;</span> <span class="n">_C_</span> <span class="n">raceName</span><span class="p">);</span>
			<span class="p">}</span>
			<span class="n">lua_rawgeti</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">);</span>
			<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">lua_isuserdata</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">-1</span><span class="p">)</span>
				<span class="o">||</span> <span class="p">(</span><span class="n">data</span> <span class="o">=</span> <span class="p">(</span><span class="n">LuaUserData</span> <span class="o">*</span><span class="p">)</span><span class="n">lua_touserdata</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">-1</span><span class="p">))</span><span class="o">-&gt;</span><span class="n">Type</span> <span class="o">!=</span> <span class="n">LuaSoundType</span><span class="p">)</span> <span class="p">{</span>
				<span class="n">LuaError</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="s">&quot;Sound id expected&quot;</span><span class="p">);</span>
			<span class="p">}</span>
			<span class="n">lua_pop</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
			<span class="n">GameSounds</span><span class="p">.</span><span class="n">NotEnoughRes</span><span class="p">[</span><span class="n">raceIndex</span><span class="p">][</span><span class="n">resId</span><span class="p">].</span><span class="n">Sound</span> <span class="o">=</span> <span class="p">(</span><span class="n">CSound</span> <span class="o">*</span><span class="p">)</span><span class="n">data</span><span class="o">-&gt;</span><span class="n">Data</span><span class="p">;</span>
		<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s">&quot;not-enough-food&quot;</span><span class="p">))</span> <span class="p">{</span>
			<span class="n">SetSoundConfigRace</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">GameSounds</span><span class="p">.</span><span class="n">NotEnoughFood</span><span class="p">);</span>
		<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s">&quot;rescue&quot;</span><span class="p">))</span> <span class="p">{</span>
			<span class="n">SetSoundConfigRace</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">GameSounds</span><span class="p">.</span><span class="n">Rescue</span><span class="p">);</span>
		<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s">&quot;building-construction&quot;</span><span class="p">))</span> <span class="p">{</span>
			<span class="n">SetSoundConfigRace</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">GameSounds</span><span class="p">.</span><span class="n">BuildingConstruction</span><span class="p">);</span>
		<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s">&quot;chat-message&quot;</span><span class="p">))</span> <span class="p">{</span>
			<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">lua_isuserdata</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
				<span class="o">||</span> <span class="p">(</span><span class="n">data</span> <span class="o">=</span> <span class="p">(</span><span class="n">LuaUserData</span> <span class="o">*</span><span class="p">)</span><span class="n">lua_touserdata</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span><span class="o">-&gt;</span><span class="n">Type</span> <span class="o">!=</span> <span class="n">LuaSoundType</span><span class="p">)</span> <span class="p">{</span>
				<span class="n">LuaError</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="s">&quot;Sound id expected&quot;</span><span class="p">);</span>
			<span class="p">}</span>
			<span class="n">GameSounds</span><span class="p">.</span><span class="n">ChatMessage</span><span class="p">.</span><span class="n">Sound</span> <span class="o">=</span> <span class="p">(</span><span class="n">CSound</span> <span class="o">*</span><span class="p">)</span><span class="n">data</span><span class="o">-&gt;</span><span class="n">Data</span><span class="p">;</span>
		<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
			<span class="n">LuaError</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="s">&quot;Unsupported tag: %s&quot;</span> <span class="n">_C_</span> <span class="n">value</span><span class="p">);</span>
		<span class="p">}</span>
	<span class="p">}</span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</p>
                          </details>
                        </details>
                        
                        <details>
                        <summary>MapSound</summary>
                        <p><br>  Glue between c and scheme. Ask to the sound system to remap a sound id<br>  to a given name.<br><br>  @param l  Lua state.<br><br>  @return   the sound object</p>
                          <details>
                          <summary>/sound/script_sound.cpp:191 CclMapSound</summary>
                          <p><div class="highlight"><pre><span></span><span class="k">static</span> <span class="kt">int</span> <span class="nf">CclMapSound</span><span class="p">(</span><span class="n">lua_State</span> <span class="o">*</span><span class="n">l</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">sound_name</span><span class="p">;</span>

	<span class="n">LuaCheckArgs</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">2</span><span class="p">);</span>
	<span class="n">sound_name</span> <span class="o">=</span> <span class="n">LuaToString</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
	<span class="n">MapSound</span><span class="p">(</span><span class="n">sound_name</span><span class="p">,</span> <span class="n">CclGetSound</span><span class="p">(</span><span class="n">l</span><span class="p">));</span>
	<span class="n">lua_pushvalue</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">2</span><span class="p">);</span>
	<span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</p>
                          </details>
                        </details>
                        
                        <details>
                        <summary>SoundForName</summary>
                        <p><br>  Glue between c and scheme. Ask the sound system to associate a<br>  sound id to a sound name.<br><br>  @param l  Lua state.</p>
                          <details>
                          <summary>/sound/script_sound.cpp:71 CclSoundForName</summary>
                          <p><div class="highlight"><pre><span></span><span class="k">static</span> <span class="kt">int</span> <span class="nf">CclSoundForName</span><span class="p">(</span><span class="n">lua_State</span> <span class="o">*</span><span class="n">l</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">CSound</span> <span class="o">*</span><span class="n">id</span><span class="p">;</span>
	<span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">sound_name</span><span class="p">;</span>
	<span class="n">LuaUserData</span> <span class="o">*</span><span class="n">data</span><span class="p">;</span>

	<span class="n">sound_name</span> <span class="o">=</span> <span class="n">LuaToString</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">-1</span><span class="p">);</span>
	<span class="n">id</span> <span class="o">=</span> <span class="n">SoundForName</span><span class="p">(</span><span class="n">sound_name</span><span class="p">);</span>

	<span class="n">data</span> <span class="o">=</span> <span class="p">(</span><span class="n">LuaUserData</span> <span class="o">*</span><span class="p">)</span><span class="n">lua_newuserdata</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">LuaUserData</span><span class="p">));</span>
	<span class="n">data</span><span class="o">-&gt;</span><span class="n">Type</span> <span class="o">=</span> <span class="n">LuaSoundType</span><span class="p">;</span>
	<span class="n">data</span><span class="o">-&gt;</span><span class="n">Data</span> <span class="o">=</span> <span class="n">id</span><span class="p">;</span>
	<span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</p>
                          </details>
                        </details>
                        
                        <details>
                        <summary>SetSoundRange</summary>
                        <p><br>  Set the range of a given sound.<br><br>  @param l  Lua state.</p>
                          <details>
                          <summary>/sound/script_sound.cpp:358 CclSetSoundRange</summary>
                          <p><div class="highlight"><pre><span></span><span class="k">static</span> <span class="kt">int</span> <span class="nf">CclSetSoundRange</span><span class="p">(</span><span class="n">lua_State</span> <span class="o">*</span><span class="n">l</span><span class="p">)</span>
<span class="p">{</span>

	<span class="n">LuaCheckArgs</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">2</span><span class="p">);</span>

	<span class="kt">int</span> <span class="n">tmp</span> <span class="o">=</span> <span class="n">LuaToNumber</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">2</span><span class="p">);</span>
	<span class="n">clamp</span><span class="p">(</span><span class="o">&amp;</span><span class="n">tmp</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">255</span><span class="p">);</span>
	<span class="k">const</span> <span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">theRange</span> <span class="o">=</span> <span class="k">static_cast</span><span class="o">&lt;</span><span class="kt">unsigned</span> <span class="kt">char</span><span class="o">&gt;</span><span class="p">(</span><span class="n">tmp</span><span class="p">);</span>

	<span class="n">lua_pushvalue</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
	<span class="n">CSound</span> <span class="o">*</span><span class="n">id</span> <span class="o">=</span> <span class="n">CclGetSound</span><span class="p">(</span><span class="n">l</span><span class="p">);</span>
	<span class="n">SetSoundRange</span><span class="p">(</span><span class="n">id</span><span class="p">,</span> <span class="n">theRange</span><span class="p">);</span>
	<span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</p>
                          </details>
                        </details>
                        
                        <details>
                        <summary>MakeSound</summary>
                        <p><br>  Create a sound.<br><br>  Glue between c and scheme. This function asks the sound system to<br>  register a sound under a given name, with an associated list of files<br>  (the list can be replaced by only one file).<br><br>  @param l  Lua state.<br><br>  @return   the sound id of the created sound</p>
                          <details>
                          <summary>/sound/script_sound.cpp:141 CclMakeSound</summary>
                          <p><div class="highlight"><pre><span></span><span class="k">static</span> <span class="kt">int</span> <span class="nf">CclMakeSound</span><span class="p">(</span><span class="n">lua_State</span> <span class="o">*</span><span class="n">l</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">LuaCheckArgs</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">2</span><span class="p">);</span>

	<span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">c_name</span> <span class="o">=</span> <span class="n">LuaToString</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
	<span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&gt;</span> <span class="n">files</span><span class="p">;</span>
	<span class="n">CSound</span> <span class="o">*</span><span class="n">id</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">lua_isstring</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span> <span class="p">{</span>
		<span class="c1">// only one file</span>
		<span class="n">files</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">LuaToString</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">2</span><span class="p">));</span>
		<span class="n">id</span> <span class="o">=</span> <span class="n">MakeSound</span><span class="p">(</span><span class="n">c_name</span><span class="p">,</span> <span class="n">files</span><span class="p">);</span>
	<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">lua_istable</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span> <span class="p">{</span>
		<span class="c1">// several files</span>
		<span class="k">const</span> <span class="kt">int</span> <span class="n">args</span> <span class="o">=</span> <span class="n">lua_rawlen</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">2</span><span class="p">);</span>
		<span class="n">files</span><span class="p">.</span><span class="n">reserve</span><span class="p">(</span><span class="n">args</span><span class="p">);</span>
		<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="n">args</span><span class="p">;</span> <span class="o">++</span><span class="n">j</span><span class="p">)</span> <span class="p">{</span>
			<span class="n">files</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">LuaToString</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">));</span>
		<span class="p">}</span>
		<span class="n">id</span> <span class="o">=</span> <span class="n">MakeSound</span><span class="p">(</span><span class="n">c_name</span><span class="p">,</span> <span class="n">files</span><span class="p">);</span>
	<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
		<span class="n">LuaError</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="s">&quot;string or table expected&quot;</span><span class="p">);</span>
		<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="n">LuaUserData</span> <span class="o">*</span><span class="n">data</span> <span class="o">=</span> <span class="p">(</span><span class="n">LuaUserData</span> <span class="o">*</span><span class="p">)</span><span class="n">lua_newuserdata</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">LuaUserData</span><span class="p">));</span>
	<span class="n">data</span><span class="o">-&gt;</span><span class="n">Type</span> <span class="o">=</span> <span class="n">LuaSoundType</span><span class="p">;</span>
	<span class="n">data</span><span class="o">-&gt;</span><span class="n">Data</span> <span class="o">=</span> <span class="n">id</span><span class="p">;</span>
	<span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</p>
                          </details>
                        </details>
                        
                        <details>
                        <summary>MakeSoundGroup</summary>
                        <p><br>  Glue between c and scheme. This function asks the sound system to<br>  build a special sound group.<br><br>  @param l  Lua state.<br><br>  @return   The sound id of the created sound</p>
                          <details>
                          <summary>/sound/script_sound.cpp:172 CclMakeSoundGroup</summary>
                          <p><div class="highlight"><pre><span></span><span class="k">static</span> <span class="kt">int</span> <span class="nf">CclMakeSoundGroup</span><span class="p">(</span><span class="n">lua_State</span> <span class="o">*</span><span class="n">l</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">CSound</span> <span class="o">*</span><span class="n">id</span><span class="p">;</span>
	<span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">c_name</span><span class="p">;</span>
	<span class="n">CSound</span> <span class="o">*</span><span class="n">first</span><span class="p">;</span>
	<span class="n">CSound</span> <span class="o">*</span><span class="n">second</span><span class="p">;</span>
	<span class="n">LuaUserData</span> <span class="o">*</span><span class="n">data</span><span class="p">;</span>

	<span class="n">LuaCheckArgs</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">3</span><span class="p">);</span>

	<span class="n">c_name</span> <span class="o">=</span> <span class="n">LuaToString</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>

	<span class="n">lua_pushvalue</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">2</span><span class="p">);</span>
	<span class="n">first</span> <span class="o">=</span> <span class="n">CclGetSound</span><span class="p">(</span><span class="n">l</span><span class="p">);</span>
	<span class="n">lua_pop</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
	<span class="n">second</span> <span class="o">=</span> <span class="n">CclGetSound</span><span class="p">(</span><span class="n">l</span><span class="p">);</span>
	<span class="n">id</span> <span class="o">=</span> <span class="n">MakeSoundGroup</span><span class="p">(</span><span class="n">c_name</span><span class="p">,</span> <span class="n">first</span><span class="p">,</span> <span class="n">second</span><span class="p">);</span>
	<span class="n">data</span> <span class="o">=</span> <span class="p">(</span><span class="n">LuaUserData</span> <span class="o">*</span><span class="p">)</span><span class="n">lua_newuserdata</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">LuaUserData</span><span class="p">));</span>
	<span class="n">data</span><span class="o">-&gt;</span><span class="n">Type</span> <span class="o">=</span> <span class="n">LuaSoundType</span><span class="p">;</span>
	<span class="n">data</span><span class="o">-&gt;</span><span class="n">Data</span> <span class="o">=</span> <span class="n">id</span><span class="p">;</span>
	<span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</p>
                          </details>
                        </details>
                        
                        <details>
                        <summary>PlaySound</summary>
                        <p><br> <b>Description</b><br><br>  Ask the sound system to play the specified sound.<br><br>  @param l  Lua state.<br><br> Example:<br><br> <div class="example"><code><strong>PlaySound</strong>("rescue (orc)")</code></div></p>
                          <details>
                          <summary>/sound/script_sound.cpp:220 CclPlaySound</summary>
                          <p><div class="highlight"><pre><span></span><span class="k">static</span> <span class="kt">int</span> <span class="nf">CclPlaySound</span><span class="p">(</span><span class="n">lua_State</span> <span class="o">*</span><span class="n">l</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">const</span> <span class="kt">int</span> <span class="n">args</span> <span class="o">=</span> <span class="n">lua_gettop</span><span class="p">(</span><span class="n">l</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">args</span> <span class="o">&lt;</span> <span class="mi">1</span> <span class="o">||</span> <span class="n">args</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">LuaError</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="s">&quot;incorrect argument&quot;</span><span class="p">);</span>
	<span class="p">}</span>

	<span class="n">lua_pushvalue</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
	<span class="n">CSound</span> <span class="o">*</span><span class="n">id</span> <span class="o">=</span> <span class="n">CclGetSound</span><span class="p">(</span><span class="n">l</span><span class="p">);</span>
	<span class="n">lua_pop</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
	<span class="kt">bool</span> <span class="n">always</span> <span class="o">=</span> <span class="nb">false</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">args</span> <span class="o">==</span> <span class="mi">2</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">always</span> <span class="o">=</span> <span class="n">LuaToBoolean</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">2</span><span class="p">);</span>
	<span class="p">}</span>
	<span class="n">PlayGameSound</span><span class="p">(</span><span class="n">id</span><span class="p">,</span> <span class="n">MaxSampleVolume</span><span class="p">,</span> <span class="n">always</span><span class="p">);</span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</p>
                          </details>
                        </details>
                        <hr>/pathfinder/script_pathfinder.cpp<hr>
                        <details>
                        <summary>AStar</summary>
                        <p><br>  Enable a*.<br><br>  @param l  Lua state.</p>
                          <details>
                          <summary>/pathfinder/script_pathfinder.cpp:101 CclAStar</summary>
                          <p><div class="highlight"><pre><span></span><span class="k">static</span> <span class="kt">int</span> <span class="nf">CclAStar</span><span class="p">(</span><span class="n">lua_State</span> <span class="o">*</span><span class="n">l</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">value</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">i</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">j</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">args</span><span class="p">;</span>

	<span class="n">args</span> <span class="o">=</span> <span class="n">lua_gettop</span><span class="p">(</span><span class="n">l</span><span class="p">);</span>
	<span class="k">for</span> <span class="p">(</span><span class="n">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="n">args</span><span class="p">;</span> <span class="o">++</span><span class="n">j</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">value</span> <span class="o">=</span> <span class="n">LuaToString</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>
		<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s">&quot;fixed-unit-cost&quot;</span><span class="p">))</span> <span class="p">{</span>
			<span class="o">++</span><span class="n">j</span><span class="p">;</span>
			<span class="n">i</span> <span class="o">=</span> <span class="n">LuaToNumber</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>
			<span class="k">if</span> <span class="p">(</span><span class="n">i</span> <span class="o">&lt;=</span> <span class="mi">3</span><span class="p">)</span> <span class="p">{</span>
				<span class="n">PrintFunction</span><span class="p">();</span>
				<span class="n">fprintf</span><span class="p">(</span><span class="n">stdout</span><span class="p">,</span> <span class="s">&quot;Fixed unit crossing cost must be strictly &gt; 3</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
			<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
				<span class="n">AStarFixedUnitCrossingCost</span> <span class="o">=</span> <span class="n">i</span><span class="p">;</span>
			<span class="p">}</span>
		<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s">&quot;moving-unit-cost&quot;</span><span class="p">))</span> <span class="p">{</span>
			<span class="o">++</span><span class="n">j</span><span class="p">;</span>
			<span class="n">i</span> <span class="o">=</span> <span class="n">LuaToNumber</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>
			<span class="k">if</span> <span class="p">(</span><span class="n">i</span> <span class="o">&lt;=</span> <span class="mi">3</span><span class="p">)</span> <span class="p">{</span>
				<span class="n">PrintFunction</span><span class="p">();</span>
				<span class="n">fprintf</span><span class="p">(</span><span class="n">stdout</span><span class="p">,</span> <span class="s">&quot;Moving unit crossing cost must be strictly &gt; 3</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
			<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
				<span class="n">AStarMovingUnitCrossingCost</span> <span class="o">=</span> <span class="n">i</span><span class="p">;</span>
			<span class="p">}</span>
		<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s">&quot;know-unseen-terrain&quot;</span><span class="p">))</span> <span class="p">{</span>
			<span class="n">AStarKnowUnseenTerrain</span> <span class="o">=</span> <span class="nb">true</span><span class="p">;</span>
		<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s">&quot;dont-know-unseen-terrain&quot;</span><span class="p">))</span> <span class="p">{</span>
			<span class="n">AStarKnowUnseenTerrain</span> <span class="o">=</span> <span class="nb">false</span><span class="p">;</span>
		<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s">&quot;unseen-terrain-cost&quot;</span><span class="p">))</span> <span class="p">{</span>
			<span class="o">++</span><span class="n">j</span><span class="p">;</span>
			<span class="n">i</span> <span class="o">=</span> <span class="n">LuaToNumber</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>
			<span class="k">if</span> <span class="p">(</span><span class="n">i</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
				<span class="n">PrintFunction</span><span class="p">();</span>
				<span class="n">fprintf</span><span class="p">(</span><span class="n">stdout</span><span class="p">,</span> <span class="s">&quot;Unseen Terrain Cost must be non-negative</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
			<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
				<span class="n">AStarUnknownTerrainCost</span> <span class="o">=</span> <span class="n">i</span><span class="p">;</span>
			<span class="p">}</span>
		<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
			<span class="n">LuaError</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="s">&quot;Unsupported tag: %s&quot;</span> <span class="n">_C_</span> <span class="n">value</span><span class="p">);</span>
		<span class="p">}</span>
	<span class="p">}</span>

	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</p>
                          </details>
                        </details>
                        <hr>/game/replay.cpp<hr>
                        <details>
                        <summary>Log</summary>
                        <p><br> Parse log</p>
                          <details>
                          <summary>/game/replay.cpp:575 CclLog</summary>
                          <p><div class="highlight"><pre><span></span><span class="k">static</span> <span class="kt">int</span> <span class="nf">CclLog</span><span class="p">(</span><span class="n">lua_State</span> <span class="o">*</span><span class="n">l</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">LogEntry</span> <span class="o">*</span><span class="n">log</span><span class="p">;</span>
	<span class="n">LogEntry</span> <span class="o">**</span><span class="n">last</span><span class="p">;</span>
	<span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">value</span><span class="p">;</span>

	<span class="n">LuaCheckArgs</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">lua_istable</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span> <span class="p">{</span>
		<span class="n">LuaError</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="s">&quot;incorrect argument&quot;</span><span class="p">);</span>
	<span class="p">}</span>

	<span class="n">Assert</span><span class="p">(</span><span class="n">CurrentReplay</span><span class="p">);</span>

	<span class="n">log</span> <span class="o">=</span> <span class="k">new</span> <span class="n">LogEntry</span><span class="p">;</span>
	<span class="n">log</span><span class="o">-&gt;</span><span class="n">UnitNumber</span> <span class="o">=</span> <span class="mi">-1</span><span class="p">;</span>
	<span class="n">log</span><span class="o">-&gt;</span><span class="n">PosX</span> <span class="o">=</span> <span class="mi">-1</span><span class="p">;</span>
	<span class="n">log</span><span class="o">-&gt;</span><span class="n">PosY</span> <span class="o">=</span> <span class="mi">-1</span><span class="p">;</span>
	<span class="n">log</span><span class="o">-&gt;</span><span class="n">DestUnitNumber</span> <span class="o">=</span> <span class="mi">-1</span><span class="p">;</span>
	<span class="n">log</span><span class="o">-&gt;</span><span class="n">Num</span> <span class="o">=</span> <span class="mi">-1</span><span class="p">;</span>

	<span class="n">lua_pushnil</span><span class="p">(</span><span class="n">l</span><span class="p">);</span>
	<span class="k">while</span> <span class="p">(</span><span class="n">lua_next</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span> <span class="p">{</span>
		<span class="n">value</span> <span class="o">=</span> <span class="n">LuaToString</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">-2</span><span class="p">);</span>
		<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s">&quot;GameCycle&quot;</span><span class="p">))</span> <span class="p">{</span>
			<span class="n">log</span><span class="o">-&gt;</span><span class="n">GameCycle</span> <span class="o">=</span> <span class="n">LuaToNumber</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">-1</span><span class="p">);</span>
		<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s">&quot;UnitNumber&quot;</span><span class="p">))</span> <span class="p">{</span>
			<span class="n">log</span><span class="o">-&gt;</span><span class="n">UnitNumber</span> <span class="o">=</span> <span class="n">LuaToNumber</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">-1</span><span class="p">);</span>
		<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s">&quot;UnitIdent&quot;</span><span class="p">))</span> <span class="p">{</span>
			<span class="n">log</span><span class="o">-&gt;</span><span class="n">UnitIdent</span> <span class="o">=</span> <span class="n">LuaToString</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">-1</span><span class="p">);</span>
		<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s">&quot;Action&quot;</span><span class="p">))</span> <span class="p">{</span>
			<span class="n">log</span><span class="o">-&gt;</span><span class="n">Action</span> <span class="o">=</span> <span class="n">LuaToString</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">-1</span><span class="p">);</span>
		<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s">&quot;Flush&quot;</span><span class="p">))</span> <span class="p">{</span>
			<span class="n">log</span><span class="o">-&gt;</span><span class="n">Flush</span> <span class="o">=</span> <span class="n">LuaToNumber</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">-1</span><span class="p">);</span>
		<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s">&quot;PosX&quot;</span><span class="p">))</span> <span class="p">{</span>
			<span class="n">log</span><span class="o">-&gt;</span><span class="n">PosX</span> <span class="o">=</span> <span class="n">LuaToNumber</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">-1</span><span class="p">);</span>
		<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s">&quot;PosY&quot;</span><span class="p">))</span> <span class="p">{</span>
			<span class="n">log</span><span class="o">-&gt;</span><span class="n">PosY</span> <span class="o">=</span> <span class="n">LuaToNumber</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">-1</span><span class="p">);</span>
		<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s">&quot;DestUnitNumber&quot;</span><span class="p">))</span> <span class="p">{</span>
			<span class="n">log</span><span class="o">-&gt;</span><span class="n">DestUnitNumber</span> <span class="o">=</span> <span class="n">LuaToNumber</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">-1</span><span class="p">);</span>
		<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s">&quot;Value&quot;</span><span class="p">))</span> <span class="p">{</span>
			<span class="n">log</span><span class="o">-&gt;</span><span class="n">Value</span> <span class="o">=</span> <span class="n">LuaToString</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">-1</span><span class="p">);</span>
		<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s">&quot;Num&quot;</span><span class="p">))</span> <span class="p">{</span>
			<span class="n">log</span><span class="o">-&gt;</span><span class="n">Num</span> <span class="o">=</span> <span class="n">LuaToNumber</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">-1</span><span class="p">);</span>
		<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s">&quot;SyncRandSeed&quot;</span><span class="p">))</span> <span class="p">{</span>
			<span class="n">log</span><span class="o">-&gt;</span><span class="n">SyncRandSeed</span> <span class="o">=</span> <span class="n">lua_tointeger</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">-1</span><span class="p">);</span>
		<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
			<span class="n">LuaError</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="s">&quot;Unsupported key: %s&quot;</span> <span class="n">_C_</span> <span class="n">value</span><span class="p">);</span>
		<span class="p">}</span>
		<span class="n">lua_pop</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
	<span class="p">}</span>

	<span class="c1">// Append to linked list</span>
	<span class="n">last</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">CurrentReplay</span><span class="o">-&gt;</span><span class="n">Commands</span><span class="p">;</span>
	<span class="k">while</span> <span class="p">(</span><span class="o">*</span><span class="n">last</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">last</span> <span class="o">=</span> <span class="o">&amp;</span><span class="p">(</span><span class="o">*</span><span class="n">last</span><span class="p">)</span><span class="o">-&gt;</span><span class="n">Next</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="o">*</span><span class="n">last</span> <span class="o">=</span> <span class="n">log</span><span class="p">;</span>

	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</p>
                          </details>
                        </details>
                        
                        <details>
                        <summary>ReplayLog</summary>
                        <p><br> Parse replay-log</p>
                          <details>
                          <summary>/game/replay.cpp:700 CclReplayLog</summary>
                          <p><div class="highlight"><pre><span></span><span class="k">static</span> <span class="kt">int</span> <span class="nf">CclReplayLog</span><span class="p">(</span><span class="n">lua_State</span> <span class="o">*</span><span class="n">l</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">FullReplay</span> <span class="o">*</span><span class="n">replay</span><span class="p">;</span>
	<span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">value</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">j</span><span class="p">;</span>

	<span class="n">LuaCheckArgs</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">lua_istable</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span> <span class="p">{</span>
		<span class="n">LuaError</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="s">&quot;incorrect argument&quot;</span><span class="p">);</span>
	<span class="p">}</span>

	<span class="n">Assert</span><span class="p">(</span><span class="n">CurrentReplay</span> <span class="o">==</span> <span class="nb">NULL</span><span class="p">);</span>

	<span class="n">replay</span> <span class="o">=</span> <span class="k">new</span> <span class="n">FullReplay</span><span class="p">;</span>

	<span class="n">lua_pushnil</span><span class="p">(</span><span class="n">l</span><span class="p">);</span>
	<span class="k">while</span> <span class="p">(</span><span class="n">lua_next</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">value</span> <span class="o">=</span> <span class="n">LuaToString</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">-2</span><span class="p">);</span>
		<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s">&quot;Comment1&quot;</span><span class="p">))</span> <span class="p">{</span>
			<span class="n">replay</span><span class="o">-&gt;</span><span class="n">Comment1</span> <span class="o">=</span> <span class="n">LuaToString</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">-1</span><span class="p">);</span>
		<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s">&quot;Comment2&quot;</span><span class="p">))</span> <span class="p">{</span>
			<span class="n">replay</span><span class="o">-&gt;</span><span class="n">Comment2</span> <span class="o">=</span> <span class="n">LuaToString</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">-1</span><span class="p">);</span>
		<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s">&quot;Comment3&quot;</span><span class="p">))</span> <span class="p">{</span>
			<span class="n">replay</span><span class="o">-&gt;</span><span class="n">Comment3</span> <span class="o">=</span> <span class="n">LuaToString</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">-1</span><span class="p">);</span>
		<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s">&quot;Date&quot;</span><span class="p">))</span> <span class="p">{</span>
			<span class="n">replay</span><span class="o">-&gt;</span><span class="n">Date</span> <span class="o">=</span> <span class="n">LuaToString</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">-1</span><span class="p">);</span>
		<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s">&quot;Map&quot;</span><span class="p">))</span> <span class="p">{</span>
			<span class="n">replay</span><span class="o">-&gt;</span><span class="n">Map</span> <span class="o">=</span> <span class="n">LuaToString</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">-1</span><span class="p">);</span>
		<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s">&quot;MapPath&quot;</span><span class="p">))</span> <span class="p">{</span>
			<span class="n">replay</span><span class="o">-&gt;</span><span class="n">MapPath</span> <span class="o">=</span> <span class="n">LuaToString</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">-1</span><span class="p">);</span>
		<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s">&quot;MapId&quot;</span><span class="p">))</span> <span class="p">{</span>
			<span class="n">replay</span><span class="o">-&gt;</span><span class="n">MapId</span> <span class="o">=</span> <span class="n">LuaToNumber</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">-1</span><span class="p">);</span>
		<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s">&quot;Type&quot;</span><span class="p">))</span> <span class="p">{</span>
			<span class="n">replay</span><span class="o">-&gt;</span><span class="n">Type</span> <span class="o">=</span> <span class="n">LuaToNumber</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">-1</span><span class="p">);</span>
		<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s">&quot;Race&quot;</span><span class="p">))</span> <span class="p">{</span>
			<span class="n">replay</span><span class="o">-&gt;</span><span class="n">Race</span> <span class="o">=</span> <span class="n">LuaToNumber</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">-1</span><span class="p">);</span>
		<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s">&quot;LocalPlayer&quot;</span><span class="p">))</span> <span class="p">{</span>
			<span class="n">replay</span><span class="o">-&gt;</span><span class="n">LocalPlayer</span> <span class="o">=</span> <span class="n">LuaToNumber</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">-1</span><span class="p">);</span>
		<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s">&quot;Players&quot;</span><span class="p">))</span> <span class="p">{</span>
			<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">lua_istable</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">-1</span><span class="p">)</span> <span class="o">||</span> <span class="n">lua_rawlen</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">-1</span><span class="p">)</span> <span class="o">!=</span> <span class="n">PlayerMax</span><span class="p">)</span> <span class="p">{</span>
				<span class="n">LuaError</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="s">&quot;incorrect argument&quot;</span><span class="p">);</span>
			<span class="p">}</span>
			<span class="k">for</span> <span class="p">(</span><span class="n">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="n">PlayerMax</span><span class="p">;</span> <span class="o">++</span><span class="n">j</span><span class="p">)</span> <span class="p">{</span>
				<span class="kt">int</span> <span class="n">top</span><span class="p">;</span>

				<span class="n">lua_rawgeti</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">-1</span><span class="p">,</span> <span class="n">j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>
				<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">lua_istable</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">-1</span><span class="p">))</span> <span class="p">{</span>
					<span class="n">LuaError</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="s">&quot;incorrect argument&quot;</span><span class="p">);</span>
				<span class="p">}</span>
				<span class="n">top</span> <span class="o">=</span> <span class="n">lua_gettop</span><span class="p">(</span><span class="n">l</span><span class="p">);</span>
				<span class="n">lua_pushnil</span><span class="p">(</span><span class="n">l</span><span class="p">);</span>
				<span class="k">while</span> <span class="p">(</span><span class="n">lua_next</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">top</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
					<span class="n">value</span> <span class="o">=</span> <span class="n">LuaToString</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">-2</span><span class="p">);</span>
					<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s">&quot;Name&quot;</span><span class="p">))</span> <span class="p">{</span>
						<span class="n">replay</span><span class="o">-&gt;</span><span class="n">Players</span><span class="p">[</span><span class="n">j</span><span class="p">].</span><span class="n">Name</span> <span class="o">=</span> <span class="n">LuaToString</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">-1</span><span class="p">);</span>
					<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s">&quot;AIScript&quot;</span><span class="p">))</span> <span class="p">{</span>
						<span class="n">replay</span><span class="o">-&gt;</span><span class="n">Players</span><span class="p">[</span><span class="n">j</span><span class="p">].</span><span class="n">AIScript</span> <span class="o">=</span> <span class="n">LuaToString</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">-1</span><span class="p">);</span>
					<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s">&quot;PlayerColor&quot;</span><span class="p">))</span> <span class="p">{</span>
						<span class="n">replay</span><span class="o">-&gt;</span><span class="n">Players</span><span class="p">[</span><span class="n">j</span><span class="p">].</span><span class="n">PlayerColor</span> <span class="o">=</span> <span class="n">LuaToNumber</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">-1</span><span class="p">);</span>
					<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s">&quot;Race&quot;</span><span class="p">))</span> <span class="p">{</span>
						<span class="n">replay</span><span class="o">-&gt;</span><span class="n">Players</span><span class="p">[</span><span class="n">j</span><span class="p">].</span><span class="n">Race</span> <span class="o">=</span> <span class="n">LuaToNumber</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">-1</span><span class="p">);</span>
					<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s">&quot;Team&quot;</span><span class="p">))</span> <span class="p">{</span>
						<span class="n">replay</span><span class="o">-&gt;</span><span class="n">Players</span><span class="p">[</span><span class="n">j</span><span class="p">].</span><span class="n">Team</span> <span class="o">=</span> <span class="n">LuaToNumber</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">-1</span><span class="p">);</span>
					<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s">&quot;Type&quot;</span><span class="p">))</span> <span class="p">{</span>
						<span class="n">replay</span><span class="o">-&gt;</span><span class="n">Players</span><span class="p">[</span><span class="n">j</span><span class="p">].</span><span class="n">Type</span> <span class="o">=</span> <span class="n">LuaToNumber</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">-1</span><span class="p">);</span>
					<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
						<span class="n">LuaError</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="s">&quot;Unsupported key: %s&quot;</span> <span class="n">_C_</span> <span class="n">value</span><span class="p">);</span>
					<span class="p">}</span>
					<span class="n">lua_pop</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
				<span class="p">}</span>
				<span class="n">lua_pop</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
			<span class="p">}</span>
		<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s">&quot;Resource&quot;</span><span class="p">))</span> <span class="p">{</span>
			<span class="n">replay</span><span class="o">-&gt;</span><span class="n">Resource</span> <span class="o">=</span> <span class="n">LuaToNumber</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">-1</span><span class="p">);</span>
		<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s">&quot;NumUnits&quot;</span><span class="p">))</span> <span class="p">{</span>
			<span class="n">replay</span><span class="o">-&gt;</span><span class="n">NumUnits</span> <span class="o">=</span> <span class="n">LuaToNumber</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">-1</span><span class="p">);</span>
		<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s">&quot;Difficulty&quot;</span><span class="p">))</span> <span class="p">{</span>
			<span class="n">replay</span><span class="o">-&gt;</span><span class="n">Difficulty</span> <span class="o">=</span> <span class="n">LuaToNumber</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">-1</span><span class="p">);</span>
		<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s">&quot;NoFow&quot;</span><span class="p">))</span> <span class="p">{</span>
			<span class="n">replay</span><span class="o">-&gt;</span><span class="n">NoFow</span> <span class="o">=</span> <span class="n">LuaToBoolean</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">-1</span><span class="p">);</span>
		<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s">&quot;Inside&quot;</span><span class="p">))</span> <span class="p">{</span>
			<span class="n">replay</span><span class="o">-&gt;</span><span class="n">Inside</span> <span class="o">=</span> <span class="n">LuaToBoolean</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">-1</span><span class="p">);</span>
		<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s">&quot;RevealMap&quot;</span><span class="p">))</span> <span class="p">{</span>
			<span class="n">replay</span><span class="o">-&gt;</span><span class="n">RevealMap</span> <span class="o">=</span> <span class="n">LuaToNumber</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">-1</span><span class="p">);</span>
		<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s">&quot;GameType&quot;</span><span class="p">))</span> <span class="p">{</span>
			<span class="n">replay</span><span class="o">-&gt;</span><span class="n">GameType</span> <span class="o">=</span> <span class="n">LuaToNumber</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">-1</span><span class="p">);</span>
		<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s">&quot;Opponents&quot;</span><span class="p">))</span> <span class="p">{</span>
			<span class="n">replay</span><span class="o">-&gt;</span><span class="n">Opponents</span> <span class="o">=</span> <span class="n">LuaToNumber</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">-1</span><span class="p">);</span>
		<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s">&quot;MapRichness&quot;</span><span class="p">))</span> <span class="p">{</span>
			<span class="n">replay</span><span class="o">-&gt;</span><span class="n">MapRichness</span> <span class="o">=</span> <span class="n">LuaToNumber</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">-1</span><span class="p">);</span>
		<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s">&quot;Engine&quot;</span><span class="p">))</span> <span class="p">{</span>
			<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">lua_istable</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">-1</span><span class="p">)</span> <span class="o">||</span> <span class="n">lua_rawlen</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">-1</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">3</span><span class="p">)</span> <span class="p">{</span>
				<span class="n">LuaError</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="s">&quot;incorrect argument&quot;</span><span class="p">);</span>
			<span class="p">}</span>
			<span class="n">replay</span><span class="o">-&gt;</span><span class="n">Engine</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">LuaToNumber</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">-1</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
			<span class="n">replay</span><span class="o">-&gt;</span><span class="n">Engine</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">LuaToNumber</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">-1</span><span class="p">,</span> <span class="mi">2</span><span class="p">);</span>
			<span class="n">replay</span><span class="o">-&gt;</span><span class="n">Engine</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">LuaToNumber</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">-1</span><span class="p">,</span> <span class="mi">3</span><span class="p">);</span>
		<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s">&quot;Network&quot;</span><span class="p">))</span> <span class="p">{</span>
			<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">lua_istable</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">-1</span><span class="p">)</span> <span class="o">||</span> <span class="n">lua_rawlen</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">-1</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">3</span><span class="p">)</span> <span class="p">{</span>
				<span class="n">LuaError</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="s">&quot;incorrect argument&quot;</span><span class="p">);</span>
			<span class="p">}</span>
			<span class="n">replay</span><span class="o">-&gt;</span><span class="n">Network</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">LuaToNumber</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">-1</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
			<span class="n">replay</span><span class="o">-&gt;</span><span class="n">Network</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">LuaToNumber</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">-1</span><span class="p">,</span> <span class="mi">2</span><span class="p">);</span>
			<span class="n">replay</span><span class="o">-&gt;</span><span class="n">Network</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">LuaToNumber</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">-1</span><span class="p">,</span> <span class="mi">3</span><span class="p">);</span>
		<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
			<span class="n">LuaError</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="s">&quot;Unsupported key: %s&quot;</span> <span class="n">_C_</span> <span class="n">value</span><span class="p">);</span>
		<span class="p">}</span>
		<span class="n">lua_pop</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
	<span class="p">}</span>

	<span class="n">CurrentReplay</span> <span class="o">=</span> <span class="n">replay</span><span class="p">;</span>

	<span class="c1">// Apply CurrentReplay settings.</span>
	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">SaveGameLoading</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">ApplyReplaySettings</span><span class="p">();</span>
	<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
		<span class="n">CommandLogDisabled</span> <span class="o">=</span> <span class="nb">false</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</p>
                          </details>
                        </details>
                        <hr>/game/trigger.cpp<hr>
                        <details>
                        <summary>AddTrigger</summary>
                        <p><br> <b>Description</b><br><br>  Add a trigger.<br><br> Example:<br><br> <div class="example"><code><strong>AddTrigger</strong>(<br>			function() return (GetPlayerData(1,"UnitTypesCount","unit-farm") >= 4) end,<br>			function() return ActionVictory() end<br>		)</code></div></p>
                          <details>
                          <summary>/game/trigger.cpp:500 CclAddTrigger</summary>
                          <p><div class="highlight"><pre><span></span><span class="k">static</span> <span class="kt">int</span> <span class="nf">CclAddTrigger</span><span class="p">(</span><span class="n">lua_State</span> <span class="o">*</span><span class="n">l</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">LuaCheckArgs</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">2</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">lua_isfunction</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
		<span class="o">||</span> <span class="p">(</span><span class="o">!</span><span class="n">lua_isfunction</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="n">lua_istable</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">2</span><span class="p">)))</span> <span class="p">{</span>
		<span class="n">LuaError</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="s">&quot;incorrect argument&quot;</span><span class="p">);</span>
	<span class="p">}</span>

	<span class="c1">// Make a list of all triggers.</span>
	<span class="c1">// A trigger is a pair of condition and action</span>
	<span class="n">lua_getglobal</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="s">&quot;_triggers_&quot;</span><span class="p">);</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">lua_isnil</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">-1</span><span class="p">))</span> <span class="p">{</span>
		<span class="n">DebugPrint</span><span class="p">(</span><span class="s">&quot;Trigger not set, defining trigger</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
		<span class="n">lua_pop</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
		<span class="n">lua_newtable</span><span class="p">(</span><span class="n">l</span><span class="p">);</span>
		<span class="n">lua_setglobal</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="s">&quot;_triggers_&quot;</span><span class="p">);</span>
		<span class="n">lua_getglobal</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="s">&quot;_triggers_&quot;</span><span class="p">);</span>
	<span class="p">}</span>

	<span class="k">const</span> <span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="n">lua_rawlen</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">-1</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">ActiveTriggers</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="n">ActiveTriggers</span><span class="p">[</span><span class="n">i</span> <span class="o">/</span> <span class="mi">2</span><span class="p">])</span> <span class="p">{</span>
		<span class="n">lua_pushnil</span><span class="p">(</span><span class="n">l</span><span class="p">);</span>
		<span class="n">lua_rawseti</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">-2</span><span class="p">,</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>
		<span class="n">lua_pushnil</span><span class="p">(</span><span class="n">l</span><span class="p">);</span>
		<span class="n">lua_rawseti</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">-2</span><span class="p">,</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">2</span><span class="p">);</span>
	<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
		<span class="n">lua_pushvalue</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
		<span class="n">lua_rawseti</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">-2</span><span class="p">,</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>
		<span class="n">lua_newtable</span><span class="p">(</span><span class="n">l</span><span class="p">);</span>
		<span class="n">lua_pushvalue</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">2</span><span class="p">);</span>
		<span class="n">lua_rawseti</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">-2</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
		<span class="n">lua_rawseti</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">-2</span><span class="p">,</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">2</span><span class="p">);</span>
	<span class="p">}</span>
	<span class="n">lua_pop</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>

	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</p>
                          </details>
                        </details>
                        
                        <details>
                        <summary>SetActiveTriggers</summary>
                        <p><br>  Set the active triggers</p>
                          <details>
                          <summary>/game/trigger.cpp:522 CclSetActiveTriggers</summary>
                          <p><div class="highlight"><pre><span></span><span class="k">static</span> <span class="kt">int</span> <span class="nf">CclSetActiveTriggers</span><span class="p">(</span><span class="n">lua_State</span> <span class="o">*</span><span class="n">l</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">const</span> <span class="kt">int</span> <span class="n">args</span> <span class="o">=</span> <span class="n">lua_gettop</span><span class="p">(</span><span class="n">l</span><span class="p">);</span>

	<span class="n">ActiveTriggers</span> <span class="o">=</span> <span class="k">new</span> <span class="kt">bool</span><span class="p">[</span><span class="n">args</span><span class="p">];</span>
	<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="n">args</span><span class="p">;</span> <span class="o">++</span><span class="n">j</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">ActiveTriggers</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">LuaToBoolean</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>
	<span class="p">}</span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</p>
                          </details>
                        </details>
                        
                        <details>
                        <summary>GetNumUnitsAt</summary>
                        <p><br> <b>Description</b><br><br>  Return the number of units of a given unit-type and player at a location.<br><br> Example:<br><br> <div class="example"><code>-- Get the number of knights from player 1 from position 0,0 to 20,15<br>			num_units = <strong>GetNumUnitsAt</strong>(1,"unit-knight",{0,0},{20,15})<br>			print(num_units)</code></div></p>
                          <details>
                          <summary>/game/trigger.cpp:204 CclGetNumUnitsAt</summary>
                          <p><div class="highlight"><pre><span></span><span class="k">static</span> <span class="kt">int</span> <span class="nf">CclGetNumUnitsAt</span><span class="p">(</span><span class="n">lua_State</span> <span class="o">*</span><span class="n">l</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">LuaCheckArgs</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">4</span><span class="p">);</span>

	<span class="kt">int</span> <span class="n">plynr</span> <span class="o">=</span> <span class="n">LuaToNumber</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
	<span class="n">lua_pushvalue</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">2</span><span class="p">);</span>
	<span class="k">const</span> <span class="n">CUnitType</span> <span class="o">*</span><span class="n">unittype</span> <span class="o">=</span> <span class="n">TriggerGetUnitType</span><span class="p">(</span><span class="n">l</span><span class="p">);</span>
	<span class="n">lua_pop</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>

	<span class="n">Vec2i</span> <span class="n">minPos</span><span class="p">;</span>
	<span class="n">Vec2i</span> <span class="n">maxPos</span><span class="p">;</span>
	<span class="n">CclGetPos</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">minPos</span><span class="p">.</span><span class="n">x</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">minPos</span><span class="p">.</span><span class="n">y</span><span class="p">,</span> <span class="mi">3</span><span class="p">);</span>
	<span class="n">CclGetPos</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">maxPos</span><span class="p">.</span><span class="n">x</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">maxPos</span><span class="p">.</span><span class="n">y</span><span class="p">,</span> <span class="mi">4</span><span class="p">);</span>

	<span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">CUnit</span> <span class="o">*&gt;</span> <span class="n">units</span><span class="p">;</span>

	<span class="n">Select</span><span class="p">(</span><span class="n">minPos</span><span class="p">,</span> <span class="n">maxPos</span><span class="p">,</span> <span class="n">units</span><span class="p">);</span>

	<span class="kt">int</span> <span class="n">s</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="k">for</span> <span class="p">(</span><span class="kt">size_t</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">!=</span> <span class="n">units</span><span class="p">.</span><span class="n">size</span><span class="p">();</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">const</span> <span class="n">CUnit</span> <span class="o">&amp;</span><span class="n">unit</span> <span class="o">=</span> <span class="o">*</span><span class="n">units</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
		<span class="c1">// Check unit type</span>

		<span class="k">if</span> <span class="p">(</span><span class="n">unittype</span> <span class="o">==</span> <span class="n">ANY_UNIT</span>
			<span class="o">||</span> <span class="p">(</span><span class="n">unittype</span> <span class="o">==</span> <span class="n">ALL_FOODUNITS</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="n">unit</span><span class="p">.</span><span class="n">Type</span><span class="o">-&gt;</span><span class="n">Building</span><span class="p">)</span>
			<span class="o">||</span> <span class="p">(</span><span class="n">unittype</span> <span class="o">==</span> <span class="n">ALL_BUILDINGS</span> <span class="o">&amp;&amp;</span> <span class="n">unit</span><span class="p">.</span><span class="n">Type</span><span class="o">-&gt;</span><span class="n">Building</span><span class="p">)</span>
			<span class="o">||</span> <span class="p">(</span><span class="n">unittype</span> <span class="o">==</span> <span class="n">unit</span><span class="p">.</span><span class="n">Type</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="n">unit</span><span class="p">.</span><span class="n">Constructed</span><span class="p">))</span> <span class="p">{</span>

			<span class="c1">// Check the player</span>
			<span class="k">if</span> <span class="p">(</span><span class="n">plynr</span> <span class="o">==</span> <span class="mi">-1</span> <span class="o">||</span> <span class="n">plynr</span> <span class="o">==</span> <span class="n">unit</span><span class="p">.</span><span class="n">Player</span><span class="o">-&gt;</span><span class="n">Index</span><span class="p">)</span> <span class="p">{</span>
				<span class="k">if</span> <span class="p">(</span><span class="n">unit</span><span class="p">.</span><span class="n">IsAlive</span><span class="p">())</span> <span class="p">{</span>
					<span class="o">++</span><span class="n">s</span><span class="p">;</span>
				<span class="p">}</span>
			<span class="p">}</span>
		<span class="p">}</span>
	<span class="p">}</span>
	<span class="n">lua_pushnumber</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">s</span><span class="p">);</span>
	<span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</p>
                          </details>
                        </details>
                        
                        <details>
                        <summary>IfNearUnit</summary>
                        <p><br> <b>Description</b><br><br>  Player has the quantity of unit-type near to unit-type.<br><br> Example:<br><br> <div class="example"><code>AddTrigger(<br>    function() return <strong>IfNearUnit</strong>(0,">",1,"unit-peasant","unit-town-hall") end,<br>    function()<br>        AddMessage("Player 0 has more than 1 peasant near the Town Hall")<br>        return false end<br>	)</code></div></p>
                          <details>
                          <summary>/game/trigger.cpp:277 CclIfNearUnit</summary>
                          <p><div class="highlight"><pre><span></span><span class="k">static</span> <span class="kt">int</span> <span class="nf">CclIfNearUnit</span><span class="p">(</span><span class="n">lua_State</span> <span class="o">*</span><span class="n">l</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">LuaCheckArgs</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">5</span><span class="p">);</span>
	<span class="n">lua_pushvalue</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
	<span class="k">const</span> <span class="kt">int</span> <span class="n">plynr</span> <span class="o">=</span> <span class="n">TriggerGetPlayer</span><span class="p">(</span><span class="n">l</span><span class="p">);</span>
	<span class="n">lua_pop</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
	<span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">op</span> <span class="o">=</span> <span class="n">LuaToString</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">2</span><span class="p">);</span>
	<span class="k">const</span> <span class="kt">int</span> <span class="n">q</span> <span class="o">=</span> <span class="n">LuaToNumber</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">3</span><span class="p">);</span>
	<span class="n">lua_pushvalue</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">4</span><span class="p">);</span>
	<span class="k">const</span> <span class="n">CUnitType</span> <span class="o">*</span><span class="n">unittype</span> <span class="o">=</span> <span class="n">TriggerGetUnitType</span><span class="p">(</span><span class="n">l</span><span class="p">);</span>
	<span class="n">lua_pop</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
	<span class="k">const</span> <span class="n">CUnitType</span> <span class="o">*</span><span class="n">ut2</span> <span class="o">=</span> <span class="n">CclGetUnitType</span><span class="p">(</span><span class="n">l</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">unittype</span> <span class="o">||</span> <span class="o">!</span><span class="n">ut2</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">LuaError</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="s">&quot;CclIfNearUnit: not a unit-type valid&quot;</span><span class="p">);</span>
	<span class="p">}</span>
	<span class="n">CompareFunction</span> <span class="n">compare</span> <span class="o">=</span> <span class="n">GetCompareFunction</span><span class="p">(</span><span class="n">op</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">compare</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">LuaError</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="s">&quot;Illegal comparison operation in if-near-unit: %s&quot;</span> <span class="n">_C_</span> <span class="n">op</span><span class="p">);</span>
	<span class="p">}</span>

	<span class="c1">//</span>
	<span class="c1">// Get all unit types &#39;near&#39;.</span>
	<span class="c1">//</span>

	<span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">CUnit</span> <span class="o">*&gt;</span> <span class="n">unitsOfType</span><span class="p">;</span>

	<span class="n">FindUnitsByType</span><span class="p">(</span><span class="o">*</span><span class="n">ut2</span><span class="p">,</span> <span class="n">unitsOfType</span><span class="p">);</span>
	<span class="k">for</span> <span class="p">(</span><span class="kt">size_t</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">!=</span> <span class="n">unitsOfType</span><span class="p">.</span><span class="n">size</span><span class="p">();</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">const</span> <span class="n">CUnit</span> <span class="o">&amp;</span><span class="n">centerUnit</span> <span class="o">=</span> <span class="o">*</span><span class="n">unitsOfType</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>

		<span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">CUnit</span> <span class="o">*&gt;</span> <span class="n">around</span><span class="p">;</span>
		<span class="n">SelectAroundUnit</span><span class="p">(</span><span class="n">centerUnit</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">around</span><span class="p">);</span>

		<span class="c1">// Count the requested units</span>
		<span class="kt">int</span> <span class="n">s</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
		<span class="k">for</span> <span class="p">(</span><span class="kt">size_t</span> <span class="n">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="n">around</span><span class="p">.</span><span class="n">size</span><span class="p">();</span> <span class="o">++</span><span class="n">j</span><span class="p">)</span> <span class="p">{</span>
			<span class="k">const</span> <span class="n">CUnit</span> <span class="o">&amp;</span><span class="n">unit</span> <span class="o">=</span> <span class="o">*</span><span class="n">around</span><span class="p">[</span><span class="n">j</span><span class="p">];</span>

			<span class="c1">// Check unit type</span>
			<span class="k">if</span> <span class="p">(</span><span class="n">unittype</span> <span class="o">==</span> <span class="n">ANY_UNIT</span>
				<span class="o">||</span> <span class="p">(</span><span class="n">unittype</span> <span class="o">==</span> <span class="n">ALL_FOODUNITS</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="n">unit</span><span class="p">.</span><span class="n">Type</span><span class="o">-&gt;</span><span class="n">Building</span><span class="p">)</span>
				<span class="o">||</span> <span class="p">(</span><span class="n">unittype</span> <span class="o">==</span> <span class="n">ALL_BUILDINGS</span> <span class="o">&amp;&amp;</span> <span class="n">unit</span><span class="p">.</span><span class="n">Type</span><span class="o">-&gt;</span><span class="n">Building</span><span class="p">)</span>
				<span class="o">||</span> <span class="p">(</span><span class="n">unittype</span> <span class="o">==</span> <span class="n">unit</span><span class="p">.</span><span class="n">Type</span><span class="p">))</span> <span class="p">{</span>

				<span class="c1">// Check the player</span>
				<span class="k">if</span> <span class="p">(</span><span class="n">plynr</span> <span class="o">==</span> <span class="mi">-1</span> <span class="o">||</span> <span class="n">plynr</span> <span class="o">==</span> <span class="n">unit</span><span class="p">.</span><span class="n">Player</span><span class="o">-&gt;</span><span class="n">Index</span><span class="p">)</span> <span class="p">{</span>
					<span class="o">++</span><span class="n">s</span><span class="p">;</span>
				<span class="p">}</span>
			<span class="p">}</span>
		<span class="p">}</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">compare</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">q</span><span class="p">))</span> <span class="p">{</span>
			<span class="n">lua_pushboolean</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
			<span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
		<span class="p">}</span>
	<span class="p">}</span>
	<span class="n">lua_pushboolean</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
	<span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</p>
                          </details>
                        </details>
                        
                        <details>
                        <summary>IfRescuedNearUnit</summary>
                        <p><br> <b>Description</b><br><br>  Player has the quantity of rescued unit-type near to unit-type.<br><br> Example:<br><br> <div class="example"><code><strong>IfRescuedNearUnit</strong>("this", ">=", 1, "unit-archer", "unit-circle-of-power")</code></div></p>
                          <details>
                          <summary>/game/trigger.cpp:345 CclIfRescuedNearUnit</summary>
                          <p><div class="highlight"><pre><span></span><span class="k">static</span> <span class="kt">int</span> <span class="nf">CclIfRescuedNearUnit</span><span class="p">(</span><span class="n">lua_State</span> <span class="o">*</span><span class="n">l</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">LuaCheckArgs</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">5</span><span class="p">);</span>

	<span class="n">lua_pushvalue</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
	<span class="k">const</span> <span class="kt">int</span> <span class="n">plynr</span> <span class="o">=</span> <span class="n">TriggerGetPlayer</span><span class="p">(</span><span class="n">l</span><span class="p">);</span>
	<span class="n">lua_pop</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
	<span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">op</span> <span class="o">=</span> <span class="n">LuaToString</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">2</span><span class="p">);</span>
	<span class="k">const</span> <span class="kt">int</span> <span class="n">q</span> <span class="o">=</span> <span class="n">LuaToNumber</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">3</span><span class="p">);</span>
	<span class="n">lua_pushvalue</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">4</span><span class="p">);</span>
	<span class="k">const</span> <span class="n">CUnitType</span> <span class="o">*</span><span class="n">unittype</span> <span class="o">=</span> <span class="n">TriggerGetUnitType</span><span class="p">(</span><span class="n">l</span><span class="p">);</span>
	<span class="n">lua_pop</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
	<span class="k">const</span> <span class="n">CUnitType</span> <span class="o">*</span><span class="n">ut2</span> <span class="o">=</span> <span class="n">CclGetUnitType</span><span class="p">(</span><span class="n">l</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">unittype</span> <span class="o">||</span> <span class="o">!</span><span class="n">ut2</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">LuaError</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="s">&quot;CclIfRescuedNearUnit: not a unit-type valid&quot;</span><span class="p">);</span>
	<span class="p">}</span>

	<span class="n">CompareFunction</span> <span class="n">compare</span> <span class="o">=</span> <span class="n">GetCompareFunction</span><span class="p">(</span><span class="n">op</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">compare</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">LuaError</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="s">&quot;Illegal comparison operation in if-rescued-near-unit: %s&quot;</span> <span class="n">_C_</span> <span class="n">op</span><span class="p">);</span>
	<span class="p">}</span>

	<span class="c1">// Get all unit types &#39;near&#39;.</span>
	<span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">CUnit</span> <span class="o">*&gt;</span> <span class="n">table</span><span class="p">;</span>
	<span class="n">FindUnitsByType</span><span class="p">(</span><span class="o">*</span><span class="n">ut2</span><span class="p">,</span> <span class="n">table</span><span class="p">);</span>
	<span class="k">for</span> <span class="p">(</span><span class="kt">size_t</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">!=</span> <span class="n">table</span><span class="p">.</span><span class="n">size</span><span class="p">();</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">CUnit</span> <span class="o">&amp;</span><span class="n">centerUnit</span> <span class="o">=</span> <span class="o">*</span><span class="n">table</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
		<span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">CUnit</span> <span class="o">*&gt;</span> <span class="n">around</span><span class="p">;</span>

		<span class="n">SelectAroundUnit</span><span class="p">(</span><span class="n">centerUnit</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">around</span><span class="p">);</span>
		<span class="c1">// Count the requested units</span>
		<span class="kt">int</span> <span class="n">s</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
		<span class="k">for</span> <span class="p">(</span><span class="kt">size_t</span> <span class="n">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">j</span> <span class="o">!=</span> <span class="n">around</span><span class="p">.</span><span class="n">size</span><span class="p">();</span> <span class="o">++</span><span class="n">j</span><span class="p">)</span> <span class="p">{</span>
			<span class="n">CUnit</span> <span class="o">&amp;</span><span class="n">unit</span> <span class="o">=</span> <span class="o">*</span><span class="n">around</span><span class="p">[</span><span class="n">j</span><span class="p">];</span>

			<span class="k">if</span> <span class="p">(</span><span class="n">unit</span><span class="p">.</span><span class="n">RescuedFrom</span><span class="p">)</span> <span class="p">{</span> <span class="c1">// only rescued units</span>
				<span class="c1">// Check unit type</span>

				<span class="k">if</span> <span class="p">(</span><span class="n">unittype</span> <span class="o">==</span> <span class="n">ANY_UNIT</span>
					<span class="o">||</span> <span class="p">(</span><span class="n">unittype</span> <span class="o">==</span> <span class="n">ALL_FOODUNITS</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="n">unit</span><span class="p">.</span><span class="n">Type</span><span class="o">-&gt;</span><span class="n">Building</span><span class="p">)</span>
					<span class="o">||</span> <span class="p">(</span><span class="n">unittype</span> <span class="o">==</span> <span class="n">ALL_BUILDINGS</span> <span class="o">&amp;&amp;</span> <span class="n">unit</span><span class="p">.</span><span class="n">Type</span><span class="o">-&gt;</span><span class="n">Building</span><span class="p">)</span>
					<span class="o">||</span> <span class="p">(</span><span class="n">unittype</span> <span class="o">==</span> <span class="n">unit</span><span class="p">.</span><span class="n">Type</span><span class="p">))</span> <span class="p">{</span>

					<span class="c1">// Check the player</span>
					<span class="k">if</span> <span class="p">(</span><span class="n">plynr</span> <span class="o">==</span> <span class="mi">-1</span> <span class="o">||</span> <span class="n">plynr</span> <span class="o">==</span> <span class="n">unit</span><span class="p">.</span><span class="n">Player</span><span class="o">-&gt;</span><span class="n">Index</span><span class="p">)</span> <span class="p">{</span>
						<span class="o">++</span><span class="n">s</span><span class="p">;</span>
					<span class="p">}</span>
				<span class="p">}</span>
			<span class="p">}</span>
		<span class="p">}</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">compare</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">q</span><span class="p">))</span> <span class="p">{</span>
			<span class="n">lua_pushboolean</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
			<span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
		<span class="p">}</span>
	<span class="p">}</span>
	<span class="n">lua_pushboolean</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
	<span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</p>
                          </details>
                        </details>
                        <hr>/game/game.cpp<hr>
                        <details>
                        <summary>SetGameName</summary>
                        <p><br> <b>Description</b><br><br>  Return of game name.<br><br>  @param l  Lua state.<br><br> Example:<br><br> <div class="example"><code><strong>SetGameName</strong>("Wargus Map - Chapter 1")</code></div></p>
                          <details>
                          <summary>/game/game.cpp:1159 CclSetGameName</summary>
                          <p><div class="highlight"><pre><span></span><span class="k">static</span> <span class="kt">int</span> <span class="nf">CclSetGameName</span><span class="p">(</span><span class="n">lua_State</span> <span class="o">*</span><span class="n">l</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">const</span> <span class="kt">int</span> <span class="n">args</span> <span class="o">=</span> <span class="n">lua_gettop</span><span class="p">(</span><span class="n">l</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">args</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="o">||</span> <span class="p">(</span><span class="n">args</span> <span class="o">==</span> <span class="mi">1</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="o">!</span><span class="n">lua_isnil</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="n">lua_isstring</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">1</span><span class="p">))))</span> <span class="p">{</span>
		<span class="n">LuaError</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="s">&quot;incorrect argument&quot;</span><span class="p">);</span>
	<span class="p">}</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">args</span> <span class="o">==</span> <span class="mi">1</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="n">lua_isnil</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span> <span class="p">{</span>
		<span class="n">GameName</span> <span class="o">=</span> <span class="n">lua_tostring</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
	<span class="p">}</span>

	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">GameName</span><span class="p">.</span><span class="n">empty</span><span class="p">())</span> <span class="p">{</span>
		<span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">path</span> <span class="o">=</span> <span class="n">Parameters</span><span class="o">::</span><span class="n">Instance</span><span class="p">.</span><span class="n">GetUserDirectory</span><span class="p">()</span> <span class="o">+</span> <span class="s">&quot;/&quot;</span> <span class="o">+</span> <span class="n">GameName</span><span class="p">;</span>
		<span class="n">makedir</span><span class="p">(</span><span class="n">path</span><span class="p">.</span><span class="n">c_str</span><span class="p">(),</span> <span class="mo">0777</span><span class="p">);</span>
	<span class="p">}</span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</p>
                          </details>
                        </details>
                        
                        <details>
                        <summary>SetFullGameName</summary>
                        <p>/game/game.cpp:1171 CclSetFullGameName</p>
                        <p><div class="highlight"><pre><span></span><span class="k">static</span> <span class="kt">int</span> <span class="nf">CclSetFullGameName</span><span class="p">(</span><span class="n">lua_State</span> <span class="o">*</span><span class="n">l</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">const</span> <span class="kt">int</span> <span class="n">args</span> <span class="o">=</span> <span class="n">lua_gettop</span><span class="p">(</span><span class="n">l</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">args</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="o">||</span> <span class="p">(</span><span class="n">args</span> <span class="o">==</span> <span class="mi">1</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="o">!</span><span class="n">lua_isnil</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="n">lua_isstring</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">1</span><span class="p">))))</span> <span class="p">{</span>
		<span class="n">LuaError</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="s">&quot;incorrect argument&quot;</span><span class="p">);</span>
	<span class="p">}</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">args</span> <span class="o">==</span> <span class="mi">1</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="n">lua_isnil</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span> <span class="p">{</span>
		<span class="n">FullGameName</span> <span class="o">=</span> <span class="n">lua_tostring</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
	<span class="p">}</span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</p>
                        </details>
                        
                        <details>
                        <summary>SetGodMode</summary>
                        <p><br> <b>Description</b><br><br>  Set God mode.<br><br>  @param l  Lua state.<br><br>  @return   The old mode.<br><br> Example:<br><br> <div class="example"><code>-- God Mode enabled<br>		<strong>SetGodMode</strong>(true)<br>		-- God Mode disabled<br>		<strong>SetGodMode</strong>(false)</code></div></p>
                          <details>
                          <summary>/game/game.cpp:1194 CclSetGodMode</summary>
                          <p><div class="highlight"><pre><span></span><span class="k">static</span> <span class="kt">int</span> <span class="nf">CclSetGodMode</span><span class="p">(</span><span class="n">lua_State</span> <span class="o">*</span><span class="n">l</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">LuaCheckArgs</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
	<span class="n">GodMode</span> <span class="o">=</span> <span class="n">LuaToBoolean</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</p>
                          </details>
                        </details>
                        
                        <details>
                        <summary>GetGodMode</summary>
                        <p><br> <b>Description</b><br><br>  Get God mode.<br><br>  @param l  Lua state.<br><br>  @return   God mode.<br><br> Example:<br><br> <div class="example"><code>g_mode = <strong>GetGodMode</strong>()<br>		print(g_mode)</code></div></p>
                          <details>
                          <summary>/game/game.cpp:1215 CclGetGodMode</summary>
                          <p><div class="highlight"><pre><span></span><span class="k">static</span> <span class="kt">int</span> <span class="nf">CclGetGodMode</span><span class="p">(</span><span class="n">lua_State</span> <span class="o">*</span><span class="n">l</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">LuaCheckArgs</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
	<span class="n">lua_pushboolean</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">GodMode</span><span class="p">);</span>
	<span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</p>
                          </details>
                        </details>
                        
                        <details>
                        <summary>SetSpeedResourcesHarvest</summary>
                        <p><br>  Set resource harvesting speed (deprecated).<br><br>  @param l  Lua state.</p>
                          <details>
                          <summary>/game/game.cpp:1232 CclSetSpeedResourcesHarvest</summary>
                          <p><div class="highlight"><pre><span></span><span class="k">static</span> <span class="kt">int</span> <span class="nf">CclSetSpeedResourcesHarvest</span><span class="p">(</span><span class="n">lua_State</span> <span class="o">*</span><span class="n">l</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">LuaCheckArgs</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">3</span><span class="p">);</span>

	<span class="k">const</span> <span class="kt">int</span> <span class="n">player</span> <span class="o">=</span> <span class="n">LuaToNumber</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
	<span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">resource</span> <span class="o">=</span> <span class="n">LuaToString</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">2</span><span class="p">);</span>
	<span class="k">const</span> <span class="kt">int</span> <span class="n">resId</span> <span class="o">=</span> <span class="n">GetResourceIdByName</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">resource</span><span class="p">.</span><span class="n">c_str</span><span class="p">());</span>

	<span class="n">Players</span><span class="p">[</span><span class="n">player</span><span class="p">].</span><span class="n">SpeedResourcesHarvest</span><span class="p">[</span><span class="n">resId</span><span class="p">]</span> <span class="o">=</span> <span class="n">LuaToNumber</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">3</span><span class="p">);</span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</p>
                          </details>
                        </details>
                        
                        <details>
                        <summary>SetSpeedResourcesReturn</summary>
                        <p><br>  Set resource returning speed (deprecated).<br><br>  @param l  Lua state.</p>
                          <details>
                          <summary>/game/game.cpp:1249 CclSetSpeedResourcesReturn</summary>
                          <p><div class="highlight"><pre><span></span><span class="k">static</span> <span class="kt">int</span> <span class="nf">CclSetSpeedResourcesReturn</span><span class="p">(</span><span class="n">lua_State</span> <span class="o">*</span><span class="n">l</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">LuaCheckArgs</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">3</span><span class="p">);</span>

	<span class="k">const</span> <span class="kt">int</span> <span class="n">player</span> <span class="o">=</span> <span class="n">LuaToNumber</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
	<span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">resource</span> <span class="o">=</span> <span class="n">LuaToString</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">2</span><span class="p">);</span>
	<span class="k">const</span> <span class="kt">int</span> <span class="n">resId</span> <span class="o">=</span> <span class="n">GetResourceIdByName</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">resource</span><span class="p">.</span><span class="n">c_str</span><span class="p">());</span>

	<span class="n">Players</span><span class="p">[</span><span class="n">player</span><span class="p">].</span><span class="n">SpeedResourcesReturn</span><span class="p">[</span><span class="n">resId</span><span class="p">]</span> <span class="o">=</span> <span class="n">LuaToNumber</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">3</span><span class="p">);</span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</p>
                          </details>
                        </details>
                        
                        <details>
                        <summary>SetSpeedBuild</summary>
                        <p><br>  Set building speed (deprecated).<br><br>  @param l  Lua state.</p>
                          <details>
                          <summary>/game/game.cpp:1262 CclSetSpeedBuild</summary>
                          <p><div class="highlight"><pre><span></span><span class="k">static</span> <span class="kt">int</span> <span class="nf">CclSetSpeedBuild</span><span class="p">(</span><span class="n">lua_State</span> <span class="o">*</span><span class="n">l</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">LuaCheckArgs</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">2</span><span class="p">);</span>
	<span class="k">const</span> <span class="kt">int</span> <span class="n">player</span> <span class="o">=</span> <span class="n">LuaToNumber</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
	<span class="n">Players</span><span class="p">[</span><span class="n">player</span><span class="p">].</span><span class="n">SpeedBuild</span> <span class="o">=</span> <span class="n">LuaToNumber</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">2</span><span class="p">);</span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</p>
                          </details>
                        </details>
                        
                        <details>
                        <summary>GetSpeedBuild</summary>
                        <p><br>  Get building speed (deprecated).<br><br>  @param l  Lua state.<br><br>  @return   Building speed.</p>
                          <details>
                          <summary>/game/game.cpp:1277 CclGetSpeedBuild</summary>
                          <p><div class="highlight"><pre><span></span><span class="k">static</span> <span class="kt">int</span> <span class="nf">CclGetSpeedBuild</span><span class="p">(</span><span class="n">lua_State</span> <span class="o">*</span><span class="n">l</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">LuaCheckArgs</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
	<span class="k">const</span> <span class="kt">int</span> <span class="n">player</span> <span class="o">=</span> <span class="n">LuaToNumber</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
	<span class="n">lua_pushnumber</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">Players</span><span class="p">[</span><span class="n">player</span><span class="p">].</span><span class="n">SpeedBuild</span><span class="p">);</span>
	<span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</p>
                          </details>
                        </details>
                        
                        <details>
                        <summary>SetSpeedTrain</summary>
                        <p><br>  Set training speed (deprecated).<br><br>  @param l  Lua state.</p>
                          <details>
                          <summary>/game/game.cpp:1290 CclSetSpeedTrain</summary>
                          <p><div class="highlight"><pre><span></span><span class="k">static</span> <span class="kt">int</span> <span class="nf">CclSetSpeedTrain</span><span class="p">(</span><span class="n">lua_State</span> <span class="o">*</span><span class="n">l</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">LuaCheckArgs</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">2</span><span class="p">);</span>
	<span class="k">const</span> <span class="kt">int</span> <span class="n">player</span> <span class="o">=</span> <span class="n">LuaToNumber</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
	<span class="n">Players</span><span class="p">[</span><span class="n">player</span><span class="p">].</span><span class="n">SpeedTrain</span> <span class="o">=</span> <span class="n">LuaToNumber</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">2</span><span class="p">);</span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</p>
                          </details>
                        </details>
                        
                        <details>
                        <summary>GetSpeedTrain</summary>
                        <p><br>  Get training speed (deprecated).<br><br>  @param l  Lua state.<br><br>  @return   Training speed.</p>
                          <details>
                          <summary>/game/game.cpp:1305 CclGetSpeedTrain</summary>
                          <p><div class="highlight"><pre><span></span><span class="k">static</span> <span class="kt">int</span> <span class="nf">CclGetSpeedTrain</span><span class="p">(</span><span class="n">lua_State</span> <span class="o">*</span><span class="n">l</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">LuaCheckArgs</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
	<span class="k">const</span> <span class="kt">int</span> <span class="n">player</span> <span class="o">=</span> <span class="n">LuaToNumber</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
	<span class="n">lua_pushnumber</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">Players</span><span class="p">[</span><span class="n">player</span><span class="p">].</span><span class="n">SpeedTrain</span><span class="p">);</span>
	<span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</p>
                          </details>
                        </details>
                        
                        <details>
                        <summary>SetSpeedUpgrade</summary>
                        <p><br>  For debug increase upgrading speed (deprecated).<br><br>  @param l  Lua state.</p>
                          <details>
                          <summary>/game/game.cpp:1320 CclSetSpeedUpgrade</summary>
                          <p><div class="highlight"><pre><span></span><span class="k">static</span> <span class="kt">int</span> <span class="nf">CclSetSpeedUpgrade</span><span class="p">(</span><span class="n">lua_State</span> <span class="o">*</span><span class="n">l</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">LuaCheckArgs</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">2</span><span class="p">);</span>
	<span class="k">const</span> <span class="kt">int</span> <span class="n">player</span> <span class="o">=</span> <span class="n">LuaToNumber</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
	<span class="n">Players</span><span class="p">[</span><span class="n">player</span><span class="p">].</span><span class="n">SpeedUpgrade</span> <span class="o">=</span> <span class="n">LuaToNumber</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">2</span><span class="p">);</span>

	<span class="n">lua_pushnumber</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">Players</span><span class="p">[</span><span class="n">player</span><span class="p">].</span><span class="n">SpeedUpgrade</span><span class="p">);</span>
	<span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</p>
                          </details>
                        </details>
                        
                        <details>
                        <summary>SetSpeedResearch</summary>
                        <p><br>  For debug increase researching speed (deprecated).<br><br>  @param l  Lua state.</p>
                          <details>
                          <summary>/game/game.cpp:1335 CclSetSpeedResearch</summary>
                          <p><div class="highlight"><pre><span></span><span class="k">static</span> <span class="kt">int</span> <span class="nf">CclSetSpeedResearch</span><span class="p">(</span><span class="n">lua_State</span> <span class="o">*</span><span class="n">l</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">LuaCheckArgs</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">2</span><span class="p">);</span>
	<span class="k">const</span> <span class="kt">int</span> <span class="n">player</span> <span class="o">=</span> <span class="n">LuaToNumber</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
	<span class="n">Players</span><span class="p">[</span><span class="n">player</span><span class="p">].</span><span class="n">SpeedResearch</span> <span class="o">=</span> <span class="n">LuaToNumber</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">2</span><span class="p">);</span>

	<span class="n">lua_pushnumber</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">Players</span><span class="p">[</span><span class="n">player</span><span class="p">].</span><span class="n">SpeedResearch</span><span class="p">);</span>
	<span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</p>
                          </details>
                        </details>
                        
                        <details>
                        <summary>SetSpeeds</summary>
                        <p><br>  For debug increase all speeds (deprecated).<br><br>  @param l  Lua state.</p>
                          <details>
                          <summary>/game/game.cpp:1356 CclSetSpeeds</summary>
                          <p><div class="highlight"><pre><span></span><span class="k">static</span> <span class="kt">int</span> <span class="nf">CclSetSpeeds</span><span class="p">(</span><span class="n">lua_State</span> <span class="o">*</span><span class="n">l</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">LuaCheckArgs</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
	<span class="k">const</span> <span class="kt">int</span> <span class="n">speed</span> <span class="o">=</span> <span class="n">LuaToNumber</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
	<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">PlayerMax</span><span class="p">;</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="n">MaxCosts</span><span class="p">;</span> <span class="o">++</span><span class="n">j</span><span class="p">)</span> <span class="p">{</span>
			<span class="n">Players</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">SpeedResourcesHarvest</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">speed</span><span class="p">;</span>
			<span class="n">Players</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">SpeedResourcesReturn</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">speed</span><span class="p">;</span>
		<span class="p">}</span>
		<span class="n">Players</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">SpeedBuild</span> <span class="o">=</span> <span class="n">Players</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">SpeedTrain</span> <span class="o">=</span> <span class="n">Players</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">SpeedUpgrade</span> <span class="o">=</span> <span class="n">Players</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">SpeedResearch</span> <span class="o">=</span> <span class="n">speed</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="n">lua_pushnumber</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">speed</span><span class="p">);</span>
	<span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</p>
                          </details>
                        </details>
                        
                        <details>
                        <summary>DefineDefaultIncomes</summary>
                        <p><br>  Define default incomes for a new player.<br><br>  @param l  Lua state.</p>
                          <details>
                          <summary>/game/game.cpp:1370 CclDefineDefaultIncomes</summary>
                          <p><div class="highlight"><pre><span></span><span class="k">static</span> <span class="kt">int</span> <span class="nf">CclDefineDefaultIncomes</span><span class="p">(</span><span class="n">lua_State</span> <span class="o">*</span><span class="n">l</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">const</span> <span class="kt">int</span> <span class="n">args</span> <span class="o">=</span> <span class="n">lua_gettop</span><span class="p">(</span><span class="n">l</span><span class="p">);</span>
	<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">MaxCosts</span> <span class="o">&amp;&amp;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">args</span><span class="p">;</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">DefaultIncomes</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">LuaToNumber</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>
	<span class="p">}</span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</p>
                          </details>
                        </details>
                        
                        <details>
                        <summary>DefineDefaultActions</summary>
                        <p><br>  Define default action for the resources.<br><br>  @param l  Lua state.</p>
                          <details>
                          <summary>/game/game.cpp:1387 CclDefineDefaultActions</summary>
                          <p><div class="highlight"><pre><span></span><span class="k">static</span> <span class="kt">int</span> <span class="nf">CclDefineDefaultActions</span><span class="p">(</span><span class="n">lua_State</span> <span class="o">*</span><span class="n">l</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">for</span> <span class="p">(</span><span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">MaxCosts</span><span class="p">;</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">DefaultActions</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">clear</span><span class="p">();</span>
	<span class="p">}</span>
	<span class="k">const</span> <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">args</span> <span class="o">=</span> <span class="n">lua_gettop</span><span class="p">(</span><span class="n">l</span><span class="p">);</span>
	<span class="k">for</span> <span class="p">(</span><span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">MaxCosts</span> <span class="o">&amp;&amp;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">args</span><span class="p">;</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">DefaultActions</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">LuaToString</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>
	<span class="p">}</span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</p>
                          </details>
                        </details>
                        
                        <details>
                        <summary>DefineDefaultResourceNames</summary>
                        <p><br>  Define default names for the resources.<br><br>  @param l  Lua state.</p>
                          <details>
                          <summary>/game/game.cpp:1404 CclDefineDefaultResourceNames</summary>
                          <p><div class="highlight"><pre><span></span><span class="k">static</span> <span class="kt">int</span> <span class="nf">CclDefineDefaultResourceNames</span><span class="p">(</span><span class="n">lua_State</span> <span class="o">*</span><span class="n">l</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">for</span> <span class="p">(</span><span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">MaxCosts</span><span class="p">;</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">DefaultResourceNames</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">clear</span><span class="p">();</span>
	<span class="p">}</span>
	<span class="k">const</span> <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">args</span> <span class="o">=</span> <span class="n">lua_gettop</span><span class="p">(</span><span class="n">l</span><span class="p">);</span>
	<span class="k">for</span> <span class="p">(</span><span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">MaxCosts</span> <span class="o">&amp;&amp;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">args</span><span class="p">;</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">DefaultResourceNames</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">LuaToString</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>
	<span class="p">}</span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</p>
                          </details>
                        </details>
                        
                        <details>
                        <summary>DefineDefaultResourceAmounts</summary>
                        <p><br>  Define default names for the resources.<br><br>  @param l  Lua state.</p>
                          <details>
                          <summary>/game/game.cpp:1426 CclDefineDefaultResourceAmounts</summary>
                          <p><div class="highlight"><pre><span></span><span class="k">static</span> <span class="kt">int</span> <span class="nf">CclDefineDefaultResourceAmounts</span><span class="p">(</span><span class="n">lua_State</span> <span class="o">*</span><span class="n">l</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">const</span> <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">args</span> <span class="o">=</span> <span class="n">lua_gettop</span><span class="p">(</span><span class="n">l</span><span class="p">);</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">args</span> <span class="o">&amp;</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">LuaError</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="s">&quot;incorrect argument&quot;</span><span class="p">);</span>
	<span class="p">}</span>
	<span class="k">for</span> <span class="p">(</span><span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="n">args</span><span class="p">;</span> <span class="o">++</span><span class="n">j</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">resource</span> <span class="o">=</span> <span class="n">LuaToString</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>
		<span class="k">const</span> <span class="kt">int</span> <span class="n">resId</span> <span class="o">=</span> <span class="n">GetResourceIdByName</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">resource</span><span class="p">.</span><span class="n">c_str</span><span class="p">());</span>

		<span class="o">++</span><span class="n">j</span><span class="p">;</span>
		<span class="n">DefaultResourceAmounts</span><span class="p">[</span><span class="n">resId</span><span class="p">]</span> <span class="o">=</span> <span class="n">LuaToNumber</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>
	<span class="p">}</span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</p>
                          </details>
                        </details>
                        
                        <details>
                        <summary>DefineDefaultResourceMaxAmounts</summary>
                        <p><br>  Define max amounts for the resources.<br><br>  @param l  Lua state.</p>
                          <details>
                          <summary>/game/game.cpp:1444 CclDefineDefaultResourceMaxAmounts</summary>
                          <p><div class="highlight"><pre><span></span><span class="k">static</span> <span class="kt">int</span> <span class="nf">CclDefineDefaultResourceMaxAmounts</span><span class="p">(</span><span class="n">lua_State</span> <span class="o">*</span><span class="n">l</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">const</span> <span class="kt">int</span> <span class="n">args</span> <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="n">min</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="p">(</span><span class="n">lua_gettop</span><span class="p">(</span><span class="n">l</span><span class="p">),</span> <span class="n">MaxCosts</span><span class="p">);</span>

	<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">args</span><span class="p">;</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">DefaultResourceMaxAmounts</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">LuaToNumber</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>
	<span class="p">}</span>
	<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="n">args</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">MaxCosts</span><span class="p">;</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">DefaultResourceMaxAmounts</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="mi">-1</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</p>
                          </details>
                        </details>
                        
                        <details>
                        <summary>SetUseHPForXp</summary>
                        <p><br>  Affect UseHPForXp.<br><br>  @param l  Lua state.<br><br>  @return 0.</p>
                          <details>
                          <summary>/game/game.cpp:1458 ScriptSetUseHPForXp</summary>
                          <p><div class="highlight"><pre><span></span><span class="k">static</span> <span class="kt">int</span> <span class="nf">ScriptSetUseHPForXp</span><span class="p">(</span><span class="n">lua_State</span> <span class="o">*</span><span class="n">l</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">LuaCheckArgs</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
	<span class="n">UseHPForXp</span> <span class="o">=</span> <span class="n">LuaToBoolean</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</p>
                          </details>
                        </details>
                        
                        <details>
                        <summary>SetLocalPlayerName</summary>
                        <p><br> <b>Description</b><br><br>  Set the local player name<br><br>  @param l  Lua state.<br><br> Example:<br><br> <div class="example"><code><strong>SetLocalPlayerName</strong>("Stormreaver Clan")</code></div></p>
                          <details>
                          <summary>/game/game.cpp:1476 CclSetLocalPlayerName</summary>
                          <p><div class="highlight"><pre><span></span><span class="k">static</span> <span class="kt">int</span> <span class="nf">CclSetLocalPlayerName</span><span class="p">(</span><span class="n">lua_State</span> <span class="o">*</span><span class="n">l</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">LuaCheckArgs</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
	<span class="n">Parameters</span><span class="o">::</span><span class="n">Instance</span><span class="p">.</span><span class="n">LocalPlayerName</span> <span class="o">=</span> <span class="n">LuaToString</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</p>
                          </details>
                        </details>
                        
                        <details>
                        <summary>GetLocalPlayerName</summary>
                        <p><br> <b>Description</b><br><br>  Get the local player name<br><br>  @param l  Lua state.<br><br> Example:<br><br> <div class="example"><code><strong>GetLocalPlayerName</strong>()</code></div></p>
                          <details>
                          <summary>/game/game.cpp:1494 CclGetLocalPlayerName</summary>
                          <p><div class="highlight"><pre><span></span><span class="k">static</span> <span class="kt">int</span> <span class="nf">CclGetLocalPlayerName</span><span class="p">(</span><span class="n">lua_State</span> <span class="o">*</span><span class="n">l</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">LuaCheckArgs</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
	<span class="n">lua_pushstring</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">Parameters</span><span class="o">::</span><span class="n">Instance</span><span class="p">.</span><span class="n">LocalPlayerName</span><span class="p">.</span><span class="n">c_str</span><span class="p">());</span>
	<span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</p>
                          </details>
                        </details>
                        
                        <details>
                        <summary>SetMenuRace</summary>
                        <p>/game/game.cpp:1535 CclSetMenuRace</p>
                        <p><div class="highlight"><pre><span></span><span class="k">static</span> <span class="kt">int</span> <span class="nf">CclSetMenuRace</span><span class="p">(</span><span class="n">lua_State</span> <span class="o">*</span><span class="n">l</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">LuaCheckArgs</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
	<span class="n">MenuRace</span> <span class="o">=</span> <span class="n">LuaToString</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</p>
                        </details>
                        
                        <details>
                        <summary>GetStratagusVersion</summary>
                        <p><br> <b>Description</b><br><br>  Get Stratagus Version<br><br> Example:<br><br> <div class="example"><code>version = <strong>GetStratagusVersion</strong>()<br>		print(version)</code></div></p>
                          <details>
                          <summary>/game/game.cpp:1511 CclGetStratagusVersion</summary>
                          <p><div class="highlight"><pre><span></span><span class="k">static</span> <span class="kt">int</span> <span class="nf">CclGetStratagusVersion</span><span class="p">(</span><span class="n">lua_State</span> <span class="o">*</span><span class="n">l</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">LuaCheckArgs</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
	<span class="n">lua_pushstring</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">VERSION</span><span class="p">);</span>
	<span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</p>
                          </details>
                        </details>
                        
                        <details>
                        <summary>GetStratagusHomepage</summary>
                        <p><br> <b>Description</b><br><br>  Get Stratagus Homepage<br><br> Example:<br><br> <div class="example"><code>url = <strong>GetStratagusHomepage</strong>()<br>	print(url)</code></div></p>
                          <details>
                          <summary>/game/game.cpp:1528 CclGetStratagusHomepage</summary>
                          <p><div class="highlight"><pre><span></span><span class="k">static</span> <span class="kt">int</span> <span class="nf">CclGetStratagusHomepage</span><span class="p">(</span><span class="n">lua_State</span> <span class="o">*</span><span class="n">l</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">LuaCheckArgs</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
	<span class="n">lua_pushstring</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">HOMEPAGE</span><span class="p">);</span>
	<span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</p>
                          </details>
                        </details>
                        
                        <details>
                        <summary>SavedGameInfo</summary>
                        <p><br>  Load the SavedGameInfo Header<br><br>  @param l  Lua state.</p>
                          <details>
                          <summary>/game/game.cpp:1571 CclSavedGameInfo</summary>
                          <p><div class="highlight"><pre><span></span><span class="k">static</span> <span class="kt">int</span> <span class="nf">CclSavedGameInfo</span><span class="p">(</span><span class="n">lua_State</span> <span class="o">*</span><span class="n">l</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">LuaCheckArgs</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">lua_istable</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span> <span class="p">{</span>
		<span class="n">LuaError</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="s">&quot;incorrect argument&quot;</span><span class="p">);</span>
	<span class="p">}</span>

	<span class="k">for</span> <span class="p">(</span><span class="n">lua_pushnil</span><span class="p">(</span><span class="n">l</span><span class="p">);</span> <span class="n">lua_next</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span> <span class="n">lua_pop</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span> <span class="p">{</span>
		<span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">value</span> <span class="o">=</span> <span class="n">LuaToString</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">-2</span><span class="p">);</span>

		<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s">&quot;SaveFile&quot;</span><span class="p">))</span> <span class="p">{</span>
			<span class="k">if</span> <span class="p">(</span><span class="n">strcpy_s</span><span class="p">(</span><span class="n">CurrentMapPath</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">CurrentMapPath</span><span class="p">),</span> <span class="n">LuaToString</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">-1</span><span class="p">))</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
				<span class="n">LuaError</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="s">&quot;SaveFile too long&quot;</span><span class="p">);</span>
			<span class="p">}</span>
			<span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">buf</span> <span class="o">=</span> <span class="n">StratagusLibPath</span><span class="p">;</span>
			<span class="n">buf</span> <span class="o">+=</span> <span class="s">&quot;/&quot;</span><span class="p">;</span>
			<span class="n">buf</span> <span class="o">+=</span> <span class="n">LuaToString</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">-1</span><span class="p">);</span>
			<span class="k">if</span> <span class="p">(</span><span class="n">LuaLoadFile</span><span class="p">(</span><span class="n">buf</span><span class="p">)</span> <span class="o">==</span> <span class="mi">-1</span><span class="p">)</span> <span class="p">{</span>
				<span class="n">DebugPrint</span><span class="p">(</span><span class="s">&quot;Load failed: %s</span><span class="se">\n</span><span class="s">&quot;</span> <span class="n">_C_</span> <span class="n">value</span><span class="p">);</span>
			<span class="p">}</span>
		<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s">&quot;SyncHash&quot;</span><span class="p">))</span> <span class="p">{</span>
			<span class="n">SyncHash</span> <span class="o">=</span> <span class="n">LuaToNumber</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">-1</span><span class="p">);</span>
		<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s">&quot;SyncRandSeed&quot;</span><span class="p">))</span> <span class="p">{</span>
			<span class="n">SyncRandSeed</span> <span class="o">=</span> <span class="n">LuaToNumber</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">-1</span><span class="p">);</span>
		<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
			<span class="n">LuaError</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="s">&quot;Unsupported tag: %s&quot;</span> <span class="n">_C_</span> <span class="n">value</span><span class="p">);</span>
		<span class="p">}</span>
	<span class="p">}</span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</p>
                          </details>
                        </details>
                        <hr>/unit/upgrade.cpp<hr>
                        <details>
                        <summary>DefineModifier</summary>
                        <p><br>  Define a new upgrade modifier.<br><br>  @param l  List of modifiers.</p>
                          <details>
                          <summary>/unit/upgrade.cpp:360 CclDefineModifier</summary>
                          <p><div class="highlight"><pre><span></span><span class="k">static</span> <span class="kt">int</span> <span class="nf">CclDefineModifier</span><span class="p">(</span><span class="n">lua_State</span> <span class="o">*</span><span class="n">l</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">const</span> <span class="kt">int</span> <span class="n">args</span> <span class="o">=</span> <span class="n">lua_gettop</span><span class="p">(</span><span class="n">l</span><span class="p">);</span>

	<span class="n">CUpgradeModifier</span> <span class="o">*</span><span class="n">um</span> <span class="o">=</span> <span class="k">new</span> <span class="n">CUpgradeModifier</span><span class="p">;</span>

	<span class="n">memset</span><span class="p">(</span><span class="n">um</span><span class="o">-&gt;</span><span class="n">ChangeUpgrades</span><span class="p">,</span> <span class="sc">&#39;?&#39;</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">um</span><span class="o">-&gt;</span><span class="n">ChangeUpgrades</span><span class="p">));</span>
	<span class="n">memset</span><span class="p">(</span><span class="n">um</span><span class="o">-&gt;</span><span class="n">ApplyTo</span><span class="p">,</span> <span class="sc">&#39;?&#39;</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">um</span><span class="o">-&gt;</span><span class="n">ApplyTo</span><span class="p">));</span>
	<span class="n">um</span><span class="o">-&gt;</span><span class="n">Modifier</span><span class="p">.</span><span class="n">Variables</span> <span class="o">=</span> <span class="k">new</span> <span class="n">CVariable</span><span class="p">[</span><span class="n">UnitTypeVar</span><span class="p">.</span><span class="n">GetNumberVariable</span><span class="p">()];</span>
	<span class="n">um</span><span class="o">-&gt;</span><span class="n">ModifyPercent</span> <span class="o">=</span> <span class="k">new</span> <span class="kt">int</span><span class="p">[</span><span class="n">UnitTypeVar</span><span class="p">.</span><span class="n">GetNumberVariable</span><span class="p">()];</span>
	<span class="n">memset</span><span class="p">(</span><span class="n">um</span><span class="o">-&gt;</span><span class="n">ModifyPercent</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">UnitTypeVar</span><span class="p">.</span><span class="n">GetNumberVariable</span><span class="p">()</span> <span class="o">*</span> <span class="k">sizeof</span><span class="p">(</span><span class="kt">int</span><span class="p">));</span>

	<span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">upgrade_ident</span> <span class="o">=</span> <span class="n">LuaToString</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
	<span class="n">um</span><span class="o">-&gt;</span><span class="n">UpgradeId</span> <span class="o">=</span> <span class="n">UpgradeIdByIdent</span><span class="p">(</span><span class="n">upgrade_ident</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">um</span><span class="o">-&gt;</span><span class="n">UpgradeId</span> <span class="o">==</span> <span class="mi">-1</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">LuaError</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="s">&quot;Error when defining upgrade modifier: upgrade </span><span class="se">\&quot;</span><span class="s">%s</span><span class="se">\&quot;</span><span class="s"> doesn&#39;t exist.&quot;</span> <span class="n">_C_</span> <span class="n">upgrade_ident</span><span class="p">.</span><span class="n">c_str</span><span class="p">());</span>
	<span class="p">}</span>

	<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">j</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="n">args</span><span class="p">;</span> <span class="o">++</span><span class="n">j</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">lua_istable</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span> <span class="p">{</span>
			<span class="n">LuaError</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="s">&quot;incorrect argument&quot;</span><span class="p">);</span>
		<span class="p">}</span>
		<span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">key</span> <span class="o">=</span> <span class="n">LuaToString</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
<span class="cp">#if 0</span><span class="c"> // To be removed. must modify lua file.</span>
<span class="c">		if (!strcmp(key, &quot;attack-range&quot;)) {</span>
<span class="c">			key = &quot;AttackRange&quot;;</span>
<span class="c">		} else if (!strcmp(key, &quot;sight-range&quot;)) {</span>
<span class="c">			key = &quot;SightRange&quot;;</span>
<span class="c">		} else if (!strcmp(key, &quot;basic-damage&quot;)) {</span>
<span class="c">			key = &quot;BasicDamage&quot;;</span>
<span class="c">		} else if (!strcmp(key, &quot;piercing-damage&quot;)) {</span>
<span class="c">			key = &quot;PiercingDamage&quot;;</span>
<span class="c">		} else if (!strcmp(key, &quot;armor&quot;)) {</span>
<span class="c">			key = &quot;Armor&quot;;</span>
<span class="c">		} else if (!strcmp(key, &quot;hit-points&quot;)) {</span>
<span class="c">			key = &quot;HitPoints&quot;;</span>
<span class="c">		}</span>
<span class="cp">#endif</span>
		<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="s">&quot;regeneration-rate&quot;</span><span class="p">))</span> <span class="p">{</span>
			<span class="n">um</span><span class="o">-&gt;</span><span class="n">Modifier</span><span class="p">.</span><span class="n">Variables</span><span class="p">[</span><span class="n">HP_INDEX</span><span class="p">].</span><span class="n">Increase</span> <span class="o">=</span> <span class="n">LuaToNumber</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">);</span>
		<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="s">&quot;regeneration-frequency&quot;</span><span class="p">))</span> <span class="p">{</span>
			<span class="n">um</span><span class="o">-&gt;</span><span class="n">Modifier</span><span class="p">.</span><span class="n">Variables</span><span class="p">[</span><span class="n">HP_INDEX</span><span class="p">].</span><span class="n">IncreaseFrequency</span> <span class="o">=</span> <span class="n">LuaToNumber</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">);</span>
		<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="s">&quot;cost&quot;</span><span class="p">))</span> <span class="p">{</span>
			<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">lua_istable</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">||</span> <span class="n">lua_rawlen</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">2</span><span class="p">)</span> <span class="p">{</span>
				<span class="n">LuaError</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="s">&quot;incorrect argument&quot;</span><span class="p">);</span>
			<span class="p">}</span>
			<span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">value</span> <span class="o">=</span> <span class="n">LuaToString</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
			<span class="k">const</span> <span class="kt">int</span> <span class="n">resId</span> <span class="o">=</span> <span class="n">GetResourceIdByName</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">value</span><span class="p">);</span>
			<span class="n">um</span><span class="o">-&gt;</span><span class="n">Modifier</span><span class="p">.</span><span class="n">Costs</span><span class="p">[</span><span class="n">resId</span><span class="p">]</span> <span class="o">=</span> <span class="n">LuaToNumber</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">);</span>
		<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="s">&quot;storing&quot;</span><span class="p">))</span> <span class="p">{</span>
			<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">lua_istable</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">||</span> <span class="n">lua_rawlen</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">2</span><span class="p">)</span> <span class="p">{</span>
				<span class="n">LuaError</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="s">&quot;incorrect argument&quot;</span><span class="p">);</span>
			<span class="p">}</span>
			<span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">value</span> <span class="o">=</span> <span class="n">LuaToString</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
			<span class="k">const</span> <span class="kt">int</span> <span class="n">resId</span> <span class="o">=</span> <span class="n">GetResourceIdByName</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">value</span><span class="p">);</span>
			<span class="n">um</span><span class="o">-&gt;</span><span class="n">Modifier</span><span class="p">.</span><span class="n">Storing</span><span class="p">[</span><span class="n">resId</span><span class="p">]</span> <span class="o">=</span> <span class="n">LuaToNumber</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">);</span>
		<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="s">&quot;improve-production&quot;</span><span class="p">))</span> <span class="p">{</span>
			<span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">value</span> <span class="o">=</span> <span class="n">LuaToString</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">);</span>
			<span class="k">const</span> <span class="kt">int</span> <span class="n">resId</span> <span class="o">=</span> <span class="n">GetResourceIdByName</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">value</span><span class="p">);</span>
			<span class="n">um</span><span class="o">-&gt;</span><span class="n">Modifier</span><span class="p">.</span><span class="n">ImproveIncomes</span><span class="p">[</span><span class="n">resId</span><span class="p">]</span> <span class="o">=</span> <span class="n">LuaToNumber</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">);</span>
		<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="s">&quot;allow-unit&quot;</span><span class="p">))</span> <span class="p">{</span>
			<span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">value</span> <span class="o">=</span> <span class="n">LuaToString</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">);</span>

			<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strncmp</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s">&quot;unit-&quot;</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span> <span class="p">{</span>
				<span class="n">um</span><span class="o">-&gt;</span><span class="n">ChangeUnits</span><span class="p">[</span><span class="n">UnitTypeIdByIdent</span><span class="p">(</span><span class="n">value</span><span class="p">)]</span> <span class="o">=</span> <span class="n">LuaToNumber</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">);</span>
			<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
				<span class="n">LuaError</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="s">&quot;unit expected&quot;</span><span class="p">);</span>
			<span class="p">}</span>
		<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="s">&quot;allow&quot;</span><span class="p">))</span> <span class="p">{</span>
			<span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">value</span> <span class="o">=</span> <span class="n">LuaToString</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">);</span>
			<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strncmp</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s">&quot;upgrade-&quot;</span><span class="p">,</span> <span class="mi">8</span><span class="p">))</span> <span class="p">{</span>
				<span class="n">um</span><span class="o">-&gt;</span><span class="n">ChangeUpgrades</span><span class="p">[</span><span class="n">UpgradeIdByIdent</span><span class="p">(</span><span class="n">value</span><span class="p">)]</span> <span class="o">=</span> <span class="n">LuaToNumber</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">);</span>
			<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
				<span class="n">LuaError</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="s">&quot;upgrade expected&quot;</span><span class="p">);</span>
			<span class="p">}</span>
		<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="s">&quot;apply-to&quot;</span><span class="p">))</span> <span class="p">{</span>
			<span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">value</span> <span class="o">=</span> <span class="n">LuaToString</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">);</span>
			<span class="n">um</span><span class="o">-&gt;</span><span class="n">ApplyTo</span><span class="p">[</span><span class="n">UnitTypeIdByIdent</span><span class="p">(</span><span class="n">value</span><span class="p">)]</span> <span class="o">=</span> <span class="sc">&#39;X&#39;</span><span class="p">;</span>
		<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="s">&quot;convert-to&quot;</span><span class="p">))</span> <span class="p">{</span>
			<span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">value</span> <span class="o">=</span> <span class="n">LuaToString</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">);</span>
			<span class="n">um</span><span class="o">-&gt;</span><span class="n">ConvertTo</span> <span class="o">=</span> <span class="n">UnitTypeByIdent</span><span class="p">(</span><span class="n">value</span><span class="p">);</span>
		<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="s">&quot;research-speed&quot;</span><span class="p">))</span> <span class="p">{</span>
			<span class="n">um</span><span class="o">-&gt;</span><span class="n">SpeedResearch</span> <span class="o">=</span> <span class="n">LuaToNumber</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">);</span>
		<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
			<span class="kt">int</span> <span class="n">index</span> <span class="o">=</span> <span class="n">UnitTypeVar</span><span class="p">.</span><span class="n">VariableNameLookup</span><span class="p">[</span><span class="n">key</span><span class="p">];</span> <span class="c1">// variable index;</span>
			<span class="k">if</span> <span class="p">(</span><span class="n">index</span> <span class="o">!=</span> <span class="mi">-1</span><span class="p">)</span> <span class="p">{</span>
				<span class="k">if</span> <span class="p">(</span><span class="n">lua_rawlen</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">==</span> <span class="mi">3</span><span class="p">)</span> <span class="p">{</span>
					<span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">value</span> <span class="o">=</span> <span class="n">LuaToString</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">);</span>
					<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s">&quot;Percent&quot;</span><span class="p">))</span> <span class="p">{</span>
						<span class="n">um</span><span class="o">-&gt;</span><span class="n">ModifyPercent</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="o">=</span> <span class="n">LuaToNumber</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">);</span>
					<span class="p">}</span>
				<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
					<span class="n">lua_rawgeti</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">);</span>
					<span class="k">if</span> <span class="p">(</span><span class="n">lua_istable</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">-1</span><span class="p">))</span> <span class="p">{</span>
						<span class="n">DefineVariableField</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">um</span><span class="o">-&gt;</span><span class="n">Modifier</span><span class="p">.</span><span class="n">Variables</span> <span class="o">+</span> <span class="n">index</span><span class="p">,</span> <span class="mi">-1</span><span class="p">);</span>
					<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">lua_isnumber</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">-1</span><span class="p">))</span> <span class="p">{</span>
						<span class="n">um</span><span class="o">-&gt;</span><span class="n">Modifier</span><span class="p">.</span><span class="n">Variables</span><span class="p">[</span><span class="n">index</span><span class="p">].</span><span class="n">Enable</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
						<span class="n">um</span><span class="o">-&gt;</span><span class="n">Modifier</span><span class="p">.</span><span class="n">Variables</span><span class="p">[</span><span class="n">index</span><span class="p">].</span><span class="n">Value</span> <span class="o">=</span> <span class="n">LuaToNumber</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">-1</span><span class="p">);</span>
						<span class="n">um</span><span class="o">-&gt;</span><span class="n">Modifier</span><span class="p">.</span><span class="n">Variables</span><span class="p">[</span><span class="n">index</span><span class="p">].</span><span class="n">Max</span> <span class="o">=</span> <span class="n">LuaToNumber</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">-1</span><span class="p">);</span>
					<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
						<span class="n">LuaError</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="s">&quot;bad argument type for &#39;%s&#39;</span><span class="se">\n</span><span class="s">&quot;</span> <span class="n">_C_</span> <span class="n">key</span><span class="p">);</span>
					<span class="p">}</span>
					<span class="n">lua_pop</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
				<span class="p">}</span>
			<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
				<span class="n">LuaError</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="s">&quot;wrong tag: %s&quot;</span> <span class="n">_C_</span> <span class="n">key</span><span class="p">);</span>
			<span class="p">}</span>
		<span class="p">}</span>
	<span class="p">}</span>

	<span class="n">UpgradeModifiers</span><span class="p">[</span><span class="n">NumUpgradeModifiers</span><span class="o">++</span><span class="p">]</span> <span class="o">=</span> <span class="n">um</span><span class="p">;</span>

	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</p>
                          </details>
                        </details>
                        
                        <details>
                        <summary>DefineAllow</summary>
                        <p><br> <b>Description</b><br><br>  Define which units/upgrades are allowed.<br><br> Example:<br><br> <div class="example"><code><strong>DefineAllow</strong>("unit-town-hall","AAAAAAAAAAAAAAAA") -- Available for everybody<br>		<strong>DefineAllow</strong>("unit-stables","FFFFFFFFFFFFFFFF") -- Not available<br>		<strong>DefineAllow</strong>("upgrade-sword1","RRRRRRRRRRRRRRRR") -- Upgrade already researched.</code></div><br></p>
                          <details>
                          <summary>/unit/upgrade.cpp:432 CclDefineAllow</summary>
                          <p><div class="highlight"><pre><span></span><span class="k">static</span> <span class="kt">int</span> <span class="nf">CclDefineAllow</span><span class="p">(</span><span class="n">lua_State</span> <span class="o">*</span><span class="n">l</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">const</span> <span class="kt">int</span> <span class="n">UnitMax</span> <span class="o">=</span> <span class="mi">65536</span><span class="p">;</span> <span class="c1">/// How many units supported</span>
	<span class="k">const</span> <span class="kt">int</span> <span class="n">args</span> <span class="o">=</span> <span class="n">lua_gettop</span><span class="p">(</span><span class="n">l</span><span class="p">);</span>

	<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="n">args</span><span class="p">;</span> <span class="o">++</span><span class="n">j</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">ident</span> <span class="o">=</span> <span class="n">LuaToString</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>
		<span class="o">++</span><span class="n">j</span><span class="p">;</span>
		<span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">ids</span> <span class="o">=</span> <span class="n">LuaToString</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>

		<span class="kt">int</span> <span class="n">n</span> <span class="o">=</span> <span class="n">strlen</span><span class="p">(</span><span class="n">ids</span><span class="p">);</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">n</span> <span class="o">&gt;</span> <span class="n">PlayerMax</span><span class="p">)</span> <span class="p">{</span>
			<span class="n">fprintf</span><span class="p">(</span><span class="n">stderr</span><span class="p">,</span> <span class="s">&quot;%s: Allow string too long %d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">ident</span><span class="p">,</span> <span class="n">n</span><span class="p">);</span>
			<span class="n">n</span> <span class="o">=</span> <span class="n">PlayerMax</span><span class="p">;</span>
		<span class="p">}</span>

		<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strncmp</span><span class="p">(</span><span class="n">ident</span><span class="p">,</span> <span class="s">&quot;unit-&quot;</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span> <span class="p">{</span>
			<span class="kt">int</span> <span class="n">id</span> <span class="o">=</span> <span class="n">UnitTypeIdByIdent</span><span class="p">(</span><span class="n">ident</span><span class="p">);</span>
			<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">n</span><span class="p">;</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span> <span class="p">{</span>
				<span class="k">if</span> <span class="p">(</span><span class="n">ids</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="sc">&#39;A&#39;</span><span class="p">)</span> <span class="p">{</span>
					<span class="n">AllowUnitId</span><span class="p">(</span><span class="n">Players</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">id</span><span class="p">,</span> <span class="n">UnitMax</span><span class="p">);</span>
				<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">ids</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="sc">&#39;F&#39;</span><span class="p">)</span> <span class="p">{</span>
					<span class="n">AllowUnitId</span><span class="p">(</span><span class="n">Players</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">id</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
				<span class="p">}</span>
			<span class="p">}</span>
		<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strncmp</span><span class="p">(</span><span class="n">ident</span><span class="p">,</span> <span class="s">&quot;upgrade-&quot;</span><span class="p">,</span> <span class="mi">8</span><span class="p">))</span> <span class="p">{</span>
			<span class="kt">int</span> <span class="n">id</span> <span class="o">=</span> <span class="n">UpgradeIdByIdent</span><span class="p">(</span><span class="n">ident</span><span class="p">);</span>
			<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">n</span><span class="p">;</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span> <span class="p">{</span>
				<span class="n">AllowUpgradeId</span><span class="p">(</span><span class="n">Players</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">id</span><span class="p">,</span> <span class="n">ids</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span>
			<span class="p">}</span>
		<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
			<span class="n">DebugPrint</span><span class="p">(</span><span class="s">&quot; wrong ident %s</span><span class="se">\n</span><span class="s">&quot;</span> <span class="n">_C_</span> <span class="n">ident</span><span class="p">);</span>
		<span class="p">}</span>
	<span class="p">}</span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</p>
                          </details>
                        </details>
                        
                        <details>
                        <summary>DefineUnitAllow</summary>
                        <p><br>  Define which units are allowed and how much.</p>
                          <details>
                          <summary>/unit/upgrade.cpp:383 CclDefineUnitAllow</summary>
                          <p><div class="highlight"><pre><span></span><span class="k">static</span> <span class="kt">int</span> <span class="nf">CclDefineUnitAllow</span><span class="p">(</span><span class="n">lua_State</span> <span class="o">*</span><span class="n">l</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">const</span> <span class="kt">int</span> <span class="n">args</span> <span class="o">=</span> <span class="n">lua_gettop</span><span class="p">(</span><span class="n">l</span><span class="p">);</span>

	<span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">ident</span> <span class="o">=</span> <span class="n">LuaToString</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">0</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">strncmp</span><span class="p">(</span><span class="n">ident</span><span class="p">,</span> <span class="s">&quot;unit-&quot;</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span> <span class="p">{</span>
		<span class="n">DebugPrint</span><span class="p">(</span><span class="s">&quot; wrong ident %s</span><span class="se">\n</span><span class="s">&quot;</span> <span class="n">_C_</span> <span class="n">ident</span><span class="p">);</span>
		<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="kt">int</span> <span class="n">id</span> <span class="o">=</span> <span class="n">UnitTypeIdByIdent</span><span class="p">(</span><span class="n">ident</span><span class="p">);</span>

	<span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">j</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="n">args</span> <span class="o">&amp;&amp;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">PlayerMax</span><span class="p">;</span> <span class="o">++</span><span class="n">j</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">AllowUnitId</span><span class="p">(</span><span class="n">Players</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">id</span><span class="p">,</span> <span class="n">LuaToNumber</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">));</span>
		<span class="o">++</span><span class="n">i</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</p>
                          </details>
                        </details>
                        <hr>/unit/script_unittype.cpp<hr>
                        <details>
                        <summary>DefineUnitType</summary>
                        <p><br> <b>Description</b><br><br>  Parse unit-type.<br><br>  @param l  Lua state.<br><br> Example:<br><br> <div class="example"><code><strong>DefineUnitType</strong>("unit-silvermoon-archer", { Name = _("Silvermoon Archer"),<br>			Image = {"file", "human/units/elven_archer.png", "size", {72, 72}},<br>			Animations = "animations-archer", Icon = "icon-archer",<br>			Costs = {"time", 70, "gold", 500, "wood", 50},<br>			Speed = 10,<br>			HitPoints = 45,<br>			DrawLevel = 40,<br>			TileSize = {1, 1}, BoxSize = {33, 33},<br>			SightRange = 6, ComputerReactionRange = 7, PersonReactionRange = 6,<br>			BasicDamage = 4, PiercingDamage = 6, Missile = "missile-arrow",<br>			MaxAttackRange = 4,<br>			Priority = 75,<br>			Points = 60,<br>			Demand = 1,<br>			Corpse = "unit-human-dead-body",<br>			Type = "land",<br>			RightMouseAction = "attack",<br>			CanAttack = true,<br>			CanTargetLand = true, CanTargetSea = true, CanTargetAir = true,<br>			LandUnit = true,<br>			organic = true,<br>			SelectableByRectangle = true,<br>			Sounds = {<br>				"selected", "archer-selected",<br>				"acknowledge", "archer-acknowledge",<br>				"ready", "archer-ready",<br>				"help", "basic human voices help 1",<br>				"dead", "basic human voices dead"} } )</code></div></p>
                          <details>
                          <summary>/unit/script_unittype.cpp:1199 CclDefineUnitType</summary>
                          <p><div class="highlight"><pre><span></span><span class="k">static</span> <span class="kt">int</span> <span class="nf">CclDefineUnitType</span><span class="p">(</span><span class="n">lua_State</span> <span class="o">*</span><span class="n">l</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">LuaCheckArgs</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">2</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">lua_istable</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span> <span class="p">{</span>
		<span class="n">LuaError</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="s">&quot;incorrect argument&quot;</span><span class="p">);</span>
	<span class="p">}</span>

	<span class="c1">// Slot identifier</span>
	<span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">str</span> <span class="o">=</span> <span class="n">LuaToString</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
	<span class="n">CUnitType</span> <span class="o">*</span><span class="n">type</span> <span class="o">=</span> <span class="n">UnitTypeByIdent</span><span class="p">(</span><span class="n">str</span><span class="p">);</span>
	<span class="kt">int</span> <span class="n">redefine</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">type</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">redefine</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
		<span class="n">DebugPrint</span><span class="p">(</span><span class="s">&quot;Redefining unit-type &#39;%s&#39;</span><span class="se">\n</span><span class="s">&quot;</span> <span class="n">_C_</span> <span class="n">str</span><span class="p">);</span>
	<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
		<span class="n">type</span> <span class="o">=</span> <span class="n">NewUnitTypeSlot</span><span class="p">(</span><span class="n">str</span><span class="p">);</span>
		<span class="n">redefine</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="n">type</span><span class="o">-&gt;</span><span class="n">NumDirections</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="n">type</span><span class="o">-&gt;</span><span class="n">Flip</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>

	<span class="c1">//  Parse the list: (still everything could be changed!)</span>
	<span class="k">for</span> <span class="p">(</span><span class="n">lua_pushnil</span><span class="p">(</span><span class="n">l</span><span class="p">);</span> <span class="n">lua_next</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">2</span><span class="p">);</span> <span class="n">lua_pop</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span> <span class="p">{</span>
		<span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">value</span> <span class="o">=</span> <span class="n">LuaToString</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">-2</span><span class="p">);</span>
		<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s">&quot;Name&quot;</span><span class="p">))</span> <span class="p">{</span>
			<span class="n">type</span><span class="o">-&gt;</span><span class="n">Name</span> <span class="o">=</span> <span class="n">LuaToString</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">-1</span><span class="p">);</span>
		<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s">&quot;Image&quot;</span><span class="p">))</span> <span class="p">{</span>
			<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">lua_istable</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">-1</span><span class="p">))</span> <span class="p">{</span>
				<span class="n">LuaError</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="s">&quot;incorrect argument&quot;</span><span class="p">);</span>
			<span class="p">}</span>
			<span class="kt">int</span> <span class="n">subargs</span> <span class="o">=</span> <span class="n">lua_rawlen</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">-1</span><span class="p">);</span>
			<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">k</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">k</span> <span class="o">&lt;</span> <span class="n">subargs</span><span class="p">;</span> <span class="o">++</span><span class="n">k</span><span class="p">)</span> <span class="p">{</span>
				<span class="n">value</span> <span class="o">=</span> <span class="n">LuaToString</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">-1</span><span class="p">,</span> <span class="n">k</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>
				<span class="o">++</span><span class="n">k</span><span class="p">;</span>

				<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s">&quot;file&quot;</span><span class="p">))</span> <span class="p">{</span>
					<span class="n">type</span><span class="o">-&gt;</span><span class="n">File</span> <span class="o">=</span> <span class="n">LuaToString</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">-1</span><span class="p">,</span> <span class="n">k</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>
				<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s">&quot;size&quot;</span><span class="p">))</span> <span class="p">{</span>
					<span class="n">lua_rawgeti</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">-1</span><span class="p">,</span> <span class="n">k</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>
					<span class="n">CclGetPos</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">type</span><span class="o">-&gt;</span><span class="n">Width</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">type</span><span class="o">-&gt;</span><span class="n">Height</span><span class="p">);</span>
					<span class="n">lua_pop</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
				<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
					<span class="n">LuaError</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="s">&quot;Unsupported image tag: %s&quot;</span> <span class="n">_C_</span> <span class="n">value</span><span class="p">);</span>
				<span class="p">}</span>
			<span class="p">}</span>
			<span class="k">if</span> <span class="p">(</span><span class="n">redefine</span> <span class="o">&amp;&amp;</span> <span class="n">type</span><span class="o">-&gt;</span><span class="n">Sprite</span><span class="p">)</span> <span class="p">{</span>
				<span class="n">CGraphic</span><span class="o">::</span><span class="n">Free</span><span class="p">(</span><span class="n">type</span><span class="o">-&gt;</span><span class="n">Sprite</span><span class="p">);</span>
				<span class="n">type</span><span class="o">-&gt;</span><span class="n">Sprite</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">;</span>
			<span class="p">}</span>
			<span class="k">if</span> <span class="p">(</span><span class="n">type</span><span class="o">-&gt;</span><span class="n">ShadowFile</span> <span class="o">==</span> <span class="n">shadowMarker</span><span class="p">)</span> <span class="p">{</span>
				<span class="n">type</span><span class="o">-&gt;</span><span class="n">ShadowFile</span> <span class="o">=</span> <span class="n">type</span><span class="o">-&gt;</span><span class="n">File</span><span class="p">;</span>
				<span class="k">if</span> <span class="p">(</span><span class="n">type</span><span class="o">-&gt;</span><span class="n">ShadowWidth</span> <span class="o">==</span> <span class="mi">0</span> <span class="o">&amp;&amp;</span> <span class="n">type</span><span class="o">-&gt;</span><span class="n">ShadowHeight</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
					<span class="n">type</span><span class="o">-&gt;</span><span class="n">ShadowWidth</span> <span class="o">=</span> <span class="n">type</span><span class="o">-&gt;</span><span class="n">Width</span><span class="p">;</span>
					<span class="n">type</span><span class="o">-&gt;</span><span class="n">ShadowHeight</span> <span class="o">=</span> <span class="n">type</span><span class="o">-&gt;</span><span class="n">Height</span><span class="p">;</span>
				<span class="p">}</span>
			<span class="p">}</span>
		<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s">&quot;Shadow&quot;</span><span class="p">))</span> <span class="p">{</span>
			<span class="c1">// default to same spritemap as unit</span>
			<span class="k">if</span> <span class="p">(</span><span class="n">type</span><span class="o">-&gt;</span><span class="n">File</span><span class="p">.</span><span class="n">length</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
				<span class="n">type</span><span class="o">-&gt;</span><span class="n">ShadowFile</span> <span class="o">=</span> <span class="n">type</span><span class="o">-&gt;</span><span class="n">File</span><span class="p">;</span>
				<span class="n">type</span><span class="o">-&gt;</span><span class="n">ShadowWidth</span> <span class="o">=</span> <span class="n">type</span><span class="o">-&gt;</span><span class="n">Width</span><span class="p">;</span>
				<span class="n">type</span><span class="o">-&gt;</span><span class="n">ShadowHeight</span> <span class="o">=</span> <span class="n">type</span><span class="o">-&gt;</span><span class="n">Height</span><span class="p">;</span>
			<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
				<span class="n">type</span><span class="o">-&gt;</span><span class="n">ShadowFile</span> <span class="o">=</span> <span class="n">shadowMarker</span><span class="p">;</span>
			<span class="p">}</span>
			<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">lua_istable</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">-1</span><span class="p">))</span> <span class="p">{</span>
				<span class="n">LuaError</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="s">&quot;incorrect argument&quot;</span><span class="p">);</span>
			<span class="p">}</span>
			<span class="k">const</span> <span class="kt">int</span> <span class="n">subargs</span> <span class="o">=</span> <span class="n">lua_rawlen</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">-1</span><span class="p">);</span>
			<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">k</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">k</span> <span class="o">&lt;</span> <span class="n">subargs</span><span class="p">;</span> <span class="o">++</span><span class="n">k</span><span class="p">)</span> <span class="p">{</span>
				<span class="n">value</span> <span class="o">=</span> <span class="n">LuaToString</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">-1</span><span class="p">,</span> <span class="n">k</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>
				<span class="o">++</span><span class="n">k</span><span class="p">;</span>

				<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s">&quot;file&quot;</span><span class="p">))</span> <span class="p">{</span>
					<span class="n">type</span><span class="o">-&gt;</span><span class="n">ShadowFile</span> <span class="o">=</span> <span class="n">LuaToString</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">-1</span><span class="p">,</span> <span class="n">k</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>
				<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s">&quot;size&quot;</span><span class="p">))</span> <span class="p">{</span>
					<span class="n">lua_rawgeti</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">-1</span><span class="p">,</span> <span class="n">k</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>
					<span class="n">CclGetPos</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">type</span><span class="o">-&gt;</span><span class="n">ShadowWidth</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">type</span><span class="o">-&gt;</span><span class="n">ShadowHeight</span><span class="p">);</span>
					<span class="n">lua_pop</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
				<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s">&quot;offset&quot;</span><span class="p">))</span> <span class="p">{</span>
					<span class="n">lua_rawgeti</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">-1</span><span class="p">,</span> <span class="n">k</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>
					<span class="n">CclGetPos</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">type</span><span class="o">-&gt;</span><span class="n">ShadowOffsetX</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">type</span><span class="o">-&gt;</span><span class="n">ShadowOffsetY</span><span class="p">);</span>
					<span class="n">lua_pop</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
				<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s">&quot;sprite-frame&quot;</span><span class="p">))</span> <span class="p">{</span>
					<span class="n">type</span><span class="o">-&gt;</span><span class="n">ShadowSpriteFrame</span> <span class="o">=</span> <span class="n">LuaToNumber</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">-1</span><span class="p">,</span> <span class="n">k</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>
				<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s">&quot;scale&quot;</span><span class="p">))</span> <span class="p">{</span>
					<span class="n">type</span><span class="o">-&gt;</span><span class="n">ShadowScale</span> <span class="o">=</span> <span class="n">LuaToNumber</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">-1</span><span class="p">,</span> <span class="n">k</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>
				<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
					<span class="n">LuaError</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="s">&quot;Unsupported shadow tag: %s&quot;</span> <span class="n">_C_</span> <span class="n">value</span><span class="p">);</span>
				<span class="p">}</span>
			<span class="p">}</span>
			<span class="k">if</span> <span class="p">(</span><span class="n">redefine</span> <span class="o">&amp;&amp;</span> <span class="n">type</span><span class="o">-&gt;</span><span class="n">ShadowSprite</span><span class="p">)</span> <span class="p">{</span>
				<span class="n">CGraphic</span><span class="o">::</span><span class="n">Free</span><span class="p">(</span><span class="n">type</span><span class="o">-&gt;</span><span class="n">ShadowSprite</span><span class="p">);</span>
				<span class="n">type</span><span class="o">-&gt;</span><span class="n">ShadowSprite</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">;</span>
			<span class="p">}</span>
		<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s">&quot;Offset&quot;</span><span class="p">))</span> <span class="p">{</span>
			<span class="n">CclGetPos</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">type</span><span class="o">-&gt;</span><span class="n">OffsetX</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">type</span><span class="o">-&gt;</span><span class="n">OffsetY</span><span class="p">);</span>
		<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s">&quot;Flip&quot;</span><span class="p">))</span> <span class="p">{</span>
			<span class="n">type</span><span class="o">-&gt;</span><span class="n">Flip</span> <span class="o">=</span> <span class="n">LuaToBoolean</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">-1</span><span class="p">);</span>
		<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s">&quot;Animations&quot;</span><span class="p">))</span> <span class="p">{</span>
			<span class="n">type</span><span class="o">-&gt;</span><span class="n">Animations</span> <span class="o">=</span> <span class="n">AnimationsByIdent</span><span class="p">(</span><span class="n">LuaToString</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">-1</span><span class="p">));</span>
			<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">type</span><span class="o">-&gt;</span><span class="n">Animations</span><span class="p">)</span> <span class="p">{</span>
				<span class="n">DebugPrint</span><span class="p">(</span><span class="s">&quot;Warning animation &#39;%s&#39; not found</span><span class="se">\n</span><span class="s">&quot;</span> <span class="n">_C_</span> <span class="n">LuaToString</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">-1</span><span class="p">));</span>
			<span class="p">}</span>
		<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s">&quot;Icon&quot;</span><span class="p">))</span> <span class="p">{</span>
			<span class="n">type</span><span class="o">-&gt;</span><span class="n">Icon</span><span class="p">.</span><span class="n">Name</span> <span class="o">=</span> <span class="n">LuaToString</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">-1</span><span class="p">);</span>
			<span class="n">type</span><span class="o">-&gt;</span><span class="n">Icon</span><span class="p">.</span><span class="n">Icon</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">;</span>
<span class="cp">#ifdef USE_MNG</span>
		<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s">&quot;Portrait&quot;</span><span class="p">))</span> <span class="p">{</span>
			<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">lua_istable</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">-1</span><span class="p">))</span> <span class="p">{</span>
				<span class="n">LuaError</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="s">&quot;incorrect argument&quot;</span><span class="p">);</span>
			<span class="p">}</span>
			<span class="k">const</span> <span class="kt">int</span> <span class="n">subargs</span> <span class="o">=</span> <span class="n">lua_rawlen</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">-1</span><span class="p">);</span>
			<span class="n">type</span><span class="o">-&gt;</span><span class="n">Portrait</span><span class="p">.</span><span class="n">Num</span> <span class="o">=</span> <span class="n">subargs</span><span class="p">;</span>
			<span class="n">type</span><span class="o">-&gt;</span><span class="n">Portrait</span><span class="p">.</span><span class="n">Files</span> <span class="o">=</span> <span class="k">new</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="p">[</span><span class="n">type</span><span class="o">-&gt;</span><span class="n">Portrait</span><span class="p">.</span><span class="n">Num</span><span class="p">];</span>
			<span class="n">type</span><span class="o">-&gt;</span><span class="n">Portrait</span><span class="p">.</span><span class="n">Mngs</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Mng</span> <span class="o">*</span><span class="p">[</span><span class="n">type</span><span class="o">-&gt;</span><span class="n">Portrait</span><span class="p">.</span><span class="n">Num</span><span class="p">];</span>
			<span class="n">memset</span><span class="p">(</span><span class="n">type</span><span class="o">-&gt;</span><span class="n">Portrait</span><span class="p">.</span><span class="n">Mngs</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">type</span><span class="o">-&gt;</span><span class="n">Portrait</span><span class="p">.</span><span class="n">Num</span> <span class="o">*</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">Mng</span> <span class="o">*</span><span class="p">));</span>
			<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">k</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">k</span> <span class="o">&lt;</span> <span class="n">subargs</span><span class="p">;</span> <span class="o">++</span><span class="n">k</span><span class="p">)</span> <span class="p">{</span>
				<span class="n">type</span><span class="o">-&gt;</span><span class="n">Portrait</span><span class="p">.</span><span class="n">Files</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">LuaToString</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">-1</span><span class="p">,</span> <span class="n">k</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>
			<span class="p">}</span>
<span class="cp">#endif</span>
		<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s">&quot;Costs&quot;</span><span class="p">))</span> <span class="p">{</span>
			<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">lua_istable</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">-1</span><span class="p">))</span> <span class="p">{</span>
				<span class="n">LuaError</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="s">&quot;incorrect argument&quot;</span><span class="p">);</span>
			<span class="p">}</span>
			<span class="k">const</span> <span class="kt">int</span> <span class="n">subargs</span> <span class="o">=</span> <span class="n">lua_rawlen</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">-1</span><span class="p">);</span>
			<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">k</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">k</span> <span class="o">&lt;</span> <span class="n">subargs</span><span class="p">;</span> <span class="o">++</span><span class="n">k</span><span class="p">)</span> <span class="p">{</span>
				<span class="n">lua_rawgeti</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">-1</span><span class="p">,</span> <span class="n">k</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>
				<span class="k">const</span> <span class="kt">int</span> <span class="n">res</span> <span class="o">=</span> <span class="n">CclGetResourceByName</span><span class="p">(</span><span class="n">l</span><span class="p">);</span>
				<span class="n">lua_pop</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
				<span class="o">++</span><span class="n">k</span><span class="p">;</span>
				<span class="n">type</span><span class="o">-&gt;</span><span class="n">DefaultStat</span><span class="p">.</span><span class="n">Costs</span><span class="p">[</span><span class="n">res</span><span class="p">]</span> <span class="o">=</span> <span class="n">LuaToNumber</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">-1</span><span class="p">,</span> <span class="n">k</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>
			<span class="p">}</span>
		<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s">&quot;Storing&quot;</span><span class="p">))</span> <span class="p">{</span>
			<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">lua_istable</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">-1</span><span class="p">))</span> <span class="p">{</span>
				<span class="n">LuaError</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="s">&quot;incorrect argument&quot;</span><span class="p">);</span>
			<span class="p">}</span>
			<span class="k">const</span> <span class="kt">int</span> <span class="n">subargs</span> <span class="o">=</span> <span class="n">lua_rawlen</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">-1</span><span class="p">);</span>
			<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">k</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">k</span> <span class="o">&lt;</span> <span class="n">subargs</span><span class="p">;</span> <span class="o">++</span><span class="n">k</span><span class="p">)</span> <span class="p">{</span>
				<span class="n">lua_rawgeti</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">-1</span><span class="p">,</span> <span class="n">k</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>
				<span class="k">const</span> <span class="kt">int</span> <span class="n">res</span> <span class="o">=</span> <span class="n">CclGetResourceByName</span><span class="p">(</span><span class="n">l</span><span class="p">);</span>
				<span class="n">lua_pop</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
				<span class="o">++</span><span class="n">k</span><span class="p">;</span>
				<span class="n">type</span><span class="o">-&gt;</span><span class="n">DefaultStat</span><span class="p">.</span><span class="n">Storing</span><span class="p">[</span><span class="n">res</span><span class="p">]</span> <span class="o">=</span> <span class="n">LuaToNumber</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">-1</span><span class="p">,</span> <span class="n">k</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>
			<span class="p">}</span>
		<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s">&quot;ImproveProduction&quot;</span><span class="p">))</span> <span class="p">{</span>
			<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">lua_istable</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">-1</span><span class="p">))</span> <span class="p">{</span>
				<span class="n">LuaError</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="s">&quot;incorrect argument&quot;</span><span class="p">);</span>
			<span class="p">}</span>
			<span class="k">const</span> <span class="kt">int</span> <span class="n">subargs</span> <span class="o">=</span> <span class="n">lua_rawlen</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">-1</span><span class="p">);</span>
			<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">k</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">k</span> <span class="o">&lt;</span> <span class="n">subargs</span><span class="p">;</span> <span class="o">++</span><span class="n">k</span><span class="p">)</span> <span class="p">{</span>
				<span class="n">lua_rawgeti</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">-1</span><span class="p">,</span> <span class="n">k</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>
				<span class="k">const</span> <span class="kt">int</span> <span class="n">res</span> <span class="o">=</span> <span class="n">CclGetResourceByName</span><span class="p">(</span><span class="n">l</span><span class="p">);</span>
				<span class="n">lua_pop</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
				<span class="o">++</span><span class="n">k</span><span class="p">;</span>
				<span class="n">type</span><span class="o">-&gt;</span><span class="n">DefaultStat</span><span class="p">.</span><span class="n">ImproveIncomes</span><span class="p">[</span><span class="n">res</span><span class="p">]</span> <span class="o">=</span> <span class="n">DefaultIncomes</span><span class="p">[</span><span class="n">res</span><span class="p">]</span> <span class="o">+</span> <span class="n">LuaToNumber</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">-1</span><span class="p">,</span> <span class="n">k</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>
			<span class="p">}</span>
		<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s">&quot;Construction&quot;</span><span class="p">))</span> <span class="p">{</span>
			<span class="c1">// FIXME: What if constructions aren&#39;t yet loaded?</span>
			<span class="n">type</span><span class="o">-&gt;</span><span class="n">Construction</span> <span class="o">=</span> <span class="n">ConstructionByIdent</span><span class="p">(</span><span class="n">LuaToString</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">-1</span><span class="p">));</span>
		<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s">&quot;DrawLevel&quot;</span><span class="p">))</span> <span class="p">{</span>
			<span class="n">type</span><span class="o">-&gt;</span><span class="n">DrawLevel</span> <span class="o">=</span> <span class="n">LuaToNumber</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">-1</span><span class="p">);</span>
		<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s">&quot;MaxOnBoard&quot;</span><span class="p">))</span> <span class="p">{</span>
			<span class="n">type</span><span class="o">-&gt;</span><span class="n">MaxOnBoard</span> <span class="o">=</span> <span class="n">LuaToNumber</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">-1</span><span class="p">);</span>
		<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s">&quot;BoardSize&quot;</span><span class="p">))</span> <span class="p">{</span>
			<span class="n">type</span><span class="o">-&gt;</span><span class="n">BoardSize</span> <span class="o">=</span> <span class="n">LuaToNumber</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">-1</span><span class="p">);</span>
		<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s">&quot;ButtonLevelForTransporter&quot;</span><span class="p">))</span> <span class="p">{</span>
			<span class="n">type</span><span class="o">-&gt;</span><span class="n">ButtonLevelForTransporter</span> <span class="o">=</span> <span class="n">LuaToNumber</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">-1</span><span class="p">);</span>
		<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s">&quot;StartingResources&quot;</span><span class="p">))</span> <span class="p">{</span>
			<span class="n">type</span><span class="o">-&gt;</span><span class="n">StartingResources</span> <span class="o">=</span> <span class="n">LuaToNumber</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">-1</span><span class="p">);</span>
		<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s">&quot;RegenerationRate&quot;</span><span class="p">))</span> <span class="p">{</span>
			<span class="n">type</span><span class="o">-&gt;</span><span class="n">DefaultStat</span><span class="p">.</span><span class="n">Variables</span><span class="p">[</span><span class="n">HP_INDEX</span><span class="p">].</span><span class="n">Increase</span> <span class="o">=</span> <span class="n">LuaToNumber</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">-1</span><span class="p">);</span>
		<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s">&quot;RegenerationFrequency&quot;</span><span class="p">))</span> <span class="p">{</span>
			<span class="kt">int</span> <span class="n">value</span> <span class="o">=</span> <span class="n">LuaToNumber</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">-1</span><span class="p">);</span>
			<span class="n">type</span><span class="o">-&gt;</span><span class="n">DefaultStat</span><span class="p">.</span><span class="n">Variables</span><span class="p">[</span><span class="n">HP_INDEX</span><span class="p">].</span><span class="n">IncreaseFrequency</span> <span class="o">=</span> <span class="n">value</span><span class="p">;</span>
			<span class="k">if</span> <span class="p">(</span><span class="n">type</span><span class="o">-&gt;</span><span class="n">DefaultStat</span><span class="p">.</span><span class="n">Variables</span><span class="p">[</span><span class="n">HP_INDEX</span><span class="p">].</span><span class="n">IncreaseFrequency</span> <span class="o">!=</span> <span class="n">value</span><span class="p">)</span> <span class="p">{</span>
				<span class="n">LuaError</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="s">&quot;RegenerationFrequency out of range!&quot;</span><span class="p">);</span>
			<span class="p">}</span>
		<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s">&quot;BurnPercent&quot;</span><span class="p">))</span> <span class="p">{</span>
			<span class="n">type</span><span class="o">-&gt;</span><span class="n">BurnPercent</span> <span class="o">=</span> <span class="n">LuaToNumber</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">-1</span><span class="p">);</span>
		<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s">&quot;BurnDamageRate&quot;</span><span class="p">))</span> <span class="p">{</span>
			<span class="n">type</span><span class="o">-&gt;</span><span class="n">BurnDamageRate</span> <span class="o">=</span> <span class="n">LuaToNumber</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">-1</span><span class="p">);</span>
		<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s">&quot;PoisonDrain&quot;</span><span class="p">))</span> <span class="p">{</span>
			<span class="n">type</span><span class="o">-&gt;</span><span class="n">PoisonDrain</span> <span class="o">=</span> <span class="n">LuaToNumber</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">-1</span><span class="p">);</span>
		<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s">&quot;ShieldPoints&quot;</span><span class="p">))</span> <span class="p">{</span>
			<span class="k">if</span> <span class="p">(</span><span class="n">lua_istable</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">-1</span><span class="p">))</span> <span class="p">{</span>
				<span class="n">DefineVariableField</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">type</span><span class="o">-&gt;</span><span class="n">DefaultStat</span><span class="p">.</span><span class="n">Variables</span> <span class="o">+</span> <span class="n">SHIELD_INDEX</span><span class="p">,</span> <span class="mi">-1</span><span class="p">);</span>
			<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">lua_isnumber</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">-1</span><span class="p">))</span> <span class="p">{</span>
				<span class="n">type</span><span class="o">-&gt;</span><span class="n">DefaultStat</span><span class="p">.</span><span class="n">Variables</span><span class="p">[</span><span class="n">SHIELD_INDEX</span><span class="p">].</span><span class="n">Max</span> <span class="o">=</span> <span class="n">LuaToNumber</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">-1</span><span class="p">);</span>
				<span class="n">type</span><span class="o">-&gt;</span><span class="n">DefaultStat</span><span class="p">.</span><span class="n">Variables</span><span class="p">[</span><span class="n">SHIELD_INDEX</span><span class="p">].</span><span class="n">Value</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
				<span class="n">type</span><span class="o">-&gt;</span><span class="n">DefaultStat</span><span class="p">.</span><span class="n">Variables</span><span class="p">[</span><span class="n">SHIELD_INDEX</span><span class="p">].</span><span class="n">Increase</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
				<span class="n">type</span><span class="o">-&gt;</span><span class="n">DefaultStat</span><span class="p">.</span><span class="n">Variables</span><span class="p">[</span><span class="n">SHIELD_INDEX</span><span class="p">].</span><span class="n">Enable</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
			<span class="p">}</span>
		<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s">&quot;TileSize&quot;</span><span class="p">))</span> <span class="p">{</span>
			<span class="n">CclGetPos</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">type</span><span class="o">-&gt;</span><span class="n">TileWidth</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">type</span><span class="o">-&gt;</span><span class="n">TileHeight</span><span class="p">);</span>
		<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s">&quot;NeutralMinimapColor&quot;</span><span class="p">))</span> <span class="p">{</span>
			<span class="n">type</span><span class="o">-&gt;</span><span class="n">NeutralMinimapColorRGB</span><span class="p">.</span><span class="n">Parse</span><span class="p">(</span><span class="n">l</span><span class="p">);</span>
		<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s">&quot;Neutral&quot;</span><span class="p">))</span> <span class="p">{</span>
			<span class="n">type</span><span class="o">-&gt;</span><span class="n">Neutral</span> <span class="o">=</span> <span class="n">LuaToBoolean</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">-1</span><span class="p">);</span>
		<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s">&quot;BoxSize&quot;</span><span class="p">))</span> <span class="p">{</span>
			<span class="n">CclGetPos</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">type</span><span class="o">-&gt;</span><span class="n">BoxWidth</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">type</span><span class="o">-&gt;</span><span class="n">BoxHeight</span><span class="p">);</span>
		<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s">&quot;BoxOffset&quot;</span><span class="p">))</span> <span class="p">{</span>
			<span class="n">CclGetPos</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">type</span><span class="o">-&gt;</span><span class="n">BoxOffsetX</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">type</span><span class="o">-&gt;</span><span class="n">BoxOffsetY</span><span class="p">);</span>
		<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s">&quot;NumDirections&quot;</span><span class="p">))</span> <span class="p">{</span>
			<span class="n">type</span><span class="o">-&gt;</span><span class="n">NumDirections</span> <span class="o">=</span> <span class="n">LuaToNumber</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">-1</span><span class="p">);</span>
		<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s">&quot;ComputerReactionRange&quot;</span><span class="p">))</span> <span class="p">{</span>
			<span class="n">type</span><span class="o">-&gt;</span><span class="n">ReactRangeComputer</span> <span class="o">=</span> <span class="n">LuaToNumber</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">-1</span><span class="p">);</span>
		<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s">&quot;PersonReactionRange&quot;</span><span class="p">))</span> <span class="p">{</span>
			<span class="n">type</span><span class="o">-&gt;</span><span class="n">ReactRangePerson</span> <span class="o">=</span> <span class="n">LuaToNumber</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">-1</span><span class="p">);</span>
		<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s">&quot;Missile&quot;</span><span class="p">))</span> <span class="p">{</span>
			<span class="n">type</span><span class="o">-&gt;</span><span class="n">Missile</span><span class="p">.</span><span class="n">Name</span> <span class="o">=</span> <span class="n">LuaToString</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">-1</span><span class="p">);</span>
			<span class="n">type</span><span class="o">-&gt;</span><span class="n">Missile</span><span class="p">.</span><span class="n">Missile</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">;</span>
		<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s">&quot;MinAttackRange&quot;</span><span class="p">))</span> <span class="p">{</span>
			<span class="n">type</span><span class="o">-&gt;</span><span class="n">MinAttackRange</span> <span class="o">=</span> <span class="n">LuaToNumber</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">-1</span><span class="p">);</span>
		<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s">&quot;MaxAttackRange&quot;</span><span class="p">))</span> <span class="p">{</span>
			<span class="n">type</span><span class="o">-&gt;</span><span class="n">DefaultStat</span><span class="p">.</span><span class="n">Variables</span><span class="p">[</span><span class="n">ATTACKRANGE_INDEX</span><span class="p">].</span><span class="n">Value</span> <span class="o">=</span> <span class="n">LuaToNumber</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">-1</span><span class="p">);</span>
			<span class="n">type</span><span class="o">-&gt;</span><span class="n">DefaultStat</span><span class="p">.</span><span class="n">Variables</span><span class="p">[</span><span class="n">ATTACKRANGE_INDEX</span><span class="p">].</span><span class="n">Max</span> <span class="o">=</span> <span class="n">LuaToNumber</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">-1</span><span class="p">);</span>
			<span class="n">type</span><span class="o">-&gt;</span><span class="n">DefaultStat</span><span class="p">.</span><span class="n">Variables</span><span class="p">[</span><span class="n">ATTACKRANGE_INDEX</span><span class="p">].</span><span class="n">Enable</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
		<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s">&quot;MaxHarvesters&quot;</span><span class="p">))</span> <span class="p">{</span>
			<span class="n">type</span><span class="o">-&gt;</span><span class="n">DefaultStat</span><span class="p">.</span><span class="n">Variables</span><span class="p">[</span><span class="n">MAXHARVESTERS_INDEX</span><span class="p">].</span><span class="n">Value</span> <span class="o">=</span> <span class="n">LuaToNumber</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">-1</span><span class="p">);</span>
			<span class="n">type</span><span class="o">-&gt;</span><span class="n">DefaultStat</span><span class="p">.</span><span class="n">Variables</span><span class="p">[</span><span class="n">MAXHARVESTERS_INDEX</span><span class="p">].</span><span class="n">Max</span> <span class="o">=</span> <span class="n">LuaToNumber</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">-1</span><span class="p">);</span>
		<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s">&quot;Priority&quot;</span><span class="p">))</span> <span class="p">{</span>
			<span class="n">type</span><span class="o">-&gt;</span><span class="n">DefaultStat</span><span class="p">.</span><span class="n">Variables</span><span class="p">[</span><span class="n">PRIORITY_INDEX</span><span class="p">].</span><span class="n">Value</span>  <span class="o">=</span> <span class="n">LuaToNumber</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">-1</span><span class="p">);</span>
			<span class="n">type</span><span class="o">-&gt;</span><span class="n">DefaultStat</span><span class="p">.</span><span class="n">Variables</span><span class="p">[</span><span class="n">PRIORITY_INDEX</span><span class="p">].</span><span class="n">Max</span>  <span class="o">=</span> <span class="n">LuaToNumber</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">-1</span><span class="p">);</span>
		<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s">&quot;AnnoyComputerFactor&quot;</span><span class="p">))</span> <span class="p">{</span>
			<span class="n">type</span><span class="o">-&gt;</span><span class="n">AnnoyComputerFactor</span> <span class="o">=</span> <span class="n">LuaToNumber</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">-1</span><span class="p">);</span>
		<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s">&quot;AiAdjacentRange&quot;</span><span class="p">))</span> <span class="p">{</span>
			<span class="n">type</span><span class="o">-&gt;</span><span class="n">AiAdjacentRange</span> <span class="o">=</span> <span class="n">LuaToNumber</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">-1</span><span class="p">);</span>
		<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s">&quot;DecayRate&quot;</span><span class="p">))</span> <span class="p">{</span>
			<span class="n">type</span><span class="o">-&gt;</span><span class="n">DecayRate</span> <span class="o">=</span> <span class="n">LuaToNumber</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">-1</span><span class="p">);</span>
		<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s">&quot;Corpse&quot;</span><span class="p">))</span> <span class="p">{</span>
			<span class="n">type</span><span class="o">-&gt;</span><span class="n">CorpseName</span> <span class="o">=</span> <span class="n">LuaToString</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">-1</span><span class="p">);</span>
			<span class="n">type</span><span class="o">-&gt;</span><span class="n">CorpseType</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">;</span>
		<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s">&quot;DamageType&quot;</span><span class="p">))</span> <span class="p">{</span>
			<span class="n">value</span> <span class="o">=</span> <span class="n">LuaToString</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">-1</span><span class="p">);</span>
			<span class="c1">//int check = ExtraDeathIndex(value);</span>
			<span class="n">type</span><span class="o">-&gt;</span><span class="n">DamageType</span> <span class="o">=</span> <span class="n">value</span><span class="p">;</span>
		<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s">&quot;ExplodeWhenKilled&quot;</span><span class="p">))</span> <span class="p">{</span>
			<span class="n">type</span><span class="o">-&gt;</span><span class="n">ExplodeWhenKilled</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
			<span class="n">type</span><span class="o">-&gt;</span><span class="n">Explosion</span><span class="p">.</span><span class="n">Name</span> <span class="o">=</span> <span class="n">LuaToString</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">-1</span><span class="p">);</span>
			<span class="n">type</span><span class="o">-&gt;</span><span class="n">Explosion</span><span class="p">.</span><span class="n">Missile</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">;</span>
		<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s">&quot;TeleportCost&quot;</span><span class="p">))</span> <span class="p">{</span>
			<span class="n">type</span><span class="o">-&gt;</span><span class="n">TeleportCost</span> <span class="o">=</span> <span class="n">LuaToNumber</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">-1</span><span class="p">);</span>
		<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s">&quot;TeleportEffectIn&quot;</span><span class="p">))</span> <span class="p">{</span>
			<span class="n">type</span><span class="o">-&gt;</span><span class="n">TeleportEffectIn</span> <span class="o">=</span> <span class="k">new</span> <span class="n">LuaCallback</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">-1</span><span class="p">);</span>
		<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s">&quot;TeleportEffectOut&quot;</span><span class="p">))</span> <span class="p">{</span>
			<span class="n">type</span><span class="o">-&gt;</span><span class="n">TeleportEffectOut</span> <span class="o">=</span> <span class="k">new</span> <span class="n">LuaCallback</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">-1</span><span class="p">);</span>
		<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s">&quot;OnDeath&quot;</span><span class="p">))</span> <span class="p">{</span>
			<span class="n">type</span><span class="o">-&gt;</span><span class="n">OnDeath</span> <span class="o">=</span> <span class="k">new</span> <span class="n">LuaCallback</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">-1</span><span class="p">);</span>
		<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s">&quot;OnHit&quot;</span><span class="p">))</span> <span class="p">{</span>
			<span class="n">type</span><span class="o">-&gt;</span><span class="n">OnHit</span> <span class="o">=</span> <span class="k">new</span> <span class="n">LuaCallback</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">-1</span><span class="p">);</span>
		<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s">&quot;OnEachCycle&quot;</span><span class="p">))</span> <span class="p">{</span>
			<span class="n">type</span><span class="o">-&gt;</span><span class="n">OnEachCycle</span> <span class="o">=</span> <span class="k">new</span> <span class="n">LuaCallback</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">-1</span><span class="p">);</span>
		<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s">&quot;OnEachSecond&quot;</span><span class="p">))</span> <span class="p">{</span>
			<span class="n">type</span><span class="o">-&gt;</span><span class="n">OnEachSecond</span> <span class="o">=</span> <span class="k">new</span> <span class="n">LuaCallback</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">-1</span><span class="p">);</span>
		<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s">&quot;OnInit&quot;</span><span class="p">))</span> <span class="p">{</span>
			<span class="n">type</span><span class="o">-&gt;</span><span class="n">OnInit</span> <span class="o">=</span> <span class="k">new</span> <span class="n">LuaCallback</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">-1</span><span class="p">);</span>
		<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s">&quot;OnReady&quot;</span><span class="p">))</span> <span class="p">{</span>
			<span class="n">type</span><span class="o">-&gt;</span><span class="n">OnReady</span> <span class="o">=</span> <span class="k">new</span> <span class="n">LuaCallback</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">-1</span><span class="p">);</span>
		<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s">&quot;Type&quot;</span><span class="p">))</span> <span class="p">{</span>
			<span class="n">value</span> <span class="o">=</span> <span class="n">LuaToString</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">-1</span><span class="p">);</span>
			<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s">&quot;land&quot;</span><span class="p">))</span> <span class="p">{</span>
				<span class="n">type</span><span class="o">-&gt;</span><span class="n">UnitType</span> <span class="o">=</span> <span class="n">UnitTypeLand</span><span class="p">;</span>
			<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s">&quot;fly&quot;</span><span class="p">))</span> <span class="p">{</span>
				<span class="n">type</span><span class="o">-&gt;</span><span class="n">UnitType</span> <span class="o">=</span> <span class="n">UnitTypeFly</span><span class="p">;</span>
			<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s">&quot;naval&quot;</span><span class="p">))</span> <span class="p">{</span>
				<span class="n">type</span><span class="o">-&gt;</span><span class="n">UnitType</span> <span class="o">=</span> <span class="n">UnitTypeNaval</span><span class="p">;</span>
			<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
				<span class="n">LuaError</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="s">&quot;Unsupported Type: %s&quot;</span> <span class="n">_C_</span> <span class="n">value</span><span class="p">);</span>
			<span class="p">}</span>
		<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s">&quot;MissileOffsets&quot;</span><span class="p">))</span> <span class="p">{</span>
			<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">lua_istable</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">-1</span><span class="p">))</span> <span class="p">{</span>
				<span class="n">LuaError</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="s">&quot;incorrect argument&quot;</span><span class="p">);</span>
			<span class="p">}</span>
			<span class="k">const</span> <span class="kt">int</span> <span class="n">subargs</span> <span class="o">=</span> <span class="n">lua_rawlen</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">-1</span><span class="p">);</span>
			<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">k</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">k</span> <span class="o">&lt;</span> <span class="n">subargs</span><span class="p">;</span> <span class="o">++</span><span class="n">k</span><span class="p">)</span> <span class="p">{</span>
				<span class="n">lua_rawgeti</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">-1</span><span class="p">,</span> <span class="n">k</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>
				<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">lua_istable</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">-1</span><span class="p">)</span> <span class="o">||</span> <span class="n">lua_rawlen</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">-1</span><span class="p">)</span> <span class="o">!=</span> <span class="n">UnitSides</span><span class="p">)</span> <span class="p">{</span>
					<span class="n">LuaError</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="s">&quot;incorrect argument&quot;</span><span class="p">);</span>
				<span class="p">}</span>
				<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">m</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">m</span> <span class="o">&lt;</span> <span class="n">UnitSides</span><span class="p">;</span> <span class="o">++</span><span class="n">m</span><span class="p">)</span> <span class="p">{</span>
					<span class="n">lua_rawgeti</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">-1</span><span class="p">,</span> <span class="n">m</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>
					<span class="n">CclGetPos</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">type</span><span class="o">-&gt;</span><span class="n">MissileOffsets</span><span class="p">[</span><span class="n">m</span><span class="p">][</span><span class="n">k</span><span class="p">].</span><span class="n">x</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">type</span><span class="o">-&gt;</span><span class="n">MissileOffsets</span><span class="p">[</span><span class="n">m</span><span class="p">][</span><span class="n">k</span><span class="p">].</span><span class="n">y</span><span class="p">);</span>
					<span class="n">lua_pop</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
				<span class="p">}</span>
				<span class="n">lua_pop</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
			<span class="p">}</span>
		<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s">&quot;Impact&quot;</span><span class="p">))</span> <span class="p">{</span>
			<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">lua_istable</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">-1</span><span class="p">))</span> <span class="p">{</span>
				<span class="n">LuaError</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="s">&quot;incorrect argument&quot;</span><span class="p">);</span>
			<span class="p">}</span>
			<span class="k">const</span> <span class="kt">int</span> <span class="n">subargs</span> <span class="o">=</span> <span class="n">lua_rawlen</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">-1</span><span class="p">);</span>
			<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">k</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">k</span> <span class="o">&lt;</span> <span class="n">subargs</span><span class="p">;</span> <span class="o">++</span><span class="n">k</span><span class="p">)</span> <span class="p">{</span>
				<span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">dtype</span> <span class="o">=</span> <span class="n">LuaToString</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">-1</span><span class="p">,</span> <span class="n">k</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>
				<span class="o">++</span><span class="n">k</span><span class="p">;</span>

				<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">dtype</span><span class="p">,</span> <span class="s">&quot;general&quot;</span><span class="p">))</span> <span class="p">{</span>
					<span class="n">type</span><span class="o">-&gt;</span><span class="n">Impact</span><span class="p">[</span><span class="n">ANIMATIONS_DEATHTYPES</span><span class="p">].</span><span class="n">Name</span> <span class="o">=</span> <span class="n">LuaToString</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">-1</span><span class="p">,</span> <span class="n">k</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>
					<span class="n">type</span><span class="o">-&gt;</span><span class="n">Impact</span><span class="p">[</span><span class="n">ANIMATIONS_DEATHTYPES</span><span class="p">].</span><span class="n">Missile</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">;</span>
				<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">dtype</span><span class="p">,</span> <span class="s">&quot;shield&quot;</span><span class="p">))</span> <span class="p">{</span>
					<span class="n">type</span><span class="o">-&gt;</span><span class="n">Impact</span><span class="p">[</span><span class="n">ANIMATIONS_DEATHTYPES</span> <span class="o">+</span> <span class="mi">1</span><span class="p">].</span><span class="n">Name</span> <span class="o">=</span> <span class="n">LuaToString</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">-1</span><span class="p">,</span> <span class="n">k</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>
					<span class="n">type</span><span class="o">-&gt;</span><span class="n">Impact</span><span class="p">[</span><span class="n">ANIMATIONS_DEATHTYPES</span> <span class="o">+</span> <span class="mi">1</span><span class="p">].</span><span class="n">Missile</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">;</span>
				<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
					<span class="kt">int</span> <span class="n">num</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
					<span class="k">for</span> <span class="p">(;</span> <span class="n">num</span> <span class="o">&lt;</span> <span class="n">ANIMATIONS_DEATHTYPES</span><span class="p">;</span> <span class="o">++</span><span class="n">num</span><span class="p">)</span> <span class="p">{</span>
						<span class="k">if</span> <span class="p">(</span><span class="n">dtype</span> <span class="o">==</span> <span class="n">ExtraDeathTypes</span><span class="p">[</span><span class="n">num</span><span class="p">])</span> <span class="p">{</span>
							<span class="k">break</span><span class="p">;</span>
						<span class="p">}</span>
					<span class="p">}</span>
					<span class="k">if</span> <span class="p">(</span><span class="n">num</span> <span class="o">==</span> <span class="n">ANIMATIONS_DEATHTYPES</span><span class="p">)</span> <span class="p">{</span>
						<span class="n">LuaError</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="s">&quot;Death type not found: %s&quot;</span> <span class="n">_C_</span> <span class="n">dtype</span><span class="p">);</span>
					<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
						<span class="n">type</span><span class="o">-&gt;</span><span class="n">Impact</span><span class="p">[</span><span class="n">num</span><span class="p">].</span><span class="n">Name</span> <span class="o">=</span> <span class="n">LuaToString</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">-1</span><span class="p">,</span> <span class="n">k</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>
						<span class="n">type</span><span class="o">-&gt;</span><span class="n">Impact</span><span class="p">[</span><span class="n">num</span><span class="p">].</span><span class="n">Missile</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">;</span>
					<span class="p">}</span>
				<span class="p">}</span>
			<span class="p">}</span>
		<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s">&quot;RightMouseAction&quot;</span><span class="p">))</span> <span class="p">{</span>
			<span class="n">value</span> <span class="o">=</span> <span class="n">LuaToString</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">-1</span><span class="p">);</span>
			<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s">&quot;none&quot;</span><span class="p">))</span> <span class="p">{</span>
				<span class="n">type</span><span class="o">-&gt;</span><span class="n">MouseAction</span> <span class="o">=</span> <span class="n">MouseActionNone</span><span class="p">;</span>
			<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s">&quot;attack&quot;</span><span class="p">))</span> <span class="p">{</span>
				<span class="n">type</span><span class="o">-&gt;</span><span class="n">MouseAction</span> <span class="o">=</span> <span class="n">MouseActionAttack</span><span class="p">;</span>
			<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s">&quot;move&quot;</span><span class="p">))</span> <span class="p">{</span>
				<span class="n">type</span><span class="o">-&gt;</span><span class="n">MouseAction</span> <span class="o">=</span> <span class="n">MouseActionMove</span><span class="p">;</span>
			<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s">&quot;harvest&quot;</span><span class="p">))</span> <span class="p">{</span>
				<span class="n">type</span><span class="o">-&gt;</span><span class="n">MouseAction</span> <span class="o">=</span> <span class="n">MouseActionHarvest</span><span class="p">;</span>
			<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s">&quot;spell-cast&quot;</span><span class="p">))</span> <span class="p">{</span>
				<span class="n">type</span><span class="o">-&gt;</span><span class="n">MouseAction</span> <span class="o">=</span> <span class="n">MouseActionSpellCast</span><span class="p">;</span>
			<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s">&quot;sail&quot;</span><span class="p">))</span> <span class="p">{</span>
				<span class="n">type</span><span class="o">-&gt;</span><span class="n">MouseAction</span> <span class="o">=</span> <span class="n">MouseActionSail</span><span class="p">;</span>
			<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
				<span class="n">LuaError</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="s">&quot;Unsupported RightMouseAction: %s&quot;</span> <span class="n">_C_</span> <span class="n">value</span><span class="p">);</span>
			<span class="p">}</span>
		<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s">&quot;CanAttack&quot;</span><span class="p">))</span> <span class="p">{</span>
			<span class="n">type</span><span class="o">-&gt;</span><span class="n">CanAttack</span> <span class="o">=</span> <span class="n">LuaToBoolean</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">-1</span><span class="p">);</span>
		<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s">&quot;RepairRange&quot;</span><span class="p">))</span> <span class="p">{</span>
			<span class="n">type</span><span class="o">-&gt;</span><span class="n">RepairRange</span> <span class="o">=</span> <span class="n">LuaToNumber</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">-1</span><span class="p">);</span>
		<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s">&quot;RepairHp&quot;</span><span class="p">))</span> <span class="p">{</span>
			<span class="n">type</span><span class="o">-&gt;</span><span class="n">RepairHP</span> <span class="o">=</span> <span class="n">LuaToNumber</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">-1</span><span class="p">);</span>
		<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s">&quot;RepairCosts&quot;</span><span class="p">))</span> <span class="p">{</span>
			<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">lua_istable</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">-1</span><span class="p">))</span> <span class="p">{</span>
				<span class="n">LuaError</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="s">&quot;incorrect argument&quot;</span><span class="p">);</span>
			<span class="p">}</span>
			<span class="k">const</span> <span class="kt">int</span> <span class="n">subargs</span> <span class="o">=</span> <span class="n">lua_rawlen</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">-1</span><span class="p">);</span>
			<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">k</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">k</span> <span class="o">&lt;</span> <span class="n">subargs</span><span class="p">;</span> <span class="o">++</span><span class="n">k</span><span class="p">)</span> <span class="p">{</span>
				<span class="n">lua_rawgeti</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">-1</span><span class="p">,</span> <span class="n">k</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>
				<span class="k">const</span> <span class="kt">int</span> <span class="n">res</span> <span class="o">=</span> <span class="n">CclGetResourceByName</span><span class="p">(</span><span class="n">l</span><span class="p">);</span>
				<span class="n">lua_pop</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
				<span class="o">++</span><span class="n">k</span><span class="p">;</span>
				<span class="n">type</span><span class="o">-&gt;</span><span class="n">RepairCosts</span><span class="p">[</span><span class="n">res</span><span class="p">]</span> <span class="o">=</span> <span class="n">LuaToNumber</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">-1</span><span class="p">,</span> <span class="n">k</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>
			<span class="p">}</span>
		<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s">&quot;CanTargetLand&quot;</span><span class="p">))</span> <span class="p">{</span>
			<span class="k">if</span> <span class="p">(</span><span class="n">LuaToBoolean</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">-1</span><span class="p">))</span> <span class="p">{</span>
				<span class="n">type</span><span class="o">-&gt;</span><span class="n">CanTarget</span> <span class="o">|=</span> <span class="n">CanTargetLand</span><span class="p">;</span>
			<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
				<span class="n">type</span><span class="o">-&gt;</span><span class="n">CanTarget</span> <span class="o">&amp;=</span> <span class="o">~</span><span class="n">CanTargetLand</span><span class="p">;</span>
			<span class="p">}</span>
		<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s">&quot;CanTargetSea&quot;</span><span class="p">))</span> <span class="p">{</span>
			<span class="k">if</span> <span class="p">(</span><span class="n">LuaToBoolean</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">-1</span><span class="p">))</span> <span class="p">{</span>
				<span class="n">type</span><span class="o">-&gt;</span><span class="n">CanTarget</span> <span class="o">|=</span> <span class="n">CanTargetSea</span><span class="p">;</span>
			<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
				<span class="n">type</span><span class="o">-&gt;</span><span class="n">CanTarget</span> <span class="o">&amp;=</span> <span class="o">~</span><span class="n">CanTargetSea</span><span class="p">;</span>
			<span class="p">}</span>
		<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s">&quot;CanTargetAir&quot;</span><span class="p">))</span> <span class="p">{</span>
			<span class="k">if</span> <span class="p">(</span><span class="n">LuaToBoolean</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">-1</span><span class="p">))</span> <span class="p">{</span>
				<span class="n">type</span><span class="o">-&gt;</span><span class="n">CanTarget</span> <span class="o">|=</span> <span class="n">CanTargetAir</span><span class="p">;</span>
			<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
				<span class="n">type</span><span class="o">-&gt;</span><span class="n">CanTarget</span> <span class="o">&amp;=</span> <span class="o">~</span><span class="n">CanTargetAir</span><span class="p">;</span>
			<span class="p">}</span>
		<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s">&quot;Building&quot;</span><span class="p">))</span> <span class="p">{</span>
			<span class="n">type</span><span class="o">-&gt;</span><span class="n">Building</span> <span class="o">=</span> <span class="n">LuaToBoolean</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">-1</span><span class="p">);</span>
		<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s">&quot;BuildingRules&quot;</span><span class="p">))</span> <span class="p">{</span>
			<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">lua_istable</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">-1</span><span class="p">))</span> <span class="p">{</span>
				<span class="n">LuaError</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="s">&quot;incorrect argument&quot;</span><span class="p">);</span>
			<span class="p">}</span>
			<span class="k">const</span> <span class="kt">int</span> <span class="n">subargs</span> <span class="o">=</span> <span class="n">lua_rawlen</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">-1</span><span class="p">);</span>
			<span class="c1">// Free any old restrictions if they are redefined</span>
			<span class="k">for</span> <span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">CBuildRestriction</span> <span class="o">*&gt;::</span><span class="n">iterator</span> <span class="n">b</span> <span class="o">=</span> <span class="n">type</span><span class="o">-&gt;</span><span class="n">BuildingRules</span><span class="p">.</span><span class="n">begin</span><span class="p">();</span>
				 <span class="n">b</span> <span class="o">!=</span> <span class="n">type</span><span class="o">-&gt;</span><span class="n">BuildingRules</span><span class="p">.</span><span class="n">end</span><span class="p">();</span> <span class="o">++</span><span class="n">b</span><span class="p">)</span> <span class="p">{</span>
				<span class="k">delete</span> <span class="o">*</span><span class="n">b</span><span class="p">;</span>
			<span class="p">}</span>
			<span class="n">type</span><span class="o">-&gt;</span><span class="n">BuildingRules</span><span class="p">.</span><span class="n">clear</span><span class="p">();</span>
			<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">k</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">k</span> <span class="o">&lt;</span> <span class="n">subargs</span><span class="p">;</span> <span class="o">++</span><span class="n">k</span><span class="p">)</span> <span class="p">{</span>
				<span class="n">lua_rawgeti</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">-1</span><span class="p">,</span> <span class="n">k</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>
				<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">lua_istable</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">-1</span><span class="p">))</span> <span class="p">{</span>
					<span class="n">LuaError</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="s">&quot;incorrect argument&quot;</span><span class="p">);</span>
				<span class="p">}</span>
				<span class="n">ParseBuildingRules</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">type</span><span class="o">-&gt;</span><span class="n">BuildingRules</span><span class="p">);</span>
				<span class="n">lua_pop</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
			<span class="p">}</span>
		<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s">&quot;AiBuildingRules&quot;</span><span class="p">))</span> <span class="p">{</span>
			<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">lua_istable</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">-1</span><span class="p">))</span> <span class="p">{</span>
				<span class="n">LuaError</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="s">&quot;incorrect argument&quot;</span><span class="p">);</span>
			<span class="p">}</span>
			<span class="k">const</span> <span class="kt">int</span> <span class="n">subargs</span> <span class="o">=</span> <span class="n">lua_rawlen</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">-1</span><span class="p">);</span>
			<span class="c1">// Free any old restrictions if they are redefined</span>
			<span class="k">for</span> <span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">CBuildRestriction</span> <span class="o">*&gt;::</span><span class="n">iterator</span> <span class="n">b</span> <span class="o">=</span> <span class="n">type</span><span class="o">-&gt;</span><span class="n">AiBuildingRules</span><span class="p">.</span><span class="n">begin</span><span class="p">();</span>
				 <span class="n">b</span> <span class="o">!=</span> <span class="n">type</span><span class="o">-&gt;</span><span class="n">AiBuildingRules</span><span class="p">.</span><span class="n">end</span><span class="p">();</span> <span class="o">++</span><span class="n">b</span><span class="p">)</span> <span class="p">{</span>
				<span class="k">delete</span> <span class="o">*</span><span class="n">b</span><span class="p">;</span>
			<span class="p">}</span>
			<span class="n">type</span><span class="o">-&gt;</span><span class="n">AiBuildingRules</span><span class="p">.</span><span class="n">clear</span><span class="p">();</span>
			<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">k</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">k</span> <span class="o">&lt;</span> <span class="n">subargs</span><span class="p">;</span> <span class="o">++</span><span class="n">k</span><span class="p">)</span> <span class="p">{</span>
				<span class="n">lua_rawgeti</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">-1</span><span class="p">,</span> <span class="n">k</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>
				<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">lua_istable</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">-1</span><span class="p">))</span> <span class="p">{</span>
					<span class="n">LuaError</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="s">&quot;incorrect argument&quot;</span><span class="p">);</span>
				<span class="p">}</span>
				<span class="n">ParseBuildingRules</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">type</span><span class="o">-&gt;</span><span class="n">AiBuildingRules</span><span class="p">);</span>
				<span class="n">lua_pop</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
			<span class="p">}</span>
		<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s">&quot;AutoBuildRate&quot;</span><span class="p">))</span> <span class="p">{</span>
			<span class="n">type</span><span class="o">-&gt;</span><span class="n">AutoBuildRate</span> <span class="o">=</span> <span class="n">LuaToNumber</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">-1</span><span class="p">);</span>
		<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s">&quot;LandUnit&quot;</span><span class="p">))</span> <span class="p">{</span>
			<span class="n">type</span><span class="o">-&gt;</span><span class="n">LandUnit</span> <span class="o">=</span> <span class="n">LuaToBoolean</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">-1</span><span class="p">);</span>
		<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s">&quot;AirUnit&quot;</span><span class="p">))</span> <span class="p">{</span>
			<span class="n">type</span><span class="o">-&gt;</span><span class="n">AirUnit</span> <span class="o">=</span> <span class="n">LuaToBoolean</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">-1</span><span class="p">);</span>
		<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s">&quot;SeaUnit&quot;</span><span class="p">))</span> <span class="p">{</span>
			<span class="n">type</span><span class="o">-&gt;</span><span class="n">SeaUnit</span> <span class="o">=</span> <span class="n">LuaToBoolean</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">-1</span><span class="p">);</span>
		<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s">&quot;RandomMovementProbability&quot;</span><span class="p">))</span> <span class="p">{</span>
			<span class="n">type</span><span class="o">-&gt;</span><span class="n">RandomMovementProbability</span> <span class="o">=</span> <span class="n">LuaToNumber</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">-1</span><span class="p">);</span>
		<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s">&quot;RandomMovementDistance&quot;</span><span class="p">))</span> <span class="p">{</span>
			<span class="n">type</span><span class="o">-&gt;</span><span class="n">RandomMovementDistance</span> <span class="o">=</span> <span class="n">LuaToNumber</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">-1</span><span class="p">);</span>
		<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s">&quot;ClicksToExplode&quot;</span><span class="p">))</span> <span class="p">{</span>
			<span class="n">type</span><span class="o">-&gt;</span><span class="n">ClicksToExplode</span> <span class="o">=</span> <span class="n">LuaToNumber</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">-1</span><span class="p">);</span>
		<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s">&quot;CanTransport&quot;</span><span class="p">))</span> <span class="p">{</span>
			<span class="c1">//  Warning: CanTransport should only be used AFTER all bool flags</span>
			<span class="c1">//  have been defined.</span>
			<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">lua_istable</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">-1</span><span class="p">))</span> <span class="p">{</span>
				<span class="n">LuaError</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="s">&quot;incorrect argument&quot;</span><span class="p">);</span>
			<span class="p">}</span>
			<span class="k">if</span> <span class="p">(</span><span class="n">type</span><span class="o">-&gt;</span><span class="n">MaxOnBoard</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span> <span class="c1">// set default value.</span>
				<span class="n">type</span><span class="o">-&gt;</span><span class="n">MaxOnBoard</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
			<span class="p">}</span>

			<span class="k">if</span> <span class="p">(</span><span class="n">type</span><span class="o">-&gt;</span><span class="n">BoolFlag</span><span class="p">.</span><span class="n">size</span><span class="p">()</span> <span class="o">&lt;</span> <span class="n">UnitTypeVar</span><span class="p">.</span><span class="n">GetNumberBoolFlag</span><span class="p">())</span> <span class="p">{</span>
				<span class="n">type</span><span class="o">-&gt;</span><span class="n">BoolFlag</span><span class="p">.</span><span class="n">resize</span><span class="p">(</span><span class="n">UnitTypeVar</span><span class="p">.</span><span class="n">GetNumberBoolFlag</span><span class="p">());</span>
			<span class="p">}</span>

			<span class="k">const</span> <span class="kt">int</span> <span class="n">subargs</span> <span class="o">=</span> <span class="n">lua_rawlen</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">-1</span><span class="p">);</span>
			<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">k</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">k</span> <span class="o">&lt;</span> <span class="n">subargs</span><span class="p">;</span> <span class="o">++</span><span class="n">k</span><span class="p">)</span> <span class="p">{</span>
				<span class="n">value</span> <span class="o">=</span> <span class="n">LuaToString</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">-1</span><span class="p">,</span> <span class="n">k</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>
				<span class="o">++</span><span class="n">k</span><span class="p">;</span>

				<span class="k">const</span> <span class="kt">int</span> <span class="n">index</span> <span class="o">=</span> <span class="n">UnitTypeVar</span><span class="p">.</span><span class="n">BoolFlagNameLookup</span><span class="p">[</span><span class="n">value</span><span class="p">];</span>
				<span class="k">if</span> <span class="p">(</span><span class="n">index</span> <span class="o">!=</span> <span class="mi">-1</span><span class="p">)</span> <span class="p">{</span>
					<span class="n">value</span> <span class="o">=</span> <span class="n">LuaToString</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">-1</span><span class="p">,</span> <span class="n">k</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>
					<span class="n">type</span><span class="o">-&gt;</span><span class="n">BoolFlag</span><span class="p">[</span><span class="n">index</span><span class="p">].</span><span class="n">CanTransport</span> <span class="o">=</span> <span class="n">Ccl2Condition</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">value</span><span class="p">);</span>
					<span class="k">continue</span><span class="p">;</span>
				<span class="p">}</span>
				<span class="n">LuaError</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="s">&quot;Unsupported flag tag for CanTransport: %s&quot;</span> <span class="n">_C_</span> <span class="n">value</span><span class="p">);</span>
			<span class="p">}</span>
		<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s">&quot;CanGatherResources&quot;</span><span class="p">))</span> <span class="p">{</span>
			<span class="k">const</span> <span class="kt">int</span> <span class="n">args</span> <span class="o">=</span> <span class="n">lua_rawlen</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">-1</span><span class="p">);</span>
			<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="n">args</span><span class="p">;</span> <span class="o">++</span><span class="n">j</span><span class="p">)</span> <span class="p">{</span>
				<span class="n">lua_rawgeti</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">-1</span><span class="p">,</span> <span class="n">j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>
				<span class="n">ResourceInfo</span> <span class="o">*</span><span class="n">res</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ResourceInfo</span><span class="p">;</span>
				<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">lua_istable</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">-1</span><span class="p">))</span> <span class="p">{</span>
					<span class="n">LuaError</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="s">&quot;incorrect argument&quot;</span><span class="p">);</span>
				<span class="p">}</span>
				<span class="k">const</span> <span class="kt">int</span> <span class="n">subargs</span> <span class="o">=</span> <span class="n">lua_rawlen</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">-1</span><span class="p">);</span>
				<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">k</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">k</span> <span class="o">&lt;</span> <span class="n">subargs</span><span class="p">;</span> <span class="o">++</span><span class="n">k</span><span class="p">)</span> <span class="p">{</span>
					<span class="n">value</span> <span class="o">=</span> <span class="n">LuaToString</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">-1</span><span class="p">,</span> <span class="n">k</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>
					<span class="o">++</span><span class="n">k</span><span class="p">;</span>
					<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s">&quot;resource-id&quot;</span><span class="p">))</span> <span class="p">{</span>
						<span class="n">lua_rawgeti</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">-1</span><span class="p">,</span> <span class="n">k</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>
						<span class="n">res</span><span class="o">-&gt;</span><span class="n">ResourceId</span> <span class="o">=</span> <span class="n">CclGetResourceByName</span><span class="p">(</span><span class="n">l</span><span class="p">);</span>
						<span class="n">lua_pop</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
						<span class="n">type</span><span class="o">-&gt;</span><span class="n">ResInfo</span><span class="p">[</span><span class="n">res</span><span class="o">-&gt;</span><span class="n">ResourceId</span><span class="p">]</span> <span class="o">=</span> <span class="n">res</span><span class="p">;</span>
					<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s">&quot;resource-step&quot;</span><span class="p">))</span> <span class="p">{</span>
						<span class="n">res</span><span class="o">-&gt;</span><span class="n">ResourceStep</span> <span class="o">=</span> <span class="n">LuaToNumber</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">-1</span><span class="p">,</span> <span class="n">k</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>
					<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s">&quot;final-resource&quot;</span><span class="p">))</span> <span class="p">{</span>
						<span class="n">lua_rawgeti</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">-1</span><span class="p">,</span> <span class="n">k</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>
						<span class="n">res</span><span class="o">-&gt;</span><span class="n">FinalResource</span> <span class="o">=</span> <span class="n">CclGetResourceByName</span><span class="p">(</span><span class="n">l</span><span class="p">);</span>
						<span class="n">lua_pop</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
					<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s">&quot;wait-at-resource&quot;</span><span class="p">))</span> <span class="p">{</span>
						<span class="n">res</span><span class="o">-&gt;</span><span class="n">WaitAtResource</span> <span class="o">=</span> <span class="n">LuaToNumber</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">-1</span><span class="p">,</span> <span class="n">k</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>
					<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s">&quot;wait-at-depot&quot;</span><span class="p">))</span> <span class="p">{</span>
						<span class="n">res</span><span class="o">-&gt;</span><span class="n">WaitAtDepot</span> <span class="o">=</span> <span class="n">LuaToNumber</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">-1</span><span class="p">,</span> <span class="n">k</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>
					<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s">&quot;resource-capacity&quot;</span><span class="p">))</span> <span class="p">{</span>
						<span class="n">res</span><span class="o">-&gt;</span><span class="n">ResourceCapacity</span> <span class="o">=</span> <span class="n">LuaToNumber</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">-1</span><span class="p">,</span> <span class="n">k</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>
					<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s">&quot;terrain-harvester&quot;</span><span class="p">))</span> <span class="p">{</span>
						<span class="n">res</span><span class="o">-&gt;</span><span class="n">TerrainHarvester</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
						<span class="o">--</span><span class="n">k</span><span class="p">;</span>
					<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s">&quot;lose-resources&quot;</span><span class="p">))</span> <span class="p">{</span>
						<span class="n">res</span><span class="o">-&gt;</span><span class="n">LoseResources</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
						<span class="o">--</span><span class="n">k</span><span class="p">;</span>
					<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s">&quot;harvest-from-outside&quot;</span><span class="p">))</span> <span class="p">{</span>
						<span class="n">res</span><span class="o">-&gt;</span><span class="n">HarvestFromOutside</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
						<span class="o">--</span><span class="n">k</span><span class="p">;</span>
					<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s">&quot;refinery-harvester&quot;</span><span class="p">))</span> <span class="p">{</span>
						<span class="n">res</span><span class="o">-&gt;</span><span class="n">RefineryHarvester</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
						<span class="o">--</span><span class="n">k</span><span class="p">;</span>
					<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s">&quot;file-when-empty&quot;</span><span class="p">))</span> <span class="p">{</span>
						<span class="n">res</span><span class="o">-&gt;</span><span class="n">FileWhenEmpty</span> <span class="o">=</span> <span class="n">LuaToString</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">-1</span><span class="p">,</span> <span class="n">k</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>
					<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s">&quot;file-when-loaded&quot;</span><span class="p">))</span> <span class="p">{</span>
						<span class="n">res</span><span class="o">-&gt;</span><span class="n">FileWhenLoaded</span> <span class="o">=</span> <span class="n">LuaToString</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">-1</span><span class="p">,</span> <span class="n">k</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>
					<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
						<span class="n">printf</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">%s</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">type</span><span class="o">-&gt;</span><span class="n">Name</span><span class="p">.</span><span class="n">c_str</span><span class="p">());</span>
						<span class="n">LuaError</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="s">&quot;Unsupported tag: %s&quot;</span> <span class="n">_C_</span> <span class="n">value</span><span class="p">);</span>
					<span class="p">}</span>
				<span class="p">}</span>
				<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">res</span><span class="o">-&gt;</span><span class="n">FinalResource</span><span class="p">)</span> <span class="p">{</span>
					<span class="n">res</span><span class="o">-&gt;</span><span class="n">FinalResource</span> <span class="o">=</span> <span class="n">res</span><span class="o">-&gt;</span><span class="n">ResourceId</span><span class="p">;</span>
				<span class="p">}</span>
				<span class="n">Assert</span><span class="p">(</span><span class="n">res</span><span class="o">-&gt;</span><span class="n">ResourceId</span><span class="p">);</span>
				<span class="n">lua_pop</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
			<span class="p">}</span>
			<span class="n">type</span><span class="o">-&gt;</span><span class="n">BoolFlag</span><span class="p">[</span><span class="n">HARVESTER_INDEX</span><span class="p">].</span><span class="n">value</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
		<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s">&quot;GivesResource&quot;</span><span class="p">))</span> <span class="p">{</span>
			<span class="n">lua_pushvalue</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">-1</span><span class="p">);</span>
			<span class="n">type</span><span class="o">-&gt;</span><span class="n">GivesResource</span> <span class="o">=</span> <span class="n">CclGetResourceByName</span><span class="p">(</span><span class="n">l</span><span class="p">);</span>
			<span class="n">lua_pop</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
		<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s">&quot;CanStore&quot;</span><span class="p">))</span> <span class="p">{</span>
			<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">lua_istable</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">-1</span><span class="p">))</span> <span class="p">{</span>
				<span class="n">LuaError</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="s">&quot;incorrect argument&quot;</span><span class="p">);</span>
			<span class="p">}</span>
			<span class="k">const</span> <span class="kt">int</span> <span class="n">subargs</span> <span class="o">=</span> <span class="n">lua_rawlen</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">-1</span><span class="p">);</span>
			<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">k</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">k</span> <span class="o">&lt;</span> <span class="n">subargs</span><span class="p">;</span> <span class="o">++</span><span class="n">k</span><span class="p">)</span> <span class="p">{</span>
				<span class="n">lua_rawgeti</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">-1</span><span class="p">,</span> <span class="n">k</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>
				<span class="n">type</span><span class="o">-&gt;</span><span class="n">CanStore</span><span class="p">[</span><span class="n">CclGetResourceByName</span><span class="p">(</span><span class="n">l</span><span class="p">)]</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
				<span class="n">lua_pop</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
			<span class="p">}</span>
		<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s">&quot;CanCastSpell&quot;</span><span class="p">))</span> <span class="p">{</span>
			<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">lua_istable</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">-1</span><span class="p">))</span> <span class="p">{</span>
				<span class="n">LuaError</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="s">&quot;incorrect argument&quot;</span><span class="p">);</span>
			<span class="p">}</span>
			<span class="c1">//</span>
			<span class="c1">// Warning: can-cast-spell should only be used AFTER all spells</span>
			<span class="c1">// have been defined. FIXME: MaxSpellType=500 or something?</span>
			<span class="c1">//</span>
			<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">type</span><span class="o">-&gt;</span><span class="n">CanCastSpell</span><span class="p">)</span> <span class="p">{</span>
				<span class="n">type</span><span class="o">-&gt;</span><span class="n">CanCastSpell</span> <span class="o">=</span> <span class="k">new</span> <span class="kt">char</span><span class="p">[</span><span class="n">SpellTypeTable</span><span class="p">.</span><span class="n">size</span><span class="p">()];</span>
				<span class="n">memset</span><span class="p">(</span><span class="n">type</span><span class="o">-&gt;</span><span class="n">CanCastSpell</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">SpellTypeTable</span><span class="p">.</span><span class="n">size</span><span class="p">()</span> <span class="o">*</span> <span class="k">sizeof</span><span class="p">(</span><span class="kt">char</span><span class="p">));</span>
			<span class="p">}</span>
			<span class="k">const</span> <span class="kt">int</span> <span class="n">subargs</span> <span class="o">=</span> <span class="n">lua_rawlen</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">-1</span><span class="p">);</span>
			<span class="k">if</span> <span class="p">(</span><span class="n">subargs</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
				<span class="k">delete</span><span class="p">[]</span> <span class="n">type</span><span class="o">-&gt;</span><span class="n">CanCastSpell</span><span class="p">;</span>
				<span class="n">type</span><span class="o">-&gt;</span><span class="n">CanCastSpell</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">;</span>
			<span class="p">}</span>
			<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">k</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">k</span> <span class="o">&lt;</span> <span class="n">subargs</span><span class="p">;</span> <span class="o">++</span><span class="n">k</span><span class="p">)</span> <span class="p">{</span>
				<span class="n">value</span> <span class="o">=</span> <span class="n">LuaToString</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">-1</span><span class="p">,</span> <span class="n">k</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>
				<span class="k">const</span> <span class="n">SpellType</span> <span class="o">*</span><span class="n">spell</span> <span class="o">=</span> <span class="n">SpellTypeByIdent</span><span class="p">(</span><span class="n">value</span><span class="p">);</span>
				<span class="k">if</span> <span class="p">(</span><span class="n">spell</span> <span class="o">==</span> <span class="nb">NULL</span><span class="p">)</span> <span class="p">{</span>
					<span class="n">LuaError</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="s">&quot;Unknown spell type: %s&quot;</span> <span class="n">_C_</span> <span class="n">value</span><span class="p">);</span>
				<span class="p">}</span>
				<span class="n">type</span><span class="o">-&gt;</span><span class="n">CanCastSpell</span><span class="p">[</span><span class="n">spell</span><span class="o">-&gt;</span><span class="n">Slot</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
			<span class="p">}</span>
		<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s">&quot;AutoCastActive&quot;</span><span class="p">))</span> <span class="p">{</span>
			<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">lua_istable</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">-1</span><span class="p">))</span> <span class="p">{</span>
				<span class="n">LuaError</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="s">&quot;incorrect argument&quot;</span><span class="p">);</span>
			<span class="p">}</span>
			<span class="c1">//</span>
			<span class="c1">// Warning: AutoCastActive should only be used AFTER all spells</span>
			<span class="c1">// have been defined.</span>
			<span class="c1">//</span>
			<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">type</span><span class="o">-&gt;</span><span class="n">AutoCastActive</span><span class="p">)</span> <span class="p">{</span>
				<span class="n">type</span><span class="o">-&gt;</span><span class="n">AutoCastActive</span> <span class="o">=</span> <span class="k">new</span> <span class="kt">char</span><span class="p">[</span><span class="n">SpellTypeTable</span><span class="p">.</span><span class="n">size</span><span class="p">()];</span>
				<span class="n">memset</span><span class="p">(</span><span class="n">type</span><span class="o">-&gt;</span><span class="n">AutoCastActive</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">SpellTypeTable</span><span class="p">.</span><span class="n">size</span><span class="p">()</span> <span class="o">*</span> <span class="k">sizeof</span><span class="p">(</span><span class="kt">char</span><span class="p">));</span>
			<span class="p">}</span>
			<span class="k">const</span> <span class="kt">int</span> <span class="n">subargs</span> <span class="o">=</span> <span class="n">lua_rawlen</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">-1</span><span class="p">);</span>
			<span class="k">if</span> <span class="p">(</span><span class="n">subargs</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
				<span class="k">delete</span><span class="p">[]</span> <span class="n">type</span><span class="o">-&gt;</span><span class="n">AutoCastActive</span><span class="p">;</span>
				<span class="n">type</span><span class="o">-&gt;</span><span class="n">AutoCastActive</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">;</span>

			<span class="p">}</span>
			<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">k</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">k</span> <span class="o">&lt;</span> <span class="n">subargs</span><span class="p">;</span> <span class="o">++</span><span class="n">k</span><span class="p">)</span> <span class="p">{</span>
				<span class="n">value</span> <span class="o">=</span> <span class="n">LuaToString</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">-1</span><span class="p">,</span> <span class="n">k</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>
				<span class="k">const</span> <span class="n">SpellType</span> <span class="o">*</span><span class="n">spell</span> <span class="o">=</span> <span class="n">SpellTypeByIdent</span><span class="p">(</span><span class="n">value</span><span class="p">);</span>
				<span class="k">if</span> <span class="p">(</span><span class="n">spell</span> <span class="o">==</span> <span class="nb">NULL</span><span class="p">)</span> <span class="p">{</span>
					<span class="n">LuaError</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="s">&quot;AutoCastActive : Unknown spell type: %s&quot;</span> <span class="n">_C_</span> <span class="n">value</span><span class="p">);</span>
				<span class="p">}</span>
				<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">spell</span><span class="o">-&gt;</span><span class="n">AutoCast</span><span class="p">)</span> <span class="p">{</span>
					<span class="n">LuaError</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="s">&quot;AutoCastActive : Define autocast method for %s.&quot;</span> <span class="n">_C_</span> <span class="n">value</span><span class="p">);</span>
				<span class="p">}</span>
				<span class="n">type</span><span class="o">-&gt;</span><span class="n">AutoCastActive</span><span class="p">[</span><span class="n">spell</span><span class="o">-&gt;</span><span class="n">Slot</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
			<span class="p">}</span>
		<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s">&quot;CanTargetFlag&quot;</span><span class="p">))</span> <span class="p">{</span>
			<span class="c1">//</span>
			<span class="c1">// Warning: can-target-flag should only be used AFTER all bool flags</span>
			<span class="c1">// have been defined.</span>
			<span class="c1">//</span>
			<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">lua_istable</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">-1</span><span class="p">))</span> <span class="p">{</span>
				<span class="n">LuaError</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="s">&quot;incorrect argument&quot;</span><span class="p">);</span>
			<span class="p">}</span>
			<span class="k">if</span> <span class="p">(</span><span class="n">type</span><span class="o">-&gt;</span><span class="n">BoolFlag</span><span class="p">.</span><span class="n">size</span><span class="p">()</span> <span class="o">&lt;</span> <span class="n">UnitTypeVar</span><span class="p">.</span><span class="n">GetNumberBoolFlag</span><span class="p">())</span> <span class="p">{</span>
				<span class="n">type</span><span class="o">-&gt;</span><span class="n">BoolFlag</span><span class="p">.</span><span class="n">resize</span><span class="p">(</span><span class="n">UnitTypeVar</span><span class="p">.</span><span class="n">GetNumberBoolFlag</span><span class="p">());</span>
			<span class="p">}</span>
			<span class="k">const</span> <span class="kt">int</span> <span class="n">subargs</span> <span class="o">=</span> <span class="n">lua_rawlen</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">-1</span><span class="p">);</span>
			<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">k</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">k</span> <span class="o">&lt;</span> <span class="n">subargs</span><span class="p">;</span> <span class="o">++</span><span class="n">k</span><span class="p">)</span> <span class="p">{</span>
				<span class="n">value</span> <span class="o">=</span> <span class="n">LuaToString</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">-1</span><span class="p">,</span> <span class="n">k</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>
				<span class="o">++</span><span class="n">k</span><span class="p">;</span>
				<span class="kt">int</span> <span class="n">index</span> <span class="o">=</span> <span class="n">UnitTypeVar</span><span class="p">.</span><span class="n">BoolFlagNameLookup</span><span class="p">[</span><span class="n">value</span><span class="p">];</span>
				<span class="k">if</span> <span class="p">(</span><span class="n">index</span> <span class="o">!=</span> <span class="mi">-1</span><span class="p">)</span> <span class="p">{</span>
					<span class="n">value</span> <span class="o">=</span> <span class="n">LuaToString</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">-1</span><span class="p">,</span> <span class="n">k</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>
					<span class="n">type</span><span class="o">-&gt;</span><span class="n">BoolFlag</span><span class="p">[</span><span class="n">index</span><span class="p">].</span><span class="n">CanTargetFlag</span> <span class="o">=</span> <span class="n">Ccl2Condition</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">value</span><span class="p">);</span>
					<span class="k">continue</span><span class="p">;</span>
				<span class="p">}</span>
				<span class="n">LuaError</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="s">&quot;Unsupported flag tag for can-target-flag: %s&quot;</span> <span class="n">_C_</span> <span class="n">value</span><span class="p">);</span>
			<span class="p">}</span>
		<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s">&quot;PriorityTarget&quot;</span><span class="p">))</span> <span class="p">{</span>
			<span class="c1">//</span>
			<span class="c1">// Warning: ai-priority-target should only be used AFTER all bool flags</span>
			<span class="c1">// have been defined.</span>
			<span class="c1">//</span>
			<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">lua_istable</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">-1</span><span class="p">))</span> <span class="p">{</span>
				<span class="n">LuaError</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="s">&quot;incorrect argument&quot;</span><span class="p">);</span>
			<span class="p">}</span>
			<span class="k">if</span> <span class="p">(</span><span class="n">type</span><span class="o">-&gt;</span><span class="n">BoolFlag</span><span class="p">.</span><span class="n">size</span><span class="p">()</span> <span class="o">&lt;</span> <span class="n">UnitTypeVar</span><span class="p">.</span><span class="n">GetNumberBoolFlag</span><span class="p">())</span> <span class="p">{</span>
				<span class="n">type</span><span class="o">-&gt;</span><span class="n">BoolFlag</span><span class="p">.</span><span class="n">resize</span><span class="p">(</span><span class="n">UnitTypeVar</span><span class="p">.</span><span class="n">GetNumberBoolFlag</span><span class="p">());</span>
			<span class="p">}</span>
			<span class="k">const</span> <span class="kt">int</span> <span class="n">subargs</span> <span class="o">=</span> <span class="n">lua_rawlen</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">-1</span><span class="p">);</span>
			<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">k</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">k</span> <span class="o">&lt;</span> <span class="n">subargs</span><span class="p">;</span> <span class="o">++</span><span class="n">k</span><span class="p">)</span> <span class="p">{</span>
				<span class="n">value</span> <span class="o">=</span> <span class="n">LuaToString</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">-1</span><span class="p">,</span> <span class="n">k</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>
				<span class="o">++</span><span class="n">k</span><span class="p">;</span>
				<span class="kt">int</span> <span class="n">index</span> <span class="o">=</span> <span class="n">UnitTypeVar</span><span class="p">.</span><span class="n">BoolFlagNameLookup</span><span class="p">[</span><span class="n">value</span><span class="p">];</span>
				<span class="k">if</span> <span class="p">(</span><span class="n">index</span> <span class="o">!=</span> <span class="mi">-1</span><span class="p">)</span> <span class="p">{</span>
					<span class="n">value</span> <span class="o">=</span> <span class="n">LuaToString</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">-1</span><span class="p">,</span> <span class="n">k</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>
					<span class="n">type</span><span class="o">-&gt;</span><span class="n">BoolFlag</span><span class="p">[</span><span class="n">index</span><span class="p">].</span><span class="n">AiPriorityTarget</span> <span class="o">=</span> <span class="n">Ccl2Condition</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">value</span><span class="p">);</span>
					<span class="k">continue</span><span class="p">;</span>
				<span class="p">}</span>
				<span class="n">LuaError</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="s">&quot;Unsupported flag tag for ai-priority-target: %s&quot;</span> <span class="n">_C_</span> <span class="n">value</span><span class="p">);</span>
			<span class="p">}</span>
		<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s">&quot;Sounds&quot;</span><span class="p">))</span> <span class="p">{</span>
			<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">lua_istable</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">-1</span><span class="p">))</span> <span class="p">{</span>
				<span class="n">LuaError</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="s">&quot;incorrect argument&quot;</span><span class="p">);</span>
			<span class="p">}</span>
			<span class="k">const</span> <span class="kt">int</span> <span class="n">subargs</span> <span class="o">=</span> <span class="n">lua_rawlen</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">-1</span><span class="p">);</span>
			<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">k</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">k</span> <span class="o">&lt;</span> <span class="n">subargs</span><span class="p">;</span> <span class="o">++</span><span class="n">k</span><span class="p">)</span> <span class="p">{</span>
				<span class="n">value</span> <span class="o">=</span> <span class="n">LuaToString</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">-1</span><span class="p">,</span> <span class="n">k</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>
				<span class="o">++</span><span class="n">k</span><span class="p">;</span>

				<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s">&quot;selected&quot;</span><span class="p">))</span> <span class="p">{</span>
					<span class="n">type</span><span class="o">-&gt;</span><span class="n">Sound</span><span class="p">.</span><span class="n">Selected</span><span class="p">.</span><span class="n">Name</span> <span class="o">=</span> <span class="n">LuaToString</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">-1</span><span class="p">,</span> <span class="n">k</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>
				<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s">&quot;acknowledge&quot;</span><span class="p">))</span> <span class="p">{</span>
					<span class="n">type</span><span class="o">-&gt;</span><span class="n">Sound</span><span class="p">.</span><span class="n">Acknowledgement</span><span class="p">.</span><span class="n">Name</span> <span class="o">=</span> <span class="n">LuaToString</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">-1</span><span class="p">,</span> <span class="n">k</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>
				<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s">&quot;attack&quot;</span><span class="p">))</span> <span class="p">{</span>
					<span class="n">type</span><span class="o">-&gt;</span><span class="n">Sound</span><span class="p">.</span><span class="n">Attack</span><span class="p">.</span><span class="n">Name</span> <span class="o">=</span> <span class="n">LuaToString</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">-1</span><span class="p">,</span> <span class="n">k</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>
				<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s">&quot;build&quot;</span><span class="p">))</span> <span class="p">{</span>
					<span class="n">type</span><span class="o">-&gt;</span><span class="n">Sound</span><span class="p">.</span><span class="n">Build</span><span class="p">.</span><span class="n">Name</span> <span class="o">=</span> <span class="n">LuaToString</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">-1</span><span class="p">,</span> <span class="n">k</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>
				<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s">&quot;ready&quot;</span><span class="p">))</span> <span class="p">{</span>
					<span class="n">type</span><span class="o">-&gt;</span><span class="n">Sound</span><span class="p">.</span><span class="n">Ready</span><span class="p">.</span><span class="n">Name</span> <span class="o">=</span> <span class="n">LuaToString</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">-1</span><span class="p">,</span> <span class="n">k</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>
				<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s">&quot;repair&quot;</span><span class="p">))</span> <span class="p">{</span>
					<span class="n">type</span><span class="o">-&gt;</span><span class="n">Sound</span><span class="p">.</span><span class="n">Repair</span><span class="p">.</span><span class="n">Name</span> <span class="o">=</span> <span class="n">LuaToString</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">-1</span><span class="p">,</span> <span class="n">k</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>
				<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s">&quot;harvest&quot;</span><span class="p">))</span> <span class="p">{</span>
					<span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">name</span> <span class="o">=</span> <span class="n">LuaToString</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">-1</span><span class="p">,</span> <span class="n">k</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>
					<span class="o">++</span><span class="n">k</span><span class="p">;</span>
					<span class="k">const</span> <span class="kt">int</span> <span class="n">resId</span> <span class="o">=</span> <span class="n">GetResourceIdByName</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">name</span><span class="p">.</span><span class="n">c_str</span><span class="p">());</span>
					<span class="n">type</span><span class="o">-&gt;</span><span class="n">Sound</span><span class="p">.</span><span class="n">Harvest</span><span class="p">[</span><span class="n">resId</span><span class="p">].</span><span class="n">Name</span> <span class="o">=</span> <span class="n">LuaToString</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">-1</span><span class="p">,</span> <span class="n">k</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>
				<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s">&quot;help&quot;</span><span class="p">))</span> <span class="p">{</span>
					<span class="n">type</span><span class="o">-&gt;</span><span class="n">Sound</span><span class="p">.</span><span class="n">Help</span><span class="p">.</span><span class="n">Name</span> <span class="o">=</span> <span class="n">LuaToString</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">-1</span><span class="p">,</span> <span class="n">k</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>
				<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s">&quot;work-complete&quot;</span><span class="p">))</span> <span class="p">{</span>
					<span class="n">type</span><span class="o">-&gt;</span><span class="n">Sound</span><span class="p">.</span><span class="n">WorkComplete</span><span class="p">.</span><span class="n">Name</span> <span class="o">=</span> <span class="n">LuaToString</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">-1</span><span class="p">,</span> <span class="n">k</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>
				<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s">&quot;dead&quot;</span><span class="p">))</span> <span class="p">{</span>
					<span class="kt">int</span> <span class="n">death</span><span class="p">;</span>

					<span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">name</span> <span class="o">=</span> <span class="n">LuaToString</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">-1</span><span class="p">,</span> <span class="n">k</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>
					<span class="k">for</span> <span class="p">(</span><span class="n">death</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">death</span> <span class="o">&lt;</span> <span class="n">ANIMATIONS_DEATHTYPES</span><span class="p">;</span> <span class="o">++</span><span class="n">death</span><span class="p">)</span> <span class="p">{</span>
						<span class="k">if</span> <span class="p">(</span><span class="n">name</span> <span class="o">==</span> <span class="n">ExtraDeathTypes</span><span class="p">[</span><span class="n">death</span><span class="p">])</span> <span class="p">{</span>
							<span class="o">++</span><span class="n">k</span><span class="p">;</span>
							<span class="k">break</span><span class="p">;</span>
						<span class="p">}</span>
					<span class="p">}</span>
					<span class="k">if</span> <span class="p">(</span><span class="n">death</span> <span class="o">==</span> <span class="n">ANIMATIONS_DEATHTYPES</span><span class="p">)</span> <span class="p">{</span>
						<span class="n">type</span><span class="o">-&gt;</span><span class="n">Sound</span><span class="p">.</span><span class="n">Dead</span><span class="p">[</span><span class="n">ANIMATIONS_DEATHTYPES</span><span class="p">].</span><span class="n">Name</span> <span class="o">=</span> <span class="n">name</span><span class="p">;</span>
					<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
						<span class="n">type</span><span class="o">-&gt;</span><span class="n">Sound</span><span class="p">.</span><span class="n">Dead</span><span class="p">[</span><span class="n">death</span><span class="p">].</span><span class="n">Name</span> <span class="o">=</span> <span class="n">LuaToString</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">-1</span><span class="p">,</span> <span class="n">k</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>
					<span class="p">}</span>
				<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
					<span class="n">LuaError</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="s">&quot;Unsupported sound tag: %s&quot;</span> <span class="n">_C_</span> <span class="n">value</span><span class="p">);</span>
				<span class="p">}</span>
			<span class="p">}</span>
		<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
			<span class="kt">int</span> <span class="n">index</span> <span class="o">=</span> <span class="n">UnitTypeVar</span><span class="p">.</span><span class="n">VariableNameLookup</span><span class="p">[</span><span class="n">value</span><span class="p">];</span>
			<span class="k">if</span> <span class="p">(</span><span class="n">index</span> <span class="o">!=</span> <span class="mi">-1</span><span class="p">)</span> <span class="p">{</span> <span class="c1">// valid index</span>
				<span class="k">if</span> <span class="p">(</span><span class="n">lua_isboolean</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">-1</span><span class="p">))</span> <span class="p">{</span>
					<span class="n">type</span><span class="o">-&gt;</span><span class="n">DefaultStat</span><span class="p">.</span><span class="n">Variables</span><span class="p">[</span><span class="n">index</span><span class="p">].</span><span class="n">Enable</span> <span class="o">=</span> <span class="n">LuaToBoolean</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">-1</span><span class="p">);</span>
				<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">lua_istable</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">-1</span><span class="p">))</span> <span class="p">{</span>
					<span class="n">DefineVariableField</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">type</span><span class="o">-&gt;</span><span class="n">DefaultStat</span><span class="p">.</span><span class="n">Variables</span> <span class="o">+</span> <span class="n">index</span><span class="p">,</span> <span class="mi">-1</span><span class="p">);</span>
				<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">lua_isnumber</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">-1</span><span class="p">))</span> <span class="p">{</span>
					<span class="n">type</span><span class="o">-&gt;</span><span class="n">DefaultStat</span><span class="p">.</span><span class="n">Variables</span><span class="p">[</span><span class="n">index</span><span class="p">].</span><span class="n">Enable</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
					<span class="n">type</span><span class="o">-&gt;</span><span class="n">DefaultStat</span><span class="p">.</span><span class="n">Variables</span><span class="p">[</span><span class="n">index</span><span class="p">].</span><span class="n">Value</span> <span class="o">=</span> <span class="n">LuaToNumber</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">-1</span><span class="p">);</span>
					<span class="n">type</span><span class="o">-&gt;</span><span class="n">DefaultStat</span><span class="p">.</span><span class="n">Variables</span><span class="p">[</span><span class="n">index</span><span class="p">].</span><span class="n">Max</span> <span class="o">=</span> <span class="n">LuaToNumber</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">-1</span><span class="p">);</span>
				<span class="p">}</span> <span class="k">else</span> <span class="p">{</span> <span class="c1">// Error</span>
					<span class="n">LuaError</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="s">&quot;incorrect argument for the variable in unittype&quot;</span><span class="p">);</span>
				<span class="p">}</span>
				<span class="k">continue</span><span class="p">;</span>
			<span class="p">}</span>

			<span class="k">if</span> <span class="p">(</span><span class="n">type</span><span class="o">-&gt;</span><span class="n">BoolFlag</span><span class="p">.</span><span class="n">size</span><span class="p">()</span> <span class="o">&lt;</span> <span class="n">UnitTypeVar</span><span class="p">.</span><span class="n">GetNumberBoolFlag</span><span class="p">())</span> <span class="p">{</span>
				<span class="n">type</span><span class="o">-&gt;</span><span class="n">BoolFlag</span><span class="p">.</span><span class="n">resize</span><span class="p">(</span><span class="n">UnitTypeVar</span><span class="p">.</span><span class="n">GetNumberBoolFlag</span><span class="p">());</span>
			<span class="p">}</span>

			<span class="n">index</span> <span class="o">=</span> <span class="n">UnitTypeVar</span><span class="p">.</span><span class="n">BoolFlagNameLookup</span><span class="p">[</span><span class="n">value</span><span class="p">];</span>
			<span class="k">if</span> <span class="p">(</span><span class="n">index</span> <span class="o">!=</span> <span class="mi">-1</span><span class="p">)</span> <span class="p">{</span>
				<span class="k">if</span> <span class="p">(</span><span class="n">lua_isnumber</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">-1</span><span class="p">))</span> <span class="p">{</span>
					<span class="n">type</span><span class="o">-&gt;</span><span class="n">BoolFlag</span><span class="p">[</span><span class="n">index</span><span class="p">].</span><span class="n">value</span> <span class="o">=</span> <span class="n">LuaToNumber</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">-1</span><span class="p">);</span>
				<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
					<span class="n">type</span><span class="o">-&gt;</span><span class="n">BoolFlag</span><span class="p">[</span><span class="n">index</span><span class="p">].</span><span class="n">value</span> <span class="o">=</span> <span class="n">LuaToBoolean</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">-1</span><span class="p">);</span>
				<span class="p">}</span>
			<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
				<span class="n">printf</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">%s</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">type</span><span class="o">-&gt;</span><span class="n">Name</span><span class="p">.</span><span class="n">c_str</span><span class="p">());</span>
				<span class="n">LuaError</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="s">&quot;Unsupported tag: %s&quot;</span> <span class="n">_C_</span> <span class="n">value</span><span class="p">);</span>
			<span class="p">}</span>
		<span class="p">}</span>
	<span class="p">}</span>

	<span class="c1">// If number of directions is not specified, make a guess</span>
	<span class="c1">// Building have 1 direction and units 8</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">type</span><span class="o">-&gt;</span><span class="n">Building</span> <span class="o">&amp;&amp;</span> <span class="n">type</span><span class="o">-&gt;</span><span class="n">NumDirections</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">type</span><span class="o">-&gt;</span><span class="n">NumDirections</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
	<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">type</span><span class="o">-&gt;</span><span class="n">NumDirections</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">type</span><span class="o">-&gt;</span><span class="n">NumDirections</span> <span class="o">=</span> <span class="mi">8</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="c1">// FIXME: try to simplify/combine the flags instead</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">type</span><span class="o">-&gt;</span><span class="n">MouseAction</span> <span class="o">==</span> <span class="n">MouseActionAttack</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="n">type</span><span class="o">-&gt;</span><span class="n">CanAttack</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">LuaError</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="s">&quot;Unit-type &#39;%s&#39;: right-attack is set, but can-attack is not</span><span class="se">\n</span><span class="s">&quot;</span> <span class="n">_C_</span> <span class="n">type</span><span class="o">-&gt;</span><span class="n">Name</span><span class="p">.</span><span class="n">c_str</span><span class="p">());</span>
	<span class="p">}</span>
	<span class="n">UpdateDefaultBoolFlags</span><span class="p">(</span><span class="o">*</span><span class="n">type</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">CclInConfigFile</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">UpdateUnitStats</span><span class="p">(</span><span class="o">*</span><span class="n">type</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
	<span class="p">}</span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</p>
                          </details>
                        </details>
                        
                        <details>
                        <summary>DefineUnitStats</summary>
                        <p><br> <b>Description</b><br><br>  Parse unit-stats.<br><br>  @param l  Lua state.<br><br> Example:<br><br> <div class="example"><code><strong>DefineUnitStats</strong>("unit-berserker", 2, {<br>    		"HitPoints", {Value = 55, Max = 55, Increase = 0, Enable = true},<br>    		"AttackRange", {Value = 5, Max = 6, Increase = 0, Enable = true},<br>    		"SightRange", {Value = 7, Max = 7, Increase = 0, Enable = true},<br>  		})</code></div></p>
                          <details>
                          <summary>/unit/script_unittype.cpp:1300 CclDefineUnitStats</summary>
                          <p><div class="highlight"><pre><span></span><span class="k">static</span> <span class="kt">int</span> <span class="nf">CclDefineUnitStats</span><span class="p">(</span><span class="n">lua_State</span> <span class="o">*</span><span class="n">l</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">CUnitType</span> <span class="o">*</span><span class="n">type</span> <span class="o">=</span> <span class="n">UnitTypeByIdent</span><span class="p">(</span><span class="n">LuaToString</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">1</span><span class="p">));</span>
	<span class="k">const</span> <span class="kt">int</span> <span class="n">playerId</span> <span class="o">=</span> <span class="n">LuaToNumber</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">2</span><span class="p">);</span>

	<span class="n">Assert</span><span class="p">(</span><span class="n">type</span><span class="p">);</span>
	<span class="n">Assert</span><span class="p">(</span><span class="n">playerId</span> <span class="o">&lt;</span> <span class="n">PlayerMax</span><span class="p">);</span>

	<span class="n">CUnitStats</span> <span class="o">*</span><span class="n">stats</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">type</span><span class="o">-&gt;</span><span class="n">Stats</span><span class="p">[</span><span class="n">playerId</span><span class="p">];</span>
	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">stats</span><span class="o">-&gt;</span><span class="n">Variables</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">stats</span><span class="o">-&gt;</span><span class="n">Variables</span> <span class="o">=</span> <span class="k">new</span> <span class="n">CVariable</span><span class="p">[</span><span class="n">UnitTypeVar</span><span class="p">.</span><span class="n">GetNumberVariable</span><span class="p">()];</span>
	<span class="p">}</span>

	<span class="c1">// Parse the list: (still everything could be changed!)</span>
	<span class="k">const</span> <span class="kt">int</span> <span class="n">args</span> <span class="o">=</span> <span class="n">lua_rawlen</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">3</span><span class="p">);</span>
	<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="n">args</span><span class="p">;</span> <span class="o">++</span><span class="n">j</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">value</span> <span class="o">=</span> <span class="n">LuaToString</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="n">j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>
		<span class="o">++</span><span class="n">j</span><span class="p">;</span>

		<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s">&quot;costs&quot;</span><span class="p">))</span> <span class="p">{</span>
			<span class="n">lua_rawgeti</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="n">j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>
			<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">lua_istable</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">-1</span><span class="p">))</span> <span class="p">{</span>
				<span class="n">LuaError</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="s">&quot;incorrect argument&quot;</span><span class="p">);</span>
			<span class="p">}</span>
			<span class="k">const</span> <span class="kt">int</span> <span class="n">subargs</span> <span class="o">=</span> <span class="n">lua_rawlen</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">-1</span><span class="p">);</span>

			<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">k</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">k</span> <span class="o">&lt;</span> <span class="n">subargs</span><span class="p">;</span> <span class="o">++</span><span class="n">k</span><span class="p">)</span> <span class="p">{</span>
				<span class="n">lua_rawgeti</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="n">j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>
				<span class="n">value</span> <span class="o">=</span> <span class="n">LuaToString</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">-1</span><span class="p">,</span> <span class="n">k</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>
				<span class="o">++</span><span class="n">k</span><span class="p">;</span>
				<span class="k">const</span> <span class="kt">int</span> <span class="n">resId</span> <span class="o">=</span> <span class="n">GetResourceIdByName</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">value</span><span class="p">);</span>
				<span class="n">stats</span><span class="o">-&gt;</span><span class="n">Costs</span><span class="p">[</span><span class="n">resId</span><span class="p">]</span> <span class="o">=</span> <span class="n">LuaToNumber</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">-1</span><span class="p">,</span> <span class="n">k</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>
				<span class="n">lua_pop</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
			<span class="p">}</span>
		<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s">&quot;storing&quot;</span><span class="p">))</span> <span class="p">{</span>
			<span class="n">lua_rawgeti</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="n">j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>
			<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">lua_istable</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">-1</span><span class="p">))</span> <span class="p">{</span>
				<span class="n">LuaError</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="s">&quot;incorrect argument&quot;</span><span class="p">);</span>
			<span class="p">}</span>
			<span class="k">const</span> <span class="kt">int</span> <span class="n">subargs</span> <span class="o">=</span> <span class="n">lua_rawlen</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">-1</span><span class="p">);</span>

			<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">k</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">k</span> <span class="o">&lt;</span> <span class="n">subargs</span><span class="p">;</span> <span class="o">++</span><span class="n">k</span><span class="p">)</span> <span class="p">{</span>
				<span class="n">lua_rawgeti</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="n">j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>
				<span class="n">value</span> <span class="o">=</span> <span class="n">LuaToString</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">-1</span><span class="p">,</span> <span class="n">k</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>
				<span class="o">++</span><span class="n">k</span><span class="p">;</span>
				<span class="k">const</span> <span class="kt">int</span> <span class="n">resId</span> <span class="o">=</span> <span class="n">GetResourceIdByName</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">value</span><span class="p">);</span>
				<span class="n">stats</span><span class="o">-&gt;</span><span class="n">Storing</span><span class="p">[</span><span class="n">resId</span><span class="p">]</span> <span class="o">=</span> <span class="n">LuaToNumber</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">-1</span><span class="p">,</span> <span class="n">k</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>
				<span class="n">lua_pop</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
			<span class="p">}</span>
		<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s">&quot;improve-production&quot;</span><span class="p">))</span> <span class="p">{</span>
			<span class="n">lua_rawgeti</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="n">j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>
			<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">lua_istable</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">-1</span><span class="p">))</span> <span class="p">{</span>
				<span class="n">LuaError</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="s">&quot;incorrect argument&quot;</span><span class="p">);</span>
			<span class="p">}</span>
			<span class="k">const</span> <span class="kt">int</span> <span class="n">subargs</span> <span class="o">=</span> <span class="n">lua_rawlen</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">-1</span><span class="p">);</span>

			<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">k</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">k</span> <span class="o">&lt;</span> <span class="n">subargs</span><span class="p">;</span> <span class="o">++</span><span class="n">k</span><span class="p">)</span> <span class="p">{</span>
				<span class="n">lua_rawgeti</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="n">j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>
				<span class="n">value</span> <span class="o">=</span> <span class="n">LuaToString</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">-1</span><span class="p">,</span> <span class="n">k</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>
				<span class="o">++</span><span class="n">k</span><span class="p">;</span>
				<span class="k">const</span> <span class="kt">int</span> <span class="n">resId</span> <span class="o">=</span> <span class="n">GetResourceIdByName</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">value</span><span class="p">);</span>
				<span class="n">stats</span><span class="o">-&gt;</span><span class="n">ImproveIncomes</span><span class="p">[</span><span class="n">resId</span><span class="p">]</span> <span class="o">=</span> <span class="n">LuaToNumber</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">-1</span><span class="p">,</span> <span class="n">k</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>
				<span class="n">lua_pop</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
			<span class="p">}</span>
		<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
			<span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="n">UnitTypeVar</span><span class="p">.</span><span class="n">VariableNameLookup</span><span class="p">[</span><span class="n">value</span><span class="p">];</span><span class="c1">// User variables</span>
			<span class="k">if</span> <span class="p">(</span><span class="n">i</span> <span class="o">!=</span> <span class="mi">-1</span><span class="p">)</span> <span class="p">{</span> <span class="c1">// valid index</span>
				<span class="n">lua_rawgeti</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="n">j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>
				<span class="k">if</span> <span class="p">(</span><span class="n">lua_istable</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">-1</span><span class="p">))</span> <span class="p">{</span>
					<span class="n">DefineVariableField</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">stats</span><span class="o">-&gt;</span><span class="n">Variables</span> <span class="o">+</span> <span class="n">i</span><span class="p">,</span> <span class="mi">-1</span><span class="p">);</span>
				<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">lua_isnumber</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">-1</span><span class="p">))</span> <span class="p">{</span>
					<span class="n">stats</span><span class="o">-&gt;</span><span class="n">Variables</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">Enable</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
					<span class="n">stats</span><span class="o">-&gt;</span><span class="n">Variables</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">Value</span> <span class="o">=</span> <span class="n">LuaToNumber</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">-1</span><span class="p">);</span>
					<span class="n">stats</span><span class="o">-&gt;</span><span class="n">Variables</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">Max</span> <span class="o">=</span> <span class="n">LuaToNumber</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">-1</span><span class="p">);</span>
				<span class="p">}</span> <span class="k">else</span> <span class="p">{</span> <span class="c1">// Error</span>
					<span class="n">LuaError</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="s">&quot;incorrect argument for the variable in unittype&quot;</span><span class="p">);</span>
				<span class="p">}</span>
				<span class="k">continue</span><span class="p">;</span>
			<span class="p">}</span>
			<span class="c1">// This leaves a half initialized unit</span>
			<span class="n">LuaError</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="s">&quot;Unsupported tag: %s&quot;</span> <span class="n">_C_</span> <span class="n">value</span><span class="p">);</span>
		<span class="p">}</span>
	<span class="p">}</span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</p>
                          </details>
                        </details>
                        
                        <details>
                        <summary>DefineBoolFlags</summary>
                        <p><br>  Define boolean flag.<br><br>  @param l  Lua state.</p>
                          <details>
                          <summary>/unit/script_unittype.cpp:1752 CclDefineBoolFlags</summary>
                          <p><div class="highlight"><pre><span></span><span class="k">static</span> <span class="kt">int</span> <span class="nf">CclDefineBoolFlags</span><span class="p">(</span><span class="n">lua_State</span> <span class="o">*</span><span class="n">l</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">const</span> <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">old</span> <span class="o">=</span> <span class="n">UnitTypeVar</span><span class="p">.</span><span class="n">GetNumberBoolFlag</span><span class="p">();</span>
	<span class="k">const</span> <span class="kt">int</span> <span class="n">args</span> <span class="o">=</span> <span class="n">lua_gettop</span><span class="p">(</span><span class="n">l</span><span class="p">);</span>
	<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="n">args</span><span class="p">;</span> <span class="o">++</span><span class="n">j</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">str</span> <span class="o">=</span> <span class="n">LuaToString</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>

		<span class="n">UnitTypeVar</span><span class="p">.</span><span class="n">BoolFlagNameLookup</span><span class="p">.</span><span class="n">AddKey</span><span class="p">(</span><span class="n">str</span><span class="p">);</span>

	<span class="p">}</span>

	<span class="k">if</span> <span class="p">(</span><span class="mi">0</span> <span class="o">&lt;</span> <span class="n">old</span> <span class="o">&amp;&amp;</span> <span class="n">old</span> <span class="o">!=</span> <span class="n">UnitTypeVar</span><span class="p">.</span><span class="n">GetNumberBoolFlag</span><span class="p">())</span> <span class="p">{</span>
		<span class="kt">size_t</span> <span class="n">new_size</span> <span class="o">=</span> <span class="n">UnitTypeVar</span><span class="p">.</span><span class="n">GetNumberBoolFlag</span><span class="p">();</span>
		<span class="k">for</span> <span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">CUnitType</span> <span class="o">*&gt;::</span><span class="n">size_type</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">UnitTypes</span><span class="p">.</span><span class="n">size</span><span class="p">();</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span> <span class="p">{</span> <span class="c1">// adjust array for unit already defined</span>
			<span class="n">UnitTypes</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">-&gt;</span><span class="n">BoolFlag</span><span class="p">.</span><span class="n">resize</span><span class="p">(</span><span class="n">new_size</span><span class="p">);</span>
		<span class="p">}</span>
	<span class="p">}</span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</p>
                          </details>
                        </details>
                        
                        <details>
                        <summary>DefineVariables</summary>
                        <p><br>  Define user variables.<br><br>  @param l  Lua state.</p>
                          <details>
                          <summary>/unit/script_unittype.cpp:1727 CclDefineVariables</summary>
                          <p><div class="highlight"><pre><span></span><span class="k">static</span> <span class="kt">int</span> <span class="nf">CclDefineVariables</span><span class="p">(</span><span class="n">lua_State</span> <span class="o">*</span><span class="n">l</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">int</span> <span class="n">old</span> <span class="o">=</span> <span class="n">UnitTypeVar</span><span class="p">.</span><span class="n">GetNumberVariable</span><span class="p">();</span>

	<span class="k">const</span> <span class="kt">int</span> <span class="n">args</span> <span class="o">=</span> <span class="n">lua_gettop</span><span class="p">(</span><span class="n">l</span><span class="p">);</span>
	<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="n">args</span><span class="p">;</span> <span class="o">++</span><span class="n">j</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">str</span> <span class="o">=</span> <span class="n">LuaToString</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>

		<span class="k">const</span> <span class="kt">int</span> <span class="n">index</span> <span class="o">=</span> <span class="n">UnitTypeVar</span><span class="p">.</span><span class="n">VariableNameLookup</span><span class="p">.</span><span class="n">AddKey</span><span class="p">(</span><span class="n">str</span><span class="p">);</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">index</span> <span class="o">==</span> <span class="n">old</span><span class="p">)</span> <span class="p">{</span>
			<span class="n">old</span><span class="o">++</span><span class="p">;</span>
			<span class="n">UnitTypeVar</span><span class="p">.</span><span class="n">Variable</span><span class="p">.</span><span class="n">resize</span><span class="p">(</span><span class="n">old</span><span class="p">);</span>
		<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
			<span class="n">DebugPrint</span><span class="p">(</span><span class="s">&quot;Warning, User Variable </span><span class="se">\&quot;</span><span class="s">%s</span><span class="se">\&quot;</span><span class="s"> redefined</span><span class="se">\n</span><span class="s">&quot;</span> <span class="n">_C_</span> <span class="n">str</span><span class="p">);</span>
		<span class="p">}</span>
		<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">lua_istable</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">j</span> <span class="o">+</span> <span class="mi">2</span><span class="p">))</span> <span class="p">{</span> <span class="c1">// No change =&gt; default value.</span>
			<span class="k">continue</span><span class="p">;</span>
		<span class="p">}</span>
		<span class="o">++</span><span class="n">j</span><span class="p">;</span>
		<span class="n">DefineVariableField</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="o">&amp;</span><span class="p">(</span><span class="n">UnitTypeVar</span><span class="p">.</span><span class="n">Variable</span><span class="p">[</span><span class="n">index</span><span class="p">]),</span> <span class="n">j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>
	<span class="p">}</span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</p>
                          </details>
                        </details>
                        
                        <details>
                        <summary>DefineDecorations</summary>
                        <p><br>  Define Decorations for user variables<br><br>  @param l  Lua state.<br><br>  @todo modify Assert with luastate with User Error.<br>  @todo continue to add configuration.</p>
                          <details>
                          <summary>/unit/script_unittype.cpp:1930 CclDefineDecorations</summary>
                          <p><div class="highlight"><pre><span></span><span class="k">static</span> <span class="kt">int</span> <span class="nf">CclDefineDecorations</span><span class="p">(</span><span class="n">lua_State</span> <span class="o">*</span><span class="n">l</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="p">{</span>
		<span class="kt">int</span> <span class="n">Index</span><span class="p">;</span>
		<span class="kt">int</span> <span class="n">OffsetX</span><span class="p">;</span>
		<span class="kt">int</span> <span class="n">OffsetY</span><span class="p">;</span>
		<span class="kt">int</span> <span class="n">OffsetXPercent</span><span class="p">;</span>
		<span class="kt">int</span> <span class="n">OffsetYPercent</span><span class="p">;</span>
		<span class="kt">bool</span> <span class="n">IsCenteredInX</span><span class="p">;</span>
		<span class="kt">bool</span> <span class="n">IsCenteredInY</span><span class="p">;</span>
		<span class="kt">bool</span> <span class="n">ShowIfNotEnable</span><span class="p">;</span>
		<span class="kt">bool</span> <span class="n">ShowWhenNull</span><span class="p">;</span>
		<span class="kt">bool</span> <span class="n">HideHalf</span><span class="p">;</span>
		<span class="kt">bool</span> <span class="n">ShowWhenMax</span><span class="p">;</span>
		<span class="kt">bool</span> <span class="n">ShowOnlySelected</span><span class="p">;</span>
		<span class="kt">bool</span> <span class="n">HideNeutral</span><span class="p">;</span>
		<span class="kt">bool</span> <span class="n">HideAllied</span><span class="p">;</span>
		<span class="kt">bool</span> <span class="n">ShowOpponent</span><span class="p">;</span>
	<span class="p">}</span> <span class="n">tmp</span><span class="p">;</span>

	<span class="k">const</span> <span class="kt">int</span> <span class="n">nargs</span> <span class="o">=</span> <span class="n">lua_gettop</span><span class="p">(</span><span class="n">l</span><span class="p">);</span>
	<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">nargs</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">Assert</span><span class="p">(</span><span class="n">lua_istable</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">));</span>
		<span class="n">CDecoVar</span> <span class="o">*</span><span class="n">decovar</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">;</span>
		<span class="n">memset</span><span class="p">(</span><span class="o">&amp;</span><span class="n">tmp</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">tmp</span><span class="p">));</span>
		<span class="n">lua_pushnil</span><span class="p">(</span><span class="n">l</span><span class="p">);</span>
		<span class="k">while</span> <span class="p">(</span><span class="n">lua_next</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span> <span class="p">{</span>
			<span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">key</span> <span class="o">=</span> <span class="n">LuaToString</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">-2</span><span class="p">);</span>
			<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="s">&quot;Index&quot;</span><span class="p">))</span> <span class="p">{</span>
				<span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="k">const</span> <span class="n">value</span> <span class="o">=</span> <span class="n">LuaToString</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">-1</span><span class="p">);</span>
				<span class="n">tmp</span><span class="p">.</span><span class="n">Index</span> <span class="o">=</span> <span class="n">UnitTypeVar</span><span class="p">.</span><span class="n">VariableNameLookup</span><span class="p">[</span><span class="n">value</span><span class="p">];</span><span class="c1">// User variables</span>
				<span class="n">Assert</span><span class="p">(</span><span class="n">tmp</span><span class="p">.</span><span class="n">Index</span> <span class="o">!=</span> <span class="mi">-1</span><span class="p">);</span>
			<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="s">&quot;Offset&quot;</span><span class="p">))</span> <span class="p">{</span>
				<span class="n">CclGetPos</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">tmp</span><span class="p">.</span><span class="n">OffsetX</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">tmp</span><span class="p">.</span><span class="n">OffsetY</span><span class="p">);</span>
			<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="s">&quot;OffsetPercent&quot;</span><span class="p">))</span> <span class="p">{</span>
				<span class="n">CclGetPos</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">tmp</span><span class="p">.</span><span class="n">OffsetXPercent</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">tmp</span><span class="p">.</span><span class="n">OffsetYPercent</span><span class="p">);</span>
			<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="s">&quot;CenterX&quot;</span><span class="p">))</span> <span class="p">{</span>
				<span class="n">tmp</span><span class="p">.</span><span class="n">IsCenteredInX</span> <span class="o">=</span> <span class="n">LuaToBoolean</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">-1</span><span class="p">);</span>
			<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="s">&quot;CenterY&quot;</span><span class="p">))</span> <span class="p">{</span>
				<span class="n">tmp</span><span class="p">.</span><span class="n">IsCenteredInY</span> <span class="o">=</span> <span class="n">LuaToBoolean</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">-1</span><span class="p">);</span>
			<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="s">&quot;ShowIfNotEnable&quot;</span><span class="p">))</span> <span class="p">{</span>
				<span class="n">tmp</span><span class="p">.</span><span class="n">ShowIfNotEnable</span> <span class="o">=</span> <span class="n">LuaToBoolean</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">-1</span><span class="p">);</span>
			<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="s">&quot;ShowWhenNull&quot;</span><span class="p">))</span> <span class="p">{</span>
				<span class="n">tmp</span><span class="p">.</span><span class="n">ShowWhenNull</span> <span class="o">=</span> <span class="n">LuaToBoolean</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">-1</span><span class="p">);</span>
			<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="s">&quot;HideHalf&quot;</span><span class="p">))</span> <span class="p">{</span>
				<span class="n">tmp</span><span class="p">.</span><span class="n">HideHalf</span> <span class="o">=</span> <span class="n">LuaToBoolean</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">-1</span><span class="p">);</span>
			<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="s">&quot;ShowWhenMax&quot;</span><span class="p">))</span> <span class="p">{</span>
				<span class="n">tmp</span><span class="p">.</span><span class="n">ShowWhenMax</span> <span class="o">=</span> <span class="n">LuaToBoolean</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">-1</span><span class="p">);</span>
			<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="s">&quot;ShowOnlySelected&quot;</span><span class="p">))</span> <span class="p">{</span>
				<span class="n">tmp</span><span class="p">.</span><span class="n">ShowOnlySelected</span> <span class="o">=</span> <span class="n">LuaToBoolean</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">-1</span><span class="p">);</span>
			<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="s">&quot;HideNeutral&quot;</span><span class="p">))</span> <span class="p">{</span>
				<span class="n">tmp</span><span class="p">.</span><span class="n">HideNeutral</span> <span class="o">=</span> <span class="n">LuaToBoolean</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">-1</span><span class="p">);</span>
			<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="s">&quot;HideAllied&quot;</span><span class="p">))</span> <span class="p">{</span>
				<span class="n">tmp</span><span class="p">.</span><span class="n">HideAllied</span> <span class="o">=</span> <span class="n">LuaToBoolean</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">-1</span><span class="p">);</span>
			<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="s">&quot;ShowOpponent&quot;</span><span class="p">))</span> <span class="p">{</span>
				<span class="n">tmp</span><span class="p">.</span><span class="n">ShowOpponent</span> <span class="o">=</span> <span class="n">LuaToBoolean</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">-1</span><span class="p">);</span>
			<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="s">&quot;Method&quot;</span><span class="p">))</span> <span class="p">{</span>
				<span class="n">Assert</span><span class="p">(</span><span class="n">lua_istable</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">-1</span><span class="p">));</span>
				<span class="n">lua_rawgeti</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">-1</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span> <span class="c1">// MethodName</span>
				<span class="n">lua_rawgeti</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">-2</span><span class="p">,</span> <span class="mi">2</span><span class="p">);</span> <span class="c1">// Data</span>
				<span class="n">Assert</span><span class="p">(</span><span class="n">lua_istable</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">-1</span><span class="p">));</span>
				<span class="n">key</span> <span class="o">=</span> <span class="n">LuaToString</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">-2</span><span class="p">);</span>
				<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="s">&quot;bar&quot;</span><span class="p">))</span> <span class="p">{</span>
					<span class="n">CDecoVarBar</span> <span class="o">*</span><span class="n">decovarbar</span> <span class="o">=</span> <span class="k">new</span> <span class="n">CDecoVarBar</span><span class="p">;</span>
					<span class="n">lua_pushnil</span><span class="p">(</span><span class="n">l</span><span class="p">);</span>
					<span class="k">while</span> <span class="p">(</span><span class="n">lua_next</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">-2</span><span class="p">))</span> <span class="p">{</span>
						<span class="n">key</span> <span class="o">=</span> <span class="n">LuaToString</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">-2</span><span class="p">);</span>
						<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="s">&quot;Height&quot;</span><span class="p">))</span> <span class="p">{</span>
							<span class="n">decovarbar</span><span class="o">-&gt;</span><span class="n">Height</span> <span class="o">=</span> <span class="n">LuaToNumber</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">-1</span><span class="p">);</span>
						<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="s">&quot;Width&quot;</span><span class="p">))</span> <span class="p">{</span>
							<span class="n">decovarbar</span><span class="o">-&gt;</span><span class="n">Width</span> <span class="o">=</span> <span class="n">LuaToNumber</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">-1</span><span class="p">);</span>
						<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="s">&quot;Orientation&quot;</span><span class="p">))</span> <span class="p">{</span>
							<span class="n">key</span> <span class="o">=</span> <span class="n">LuaToString</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">-1</span><span class="p">);</span>
							<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="s">&quot;horizontal&quot;</span><span class="p">))</span> <span class="p">{</span>
								<span class="n">decovarbar</span><span class="o">-&gt;</span><span class="n">IsVertical</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
							<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="s">&quot;vertical&quot;</span><span class="p">))</span> <span class="p">{</span>
								<span class="n">decovarbar</span><span class="o">-&gt;</span><span class="n">IsVertical</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
							<span class="p">}</span> <span class="k">else</span> <span class="p">{</span> <span class="c1">// Error</span>
								<span class="n">LuaError</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="s">&quot;invalid Orientation &#39;%s&#39; for bar in DefineDecorations&quot;</span> <span class="n">_C_</span> <span class="n">key</span><span class="p">);</span>
							<span class="p">}</span>
						<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="s">&quot;SEToNW&quot;</span><span class="p">))</span> <span class="p">{</span>
							<span class="n">decovarbar</span><span class="o">-&gt;</span><span class="n">SEToNW</span> <span class="o">=</span> <span class="n">LuaToBoolean</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">-1</span><span class="p">);</span>
						<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="s">&quot;BorderSize&quot;</span><span class="p">))</span> <span class="p">{</span>
							<span class="n">decovarbar</span><span class="o">-&gt;</span><span class="n">BorderSize</span> <span class="o">=</span> <span class="n">LuaToNumber</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">-1</span><span class="p">);</span>
						<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="s">&quot;ShowFullBackground&quot;</span><span class="p">))</span> <span class="p">{</span>
							<span class="n">decovarbar</span><span class="o">-&gt;</span><span class="n">ShowFullBackground</span> <span class="o">=</span> <span class="n">LuaToBoolean</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">-1</span><span class="p">);</span>
<span class="cp">#if 0</span><span class="c"> // FIXME Color configuration</span>
<span class="c">						} else if (!strcmp(key, &quot;Color&quot;)) {</span>
<span class="c">							decovar-&gt;Color = // FIXME</span>
<span class="c">						} else if (!strcmp(key, &quot;BColor&quot;)) {</span>
<span class="c">							decovar-&gt;BColor = // FIXME</span>
<span class="cp">#endif</span>
						<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
							<span class="n">LuaError</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="s">&quot;&#39;%s&#39; invalid for Method bar&quot;</span> <span class="n">_C_</span> <span class="n">key</span><span class="p">);</span>
						<span class="p">}</span>
						<span class="n">lua_pop</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span> <span class="c1">// Pop value</span>
					<span class="p">}</span>
					<span class="n">decovar</span> <span class="o">=</span> <span class="n">decovarbar</span><span class="p">;</span>
				<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="s">&quot;frame&quot;</span><span class="p">))</span> <span class="p">{</span>
					<span class="n">CDecoVarFrame</span> <span class="o">*</span><span class="n">frame</span> <span class="o">=</span> <span class="k">new</span> <span class="n">CDecoVarFrame</span><span class="p">;</span>
					<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">lua_istable</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">-1</span><span class="p">))</span> <span class="p">{</span>
						<span class="n">LuaError</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="s">&quot;incorrect argument, need table with Thickness= and Color=&quot;</span><span class="p">);</span>
					<span class="p">}</span>
					<span class="k">for</span> <span class="p">(</span><span class="n">lua_pushnil</span><span class="p">(</span><span class="n">l</span><span class="p">);</span> <span class="n">lua_next</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">-2</span><span class="p">);</span> <span class="n">lua_pop</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span> <span class="p">{</span>
						<span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">innerkey</span> <span class="o">=</span> <span class="n">LuaToString</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">-2</span><span class="p">);</span>
						<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">innerkey</span><span class="p">,</span> <span class="s">&quot;Thickness&quot;</span><span class="p">))</span> <span class="p">{</span>
							<span class="n">frame</span><span class="o">-&gt;</span><span class="n">Thickness</span> <span class="o">=</span> <span class="n">LuaToNumber</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">-1</span><span class="p">);</span>
						<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">innerkey</span><span class="p">,</span> <span class="s">&quot;ColorName&quot;</span><span class="p">))</span> <span class="p">{</span>
							<span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="k">const</span> <span class="n">colorName</span> <span class="o">=</span> <span class="n">LuaToString</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">-1</span><span class="p">);</span>
							<span class="n">frame</span><span class="o">-&gt;</span><span class="n">ColorIndex</span> <span class="o">=</span> <span class="n">GetColorIndexByName</span><span class="p">(</span><span class="n">colorName</span><span class="p">);</span>
						<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
							<span class="n">LuaError</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="s">&quot;&#39;%s&#39; invalid for Method frame&quot;</span> <span class="n">_C_</span> <span class="n">innerkey</span><span class="p">);</span>
						<span class="p">}</span>
					<span class="p">}</span>
					<span class="n">decovar</span> <span class="o">=</span> <span class="n">frame</span><span class="p">;</span>
				<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="s">&quot;text&quot;</span><span class="p">))</span> <span class="p">{</span>
					<span class="n">CDecoVarText</span> <span class="o">*</span><span class="n">decovartext</span> <span class="o">=</span> <span class="k">new</span> <span class="n">CDecoVarText</span><span class="p">;</span>

					<span class="n">decovartext</span><span class="o">-&gt;</span><span class="n">Font</span> <span class="o">=</span> <span class="n">CFont</span><span class="o">::</span><span class="n">Get</span><span class="p">(</span><span class="n">LuaToString</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">-1</span><span class="p">,</span> <span class="mi">1</span><span class="p">));</span>
					<span class="c1">// FIXME : More arguments ? color...</span>
					<span class="n">decovar</span> <span class="o">=</span> <span class="n">decovartext</span><span class="p">;</span>
				<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="s">&quot;sprite&quot;</span><span class="p">))</span> <span class="p">{</span>
					<span class="n">CDecoVarSpriteBar</span> <span class="o">*</span><span class="n">decovarspritebar</span> <span class="o">=</span> <span class="k">new</span> <span class="n">CDecoVarSpriteBar</span><span class="p">;</span>
					<span class="n">decovarspritebar</span><span class="o">-&gt;</span><span class="n">NSprite</span> <span class="o">=</span> <span class="n">GetSpriteIndex</span><span class="p">(</span><span class="n">LuaToString</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">-1</span><span class="p">,</span> <span class="mi">1</span><span class="p">));</span>
					<span class="k">if</span> <span class="p">(</span><span class="n">decovarspritebar</span><span class="o">-&gt;</span><span class="n">NSprite</span> <span class="o">==</span> <span class="mi">-1</span><span class="p">)</span> <span class="p">{</span>
						<span class="n">LuaError</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="s">&quot;invalid sprite-name &#39;%s&#39; for Method in DefineDecorations&quot;</span> <span class="n">_C_</span> <span class="n">LuaToString</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">-1</span><span class="p">,</span> <span class="mi">1</span><span class="p">));</span>
					<span class="p">}</span>
					<span class="c1">// FIXME : More arguments ?</span>
					<span class="n">decovar</span> <span class="o">=</span> <span class="n">decovarspritebar</span><span class="p">;</span>
				<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="s">&quot;static-sprite&quot;</span><span class="p">))</span> <span class="p">{</span>
					<span class="n">CDecoVarStaticSprite</span> <span class="o">*</span><span class="n">decovarstaticsprite</span> <span class="o">=</span> <span class="k">new</span> <span class="n">CDecoVarStaticSprite</span><span class="p">;</span>
					<span class="k">if</span> <span class="p">(</span><span class="n">lua_rawlen</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">-1</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">)</span> <span class="p">{</span>
						<span class="n">decovarstaticsprite</span><span class="o">-&gt;</span><span class="n">NSprite</span> <span class="o">=</span> <span class="n">GetSpriteIndex</span><span class="p">(</span><span class="n">LuaToString</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">-1</span><span class="p">,</span> <span class="mi">1</span><span class="p">));</span>
						<span class="n">decovarstaticsprite</span><span class="o">-&gt;</span><span class="n">n</span> <span class="o">=</span> <span class="n">LuaToNumber</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">-1</span><span class="p">,</span> <span class="mi">2</span><span class="p">);</span>
					<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
						<span class="n">decovarstaticsprite</span><span class="o">-&gt;</span><span class="n">NSprite</span> <span class="o">=</span> <span class="n">GetSpriteIndex</span><span class="p">(</span><span class="n">LuaToString</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">-1</span><span class="p">,</span> <span class="mi">1</span><span class="p">));</span>
						<span class="n">decovarstaticsprite</span><span class="o">-&gt;</span><span class="n">n</span> <span class="o">=</span> <span class="n">LuaToNumber</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">-1</span><span class="p">,</span> <span class="mi">2</span><span class="p">);</span>
						<span class="n">decovarstaticsprite</span><span class="o">-&gt;</span><span class="n">FadeValue</span> <span class="o">=</span> <span class="n">LuaToNumber</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">-1</span><span class="p">,</span> <span class="mi">3</span><span class="p">);</span>
					<span class="p">}</span>
					<span class="n">decovar</span> <span class="o">=</span> <span class="n">decovarstaticsprite</span><span class="p">;</span>
				<span class="p">}</span> <span class="k">else</span> <span class="p">{</span> <span class="c1">// Error</span>
					<span class="n">LuaError</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="s">&quot;invalid method &#39;%s&#39; for Method in DefineDecorations&quot;</span> <span class="n">_C_</span> <span class="n">key</span><span class="p">);</span>
				<span class="p">}</span>
				<span class="n">lua_pop</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">2</span><span class="p">);</span> <span class="c1">// MethodName and data</span>
			<span class="p">}</span> <span class="k">else</span> <span class="p">{</span> <span class="c1">// Error</span>
				<span class="n">LuaError</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="s">&quot;invalid key &#39;%s&#39; for DefineDecorations&quot;</span> <span class="n">_C_</span> <span class="n">key</span><span class="p">);</span>
			<span class="p">}</span>
			<span class="n">lua_pop</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span> <span class="c1">// Pop the value</span>
		<span class="p">}</span>
		<span class="n">decovar</span><span class="o">-&gt;</span><span class="n">Index</span> <span class="o">=</span> <span class="n">tmp</span><span class="p">.</span><span class="n">Index</span><span class="p">;</span>
		<span class="n">decovar</span><span class="o">-&gt;</span><span class="n">OffsetX</span> <span class="o">=</span> <span class="n">tmp</span><span class="p">.</span><span class="n">OffsetX</span><span class="p">;</span>
		<span class="n">decovar</span><span class="o">-&gt;</span><span class="n">OffsetY</span> <span class="o">=</span> <span class="n">tmp</span><span class="p">.</span><span class="n">OffsetY</span><span class="p">;</span>
		<span class="n">decovar</span><span class="o">-&gt;</span><span class="n">OffsetXPercent</span> <span class="o">=</span> <span class="n">tmp</span><span class="p">.</span><span class="n">OffsetXPercent</span><span class="p">;</span>
		<span class="n">decovar</span><span class="o">-&gt;</span><span class="n">OffsetYPercent</span> <span class="o">=</span> <span class="n">tmp</span><span class="p">.</span><span class="n">OffsetYPercent</span><span class="p">;</span>
		<span class="n">decovar</span><span class="o">-&gt;</span><span class="n">IsCenteredInX</span> <span class="o">=</span> <span class="n">tmp</span><span class="p">.</span><span class="n">IsCenteredInX</span><span class="p">;</span>
		<span class="n">decovar</span><span class="o">-&gt;</span><span class="n">IsCenteredInY</span> <span class="o">=</span> <span class="n">tmp</span><span class="p">.</span><span class="n">IsCenteredInY</span><span class="p">;</span>
		<span class="n">decovar</span><span class="o">-&gt;</span><span class="n">ShowIfNotEnable</span> <span class="o">=</span> <span class="n">tmp</span><span class="p">.</span><span class="n">ShowIfNotEnable</span><span class="p">;</span>
		<span class="n">decovar</span><span class="o">-&gt;</span><span class="n">ShowWhenNull</span> <span class="o">=</span> <span class="n">tmp</span><span class="p">.</span><span class="n">ShowWhenNull</span><span class="p">;</span>
		<span class="n">decovar</span><span class="o">-&gt;</span><span class="n">HideHalf</span> <span class="o">=</span> <span class="n">tmp</span><span class="p">.</span><span class="n">HideHalf</span><span class="p">;</span>
		<span class="n">decovar</span><span class="o">-&gt;</span><span class="n">ShowWhenMax</span> <span class="o">=</span> <span class="n">tmp</span><span class="p">.</span><span class="n">ShowWhenMax</span><span class="p">;</span>
		<span class="n">decovar</span><span class="o">-&gt;</span><span class="n">ShowOnlySelected</span> <span class="o">=</span> <span class="n">tmp</span><span class="p">.</span><span class="n">ShowOnlySelected</span><span class="p">;</span>
		<span class="n">decovar</span><span class="o">-&gt;</span><span class="n">HideNeutral</span> <span class="o">=</span> <span class="n">tmp</span><span class="p">.</span><span class="n">HideNeutral</span><span class="p">;</span>
		<span class="n">decovar</span><span class="o">-&gt;</span><span class="n">HideAllied</span> <span class="o">=</span> <span class="n">tmp</span><span class="p">.</span><span class="n">HideAllied</span><span class="p">;</span>
		<span class="n">decovar</span><span class="o">-&gt;</span><span class="n">ShowOpponent</span> <span class="o">=</span> <span class="n">tmp</span><span class="p">.</span><span class="n">ShowOpponent</span><span class="p">;</span>
		<span class="n">UnitTypeVar</span><span class="p">.</span><span class="n">DecoVar</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">decovar</span><span class="p">);</span>
	<span class="p">}</span>
	<span class="n">Assert</span><span class="p">(</span><span class="n">lua_gettop</span><span class="p">(</span><span class="n">l</span><span class="p">));</span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</p>
                          </details>
                        </details>
                        
                        <details>
                        <summary>DefineExtraDeathTypes</summary>
                        <p><br>  Define default extra death types.<br><br>  @param l  Lua state.</p>
                          <details>
                          <summary>/unit/script_unittype.cpp:1949 CclDefineExtraDeathTypes</summary>
                          <p><div class="highlight"><pre><span></span><span class="k">static</span> <span class="kt">int</span> <span class="nf">CclDefineExtraDeathTypes</span><span class="p">(</span><span class="n">lua_State</span> <span class="o">*</span><span class="n">l</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">args</span><span class="p">;</span>

	<span class="k">for</span> <span class="p">(</span><span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">ANIMATIONS_DEATHTYPES</span><span class="p">;</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">ExtraDeathTypes</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">clear</span><span class="p">();</span>
	<span class="p">}</span>
	<span class="n">args</span> <span class="o">=</span> <span class="n">lua_gettop</span><span class="p">(</span><span class="n">l</span><span class="p">);</span>
	<span class="k">for</span> <span class="p">(</span><span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">ANIMATIONS_DEATHTYPES</span> <span class="o">&amp;&amp;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">args</span><span class="p">;</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">ExtraDeathTypes</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">LuaToString</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>
	<span class="p">}</span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</p>
                          </details>
                        </details>
                        
                        <details>
                        <summary>UnitType</summary>
                        <p><br>  Get unit-type structure.<br><br>  @param l  Lua state.<br><br>  @return   Unit-type structure.</p>
                          <details>
                          <summary>/unit/script_unittype.cpp:1342 CclUnitType</summary>
                          <p><div class="highlight"><pre><span></span><span class="k">static</span> <span class="kt">int</span> <span class="nf">CclUnitType</span><span class="p">(</span><span class="n">lua_State</span> <span class="o">*</span><span class="n">l</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">LuaCheckArgs</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>

	<span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">str</span> <span class="o">=</span> <span class="n">LuaToString</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
	<span class="n">CUnitType</span> <span class="o">*</span><span class="n">type</span> <span class="o">=</span> <span class="n">UnitTypeByIdent</span><span class="p">(</span><span class="n">str</span><span class="p">);</span>
	<span class="n">LuaUserData</span> <span class="o">*</span><span class="n">data</span> <span class="o">=</span> <span class="p">(</span><span class="n">LuaUserData</span> <span class="o">*</span><span class="p">)</span><span class="n">lua_newuserdata</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">LuaUserData</span><span class="p">));</span>
	<span class="n">data</span><span class="o">-&gt;</span><span class="n">Type</span> <span class="o">=</span> <span class="n">LuaUnitType</span><span class="p">;</span>
	<span class="n">data</span><span class="o">-&gt;</span><span class="n">Data</span> <span class="o">=</span> <span class="n">type</span><span class="p">;</span>
	<span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</p>
                          </details>
                        </details>
                        
                        <details>
                        <summary>UnitTypeArray</summary>
                        <p><br>  Get all unit-type structures.<br><br>  @param l  Lua state.<br><br>  @return   An array of all unit-type structures.</p>
                          <details>
                          <summary>/unit/script_unittype.cpp:1364 CclUnitTypeArray</summary>
                          <p><div class="highlight"><pre><span></span><span class="k">static</span> <span class="kt">int</span> <span class="nf">CclUnitTypeArray</span><span class="p">(</span><span class="n">lua_State</span> <span class="o">*</span><span class="n">l</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">LuaCheckArgs</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>

	<span class="n">lua_newtable</span><span class="p">(</span><span class="n">l</span><span class="p">);</span>

	<span class="k">for</span> <span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">CUnitType</span> <span class="o">*&gt;::</span><span class="n">size_type</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">UnitTypes</span><span class="p">.</span><span class="n">size</span><span class="p">();</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">LuaUserData</span> <span class="o">*</span><span class="n">data</span> <span class="o">=</span> <span class="p">(</span><span class="n">LuaUserData</span> <span class="o">*</span><span class="p">)</span><span class="n">lua_newuserdata</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">LuaUserData</span><span class="p">));</span>
		<span class="n">data</span><span class="o">-&gt;</span><span class="n">Type</span> <span class="o">=</span> <span class="n">LuaUnitType</span><span class="p">;</span>
		<span class="n">data</span><span class="o">-&gt;</span><span class="n">Data</span> <span class="o">=</span> <span class="n">UnitTypes</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
		<span class="n">lua_rawseti</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>
	<span class="p">}</span>
	<span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</p>
                          </details>
                        </details>
                        
                        <details>
                        <summary>GetUnitTypeIdent</summary>
                        <p><br>  Get the ident of the unit-type structure.<br><br>  @param l  Lua state.<br><br>  @return   The identifier of the unit-type.</p>
                          <details>
                          <summary>/unit/script_unittype.cpp:1384 CclGetUnitTypeIdent</summary>
                          <p><div class="highlight"><pre><span></span><span class="k">static</span> <span class="kt">int</span> <span class="nf">CclGetUnitTypeIdent</span><span class="p">(</span><span class="n">lua_State</span> <span class="o">*</span><span class="n">l</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">LuaCheckArgs</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>

	<span class="k">const</span> <span class="n">CUnitType</span> <span class="o">*</span><span class="n">type</span> <span class="o">=</span> <span class="n">CclGetUnitType</span><span class="p">(</span><span class="n">l</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">type</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">lua_pushstring</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">type</span><span class="o">-&gt;</span><span class="n">Ident</span><span class="p">.</span><span class="n">c_str</span><span class="p">());</span>
	<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
		<span class="n">LuaError</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="s">&quot;unit &#39;%s&#39; not defined&quot;</span> <span class="n">_C_</span> <span class="n">LuaToString</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">-1</span><span class="p">));</span>
	<span class="p">}</span>
	<span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</p>
                          </details>
                        </details>
                        
                        <details>
                        <summary>GetUnitTypeName</summary>
                        <p><br> <b>Description</b><br><br>  Get the name of the unit-type structure.<br><br>  @param l  Lua state.<br><br>  @return   The name of the unit-type.<br><br> Example:<br><br> <div class="example"><code>name = <strong>GetUnitTypeName</strong>("unit-knight")<br>		  print(name)</code></div></p>
                          <details>
                          <summary>/unit/script_unittype.cpp:1407 CclGetUnitTypeName</summary>
                          <p><div class="highlight"><pre><span></span><span class="k">static</span> <span class="kt">int</span> <span class="nf">CclGetUnitTypeName</span><span class="p">(</span><span class="n">lua_State</span> <span class="o">*</span><span class="n">l</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">LuaCheckArgs</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>

	<span class="k">const</span> <span class="n">CUnitType</span> <span class="o">*</span><span class="n">type</span> <span class="o">=</span> <span class="n">CclGetUnitType</span><span class="p">(</span><span class="n">l</span><span class="p">);</span>
	<span class="n">lua_pushstring</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">type</span><span class="o">-&gt;</span><span class="n">Name</span><span class="p">.</span><span class="n">c_str</span><span class="p">());</span>
	<span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</p>
                          </details>
                        </details>
                        
                        <details>
                        <summary>SetUnitTypeName</summary>
                        <p><br> <b>Description</b><br><br>  Set the name of the unit-type structure.<br><br>  @param l  Lua state.<br><br>  @return   The name of the unit-type.<br><br> Example:<br><br> <div class="example"><code><strong>SetUnitTypeName</strong>("unit-beast-cry","Doomhammer")</code></div></p>
                          <details>
                          <summary>/unit/script_unittype.cpp:1433 CclSetUnitTypeName</summary>
                          <p><div class="highlight"><pre><span></span><span class="k">static</span> <span class="kt">int</span> <span class="nf">CclSetUnitTypeName</span><span class="p">(</span><span class="n">lua_State</span> <span class="o">*</span><span class="n">l</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">LuaCheckArgs</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">2</span><span class="p">);</span>

	<span class="n">lua_pushvalue</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
	<span class="n">CUnitType</span> <span class="o">*</span><span class="n">type</span> <span class="o">=</span> <span class="n">CclGetUnitType</span><span class="p">(</span><span class="n">l</span><span class="p">);</span>
	<span class="n">lua_pop</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
	<span class="n">type</span><span class="o">-&gt;</span><span class="n">Name</span> <span class="o">=</span> <span class="n">LuaToString</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">2</span><span class="p">);</span>

	<span class="n">lua_pushvalue</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">2</span><span class="p">);</span>
	<span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</p>
                          </details>
                        </details>
                        
                        <details>
                        <summary>GetUnitTypeData</summary>
                        <p><br> <b>Description</b><br><br>  Get unit type data.<br><br>  @param l  Lua state.<br><br> Example:<br><br> <div class="example"><code>-- Get the amount of supply from Human Farms<br>		  supply = <strong>GetUnitTypeData</strong>("unit-farm","Supply")<br>		  print(supply)</code></div></p>
                          <details>
                          <summary>/unit/script_unittype.cpp:1657 CclGetUnitTypeData</summary>
                          <p><div class="highlight"><pre><span></span><span class="k">static</span> <span class="kt">int</span> <span class="nf">CclGetUnitTypeData</span><span class="p">(</span><span class="n">lua_State</span> <span class="o">*</span><span class="n">l</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">lua_gettop</span><span class="p">(</span><span class="n">l</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">LuaError</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="s">&quot;incorrect argument&quot;</span><span class="p">);</span>
	<span class="p">}</span>
	<span class="n">lua_pushvalue</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
	<span class="k">const</span> <span class="n">CUnitType</span> <span class="o">*</span><span class="n">type</span> <span class="o">=</span> <span class="n">CclGetUnitType</span><span class="p">(</span><span class="n">l</span><span class="p">);</span>
	<span class="n">lua_pop</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
	<span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">data</span> <span class="o">=</span> <span class="n">LuaToString</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">2</span><span class="p">);</span>

	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="s">&quot;Name&quot;</span><span class="p">))</span> <span class="p">{</span>
		<span class="n">lua_pushstring</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">type</span><span class="o">-&gt;</span><span class="n">Name</span><span class="p">.</span><span class="n">c_str</span><span class="p">());</span>
		<span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
	<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="s">&quot;Icon&quot;</span><span class="p">))</span> <span class="p">{</span>
		<span class="n">lua_pushstring</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">type</span><span class="o">-&gt;</span><span class="n">Icon</span><span class="p">.</span><span class="n">Name</span><span class="p">.</span><span class="n">c_str</span><span class="p">());</span>
		<span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
	<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="s">&quot;Costs&quot;</span><span class="p">))</span> <span class="p">{</span>
		<span class="n">LuaCheckArgs</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">3</span><span class="p">);</span>
		<span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">res</span> <span class="o">=</span> <span class="n">LuaToString</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">3</span><span class="p">);</span>
		<span class="k">const</span> <span class="kt">int</span> <span class="n">resId</span> <span class="o">=</span> <span class="n">GetResourceIdByName</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">res</span><span class="p">.</span><span class="n">c_str</span><span class="p">());</span>
		<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">GameRunning</span> <span class="o">&amp;&amp;</span> <span class="n">Editor</span><span class="p">.</span><span class="n">Running</span> <span class="o">!=</span> <span class="n">EditorEditing</span><span class="p">)</span> <span class="p">{</span>
			<span class="n">lua_pushnumber</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">type</span><span class="o">-&gt;</span><span class="n">DefaultStat</span><span class="p">.</span><span class="n">Costs</span><span class="p">[</span><span class="n">resId</span><span class="p">]);</span>
		<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
			<span class="n">lua_pushnumber</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">type</span><span class="o">-&gt;</span><span class="n">MapDefaultStat</span><span class="p">.</span><span class="n">Costs</span><span class="p">[</span><span class="n">resId</span><span class="p">]);</span>
		<span class="p">}</span>
		<span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
	<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="s">&quot;ImproveProduction&quot;</span><span class="p">))</span> <span class="p">{</span>
		<span class="n">LuaCheckArgs</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">3</span><span class="p">);</span>
		<span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">res</span> <span class="o">=</span> <span class="n">LuaToString</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">3</span><span class="p">);</span>
		<span class="k">const</span> <span class="kt">int</span> <span class="n">resId</span> <span class="o">=</span> <span class="n">GetResourceIdByName</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">res</span><span class="p">.</span><span class="n">c_str</span><span class="p">());</span>
		<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">GameRunning</span> <span class="o">&amp;&amp;</span> <span class="n">Editor</span><span class="p">.</span><span class="n">Running</span> <span class="o">!=</span> <span class="n">EditorEditing</span><span class="p">)</span> <span class="p">{</span>
			<span class="n">lua_pushnumber</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">type</span><span class="o">-&gt;</span><span class="n">DefaultStat</span><span class="p">.</span><span class="n">ImproveIncomes</span><span class="p">[</span><span class="n">resId</span><span class="p">]);</span>
		<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
			<span class="n">lua_pushnumber</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">type</span><span class="o">-&gt;</span><span class="n">MapDefaultStat</span><span class="p">.</span><span class="n">ImproveIncomes</span><span class="p">[</span><span class="n">resId</span><span class="p">]);</span>
		<span class="p">}</span>
		<span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
	<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="s">&quot;DrawLevel&quot;</span><span class="p">))</span> <span class="p">{</span>
		<span class="n">lua_pushnumber</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">type</span><span class="o">-&gt;</span><span class="n">DrawLevel</span><span class="p">);</span>
		<span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
	<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="s">&quot;TileWidth&quot;</span><span class="p">))</span> <span class="p">{</span>
		<span class="n">lua_pushnumber</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">type</span><span class="o">-&gt;</span><span class="n">TileWidth</span><span class="p">);</span>
		<span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
	<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="s">&quot;TileHeight&quot;</span><span class="p">))</span> <span class="p">{</span>
		<span class="n">lua_pushnumber</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">type</span><span class="o">-&gt;</span><span class="n">TileHeight</span><span class="p">);</span>
		<span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
	<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="s">&quot;ComputerReactionRange&quot;</span><span class="p">))</span> <span class="p">{</span>
		<span class="n">lua_pushnumber</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">type</span><span class="o">-&gt;</span><span class="n">ReactRangeComputer</span><span class="p">);</span>
		<span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
	<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="s">&quot;PersonReactionRange&quot;</span><span class="p">))</span> <span class="p">{</span>
		<span class="n">lua_pushnumber</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">type</span><span class="o">-&gt;</span><span class="n">ReactRangePerson</span><span class="p">);</span>
		<span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
	<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="s">&quot;Missile&quot;</span><span class="p">))</span> <span class="p">{</span>
		<span class="n">lua_pushstring</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">type</span><span class="o">-&gt;</span><span class="n">Missile</span><span class="p">.</span><span class="n">Name</span><span class="p">.</span><span class="n">c_str</span><span class="p">());</span>
		<span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
	<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="s">&quot;MinAttackRange&quot;</span><span class="p">))</span> <span class="p">{</span>
		<span class="n">lua_pushnumber</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">type</span><span class="o">-&gt;</span><span class="n">MinAttackRange</span><span class="p">);</span>
		<span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
	<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="s">&quot;MaxAttackRange&quot;</span><span class="p">))</span> <span class="p">{</span>
		<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">GameRunning</span> <span class="o">&amp;&amp;</span> <span class="n">Editor</span><span class="p">.</span><span class="n">Running</span> <span class="o">!=</span> <span class="n">EditorEditing</span><span class="p">)</span> <span class="p">{</span>
			<span class="n">lua_pushnumber</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">type</span><span class="o">-&gt;</span><span class="n">DefaultStat</span><span class="p">.</span><span class="n">Variables</span><span class="p">[</span><span class="n">ATTACKRANGE_INDEX</span><span class="p">].</span><span class="n">Value</span><span class="p">);</span>
		<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
			<span class="n">lua_pushnumber</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">type</span><span class="o">-&gt;</span><span class="n">MapDefaultStat</span><span class="p">.</span><span class="n">Variables</span><span class="p">[</span><span class="n">ATTACKRANGE_INDEX</span><span class="p">].</span><span class="n">Value</span><span class="p">);</span>
		<span class="p">}</span>
		<span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
	<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="s">&quot;Priority&quot;</span><span class="p">))</span> <span class="p">{</span>
		<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">GameRunning</span> <span class="o">&amp;&amp;</span> <span class="n">Editor</span><span class="p">.</span><span class="n">Running</span> <span class="o">!=</span> <span class="n">EditorEditing</span><span class="p">)</span> <span class="p">{</span>
			<span class="n">lua_pushnumber</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">type</span><span class="o">-&gt;</span><span class="n">DefaultStat</span><span class="p">.</span><span class="n">Variables</span><span class="p">[</span><span class="n">PRIORITY_INDEX</span><span class="p">].</span><span class="n">Value</span><span class="p">);</span>
		<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
			<span class="n">lua_pushnumber</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">type</span><span class="o">-&gt;</span><span class="n">MapDefaultStat</span><span class="p">.</span><span class="n">Variables</span><span class="p">[</span><span class="n">PRIORITY_INDEX</span><span class="p">].</span><span class="n">Value</span><span class="p">);</span>
		<span class="p">}</span>
		<span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
	<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="s">&quot;Type&quot;</span><span class="p">))</span> <span class="p">{</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">type</span><span class="o">-&gt;</span><span class="n">UnitType</span> <span class="o">==</span> <span class="n">UnitTypeLand</span><span class="p">)</span> <span class="p">{</span>
			<span class="n">lua_pushstring</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="s">&quot;land&quot;</span><span class="p">);</span>
			<span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
		<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">type</span><span class="o">-&gt;</span><span class="n">UnitType</span> <span class="o">==</span> <span class="n">UnitTypeFly</span><span class="p">)</span> <span class="p">{</span>
			<span class="n">lua_pushstring</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="s">&quot;fly&quot;</span><span class="p">);</span>
			<span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
		<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">type</span><span class="o">-&gt;</span><span class="n">UnitType</span> <span class="o">==</span> <span class="n">UnitTypeNaval</span><span class="p">)</span> <span class="p">{</span>
			<span class="n">lua_pushstring</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="s">&quot;naval&quot;</span><span class="p">);</span>
			<span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
		<span class="p">}</span>
	<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="s">&quot;Corpse&quot;</span><span class="p">))</span> <span class="p">{</span>
		<span class="n">lua_pushstring</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">type</span><span class="o">-&gt;</span><span class="n">CorpseName</span><span class="p">.</span><span class="n">c_str</span><span class="p">());</span>
		<span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
	<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="s">&quot;CanAttack&quot;</span><span class="p">))</span> <span class="p">{</span>
		<span class="n">lua_pushboolean</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">type</span><span class="o">-&gt;</span><span class="n">CanAttack</span><span class="p">);</span>
		<span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
	<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="s">&quot;Building&quot;</span><span class="p">))</span> <span class="p">{</span>
		<span class="n">lua_pushboolean</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">type</span><span class="o">-&gt;</span><span class="n">Building</span><span class="p">);</span>
		<span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
	<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="s">&quot;LandUnit&quot;</span><span class="p">))</span> <span class="p">{</span>
		<span class="n">lua_pushboolean</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">type</span><span class="o">-&gt;</span><span class="n">LandUnit</span><span class="p">);</span>
		<span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
	<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="s">&quot;GivesResource&quot;</span><span class="p">))</span> <span class="p">{</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">type</span><span class="o">-&gt;</span><span class="n">GivesResource</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
			<span class="n">lua_pushstring</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">DefaultResourceNames</span><span class="p">[</span><span class="n">type</span><span class="o">-&gt;</span><span class="n">GivesResource</span><span class="p">].</span><span class="n">c_str</span><span class="p">());</span>
			<span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
		<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
			<span class="n">lua_pushstring</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="s">&quot;&quot;</span><span class="p">);</span>
			<span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
		<span class="p">}</span>
	<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="s">&quot;Sounds&quot;</span><span class="p">))</span> <span class="p">{</span>
		<span class="n">LuaCheckArgs</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">3</span><span class="p">);</span>
		<span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">sound_type</span> <span class="o">=</span> <span class="n">LuaToString</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">3</span><span class="p">);</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">sound_type</span> <span class="o">==</span> <span class="s">&quot;selected&quot;</span><span class="p">)</span> <span class="p">{</span>
			<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">GameRunning</span> <span class="o">&amp;&amp;</span> <span class="n">Editor</span><span class="p">.</span><span class="n">Running</span> <span class="o">!=</span> <span class="n">EditorEditing</span><span class="p">)</span> <span class="p">{</span>
				<span class="n">lua_pushstring</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">type</span><span class="o">-&gt;</span><span class="n">Sound</span><span class="p">.</span><span class="n">Selected</span><span class="p">.</span><span class="n">Name</span><span class="p">.</span><span class="n">c_str</span><span class="p">());</span>
			<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
				<span class="n">lua_pushstring</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">type</span><span class="o">-&gt;</span><span class="n">MapSound</span><span class="p">.</span><span class="n">Selected</span><span class="p">.</span><span class="n">Name</span><span class="p">.</span><span class="n">c_str</span><span class="p">());</span>
			<span class="p">}</span>
		<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">sound_type</span> <span class="o">==</span> <span class="s">&quot;acknowledge&quot;</span><span class="p">)</span> <span class="p">{</span>
			<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">GameRunning</span> <span class="o">&amp;&amp;</span> <span class="n">Editor</span><span class="p">.</span><span class="n">Running</span> <span class="o">!=</span> <span class="n">EditorEditing</span><span class="p">)</span> <span class="p">{</span>
				<span class="n">lua_pushstring</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">type</span><span class="o">-&gt;</span><span class="n">Sound</span><span class="p">.</span><span class="n">Acknowledgement</span><span class="p">.</span><span class="n">Name</span><span class="p">.</span><span class="n">c_str</span><span class="p">());</span>
			<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
				<span class="n">lua_pushstring</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">type</span><span class="o">-&gt;</span><span class="n">MapSound</span><span class="p">.</span><span class="n">Acknowledgement</span><span class="p">.</span><span class="n">Name</span><span class="p">.</span><span class="n">c_str</span><span class="p">());</span>
			<span class="p">}</span>
		<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">sound_type</span> <span class="o">==</span> <span class="s">&quot;attack&quot;</span><span class="p">)</span> <span class="p">{</span>
			<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">GameRunning</span> <span class="o">&amp;&amp;</span> <span class="n">Editor</span><span class="p">.</span><span class="n">Running</span> <span class="o">!=</span> <span class="n">EditorEditing</span><span class="p">)</span> <span class="p">{</span>
				<span class="n">lua_pushstring</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">type</span><span class="o">-&gt;</span><span class="n">Sound</span><span class="p">.</span><span class="n">Attack</span><span class="p">.</span><span class="n">Name</span><span class="p">.</span><span class="n">c_str</span><span class="p">());</span>
			<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
				<span class="n">lua_pushstring</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">type</span><span class="o">-&gt;</span><span class="n">MapSound</span><span class="p">.</span><span class="n">Attack</span><span class="p">.</span><span class="n">Name</span><span class="p">.</span><span class="n">c_str</span><span class="p">());</span>
			<span class="p">}</span>
		<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">sound_type</span> <span class="o">==</span> <span class="s">&quot;build&quot;</span><span class="p">)</span> <span class="p">{</span>
			<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">GameRunning</span> <span class="o">&amp;&amp;</span> <span class="n">Editor</span><span class="p">.</span><span class="n">Running</span> <span class="o">!=</span> <span class="n">EditorEditing</span><span class="p">)</span> <span class="p">{</span>
				<span class="n">lua_pushstring</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">type</span><span class="o">-&gt;</span><span class="n">Sound</span><span class="p">.</span><span class="n">Build</span><span class="p">.</span><span class="n">Name</span><span class="p">.</span><span class="n">c_str</span><span class="p">());</span>
			<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
				<span class="n">lua_pushstring</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">type</span><span class="o">-&gt;</span><span class="n">MapSound</span><span class="p">.</span><span class="n">Build</span><span class="p">.</span><span class="n">Name</span><span class="p">.</span><span class="n">c_str</span><span class="p">());</span>
			<span class="p">}</span>
		<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">sound_type</span> <span class="o">==</span> <span class="s">&quot;ready&quot;</span><span class="p">)</span> <span class="p">{</span>
			<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">GameRunning</span> <span class="o">&amp;&amp;</span> <span class="n">Editor</span><span class="p">.</span><span class="n">Running</span> <span class="o">!=</span> <span class="n">EditorEditing</span><span class="p">)</span> <span class="p">{</span>
				<span class="n">lua_pushstring</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">type</span><span class="o">-&gt;</span><span class="n">Sound</span><span class="p">.</span><span class="n">Ready</span><span class="p">.</span><span class="n">Name</span><span class="p">.</span><span class="n">c_str</span><span class="p">());</span>
			<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
				<span class="n">lua_pushstring</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">type</span><span class="o">-&gt;</span><span class="n">MapSound</span><span class="p">.</span><span class="n">Ready</span><span class="p">.</span><span class="n">Name</span><span class="p">.</span><span class="n">c_str</span><span class="p">());</span>
			<span class="p">}</span>
		<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">sound_type</span> <span class="o">==</span> <span class="s">&quot;repair&quot;</span><span class="p">)</span> <span class="p">{</span>
			<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">GameRunning</span> <span class="o">&amp;&amp;</span> <span class="n">Editor</span><span class="p">.</span><span class="n">Running</span> <span class="o">!=</span> <span class="n">EditorEditing</span><span class="p">)</span> <span class="p">{</span>
				<span class="n">lua_pushstring</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">type</span><span class="o">-&gt;</span><span class="n">Sound</span><span class="p">.</span><span class="n">Repair</span><span class="p">.</span><span class="n">Name</span><span class="p">.</span><span class="n">c_str</span><span class="p">());</span>
			<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
				<span class="n">lua_pushstring</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">type</span><span class="o">-&gt;</span><span class="n">MapSound</span><span class="p">.</span><span class="n">Repair</span><span class="p">.</span><span class="n">Name</span><span class="p">.</span><span class="n">c_str</span><span class="p">());</span>
			<span class="p">}</span>
		<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">sound_type</span> <span class="o">==</span> <span class="s">&quot;harvest&quot;</span><span class="p">)</span> <span class="p">{</span>
			<span class="n">LuaCheckArgs</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">4</span><span class="p">);</span>
			<span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">sound_subtype</span> <span class="o">=</span> <span class="n">LuaToString</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">4</span><span class="p">);</span>
			<span class="k">const</span> <span class="kt">int</span> <span class="n">resId</span> <span class="o">=</span> <span class="n">GetResourceIdByName</span><span class="p">(</span><span class="n">sound_subtype</span><span class="p">.</span><span class="n">c_str</span><span class="p">());</span>
			<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">GameRunning</span> <span class="o">&amp;&amp;</span> <span class="n">Editor</span><span class="p">.</span><span class="n">Running</span> <span class="o">!=</span> <span class="n">EditorEditing</span><span class="p">)</span> <span class="p">{</span>
				<span class="n">lua_pushstring</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">type</span><span class="o">-&gt;</span><span class="n">Sound</span><span class="p">.</span><span class="n">Harvest</span><span class="p">[</span><span class="n">resId</span><span class="p">].</span><span class="n">Name</span><span class="p">.</span><span class="n">c_str</span><span class="p">());</span>
			<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
				<span class="n">lua_pushstring</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">type</span><span class="o">-&gt;</span><span class="n">MapSound</span><span class="p">.</span><span class="n">Harvest</span><span class="p">[</span><span class="n">resId</span><span class="p">].</span><span class="n">Name</span><span class="p">.</span><span class="n">c_str</span><span class="p">());</span>
			<span class="p">}</span>
		<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">sound_type</span> <span class="o">==</span> <span class="s">&quot;help&quot;</span><span class="p">)</span> <span class="p">{</span>
			<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">GameRunning</span> <span class="o">&amp;&amp;</span> <span class="n">Editor</span><span class="p">.</span><span class="n">Running</span> <span class="o">!=</span> <span class="n">EditorEditing</span><span class="p">)</span> <span class="p">{</span>
				<span class="n">lua_pushstring</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">type</span><span class="o">-&gt;</span><span class="n">Sound</span><span class="p">.</span><span class="n">Help</span><span class="p">.</span><span class="n">Name</span><span class="p">.</span><span class="n">c_str</span><span class="p">());</span>
			<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
				<span class="n">lua_pushstring</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">type</span><span class="o">-&gt;</span><span class="n">MapSound</span><span class="p">.</span><span class="n">Help</span><span class="p">.</span><span class="n">Name</span><span class="p">.</span><span class="n">c_str</span><span class="p">());</span>
			<span class="p">}</span>
		<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">sound_type</span> <span class="o">==</span> <span class="s">&quot;dead&quot;</span><span class="p">)</span> <span class="p">{</span>
			<span class="k">if</span> <span class="p">(</span><span class="n">lua_gettop</span><span class="p">(</span><span class="n">l</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">4</span><span class="p">)</span> <span class="p">{</span>
				<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">GameRunning</span> <span class="o">&amp;&amp;</span> <span class="n">Editor</span><span class="p">.</span><span class="n">Running</span> <span class="o">!=</span> <span class="n">EditorEditing</span><span class="p">)</span> <span class="p">{</span>
					<span class="n">lua_pushstring</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">type</span><span class="o">-&gt;</span><span class="n">Sound</span><span class="p">.</span><span class="n">Dead</span><span class="p">[</span><span class="n">ANIMATIONS_DEATHTYPES</span><span class="p">].</span><span class="n">Name</span><span class="p">.</span><span class="n">c_str</span><span class="p">());</span>
				<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
					<span class="n">lua_pushstring</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">type</span><span class="o">-&gt;</span><span class="n">MapSound</span><span class="p">.</span><span class="n">Dead</span><span class="p">[</span><span class="n">ANIMATIONS_DEATHTYPES</span><span class="p">].</span><span class="n">Name</span><span class="p">.</span><span class="n">c_str</span><span class="p">());</span>
				<span class="p">}</span>
			<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
				<span class="kt">int</span> <span class="n">death</span><span class="p">;</span>
				<span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">sound_subtype</span> <span class="o">=</span> <span class="n">LuaToString</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">4</span><span class="p">);</span>

				<span class="k">for</span> <span class="p">(</span><span class="n">death</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">death</span> <span class="o">&lt;</span> <span class="n">ANIMATIONS_DEATHTYPES</span><span class="p">;</span> <span class="o">++</span><span class="n">death</span><span class="p">)</span> <span class="p">{</span>
					<span class="k">if</span> <span class="p">(</span><span class="n">sound_subtype</span> <span class="o">==</span> <span class="n">ExtraDeathTypes</span><span class="p">[</span><span class="n">death</span><span class="p">])</span> <span class="p">{</span>
						<span class="k">break</span><span class="p">;</span>
					<span class="p">}</span>
				<span class="p">}</span>
				<span class="k">if</span> <span class="p">(</span><span class="n">death</span> <span class="o">==</span> <span class="n">ANIMATIONS_DEATHTYPES</span><span class="p">)</span> <span class="p">{</span>
					<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">GameRunning</span> <span class="o">&amp;&amp;</span> <span class="n">Editor</span><span class="p">.</span><span class="n">Running</span> <span class="o">!=</span> <span class="n">EditorEditing</span><span class="p">)</span> <span class="p">{</span>
						<span class="n">lua_pushstring</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">type</span><span class="o">-&gt;</span><span class="n">Sound</span><span class="p">.</span><span class="n">Dead</span><span class="p">[</span><span class="n">ANIMATIONS_DEATHTYPES</span><span class="p">].</span><span class="n">Name</span><span class="p">.</span><span class="n">c_str</span><span class="p">());</span>
					<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
						<span class="n">lua_pushstring</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">type</span><span class="o">-&gt;</span><span class="n">MapSound</span><span class="p">.</span><span class="n">Dead</span><span class="p">[</span><span class="n">ANIMATIONS_DEATHTYPES</span><span class="p">].</span><span class="n">Name</span><span class="p">.</span><span class="n">c_str</span><span class="p">());</span>
					<span class="p">}</span>
				<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
					<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">GameRunning</span> <span class="o">&amp;&amp;</span> <span class="n">Editor</span><span class="p">.</span><span class="n">Running</span> <span class="o">!=</span> <span class="n">EditorEditing</span><span class="p">)</span> <span class="p">{</span>
						<span class="n">lua_pushstring</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">type</span><span class="o">-&gt;</span><span class="n">Sound</span><span class="p">.</span><span class="n">Dead</span><span class="p">[</span><span class="n">death</span><span class="p">].</span><span class="n">Name</span><span class="p">.</span><span class="n">c_str</span><span class="p">());</span>
					<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
						<span class="n">lua_pushstring</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">type</span><span class="o">-&gt;</span><span class="n">MapSound</span><span class="p">.</span><span class="n">Dead</span><span class="p">[</span><span class="n">death</span><span class="p">].</span><span class="n">Name</span><span class="p">.</span><span class="n">c_str</span><span class="p">());</span>
					<span class="p">}</span>
				<span class="p">}</span>
			<span class="p">}</span>
		<span class="p">}</span>
		<span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
	<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
		<span class="kt">int</span> <span class="n">index</span> <span class="o">=</span> <span class="n">UnitTypeVar</span><span class="p">.</span><span class="n">VariableNameLookup</span><span class="p">[</span><span class="n">data</span><span class="p">];</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">index</span> <span class="o">!=</span> <span class="mi">-1</span><span class="p">)</span> <span class="p">{</span> <span class="c1">// valid index</span>
			<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">GameRunning</span> <span class="o">&amp;&amp;</span> <span class="n">Editor</span><span class="p">.</span><span class="n">Running</span> <span class="o">!=</span> <span class="n">EditorEditing</span><span class="p">)</span> <span class="p">{</span>
				<span class="n">lua_pushnumber</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">type</span><span class="o">-&gt;</span><span class="n">DefaultStat</span><span class="p">.</span><span class="n">Variables</span><span class="p">[</span><span class="n">index</span><span class="p">].</span><span class="n">Value</span><span class="p">);</span>
			<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
				<span class="n">lua_pushnumber</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">type</span><span class="o">-&gt;</span><span class="n">MapDefaultStat</span><span class="p">.</span><span class="n">Variables</span><span class="p">[</span><span class="n">index</span><span class="p">].</span><span class="n">Value</span><span class="p">);</span>
			<span class="p">}</span>
			<span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
		<span class="p">}</span>

		<span class="n">index</span> <span class="o">=</span> <span class="n">UnitTypeVar</span><span class="p">.</span><span class="n">BoolFlagNameLookup</span><span class="p">[</span><span class="n">data</span><span class="p">];</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">index</span> <span class="o">!=</span> <span class="mi">-1</span><span class="p">)</span> <span class="p">{</span>
			<span class="n">lua_pushboolean</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">type</span><span class="o">-&gt;</span><span class="n">BoolFlag</span><span class="p">[</span><span class="n">index</span><span class="p">].</span><span class="n">value</span><span class="p">);</span>
			<span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
		<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
			<span class="n">LuaError</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="s">&quot;Invalid field: %s&quot;</span> <span class="n">_C_</span> <span class="n">data</span><span class="p">);</span>
		<span class="p">}</span>
	<span class="p">}</span>

	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</p>
                          </details>
                        </details>
                        <hr>/unit/depend.cpp<hr>
                        <details>
                        <summary>DefineDependency</summary>
                        <p><br>  Define a new dependency.<br><br>  @param l  Lua state.</p>
                          <details>
                          <summary>/unit/depend.cpp:461 CclDefineDependency</summary>
                          <p><div class="highlight"><pre><span></span><span class="k">static</span> <span class="kt">int</span> <span class="nf">CclDefineDependency</span><span class="p">(</span><span class="n">lua_State</span> <span class="o">*</span><span class="n">l</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">const</span> <span class="kt">int</span> <span class="n">args</span> <span class="o">=</span> <span class="n">lua_gettop</span><span class="p">(</span><span class="n">l</span><span class="p">);</span>
	<span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">target</span> <span class="o">=</span> <span class="n">LuaToString</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>

	<span class="c1">//  All or rules.</span>
	<span class="kt">int</span> <span class="n">or_flag</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">j</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="n">args</span><span class="p">;</span> <span class="o">++</span><span class="n">j</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">lua_istable</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span> <span class="p">{</span>
			<span class="n">LuaError</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="s">&quot;incorrect argument&quot;</span><span class="p">);</span>
		<span class="p">}</span>
		<span class="k">const</span> <span class="kt">int</span> <span class="n">subargs</span> <span class="o">=</span> <span class="n">lua_rawlen</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>

		<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">k</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">k</span> <span class="o">&lt;</span> <span class="n">subargs</span><span class="p">;</span> <span class="o">++</span><span class="n">k</span><span class="p">)</span> <span class="p">{</span>
			<span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">required</span> <span class="o">=</span> <span class="n">LuaToString</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">k</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>
			<span class="kt">int</span> <span class="n">count</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
			<span class="k">if</span> <span class="p">(</span><span class="n">k</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">&lt;</span> <span class="n">subargs</span><span class="p">)</span> <span class="p">{</span>
				<span class="n">lua_rawgeti</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">k</span> <span class="o">+</span> <span class="mi">2</span><span class="p">);</span>
				<span class="k">if</span> <span class="p">(</span><span class="n">lua_isnumber</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">-1</span><span class="p">))</span> <span class="p">{</span>
					<span class="n">count</span> <span class="o">=</span> <span class="n">LuaToNumber</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">-1</span><span class="p">);</span>
					<span class="o">++</span><span class="n">k</span><span class="p">;</span>
				<span class="p">}</span>
				<span class="n">lua_pop</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
			<span class="p">}</span>
			<span class="n">AddDependency</span><span class="p">(</span><span class="n">target</span><span class="p">,</span> <span class="n">required</span><span class="p">,</span> <span class="n">count</span><span class="p">,</span> <span class="n">or_flag</span><span class="p">);</span>
			<span class="n">or_flag</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
		<span class="p">}</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">j</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">&lt;</span> <span class="n">args</span><span class="p">)</span> <span class="p">{</span>
			<span class="o">++</span><span class="n">j</span><span class="p">;</span>
			<span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">value</span> <span class="o">=</span> <span class="n">LuaToString</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>
			<span class="k">if</span> <span class="p">(</span><span class="n">strcmp</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s">&quot;or&quot;</span><span class="p">))</span> <span class="p">{</span>
				<span class="n">LuaError</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="s">&quot;not or symbol: %s&quot;</span> <span class="n">_C_</span> <span class="n">value</span><span class="p">);</span>
				<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
			<span class="p">}</span>
			<span class="n">or_flag</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
		<span class="p">}</span>
	<span class="p">}</span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</p>
                          </details>
                        </details>
                        
                        <details>
                        <summary>GetDependency</summary>
                        <p><br>  Get the dependency.<br><br>  @todo not written.<br><br>  @param l  Lua state.</p>
                          <details>
                          <summary>/unit/depend.cpp:475 CclGetDependency</summary>
                          <p><div class="highlight"><pre><span></span><span class="k">static</span> <span class="kt">int</span> <span class="nf">CclGetDependency</span><span class="p">(</span><span class="n">lua_State</span> <span class="o">*</span><span class="n">l</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">DebugPrint</span><span class="p">(</span><span class="s">&quot;FIXME: write this %p</span><span class="se">\n</span><span class="s">&quot;</span> <span class="n">_C_</span><span class="p">(</span><span class="kt">void</span> <span class="o">*</span><span class="p">)</span><span class="n">l</span><span class="p">);</span>

	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</p>
                          </details>
                        </details>
                        
                        <details>
                        <summary>CheckDependency</summary>
                        <p><br>  Checks if dependencies are met.<br><br>  @return true if the dependencies are met.<br><br>  @param l  Lua state.<br>  Argument 1: player<br>  Argument 2: object which we want to check the dependencies of</p>
                          <details>
                          <summary>/unit/depend.cpp:499 CclCheckDependency</summary>
                          <p><div class="highlight"><pre><span></span><span class="k">static</span> <span class="kt">int</span> <span class="nf">CclCheckDependency</span><span class="p">(</span><span class="n">lua_State</span> <span class="o">*</span><span class="n">l</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">LuaCheckArgs</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">2</span><span class="p">);</span>
	<span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">object</span> <span class="o">=</span> <span class="n">LuaToString</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">2</span><span class="p">);</span>
	<span class="n">lua_pop</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
	<span class="k">const</span> <span class="kt">int</span> <span class="n">plynr</span> <span class="o">=</span> <span class="n">TriggerGetPlayer</span><span class="p">(</span><span class="n">l</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">plynr</span> <span class="o">==</span> <span class="mi">-1</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">LuaError</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="s">&quot;bad player: %i&quot;</span> <span class="n">_C_</span> <span class="n">plynr</span><span class="p">);</span>
	<span class="p">}</span>
	<span class="n">CPlayer</span> <span class="o">&amp;</span><span class="n">player</span> <span class="o">=</span> <span class="n">Players</span><span class="p">[</span><span class="n">plynr</span><span class="p">];</span>

	<span class="n">lua_pushboolean</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">CheckDependByIdent</span><span class="p">(</span><span class="n">player</span><span class="p">,</span> <span class="n">object</span><span class="p">));</span>
	<span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</p>
                          </details>
                        </details>
                        <hr>/unit/script_unit.cpp<hr>
                        <details>
                        <summary>SetTrainingQueue</summary>
                        <p><br> <b>Description</b><br><br>  Set training queue<br><br>  @param l  Lua state.<br><br>  @return  The old state of the training queue<br><br> Example:<br><br> <div class="example"><code>-- Training queue available. Train multiple units.<br>		<strong>SetTrainingQueue</strong>(true)<br>		-- Train one unit at a time.<br>		<strong>SetTrainingQueue</strong>(false)</code></div></p>
                          <details>
                          <summary>/unit/script_unit.cpp:88 CclSetTrainingQueue</summary>
                          <p><div class="highlight"><pre><span></span><span class="k">static</span> <span class="kt">int</span> <span class="nf">CclSetTrainingQueue</span><span class="p">(</span><span class="n">lua_State</span> <span class="o">*</span><span class="n">l</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">LuaCheckArgs</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
	<span class="n">EnableTrainingQueue</span> <span class="o">=</span> <span class="n">LuaToBoolean</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</p>
                          </details>
                        </details>
                        
                        <details>
                        <summary>SetBuildingCapture</summary>
                        <p><br>  Set capture buildings<br><br>  @param l  Lua state.<br><br>  @return   The old state of the flag</p>
                          <details>
                          <summary>/unit/script_unit.cpp:102 CclSetBuildingCapture</summary>
                          <p><div class="highlight"><pre><span></span><span class="k">static</span> <span class="kt">int</span> <span class="nf">CclSetBuildingCapture</span><span class="p">(</span><span class="n">lua_State</span> <span class="o">*</span><span class="n">l</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">LuaCheckArgs</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
	<span class="n">EnableBuildingCapture</span> <span class="o">=</span> <span class="n">LuaToBoolean</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</p>
                          </details>
                        </details>
                        
                        <details>
                        <summary>SetRevealAttacker</summary>
                        <p><br>  Set reveal attacker<br><br>  @param l  Lua state.<br><br>  @return   The old state of the flag</p>
                          <details>
                          <summary>/unit/script_unit.cpp:116 CclSetRevealAttacker</summary>
                          <p><div class="highlight"><pre><span></span><span class="k">static</span> <span class="kt">int</span> <span class="nf">CclSetRevealAttacker</span><span class="p">(</span><span class="n">lua_State</span> <span class="o">*</span><span class="n">l</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">LuaCheckArgs</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
	<span class="n">RevealAttacker</span> <span class="o">=</span> <span class="n">LuaToBoolean</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</p>
                          </details>
                        </details>
                        
                        <details>
                        <summary>ResourcesMultiBuildersMultiplier</summary>
                        <p><br>  Set cost multiplier to RepairCost for buildings additional workers helping (0 = no additional cost)<br><br>  @param l  Lua state.</p>
                          <details>
                          <summary>/unit/script_unit.cpp:128 CclResourcesMultiBuildersMultiplier</summary>
                          <p><div class="highlight"><pre><span></span><span class="k">static</span> <span class="kt">int</span> <span class="nf">CclResourcesMultiBuildersMultiplier</span><span class="p">(</span><span class="n">lua_State</span> <span class="o">*</span><span class="n">l</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">LuaCheckArgs</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
	<span class="n">ResourcesMultiBuildersMultiplier</span> <span class="o">=</span> <span class="n">LuaToNumber</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</p>
                          </details>
                        </details>
                        
                        <details>
                        <summary>Unit</summary>
                        <p><br>  Parse unit<br><br>  @param l  Lua state.<br><br>  @todo  Verify that vision table is always correct (transporter)<br>  @todo (PlaceUnit() and host-info).</p>
                          <details>
                          <summary>/unit/script_unit.cpp:614 CclUnit</summary>
                          <p><div class="highlight"><pre><span></span><span class="k">static</span> <span class="kt">int</span> <span class="nf">CclUnit</span><span class="p">(</span><span class="n">lua_State</span> <span class="o">*</span><span class="n">l</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">const</span> <span class="kt">int</span> <span class="n">slot</span> <span class="o">=</span> <span class="n">LuaToNumber</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>

	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">lua_istable</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span> <span class="p">{</span>
		<span class="n">LuaError</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="s">&quot;incorrect argument&quot;</span><span class="p">);</span>
	<span class="p">}</span>

	<span class="n">CUnit</span> <span class="o">*</span><span class="n">unit</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">UnitManager</span><span class="p">.</span><span class="n">GetSlotUnit</span><span class="p">(</span><span class="n">slot</span><span class="p">);</span>
	<span class="n">CUnitType</span> <span class="o">*</span><span class="n">type</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">;</span>
	<span class="n">CUnitType</span> <span class="o">*</span><span class="n">seentype</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">;</span>
	<span class="n">CPlayer</span> <span class="o">*</span><span class="n">player</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">;</span>

	<span class="c1">// Parse the list:</span>
	<span class="k">const</span> <span class="kt">int</span> <span class="n">args</span> <span class="o">=</span> <span class="n">lua_rawlen</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">2</span><span class="p">);</span>
	<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="n">args</span><span class="p">;</span> <span class="o">++</span><span class="n">j</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">value</span> <span class="o">=</span> <span class="n">LuaToString</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>
		<span class="o">++</span><span class="n">j</span><span class="p">;</span>

		<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s">&quot;type&quot;</span><span class="p">))</span> <span class="p">{</span>
			<span class="n">type</span> <span class="o">=</span> <span class="n">UnitTypeByIdent</span><span class="p">(</span><span class="n">LuaToString</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">));</span>
		<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s">&quot;seen-type&quot;</span><span class="p">))</span> <span class="p">{</span>
			<span class="n">seentype</span> <span class="o">=</span> <span class="n">UnitTypeByIdent</span><span class="p">(</span><span class="n">LuaToString</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">));</span>
		<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s">&quot;player&quot;</span><span class="p">))</span> <span class="p">{</span>
			<span class="n">player</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">Players</span><span class="p">[</span><span class="n">LuaToNumber</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)];</span>

			<span class="c1">// During a unit&#39;s death animation (when action is &quot;die&quot; but the</span>
			<span class="c1">// unit still has its original type, i.e. it&#39;s still not a corpse)</span>
			<span class="c1">// the unit is already removed from map and from player&#39;s</span>
			<span class="c1">// unit list (=the unit went through LetUnitDie() which</span>
			<span class="c1">// calls RemoveUnit() and UnitLost()).  Such a unit should not</span>
			<span class="c1">// be put on player&#39;s unit list!  However, this state is not</span>
			<span class="c1">// easily detected from this place.  It seems that it is</span>
			<span class="c1">// characterized by</span>
			<span class="c1">// unit-&gt;CurrentAction()==UnitActionDie so we have to wait</span>
			<span class="c1">// until we parsed at least Unit::Orders[].</span>
			<span class="n">Assert</span><span class="p">(</span><span class="n">type</span><span class="p">);</span>
			<span class="n">unit</span><span class="o">-&gt;</span><span class="n">Init</span><span class="p">(</span><span class="o">*</span><span class="n">type</span><span class="p">);</span>
			<span class="n">unit</span><span class="o">-&gt;</span><span class="n">Seen</span><span class="p">.</span><span class="n">Type</span> <span class="o">=</span> <span class="n">seentype</span><span class="p">;</span>
			<span class="n">unit</span><span class="o">-&gt;</span><span class="n">Active</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
			<span class="n">unit</span><span class="o">-&gt;</span><span class="n">Removed</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
			<span class="n">Assert</span><span class="p">(</span><span class="n">UnitNumber</span><span class="p">(</span><span class="o">*</span><span class="n">unit</span><span class="p">)</span> <span class="o">==</span> <span class="n">slot</span><span class="p">);</span>
		<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s">&quot;current-sight-range&quot;</span><span class="p">))</span> <span class="p">{</span>
			<span class="n">unit</span><span class="o">-&gt;</span><span class="n">CurrentSightRange</span> <span class="o">=</span> <span class="n">LuaToNumber</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>
		<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s">&quot;refs&quot;</span><span class="p">))</span> <span class="p">{</span>
			<span class="n">unit</span><span class="o">-&gt;</span><span class="n">Refs</span> <span class="o">=</span> <span class="n">LuaToNumber</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>
		<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s">&quot;host-info&quot;</span><span class="p">))</span> <span class="p">{</span>
			<span class="n">lua_rawgeti</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>
			<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">lua_istable</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">-1</span><span class="p">)</span> <span class="o">||</span> <span class="n">lua_rawlen</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">-1</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">4</span><span class="p">)</span> <span class="p">{</span>
				<span class="n">LuaError</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="s">&quot;incorrect argument&quot;</span><span class="p">);</span>
			<span class="p">}</span>
			<span class="n">Vec2i</span> <span class="n">pos</span><span class="p">;</span>
			<span class="kt">int</span> <span class="n">w</span><span class="p">;</span>
			<span class="kt">int</span> <span class="n">h</span><span class="p">;</span>

			<span class="n">pos</span><span class="p">.</span><span class="n">x</span> <span class="o">=</span> <span class="n">LuaToNumber</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">-1</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
			<span class="n">pos</span><span class="p">.</span><span class="n">y</span> <span class="o">=</span> <span class="n">LuaToNumber</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">-1</span><span class="p">,</span> <span class="mi">2</span><span class="p">);</span>
			<span class="n">w</span> <span class="o">=</span> <span class="n">LuaToNumber</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">-1</span><span class="p">,</span> <span class="mi">3</span><span class="p">);</span>
			<span class="n">h</span> <span class="o">=</span> <span class="n">LuaToNumber</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">-1</span><span class="p">,</span> <span class="mi">4</span><span class="p">);</span>
			<span class="n">MapSight</span><span class="p">(</span><span class="o">*</span><span class="n">player</span><span class="p">,</span> <span class="o">*</span><span class="n">unit</span><span class="p">,</span> <span class="n">pos</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="n">h</span><span class="p">,</span> <span class="n">unit</span><span class="o">-&gt;</span><span class="n">CurrentSightRange</span><span class="p">,</span> <span class="n">MapMarkTileSight</span><span class="p">);</span>
			<span class="c1">// Detectcloak works in container</span>
			<span class="k">if</span> <span class="p">(</span><span class="n">unit</span><span class="o">-&gt;</span><span class="n">Type</span><span class="o">-&gt;</span><span class="n">BoolFlag</span><span class="p">[</span><span class="n">DETECTCLOAK_INDEX</span><span class="p">].</span><span class="n">value</span><span class="p">)</span> <span class="p">{</span>
				<span class="n">MapSight</span><span class="p">(</span><span class="o">*</span><span class="n">player</span><span class="p">,</span> <span class="o">*</span><span class="n">unit</span><span class="p">,</span> <span class="n">pos</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="n">h</span><span class="p">,</span> <span class="n">unit</span><span class="o">-&gt;</span><span class="n">CurrentSightRange</span><span class="p">,</span> <span class="n">MapMarkTileDetectCloak</span><span class="p">);</span>
			<span class="p">}</span>
			<span class="c1">// Radar(Jammer) not.</span>
			<span class="n">lua_pop</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
		<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s">&quot;tile&quot;</span><span class="p">))</span> <span class="p">{</span>
			<span class="n">lua_rawgeti</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>
			<span class="n">CclGetPos</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">unit</span><span class="o">-&gt;</span><span class="n">tilePos</span><span class="p">.</span><span class="n">x</span> <span class="p">,</span> <span class="o">&amp;</span><span class="n">unit</span><span class="o">-&gt;</span><span class="n">tilePos</span><span class="p">.</span><span class="n">y</span><span class="p">,</span> <span class="mi">-1</span><span class="p">);</span>
			<span class="n">lua_pop</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
			<span class="n">unit</span><span class="o">-&gt;</span><span class="n">Offset</span> <span class="o">=</span> <span class="n">Map</span><span class="p">.</span><span class="n">getIndex</span><span class="p">(</span><span class="n">unit</span><span class="o">-&gt;</span><span class="n">tilePos</span><span class="p">);</span>
		<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s">&quot;seen-tile&quot;</span><span class="p">))</span> <span class="p">{</span>
			<span class="n">lua_rawgeti</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>
			<span class="n">CclGetPos</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">unit</span><span class="o">-&gt;</span><span class="n">Seen</span><span class="p">.</span><span class="n">tilePos</span><span class="p">.</span><span class="n">x</span> <span class="p">,</span> <span class="o">&amp;</span><span class="n">unit</span><span class="o">-&gt;</span><span class="n">Seen</span><span class="p">.</span><span class="n">tilePos</span><span class="p">.</span><span class="n">y</span><span class="p">,</span> <span class="mi">-1</span><span class="p">);</span>
			<span class="n">lua_pop</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
		<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s">&quot;stats&quot;</span><span class="p">))</span> <span class="p">{</span>
			<span class="n">unit</span><span class="o">-&gt;</span><span class="n">Stats</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">type</span><span class="o">-&gt;</span><span class="n">Stats</span><span class="p">[</span><span class="n">LuaToNumber</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)];</span>
		<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s">&quot;pixel&quot;</span><span class="p">))</span> <span class="p">{</span>
			<span class="n">lua_rawgeti</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>
			<span class="n">CclGetPos</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">unit</span><span class="o">-&gt;</span><span class="n">IX</span> <span class="p">,</span> <span class="o">&amp;</span><span class="n">unit</span><span class="o">-&gt;</span><span class="n">IY</span><span class="p">,</span> <span class="mi">-1</span><span class="p">);</span>
			<span class="n">lua_pop</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
		<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s">&quot;seen-pixel&quot;</span><span class="p">))</span> <span class="p">{</span>
			<span class="n">lua_rawgeti</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>
			<span class="n">CclGetPos</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">unit</span><span class="o">-&gt;</span><span class="n">Seen</span><span class="p">.</span><span class="n">IX</span> <span class="p">,</span> <span class="o">&amp;</span><span class="n">unit</span><span class="o">-&gt;</span><span class="n">Seen</span><span class="p">.</span><span class="n">IY</span><span class="p">,</span> <span class="mi">-1</span><span class="p">);</span>
			<span class="n">lua_pop</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
		<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s">&quot;frame&quot;</span><span class="p">))</span> <span class="p">{</span>
			<span class="n">unit</span><span class="o">-&gt;</span><span class="n">Frame</span> <span class="o">=</span> <span class="n">LuaToNumber</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>
		<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s">&quot;seen&quot;</span><span class="p">))</span> <span class="p">{</span>
			<span class="n">unit</span><span class="o">-&gt;</span><span class="n">Seen</span><span class="p">.</span><span class="n">Frame</span> <span class="o">=</span> <span class="n">LuaToNumber</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>
		<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s">&quot;not-seen&quot;</span><span class="p">))</span> <span class="p">{</span>
			<span class="n">unit</span><span class="o">-&gt;</span><span class="n">Seen</span><span class="p">.</span><span class="n">Frame</span> <span class="o">=</span> <span class="n">UnitNotSeen</span><span class="p">;</span>
			<span class="o">--</span><span class="n">j</span><span class="p">;</span>
		<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s">&quot;direction&quot;</span><span class="p">))</span> <span class="p">{</span>
			<span class="n">unit</span><span class="o">-&gt;</span><span class="n">Direction</span> <span class="o">=</span> <span class="n">LuaToNumber</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>
		<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s">&quot;damage-type&quot;</span><span class="p">))</span> <span class="p">{</span>
			<span class="n">unit</span><span class="o">-&gt;</span><span class="n">DamagedType</span> <span class="o">=</span> <span class="n">LuaToNumber</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>
		<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s">&quot;attacked&quot;</span><span class="p">))</span> <span class="p">{</span>
			<span class="c1">// FIXME : unsigned long should be better handled</span>
			<span class="n">unit</span><span class="o">-&gt;</span><span class="n">Attacked</span> <span class="o">=</span> <span class="n">LuaToNumber</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>
		<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s">&quot;auto-repair&quot;</span><span class="p">))</span> <span class="p">{</span>
			<span class="n">unit</span><span class="o">-&gt;</span><span class="n">AutoRepair</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
			<span class="o">--</span><span class="n">j</span><span class="p">;</span>
		<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s">&quot;burning&quot;</span><span class="p">))</span> <span class="p">{</span>
			<span class="n">unit</span><span class="o">-&gt;</span><span class="n">Burning</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
			<span class="o">--</span><span class="n">j</span><span class="p">;</span>
		<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s">&quot;destroyed&quot;</span><span class="p">))</span> <span class="p">{</span>
			<span class="n">unit</span><span class="o">-&gt;</span><span class="n">Destroyed</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
			<span class="o">--</span><span class="n">j</span><span class="p">;</span>
		<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s">&quot;removed&quot;</span><span class="p">))</span> <span class="p">{</span>
			<span class="n">unit</span><span class="o">-&gt;</span><span class="n">Removed</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
			<span class="o">--</span><span class="n">j</span><span class="p">;</span>
		<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s">&quot;selected&quot;</span><span class="p">))</span> <span class="p">{</span>
			<span class="n">unit</span><span class="o">-&gt;</span><span class="n">Selected</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
			<span class="o">--</span><span class="n">j</span><span class="p">;</span>
		<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s">&quot;summoned&quot;</span><span class="p">))</span> <span class="p">{</span>
			<span class="c1">// FIXME : unsigned long should be better handled</span>
			<span class="n">unit</span><span class="o">-&gt;</span><span class="n">Summoned</span> <span class="o">=</span> <span class="n">LuaToNumber</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>
		<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s">&quot;waiting&quot;</span><span class="p">))</span> <span class="p">{</span>
			<span class="n">unit</span><span class="o">-&gt;</span><span class="n">Waiting</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
			<span class="o">--</span><span class="n">j</span><span class="p">;</span>
		<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s">&quot;mine-low&quot;</span><span class="p">))</span> <span class="p">{</span>
			<span class="n">unit</span><span class="o">-&gt;</span><span class="n">MineLow</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
			<span class="o">--</span><span class="n">j</span><span class="p">;</span>
		<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s">&quot;rescued-from&quot;</span><span class="p">))</span> <span class="p">{</span>
			<span class="n">unit</span><span class="o">-&gt;</span><span class="n">RescuedFrom</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">Players</span><span class="p">[</span><span class="n">LuaToNumber</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)];</span>
		<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s">&quot;seen-by-player&quot;</span><span class="p">))</span> <span class="p">{</span>
			<span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">s</span> <span class="o">=</span> <span class="n">LuaToString</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>
			<span class="n">unit</span><span class="o">-&gt;</span><span class="n">Seen</span><span class="p">.</span><span class="n">ByPlayer</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
			<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">PlayerMax</span> <span class="o">&amp;&amp;</span> <span class="o">*</span><span class="n">s</span><span class="p">;</span> <span class="o">++</span><span class="n">i</span><span class="p">,</span> <span class="o">++</span><span class="n">s</span><span class="p">)</span> <span class="p">{</span>
				<span class="k">if</span> <span class="p">(</span><span class="o">*</span><span class="n">s</span> <span class="o">==</span> <span class="sc">&#39;-&#39;</span> <span class="o">||</span> <span class="o">*</span><span class="n">s</span> <span class="o">==</span> <span class="sc">&#39;_&#39;</span> <span class="o">||</span> <span class="o">*</span><span class="n">s</span> <span class="o">==</span> <span class="sc">&#39; &#39;</span><span class="p">)</span> <span class="p">{</span>
					<span class="n">unit</span><span class="o">-&gt;</span><span class="n">Seen</span><span class="p">.</span><span class="n">ByPlayer</span> <span class="o">&amp;=</span> <span class="o">~</span><span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="n">i</span><span class="p">);</span>
				<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
					<span class="n">unit</span><span class="o">-&gt;</span><span class="n">Seen</span><span class="p">.</span><span class="n">ByPlayer</span> <span class="o">|=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="n">i</span><span class="p">);</span>
				<span class="p">}</span>
			<span class="p">}</span>
		<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s">&quot;seen-destroyed&quot;</span><span class="p">))</span> <span class="p">{</span>
			<span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">s</span> <span class="o">=</span> <span class="n">LuaToString</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>
			<span class="n">unit</span><span class="o">-&gt;</span><span class="n">Seen</span><span class="p">.</span><span class="n">Destroyed</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
			<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">PlayerMax</span> <span class="o">&amp;&amp;</span> <span class="o">*</span><span class="n">s</span><span class="p">;</span> <span class="o">++</span><span class="n">i</span><span class="p">,</span> <span class="o">++</span><span class="n">s</span><span class="p">)</span> <span class="p">{</span>
				<span class="k">if</span> <span class="p">(</span><span class="o">*</span><span class="n">s</span> <span class="o">==</span> <span class="sc">&#39;-&#39;</span> <span class="o">||</span> <span class="o">*</span><span class="n">s</span> <span class="o">==</span> <span class="sc">&#39;_&#39;</span> <span class="o">||</span> <span class="o">*</span><span class="n">s</span> <span class="o">==</span> <span class="sc">&#39; &#39;</span><span class="p">)</span> <span class="p">{</span>
					<span class="n">unit</span><span class="o">-&gt;</span><span class="n">Seen</span><span class="p">.</span><span class="n">Destroyed</span> <span class="o">&amp;=</span> <span class="o">~</span><span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="n">i</span><span class="p">);</span>
				<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
					<span class="n">unit</span><span class="o">-&gt;</span><span class="n">Seen</span><span class="p">.</span><span class="n">Destroyed</span> <span class="o">|=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="n">i</span><span class="p">);</span>
				<span class="p">}</span>
			<span class="p">}</span>
		<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s">&quot;constructed&quot;</span><span class="p">))</span> <span class="p">{</span>
			<span class="n">unit</span><span class="o">-&gt;</span><span class="n">Constructed</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
			<span class="o">--</span><span class="n">j</span><span class="p">;</span>
		<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s">&quot;seen-constructed&quot;</span><span class="p">))</span> <span class="p">{</span>
			<span class="n">unit</span><span class="o">-&gt;</span><span class="n">Seen</span><span class="p">.</span><span class="n">Constructed</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
			<span class="o">--</span><span class="n">j</span><span class="p">;</span>
		<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s">&quot;seen-state&quot;</span><span class="p">))</span> <span class="p">{</span>
			<span class="n">unit</span><span class="o">-&gt;</span><span class="n">Seen</span><span class="p">.</span><span class="n">State</span> <span class="o">=</span> <span class="n">LuaToNumber</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>
		<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s">&quot;active&quot;</span><span class="p">))</span> <span class="p">{</span>
			<span class="n">unit</span><span class="o">-&gt;</span><span class="n">Active</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
			<span class="o">--</span><span class="n">j</span><span class="p">;</span>
		<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s">&quot;ttl&quot;</span><span class="p">))</span> <span class="p">{</span>
			<span class="c1">// FIXME : unsigned long should be better handled</span>
			<span class="n">unit</span><span class="o">-&gt;</span><span class="n">TTL</span> <span class="o">=</span> <span class="n">LuaToNumber</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>
		<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s">&quot;threshold&quot;</span><span class="p">))</span> <span class="p">{</span>
			<span class="c1">// FIXME : unsigned long should be better handled</span>
			<span class="n">unit</span><span class="o">-&gt;</span><span class="n">Threshold</span> <span class="o">=</span> <span class="n">LuaToNumber</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>
		<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s">&quot;group-id&quot;</span><span class="p">))</span> <span class="p">{</span>
			<span class="n">unit</span><span class="o">-&gt;</span><span class="n">GroupId</span> <span class="o">=</span> <span class="n">LuaToNumber</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>
		<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s">&quot;last-group&quot;</span><span class="p">))</span> <span class="p">{</span>
			<span class="n">unit</span><span class="o">-&gt;</span><span class="n">LastGroup</span> <span class="o">=</span> <span class="n">LuaToNumber</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>
		<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s">&quot;resources-held&quot;</span><span class="p">))</span> <span class="p">{</span>
			<span class="n">unit</span><span class="o">-&gt;</span><span class="n">ResourcesHeld</span> <span class="o">=</span> <span class="n">LuaToNumber</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>
		<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s">&quot;current-resource&quot;</span><span class="p">))</span> <span class="p">{</span>
			<span class="n">lua_rawgeti</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>
			<span class="n">lua_pushvalue</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">-1</span><span class="p">);</span>
			<span class="n">unit</span><span class="o">-&gt;</span><span class="n">CurrentResource</span> <span class="o">=</span> <span class="n">CclGetResourceByName</span><span class="p">(</span><span class="n">l</span><span class="p">);</span>
			<span class="n">lua_pop</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
		<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s">&quot;pathfinder-input&quot;</span><span class="p">))</span> <span class="p">{</span>
			<span class="n">lua_rawgeti</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>
			<span class="n">lua_pushvalue</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">-1</span><span class="p">);</span>
			<span class="n">unit</span><span class="o">-&gt;</span><span class="n">pathFinderData</span><span class="o">-&gt;</span><span class="n">input</span><span class="p">.</span><span class="n">Load</span><span class="p">(</span><span class="n">l</span><span class="p">);</span>
			<span class="n">lua_pop</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
		<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s">&quot;pathfinder-output&quot;</span><span class="p">))</span> <span class="p">{</span>
			<span class="n">lua_rawgeti</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>
			<span class="n">lua_pushvalue</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">-1</span><span class="p">);</span>
			<span class="n">unit</span><span class="o">-&gt;</span><span class="n">pathFinderData</span><span class="o">-&gt;</span><span class="n">output</span><span class="p">.</span><span class="n">Load</span><span class="p">(</span><span class="n">l</span><span class="p">);</span>
			<span class="n">lua_pop</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
		<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s">&quot;wait&quot;</span><span class="p">))</span> <span class="p">{</span>
			<span class="n">unit</span><span class="o">-&gt;</span><span class="n">Wait</span> <span class="o">=</span> <span class="n">LuaToNumber</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>
		<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s">&quot;anim-data&quot;</span><span class="p">))</span> <span class="p">{</span>
			<span class="n">lua_rawgeti</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>
			<span class="n">CAnimations</span><span class="o">::</span><span class="n">LoadUnitAnim</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="o">*</span><span class="n">unit</span><span class="p">,</span> <span class="mi">-1</span><span class="p">);</span>
			<span class="n">lua_pop</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
		<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s">&quot;wait-anim-data&quot;</span><span class="p">))</span> <span class="p">{</span>
			<span class="n">lua_rawgeti</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>
			<span class="n">CAnimations</span><span class="o">::</span><span class="n">LoadWaitUnitAnim</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="o">*</span><span class="n">unit</span><span class="p">,</span> <span class="mi">-1</span><span class="p">);</span>
			<span class="n">lua_pop</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
		<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s">&quot;blink&quot;</span><span class="p">))</span> <span class="p">{</span>
			<span class="n">unit</span><span class="o">-&gt;</span><span class="n">Blink</span> <span class="o">=</span> <span class="n">LuaToNumber</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>
		<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s">&quot;moving&quot;</span><span class="p">))</span> <span class="p">{</span>
			<span class="n">unit</span><span class="o">-&gt;</span><span class="n">Moving</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
			<span class="o">--</span><span class="n">j</span><span class="p">;</span>
		<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s">&quot;re-cast&quot;</span><span class="p">))</span> <span class="p">{</span>
			<span class="n">unit</span><span class="o">-&gt;</span><span class="n">ReCast</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
			<span class="o">--</span><span class="n">j</span><span class="p">;</span>
		<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s">&quot;boarded&quot;</span><span class="p">))</span> <span class="p">{</span>
			<span class="n">unit</span><span class="o">-&gt;</span><span class="n">Boarded</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
			<span class="o">--</span><span class="n">j</span><span class="p">;</span>
		<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s">&quot;next-worker&quot;</span><span class="p">))</span> <span class="p">{</span>
			<span class="n">lua_rawgeti</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>
			<span class="n">lua_pushvalue</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">-1</span><span class="p">);</span>
			<span class="n">unit</span><span class="o">-&gt;</span><span class="n">NextWorker</span> <span class="o">=</span> <span class="n">CclGetUnitFromRef</span><span class="p">(</span><span class="n">l</span><span class="p">);</span>
			<span class="n">lua_pop</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
		<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s">&quot;resource-workers&quot;</span><span class="p">))</span> <span class="p">{</span>
			<span class="n">lua_rawgeti</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>
			<span class="n">lua_pushvalue</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">-1</span><span class="p">);</span>
			<span class="n">unit</span><span class="o">-&gt;</span><span class="n">Resource</span><span class="p">.</span><span class="n">Workers</span> <span class="o">=</span> <span class="n">CclGetUnitFromRef</span><span class="p">(</span><span class="n">l</span><span class="p">);</span>
			<span class="n">lua_pop</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
		<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s">&quot;resource-assigned&quot;</span><span class="p">))</span> <span class="p">{</span>
			<span class="n">lua_rawgeti</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>
			<span class="n">lua_pushvalue</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">-1</span><span class="p">);</span>
			<span class="n">unit</span><span class="o">-&gt;</span><span class="n">Resource</span><span class="p">.</span><span class="n">Assigned</span> <span class="o">=</span> <span class="n">LuaToNumber</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">-1</span><span class="p">);</span>
			<span class="n">lua_pop</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
		<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s">&quot;resource-active&quot;</span><span class="p">))</span> <span class="p">{</span>
			<span class="n">lua_rawgeti</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>
			<span class="n">lua_pushvalue</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">-1</span><span class="p">);</span>
			<span class="n">unit</span><span class="o">-&gt;</span><span class="n">Resource</span><span class="p">.</span><span class="n">Active</span> <span class="o">=</span> <span class="n">LuaToNumber</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">-1</span><span class="p">);</span>
			<span class="n">lua_pop</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
		<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s">&quot;units-boarded-count&quot;</span><span class="p">))</span> <span class="p">{</span>
			<span class="n">unit</span><span class="o">-&gt;</span><span class="n">BoardCount</span> <span class="o">=</span> <span class="n">LuaToNumber</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>
		<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s">&quot;units-contained&quot;</span><span class="p">))</span> <span class="p">{</span>
			<span class="kt">int</span> <span class="n">subargs</span><span class="p">;</span>
			<span class="kt">int</span> <span class="n">k</span><span class="p">;</span>
			<span class="n">lua_rawgeti</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>
			<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">lua_istable</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">-1</span><span class="p">))</span> <span class="p">{</span>
				<span class="n">LuaError</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="s">&quot;incorrect argument&quot;</span><span class="p">);</span>
			<span class="p">}</span>
			<span class="n">subargs</span> <span class="o">=</span> <span class="n">lua_rawlen</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">-1</span><span class="p">);</span>
			<span class="k">for</span> <span class="p">(</span><span class="n">k</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">k</span> <span class="o">&lt;</span> <span class="n">subargs</span><span class="p">;</span> <span class="o">++</span><span class="n">k</span><span class="p">)</span> <span class="p">{</span>
				<span class="n">lua_rawgeti</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">-1</span><span class="p">,</span> <span class="n">k</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>
				<span class="n">CUnit</span> <span class="o">*</span><span class="n">u</span> <span class="o">=</span> <span class="n">CclGetUnitFromRef</span><span class="p">(</span><span class="n">l</span><span class="p">);</span>
				<span class="n">lua_pop</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
				<span class="n">u</span><span class="o">-&gt;</span><span class="n">AddInContainer</span><span class="p">(</span><span class="o">*</span><span class="n">unit</span><span class="p">);</span>
			<span class="p">}</span>
			<span class="n">lua_pop</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
		<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s">&quot;orders&quot;</span><span class="p">))</span> <span class="p">{</span>
			<span class="n">lua_rawgeti</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>
			<span class="n">lua_pushvalue</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">-1</span><span class="p">);</span>
			<span class="n">CclParseOrders</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="o">*</span><span class="n">unit</span><span class="p">);</span>
			<span class="n">lua_pop</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
			<span class="c1">// now we know unit&#39;s action so we can assign it to a player</span>
			<span class="n">Assert</span><span class="p">(</span><span class="n">player</span> <span class="o">!=</span> <span class="nb">NULL</span><span class="p">);</span>
			<span class="n">unit</span><span class="o">-&gt;</span><span class="n">AssignToPlayer</span><span class="p">(</span><span class="o">*</span><span class="n">player</span><span class="p">);</span>
			<span class="k">if</span> <span class="p">(</span><span class="n">unit</span><span class="o">-&gt;</span><span class="n">CurrentAction</span><span class="p">()</span> <span class="o">==</span> <span class="n">UnitActionBuilt</span><span class="p">)</span> <span class="p">{</span>
				<span class="n">DebugPrint</span><span class="p">(</span><span class="s">&quot;HACK: the building is not ready yet</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
				<span class="c1">// HACK: the building is not ready yet</span>
				<span class="n">unit</span><span class="o">-&gt;</span><span class="n">Player</span><span class="o">-&gt;</span><span class="n">UnitTypesCount</span><span class="p">[</span><span class="n">type</span><span class="o">-&gt;</span><span class="n">Slot</span><span class="p">]</span><span class="o">--</span><span class="p">;</span>
				<span class="k">if</span> <span class="p">(</span><span class="n">unit</span><span class="o">-&gt;</span><span class="n">Active</span><span class="p">)</span> <span class="p">{</span>
					<span class="n">unit</span><span class="o">-&gt;</span><span class="n">Player</span><span class="o">-&gt;</span><span class="n">UnitTypesAiActiveCount</span><span class="p">[</span><span class="n">type</span><span class="o">-&gt;</span><span class="n">Slot</span><span class="p">]</span><span class="o">--</span><span class="p">;</span>
				<span class="p">}</span>
			<span class="p">}</span>
		<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s">&quot;critical-order&quot;</span><span class="p">))</span> <span class="p">{</span>
			<span class="n">lua_rawgeti</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>
			<span class="n">lua_pushvalue</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">-1</span><span class="p">);</span>
			<span class="n">CclParseOrder</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="o">*</span><span class="n">unit</span> <span class="p">,</span> <span class="o">&amp;</span><span class="n">unit</span><span class="o">-&gt;</span><span class="n">CriticalOrder</span><span class="p">);</span>
			<span class="n">lua_pop</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
		<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s">&quot;saved-order&quot;</span><span class="p">))</span> <span class="p">{</span>
			<span class="n">lua_rawgeti</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>
			<span class="n">lua_pushvalue</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">-1</span><span class="p">);</span>
			<span class="n">CclParseOrder</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="o">*</span><span class="n">unit</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">unit</span><span class="o">-&gt;</span><span class="n">SavedOrder</span><span class="p">);</span>
			<span class="n">lua_pop</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
		<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s">&quot;new-order&quot;</span><span class="p">))</span> <span class="p">{</span>
			<span class="n">lua_rawgeti</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>
			<span class="n">lua_pushvalue</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">-1</span><span class="p">);</span>
			<span class="n">CclParseOrder</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="o">*</span><span class="n">unit</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">unit</span><span class="o">-&gt;</span><span class="n">NewOrder</span><span class="p">);</span>
			<span class="n">lua_pop</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
		<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s">&quot;goal&quot;</span><span class="p">))</span> <span class="p">{</span>
			<span class="n">unit</span><span class="o">-&gt;</span><span class="n">Goal</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">UnitManager</span><span class="p">.</span><span class="n">GetSlotUnit</span><span class="p">(</span><span class="n">LuaToNumber</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">));</span>
		<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s">&quot;auto-cast&quot;</span><span class="p">))</span> <span class="p">{</span>
			<span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">s</span> <span class="o">=</span> <span class="n">LuaToString</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>
			<span class="n">Assert</span><span class="p">(</span><span class="n">SpellTypeByIdent</span><span class="p">(</span><span class="n">s</span><span class="p">));</span>
			<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">unit</span><span class="o">-&gt;</span><span class="n">AutoCastSpell</span><span class="p">)</span> <span class="p">{</span>
				<span class="n">unit</span><span class="o">-&gt;</span><span class="n">AutoCastSpell</span> <span class="o">=</span> <span class="k">new</span> <span class="kt">char</span><span class="p">[</span><span class="n">SpellTypeTable</span><span class="p">.</span><span class="n">size</span><span class="p">()];</span>
				<span class="n">memset</span><span class="p">(</span><span class="n">unit</span><span class="o">-&gt;</span><span class="n">AutoCastSpell</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">SpellTypeTable</span><span class="p">.</span><span class="n">size</span><span class="p">());</span>
			<span class="p">}</span>
			<span class="n">unit</span><span class="o">-&gt;</span><span class="n">AutoCastSpell</span><span class="p">[</span><span class="n">SpellTypeByIdent</span><span class="p">(</span><span class="n">s</span><span class="p">)</span><span class="o">-&gt;</span><span class="n">Slot</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
		<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s">&quot;spell-cooldown&quot;</span><span class="p">))</span> <span class="p">{</span>
			<span class="n">lua_rawgeti</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>
			<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">lua_istable</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">-1</span><span class="p">)</span> <span class="o">||</span> <span class="n">lua_rawlen</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">-1</span><span class="p">)</span> <span class="o">!=</span> <span class="n">SpellTypeTable</span><span class="p">.</span><span class="n">size</span><span class="p">())</span> <span class="p">{</span>
				<span class="n">LuaError</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="s">&quot;incorrect argument&quot;</span><span class="p">);</span>
			<span class="p">}</span>
			<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">unit</span><span class="o">-&gt;</span><span class="n">SpellCoolDownTimers</span><span class="p">)</span> <span class="p">{</span>
				<span class="n">unit</span><span class="o">-&gt;</span><span class="n">SpellCoolDownTimers</span> <span class="o">=</span> <span class="k">new</span> <span class="kt">int</span><span class="p">[</span><span class="n">SpellTypeTable</span><span class="p">.</span><span class="n">size</span><span class="p">()];</span>
				<span class="n">memset</span><span class="p">(</span><span class="n">unit</span><span class="o">-&gt;</span><span class="n">SpellCoolDownTimers</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">SpellTypeTable</span><span class="p">.</span><span class="n">size</span><span class="p">()</span> <span class="o">*</span> <span class="k">sizeof</span><span class="p">(</span><span class="kt">int</span><span class="p">));</span>
			<span class="p">}</span>
			<span class="k">for</span> <span class="p">(</span><span class="kt">size_t</span> <span class="n">k</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">k</span> <span class="o">&lt;</span> <span class="n">SpellTypeTable</span><span class="p">.</span><span class="n">size</span><span class="p">();</span> <span class="o">++</span><span class="n">k</span><span class="p">)</span> <span class="p">{</span>
				<span class="n">unit</span><span class="o">-&gt;</span><span class="n">SpellCoolDownTimers</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">LuaToNumber</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">-1</span><span class="p">,</span> <span class="n">k</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>
			<span class="p">}</span>
			<span class="n">lua_pop</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
		<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
			<span class="k">const</span> <span class="kt">int</span> <span class="n">index</span> <span class="o">=</span> <span class="n">UnitTypeVar</span><span class="p">.</span><span class="n">VariableNameLookup</span><span class="p">[</span><span class="n">value</span><span class="p">];</span><span class="c1">// User variables</span>
			<span class="k">if</span> <span class="p">(</span><span class="n">index</span> <span class="o">!=</span> <span class="mi">-1</span><span class="p">)</span> <span class="p">{</span> <span class="c1">// Valid index</span>
				<span class="n">lua_rawgeti</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>
				<span class="n">DefineVariableField</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">unit</span><span class="o">-&gt;</span><span class="n">Variable</span> <span class="o">+</span> <span class="n">index</span><span class="p">,</span> <span class="mi">-1</span><span class="p">);</span>
				<span class="n">lua_pop</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
				<span class="k">continue</span><span class="p">;</span>
			<span class="p">}</span>
			<span class="n">LuaError</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="s">&quot;Unit: Unsupported tag: %s&quot;</span> <span class="n">_C_</span> <span class="n">value</span><span class="p">);</span>
		<span class="p">}</span>
	<span class="p">}</span>

	<span class="c1">// Unit may not have been assigned to a player before now. If not,</span>
	<span class="c1">// do so now. It is only assigned earlier if we have orders.</span>
	<span class="c1">// for loading of units from a MAP, and not a savegame, we won&#39;t</span>
	<span class="c1">// have orders for those units.  They should appear here as if</span>
	<span class="c1">// they were just created.</span>
	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">unit</span><span class="o">-&gt;</span><span class="n">Player</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">Assert</span><span class="p">(</span><span class="n">player</span><span class="p">);</span>
		<span class="n">unit</span><span class="o">-&gt;</span><span class="n">AssignToPlayer</span><span class="p">(</span><span class="o">*</span><span class="n">player</span><span class="p">);</span>
		<span class="n">UpdateForNewUnit</span><span class="p">(</span><span class="o">*</span><span class="n">unit</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
	<span class="p">}</span>

	<span class="c1">//  Revealers are units that can see while removed</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">unit</span><span class="o">-&gt;</span><span class="n">Removed</span> <span class="o">&amp;&amp;</span> <span class="n">unit</span><span class="o">-&gt;</span><span class="n">Type</span><span class="o">-&gt;</span><span class="n">BoolFlag</span><span class="p">[</span><span class="n">REVEALER_INDEX</span><span class="p">].</span><span class="n">value</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">MapMarkUnitSight</span><span class="p">(</span><span class="o">*</span><span class="n">unit</span><span class="p">);</span>
	<span class="p">}</span>

	<span class="c1">// Fix Colors for rescued units.</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">unit</span><span class="o">-&gt;</span><span class="n">RescuedFrom</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">unit</span><span class="o">-&gt;</span><span class="n">Colors</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">unit</span><span class="o">-&gt;</span><span class="n">RescuedFrom</span><span class="o">-&gt;</span><span class="n">UnitColors</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</p>
                          </details>
                        </details>
                        
                        <details>
                        <summary>MoveUnit</summary>
                        <p><br>  Move a unit on map.<br><br>  @param l  Lua state.<br><br>  @return   Returns the slot number of the made placed.</p>
                          <details>
                          <summary>/unit/script_unit.cpp:644 CclMoveUnit</summary>
                          <p><div class="highlight"><pre><span></span><span class="k">static</span> <span class="kt">int</span> <span class="nf">CclMoveUnit</span><span class="p">(</span><span class="n">lua_State</span> <span class="o">*</span><span class="n">l</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">LuaCheckArgs</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">2</span><span class="p">);</span>

	<span class="n">lua_pushvalue</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
	<span class="n">CUnit</span> <span class="o">*</span><span class="n">unit</span> <span class="o">=</span> <span class="n">CclGetUnit</span><span class="p">(</span><span class="n">l</span><span class="p">);</span>
	<span class="n">lua_pop</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>

	<span class="n">Vec2i</span> <span class="n">ipos</span><span class="p">;</span>
	<span class="n">CclGetPos</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">ipos</span><span class="p">.</span><span class="n">x</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">ipos</span><span class="p">.</span><span class="n">y</span><span class="p">,</span> <span class="mi">2</span><span class="p">);</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">UnitCanBeAt</span><span class="p">(</span><span class="o">*</span><span class="n">unit</span><span class="p">,</span> <span class="n">ipos</span><span class="p">))</span> <span class="p">{</span>
		<span class="n">unit</span><span class="o">-&gt;</span><span class="n">Place</span><span class="p">(</span><span class="n">ipos</span><span class="p">);</span>
	<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
		<span class="k">const</span> <span class="kt">int</span> <span class="n">heading</span> <span class="o">=</span> <span class="n">SyncRand</span><span class="p">()</span> <span class="o">%</span> <span class="mi">256</span><span class="p">;</span>

		<span class="n">unit</span><span class="o">-&gt;</span><span class="n">tilePos</span> <span class="o">=</span> <span class="n">ipos</span><span class="p">;</span>
		<span class="n">DropOutOnSide</span><span class="p">(</span><span class="o">*</span><span class="n">unit</span><span class="p">,</span> <span class="n">heading</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">);</span>
	<span class="p">}</span>
	<span class="n">lua_pushvalue</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
	<span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</p>
                          </details>
                        </details>
                        
                        <details>
                        <summary>RemoveUnit</summary>
                        <p><br> <b>Description</b><br><br>  Remove unit from the map.<br><br>  @param l  Lua state.<br><br>  @return   Returns 1.<br><br> Example:<br><br> <div class="example"><code>ogre = CreateUnit("unit-ogre", 0, {24, 89})<br><br>		AddTrigger(<br>  		function() return (GameCycle > 150) end,<br>  		function()<br>    			<strong>RemoveUnit</strong>(ogre)<br>    			return false end -- end of function<br>		)</code></div></p>
                          <details>
                          <summary>/unit/script_unit.cpp:676 CclRemoveUnit</summary>
                          <p><div class="highlight"><pre><span></span><span class="k">static</span> <span class="kt">int</span> <span class="nf">CclRemoveUnit</span><span class="p">(</span><span class="n">lua_State</span> <span class="o">*</span><span class="n">l</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">LuaCheckArgs</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
	<span class="n">lua_pushvalue</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
	<span class="n">CUnit</span> <span class="o">*</span><span class="n">unit</span> <span class="o">=</span> <span class="n">CclGetUnit</span><span class="p">(</span><span class="n">l</span><span class="p">);</span>
	<span class="n">lua_pop</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
	<span class="n">unit</span><span class="o">-&gt;</span><span class="n">Remove</span><span class="p">(</span><span class="nb">NULL</span><span class="p">);</span>
	<span class="n">LetUnitDie</span><span class="p">(</span><span class="o">*</span><span class="n">unit</span><span class="p">);</span>
	<span class="n">lua_pushvalue</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
	<span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</p>
                          </details>
                        </details>
                        
                        <details>
                        <summary>CreateUnit</summary>
                        <p><br> <b>Description</b><br><br>  Create a unit and place it on the map<br><br>  @param l  Lua state.<br><br>  @return   Returns the slot number of the made unit.<br><br> Example:<br><br> <div class="example"><code><strong>CreateUnit</strong>("unit-human-transport", 1, {94, 0})</code></div></p>
                          <details>
                          <summary>/unit/script_unit.cpp:736 CclCreateUnit</summary>
                          <p><div class="highlight"><pre><span></span><span class="k">static</span> <span class="kt">int</span> <span class="nf">CclCreateUnit</span><span class="p">(</span><span class="n">lua_State</span> <span class="o">*</span><span class="n">l</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">LuaCheckArgs</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">3</span><span class="p">);</span>

	<span class="n">lua_pushvalue</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
	<span class="n">CUnitType</span> <span class="o">*</span><span class="n">unittype</span> <span class="o">=</span> <span class="n">CclGetUnitType</span><span class="p">(</span><span class="n">l</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">unittype</span> <span class="o">==</span> <span class="nb">NULL</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">LuaError</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="s">&quot;Bad unittype&quot;</span><span class="p">);</span>
	<span class="p">}</span>
	<span class="n">lua_pop</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
	<span class="n">Vec2i</span> <span class="n">ipos</span><span class="p">;</span>
	<span class="n">CclGetPos</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">ipos</span><span class="p">.</span><span class="n">x</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">ipos</span><span class="p">.</span><span class="n">y</span><span class="p">,</span> <span class="mi">3</span><span class="p">);</span>

	<span class="n">lua_pushvalue</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">2</span><span class="p">);</span>
	<span class="k">const</span> <span class="kt">int</span> <span class="n">playerno</span> <span class="o">=</span> <span class="n">TriggerGetPlayer</span><span class="p">(</span><span class="n">l</span><span class="p">);</span>
	<span class="n">lua_pop</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">playerno</span> <span class="o">==</span> <span class="mi">-1</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">printf</span><span class="p">(</span><span class="s">&quot;CreateUnit: You cannot use </span><span class="se">\&quot;</span><span class="s">any</span><span class="se">\&quot;</span><span class="s"> in create-unit, specify a player</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
		<span class="n">LuaError</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="s">&quot;bad player&quot;</span><span class="p">);</span>
		<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">Players</span><span class="p">[</span><span class="n">playerno</span><span class="p">].</span><span class="n">Type</span> <span class="o">==</span> <span class="n">PlayerNobody</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">printf</span><span class="p">(</span><span class="s">&quot;CreateUnit: player %d does not exist</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">playerno</span><span class="p">);</span>
		<span class="n">LuaError</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="s">&quot;bad player&quot;</span><span class="p">);</span>
		<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="n">CUnit</span> <span class="o">*</span><span class="n">unit</span> <span class="o">=</span> <span class="n">MakeUnit</span><span class="p">(</span><span class="o">*</span><span class="n">unittype</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">Players</span><span class="p">[</span><span class="n">playerno</span><span class="p">]);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">unit</span> <span class="o">==</span> <span class="nb">NULL</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">DebugPrint</span><span class="p">(</span><span class="s">&quot;Unable to allocate unit&quot;</span><span class="p">);</span>
		<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
	<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">UnitCanBeAt</span><span class="p">(</span><span class="o">*</span><span class="n">unit</span><span class="p">,</span> <span class="n">ipos</span><span class="p">)</span>
			<span class="o">||</span> <span class="p">(</span><span class="n">unit</span><span class="o">-&gt;</span><span class="n">Type</span><span class="o">-&gt;</span><span class="n">Building</span> <span class="o">&amp;&amp;</span> <span class="n">CanBuildUnitType</span><span class="p">(</span><span class="nb">NULL</span><span class="p">,</span> <span class="o">*</span><span class="n">unit</span><span class="o">-&gt;</span><span class="n">Type</span><span class="p">,</span> <span class="n">ipos</span><span class="p">,</span> <span class="mi">0</span><span class="p">)))</span> <span class="p">{</span>
			<span class="n">unit</span><span class="o">-&gt;</span><span class="n">Place</span><span class="p">(</span><span class="n">ipos</span><span class="p">);</span>
		<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
			<span class="k">const</span> <span class="kt">int</span> <span class="n">heading</span> <span class="o">=</span> <span class="n">SyncRand</span><span class="p">()</span> <span class="o">%</span> <span class="mi">256</span><span class="p">;</span>

			<span class="n">unit</span><span class="o">-&gt;</span><span class="n">tilePos</span> <span class="o">=</span> <span class="n">ipos</span><span class="p">;</span>
			<span class="n">DropOutOnSide</span><span class="p">(</span><span class="o">*</span><span class="n">unit</span><span class="p">,</span> <span class="n">heading</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">);</span>
		<span class="p">}</span>
		<span class="n">UpdateForNewUnit</span><span class="p">(</span><span class="o">*</span><span class="n">unit</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>

		<span class="n">lua_pushnumber</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">UnitNumber</span><span class="p">(</span><span class="o">*</span><span class="n">unit</span><span class="p">));</span>
		<span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
	<span class="p">}</span>
<span class="p">}</span>
</pre></div>
</p>
                          </details>
                        </details>
                        
                        <details>
                        <summary>TransformUnit</summary>
                        <p><br> <b>Description</b><br><br>  'Upgrade' a unit in place to a unit of different type.<br><br>  @param l  Lua state.<br><br>  @return   Returns success.<br><br> Example:<br><br> <div class="example"><code>-- Make a peon for player 5<br>		peon = CreateUnit("unit-peon", 5, {58, 9})<br>		-- The peon will be trasformed into a Grunt<br>		<strong>TransformUnit</strong>(peon,"unit-grunt")</code></div></p>
                          <details>
                          <summary>/unit/script_unit.cpp:765 CclTransformUnit</summary>
                          <p><div class="highlight"><pre><span></span><span class="k">static</span> <span class="kt">int</span> <span class="nf">CclTransformUnit</span><span class="p">(</span><span class="n">lua_State</span> <span class="o">*</span><span class="n">l</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">lua_pushvalue</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
	<span class="n">CUnit</span> <span class="o">*</span><span class="n">targetUnit</span> <span class="o">=</span> <span class="n">CclGetUnit</span><span class="p">(</span><span class="n">l</span><span class="p">);</span>
	<span class="n">lua_pop</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
	<span class="n">lua_pushvalue</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">2</span><span class="p">);</span>
	<span class="k">const</span> <span class="n">CUnitType</span> <span class="o">*</span><span class="n">unittype</span> <span class="o">=</span> <span class="n">TriggerGetUnitType</span><span class="p">(</span><span class="n">l</span><span class="p">);</span>
	<span class="n">lua_pop</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
	<span class="n">CommandUpgradeTo</span><span class="p">(</span><span class="o">*</span><span class="n">targetUnit</span><span class="p">,</span> <span class="o">*</span><span class="p">(</span><span class="n">CUnitType</span><span class="o">*</span><span class="p">)</span><span class="n">unittype</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="nb">true</span><span class="p">);</span>
	<span class="n">lua_pushvalue</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
	<span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</p>
                          </details>
                        </details>
                        
                        <details>
                        <summary>DamageUnit</summary>
                        <p><br> <b>Description</b><br><br>  Damages unit, additionally using another unit as first's attacker<br><br>  @param l  Lua state.<br><br>  @return   Returns the slot number of the made unit.<br><br> Example:<br><br> <div class="example"><code>-- Make a grunt for player 5<br>		grunt = CreateUnit("unit-grunt", 5, {58, 8})<br>		-- Damage the grunt with 15 points<br>		<strong>DamageUnit</strong>(-1,grunt,15)</code></div></p>
                          <details>
                          <summary>/unit/script_unit.cpp:799 CclDamageUnit</summary>
                          <p><div class="highlight"><pre><span></span><span class="k">static</span> <span class="kt">int</span> <span class="nf">CclDamageUnit</span><span class="p">(</span><span class="n">lua_State</span> <span class="o">*</span><span class="n">l</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">LuaCheckArgs</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">3</span><span class="p">);</span>

	<span class="k">const</span> <span class="kt">int</span> <span class="n">attacker</span> <span class="o">=</span> <span class="n">LuaToNumber</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
	<span class="n">CUnit</span> <span class="o">*</span><span class="n">attackerUnit</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">attacker</span> <span class="o">!=</span> <span class="mi">-1</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">attackerUnit</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">UnitManager</span><span class="p">.</span><span class="n">GetSlotUnit</span><span class="p">(</span><span class="n">attacker</span><span class="p">);</span>
	<span class="p">}</span>
	<span class="n">lua_pushvalue</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">2</span><span class="p">);</span>
	<span class="n">CUnit</span> <span class="o">*</span><span class="n">targetUnit</span> <span class="o">=</span> <span class="n">CclGetUnit</span><span class="p">(</span><span class="n">l</span><span class="p">);</span>
	<span class="n">lua_pop</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
	<span class="k">const</span> <span class="kt">int</span> <span class="n">damage</span> <span class="o">=</span> <span class="n">LuaToNumber</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">3</span><span class="p">);</span>
	<span class="n">HitUnit</span><span class="p">(</span><span class="n">attackerUnit</span><span class="p">,</span> <span class="o">*</span><span class="n">targetUnit</span><span class="p">,</span> <span class="n">damage</span><span class="p">);</span>

	<span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</p>
                          </details>
                        </details>
                        
                        <details>
                        <summary>SetResourcesHeld</summary>
                        <p><br>  Set resources held by a unit<br><br>  @param l  Lua state.</p>
                          <details>
                          <summary>/unit/script_unit.cpp:824 CclSetResourcesHeld</summary>
                          <p><div class="highlight"><pre><span></span><span class="k">static</span> <span class="kt">int</span> <span class="nf">CclSetResourcesHeld</span><span class="p">(</span><span class="n">lua_State</span> <span class="o">*</span><span class="n">l</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">LuaCheckArgs</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">2</span><span class="p">);</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">lua_isnil</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span> <span class="p">{</span>
		<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="n">lua_pushvalue</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
	<span class="n">CUnit</span> <span class="o">*</span><span class="n">unit</span> <span class="o">=</span> <span class="n">CclGetUnit</span><span class="p">(</span><span class="n">l</span><span class="p">);</span>
	<span class="n">lua_pop</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
	<span class="k">const</span> <span class="kt">int</span> <span class="n">value</span> <span class="o">=</span> <span class="n">LuaToNumber</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">2</span><span class="p">);</span>
	<span class="n">unit</span><span class="o">-&gt;</span><span class="n">ResourcesHeld</span> <span class="o">=</span> <span class="n">value</span><span class="p">;</span>
	<span class="n">unit</span><span class="o">-&gt;</span><span class="n">Variable</span><span class="p">[</span><span class="n">GIVERESOURCE_INDEX</span><span class="p">].</span><span class="n">Value</span> <span class="o">=</span> <span class="n">value</span><span class="p">;</span>
	<span class="n">unit</span><span class="o">-&gt;</span><span class="n">Variable</span><span class="p">[</span><span class="n">GIVERESOURCE_INDEX</span><span class="p">].</span><span class="n">Max</span> <span class="o">=</span> <span class="n">value</span><span class="p">;</span>
	<span class="n">unit</span><span class="o">-&gt;</span><span class="n">Variable</span><span class="p">[</span><span class="n">GIVERESOURCE_INDEX</span><span class="p">].</span><span class="n">Enable</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>

	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</p>
                          </details>
                        </details>
                        
                        <details>
                        <summary>SetTeleportDestination</summary>
                        <p><br>  Set teleport deastination for teleporter unit<br><br>  @param l  Lua state.</p>
                          <details>
                          <summary>/unit/script_unit.cpp:849 CclSetTeleportDestination</summary>
                          <p><div class="highlight"><pre><span></span><span class="k">static</span> <span class="kt">int</span> <span class="nf">CclSetTeleportDestination</span><span class="p">(</span><span class="n">lua_State</span> <span class="o">*</span><span class="n">l</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">LuaCheckArgs</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">2</span><span class="p">);</span>

	<span class="n">lua_pushvalue</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
	<span class="n">CUnit</span> <span class="o">*</span><span class="n">unit</span> <span class="o">=</span> <span class="n">CclGetUnit</span><span class="p">(</span><span class="n">l</span><span class="p">);</span>
	<span class="n">lua_pop</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">unit</span><span class="o">-&gt;</span><span class="n">Type</span><span class="o">-&gt;</span><span class="n">BoolFlag</span><span class="p">[</span><span class="n">TELEPORTER_INDEX</span><span class="p">].</span><span class="n">value</span> <span class="o">==</span> <span class="nb">false</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">LuaError</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="s">&quot;Unit not a teleporter&quot;</span><span class="p">);</span>
	<span class="p">}</span>
	<span class="n">lua_pushvalue</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">2</span><span class="p">);</span>
	<span class="n">CUnit</span> <span class="o">*</span><span class="n">dest</span> <span class="o">=</span> <span class="n">CclGetUnit</span><span class="p">(</span><span class="n">l</span><span class="p">);</span>
	<span class="n">lua_pop</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">dest</span><span class="o">-&gt;</span><span class="n">IsAliveOnMap</span><span class="p">())</span> <span class="p">{</span>
		<span class="n">unit</span><span class="o">-&gt;</span><span class="n">Goal</span> <span class="o">=</span> <span class="n">dest</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</p>
                          </details>
                        </details>
                        
                        <details>
                        <summary>OrderUnit</summary>
                        <p><br> <b>Description</b><br><br>  Order a unit<br><br>  @param l  Lua state.<br><br>  OrderUnit(player, unit-type, start_loc, dest_loc, order)<br><br> Example:<br><br> <div class="example"><code>-- Move transport from position x=94,y=0 to x=80,y=9<br>		<strong>OrderUnit</strong>(1,"unit-human-transport",{94,0},{80,9},"move")</code></div></p>
                          <details>
                          <summary>/unit/script_unit.cpp:933 CclOrderUnit</summary>
                          <p><div class="highlight"><pre><span></span><span class="k">static</span> <span class="kt">int</span> <span class="nf">CclOrderUnit</span><span class="p">(</span><span class="n">lua_State</span> <span class="o">*</span><span class="n">l</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">LuaCheckArgs</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">5</span><span class="p">);</span>

	<span class="n">lua_pushvalue</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
	<span class="k">const</span> <span class="kt">int</span> <span class="n">plynr</span> <span class="o">=</span> <span class="n">TriggerGetPlayer</span><span class="p">(</span><span class="n">l</span><span class="p">);</span>
	<span class="n">lua_pop</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
	<span class="n">lua_pushvalue</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">2</span><span class="p">);</span>
	<span class="k">const</span> <span class="n">CUnitType</span> <span class="o">*</span><span class="n">unittype</span> <span class="o">=</span> <span class="n">TriggerGetUnitType</span><span class="p">(</span><span class="n">l</span><span class="p">);</span>
	<span class="n">lua_pop</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">lua_istable</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span> <span class="p">{</span>
		<span class="n">LuaError</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="s">&quot;incorrect argument&quot;</span><span class="p">);</span>
	<span class="p">}</span>
	<span class="n">Vec2i</span> <span class="n">pos1</span><span class="p">;</span>
	<span class="n">pos1</span><span class="p">.</span><span class="n">x</span> <span class="o">=</span> <span class="n">LuaToNumber</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
	<span class="n">pos1</span><span class="p">.</span><span class="n">y</span> <span class="o">=</span> <span class="n">LuaToNumber</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">);</span>

	<span class="n">Vec2i</span> <span class="n">pos2</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">lua_rawlen</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span> <span class="o">==</span> <span class="mi">4</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">pos2</span><span class="p">.</span><span class="n">x</span> <span class="o">=</span> <span class="n">LuaToNumber</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">);</span>
		<span class="n">pos2</span><span class="p">.</span><span class="n">y</span> <span class="o">=</span> <span class="n">LuaToNumber</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">);</span>
	<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
		<span class="n">pos2</span> <span class="o">=</span> <span class="n">pos1</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">lua_istable</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span> <span class="p">{</span>
		<span class="n">LuaError</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="s">&quot;incorrect argument&quot;</span><span class="p">);</span>
	<span class="p">}</span>
	<span class="n">Vec2i</span> <span class="n">dpos1</span><span class="p">;</span>
	<span class="n">Vec2i</span> <span class="n">dpos2</span><span class="p">;</span>
	<span class="n">dpos1</span><span class="p">.</span><span class="n">x</span> <span class="o">=</span> <span class="n">LuaToNumber</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
	<span class="n">dpos1</span><span class="p">.</span><span class="n">y</span> <span class="o">=</span> <span class="n">LuaToNumber</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">2</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">lua_rawlen</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span> <span class="o">==</span> <span class="mi">4</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">dpos2</span><span class="p">.</span><span class="n">x</span> <span class="o">=</span> <span class="n">LuaToNumber</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">3</span><span class="p">);</span>
		<span class="n">dpos2</span><span class="p">.</span><span class="n">y</span> <span class="o">=</span> <span class="n">LuaToNumber</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">);</span>
	<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
		<span class="n">dpos2</span> <span class="o">=</span> <span class="n">dpos1</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">order</span> <span class="o">=</span> <span class="n">LuaToString</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">5</span><span class="p">);</span>
	<span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">CUnit</span> <span class="o">*&gt;</span> <span class="n">table</span><span class="p">;</span>
	<span class="n">Select</span><span class="p">(</span><span class="n">pos1</span><span class="p">,</span> <span class="n">pos2</span><span class="p">,</span> <span class="n">table</span><span class="p">);</span>
	<span class="k">for</span> <span class="p">(</span><span class="kt">size_t</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">!=</span> <span class="n">table</span><span class="p">.</span><span class="n">size</span><span class="p">();</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">CUnit</span> <span class="o">&amp;</span><span class="n">unit</span> <span class="o">=</span> <span class="o">*</span><span class="n">table</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>

		<span class="k">if</span> <span class="p">(</span><span class="n">unittype</span> <span class="o">==</span> <span class="n">ANY_UNIT</span>
			<span class="o">||</span> <span class="p">(</span><span class="n">unittype</span> <span class="o">==</span> <span class="n">ALL_FOODUNITS</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="n">unit</span><span class="p">.</span><span class="n">Type</span><span class="o">-&gt;</span><span class="n">Building</span><span class="p">)</span>
			<span class="o">||</span> <span class="p">(</span><span class="n">unittype</span> <span class="o">==</span> <span class="n">ALL_BUILDINGS</span> <span class="o">&amp;&amp;</span> <span class="n">unit</span><span class="p">.</span><span class="n">Type</span><span class="o">-&gt;</span><span class="n">Building</span><span class="p">)</span>
			<span class="o">||</span> <span class="n">unittype</span> <span class="o">==</span> <span class="n">unit</span><span class="p">.</span><span class="n">Type</span><span class="p">)</span> <span class="p">{</span>
			<span class="k">if</span> <span class="p">(</span><span class="n">plynr</span> <span class="o">==</span> <span class="mi">-1</span> <span class="o">||</span> <span class="n">plynr</span> <span class="o">==</span> <span class="n">unit</span><span class="p">.</span><span class="n">Player</span><span class="o">-&gt;</span><span class="n">Index</span><span class="p">)</span> <span class="p">{</span>
				<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">order</span><span class="p">,</span> <span class="s">&quot;move&quot;</span><span class="p">))</span> <span class="p">{</span>
					<span class="n">CommandMove</span><span class="p">(</span><span class="n">unit</span><span class="p">,</span> <span class="p">(</span><span class="n">dpos1</span> <span class="o">+</span> <span class="n">dpos2</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
				<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">order</span><span class="p">,</span> <span class="s">&quot;stop&quot;</span><span class="p">))</span> <span class="p">{</span>
					<span class="n">CommandStopUnit</span><span class="p">(</span><span class="n">unit</span><span class="p">);</span> <span class="c1">//Stop the unit</span>
				<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">order</span><span class="p">,</span> <span class="s">&quot;stand-ground&quot;</span><span class="p">))</span> <span class="p">{</span>
					<span class="n">CommandStandGround</span><span class="p">(</span><span class="n">unit</span><span class="p">,</span><span class="mi">0</span><span class="p">);</span> <span class="c1">//Stand and flush every order</span>
				<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">order</span><span class="p">,</span> <span class="s">&quot;attack&quot;</span><span class="p">))</span> <span class="p">{</span>
					<span class="n">CUnit</span> <span class="o">*</span><span class="n">attack</span> <span class="o">=</span> <span class="n">TargetOnMap</span><span class="p">(</span><span class="n">unit</span><span class="p">,</span> <span class="n">dpos1</span><span class="p">,</span> <span class="n">dpos2</span><span class="p">);</span>
					<span class="n">CommandAttack</span><span class="p">(</span><span class="n">unit</span><span class="p">,</span> <span class="p">(</span><span class="n">dpos1</span> <span class="o">+</span> <span class="n">dpos2</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="n">attack</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
				<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">order</span><span class="p">,</span> <span class="s">&quot;explore&quot;</span><span class="p">))</span> <span class="p">{</span>
					<span class="n">CommandExplore</span><span class="p">(</span><span class="n">unit</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
				<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">order</span><span class="p">,</span> <span class="s">&quot;patrol&quot;</span><span class="p">))</span> <span class="p">{</span>
					<span class="n">CommandPatrolUnit</span><span class="p">(</span><span class="n">unit</span><span class="p">,</span> <span class="p">(</span><span class="n">dpos1</span> <span class="o">+</span> <span class="n">dpos2</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
				<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
					<span class="n">LuaError</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="s">&quot;Unsupported order: %s&quot;</span> <span class="n">_C_</span> <span class="n">order</span><span class="p">);</span>
				<span class="p">}</span>
			<span class="p">}</span>
		<span class="p">}</span>
	<span class="p">}</span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</p>
                          </details>
                        </details>
                        
                        <details>
                        <summary>KillUnit</summary>
                        <p><br> <b>Description</b><br><br>  Kill a unit<br><br>  @param l  Lua state.<br><br>  @return   Returns true if a unit was killed.<br><br> Example:<br><br> <div class="example"><code>-- Kills an ogre controlled by player 3<br>		<strong>KillUnit</strong>("unit-ogre", 3)</code></div></p>
                          <details>
                          <summary>/unit/script_unit.cpp:992 CclKillUnit</summary>
                          <p><div class="highlight"><pre><span></span><span class="k">static</span> <span class="kt">int</span> <span class="nf">CclKillUnit</span><span class="p">(</span><span class="n">lua_State</span> <span class="o">*</span><span class="n">l</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">LuaCheckArgs</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">2</span><span class="p">);</span>

	<span class="n">lua_pushvalue</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
	<span class="k">const</span> <span class="n">CUnitType</span> <span class="o">*</span><span class="n">unittype</span> <span class="o">=</span> <span class="n">TriggerGetUnitType</span><span class="p">(</span><span class="n">l</span><span class="p">);</span>
	<span class="n">lua_pop</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
	<span class="k">const</span> <span class="kt">int</span> <span class="n">plynr</span> <span class="o">=</span> <span class="n">TriggerGetPlayer</span><span class="p">(</span><span class="n">l</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">plynr</span> <span class="o">==</span> <span class="mi">-1</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">CUnitManager</span><span class="o">::</span><span class="n">Iterator</span> <span class="n">it</span> <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="n">find_if</span><span class="p">(</span><span class="n">UnitManager</span><span class="p">.</span><span class="n">begin</span><span class="p">(),</span> <span class="n">UnitManager</span><span class="p">.</span><span class="n">end</span><span class="p">(),</span> <span class="n">HasSameUnitTypeAs</span><span class="p">(</span><span class="n">unittype</span><span class="p">));</span>

		<span class="k">if</span> <span class="p">(</span><span class="n">it</span> <span class="o">!=</span> <span class="n">UnitManager</span><span class="p">.</span><span class="n">end</span><span class="p">())</span> <span class="p">{</span>
			<span class="n">LetUnitDie</span><span class="p">(</span><span class="o">**</span><span class="n">it</span><span class="p">);</span>
			<span class="n">lua_pushboolean</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
			<span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
		<span class="p">}</span>
	<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
		<span class="n">CPlayer</span> <span class="o">&amp;</span><span class="n">player</span> <span class="o">=</span> <span class="n">Players</span><span class="p">[</span><span class="n">plynr</span><span class="p">];</span>
		<span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">CUnit</span> <span class="o">*&gt;::</span><span class="n">iterator</span> <span class="n">it</span> <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="n">find_if</span><span class="p">(</span><span class="n">player</span><span class="p">.</span><span class="n">UnitBegin</span><span class="p">(),</span> <span class="n">player</span><span class="p">.</span><span class="n">UnitEnd</span><span class="p">(),</span> <span class="n">HasSameUnitTypeAs</span><span class="p">(</span><span class="n">unittype</span><span class="p">));</span>

		<span class="k">if</span> <span class="p">(</span><span class="n">it</span> <span class="o">!=</span> <span class="n">player</span><span class="p">.</span><span class="n">UnitEnd</span><span class="p">())</span> <span class="p">{</span>
			<span class="n">LetUnitDie</span><span class="p">(</span><span class="o">**</span><span class="n">it</span><span class="p">);</span>
			<span class="n">lua_pushboolean</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
			<span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
		<span class="p">}</span>
	<span class="p">}</span>
	<span class="n">lua_pushboolean</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
	<span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</p>
                          </details>
                        </details>
                        
                        <details>
                        <summary>KillUnitAt</summary>
                        <p><br> <b>Description</b><br><br>  Kill a unit at a location<br><br>  @param l  Lua state.<br><br>  @return   Returns the number of units killed.<br><br> Example:<br><br> <div class="example"><code>-- Kill 8 peasants controlled by player 7 from position {27,1} to {34,5}<br>		<strong>KillUnitAt</strong>("unit-peasant",7,8,{27,1},{34,5})</code></div></p>
                          <details>
                          <summary>/unit/script_unit.cpp:1048 CclKillUnitAt</summary>
                          <p><div class="highlight"><pre><span></span><span class="k">static</span> <span class="kt">int</span> <span class="nf">CclKillUnitAt</span><span class="p">(</span><span class="n">lua_State</span> <span class="o">*</span><span class="n">l</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">LuaCheckArgs</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">5</span><span class="p">);</span>

	<span class="n">lua_pushvalue</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
	<span class="k">const</span> <span class="n">CUnitType</span> <span class="o">*</span><span class="n">unittype</span> <span class="o">=</span> <span class="n">TriggerGetUnitType</span><span class="p">(</span><span class="n">l</span><span class="p">);</span>
	<span class="n">lua_pop</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
	<span class="n">lua_pushvalue</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">2</span><span class="p">);</span>
	<span class="kt">int</span> <span class="n">plynr</span> <span class="o">=</span> <span class="n">TriggerGetPlayer</span><span class="p">(</span><span class="n">l</span><span class="p">);</span>
	<span class="n">lua_pop</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
	<span class="kt">int</span> <span class="n">q</span> <span class="o">=</span> <span class="n">LuaToNumber</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">3</span><span class="p">);</span>

	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">lua_istable</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span> <span class="o">||</span> <span class="o">!</span><span class="n">lua_istable</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span> <span class="p">{</span>
		<span class="n">LuaError</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="s">&quot;incorrect argument&quot;</span><span class="p">);</span>
	<span class="p">}</span>
	<span class="n">Vec2i</span> <span class="n">pos1</span><span class="p">;</span>
	<span class="n">Vec2i</span> <span class="n">pos2</span><span class="p">;</span>
	<span class="n">CclGetPos</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">pos1</span><span class="p">.</span><span class="n">x</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">pos1</span><span class="p">.</span><span class="n">y</span><span class="p">,</span> <span class="mi">4</span><span class="p">);</span>
	<span class="n">CclGetPos</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">pos2</span><span class="p">.</span><span class="n">x</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">pos2</span><span class="p">.</span><span class="n">y</span><span class="p">,</span> <span class="mi">5</span><span class="p">);</span>

	<span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">CUnit</span> <span class="o">*&gt;</span> <span class="n">table</span><span class="p">;</span>

	<span class="n">Select</span><span class="p">(</span><span class="n">pos1</span><span class="p">,</span> <span class="n">pos2</span><span class="p">,</span> <span class="n">table</span><span class="p">);</span>

	<span class="kt">int</span> <span class="n">s</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="k">for</span> <span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">CUnit</span> <span class="o">*&gt;::</span><span class="n">iterator</span> <span class="n">it</span> <span class="o">=</span> <span class="n">table</span><span class="p">.</span><span class="n">begin</span><span class="p">();</span> <span class="n">it</span> <span class="o">!=</span> <span class="n">table</span><span class="p">.</span><span class="n">end</span><span class="p">()</span> <span class="o">&amp;&amp;</span> <span class="n">s</span> <span class="o">&lt;</span> <span class="n">q</span><span class="p">;</span> <span class="o">++</span><span class="n">it</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">CUnit</span> <span class="o">&amp;</span><span class="n">unit</span> <span class="o">=</span> <span class="o">**</span><span class="n">it</span><span class="p">;</span>

		<span class="k">if</span> <span class="p">(</span><span class="n">unittype</span> <span class="o">==</span> <span class="n">ANY_UNIT</span>
			<span class="o">||</span> <span class="p">(</span><span class="n">unittype</span> <span class="o">==</span> <span class="n">ALL_FOODUNITS</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="n">unit</span><span class="p">.</span><span class="n">Type</span><span class="o">-&gt;</span><span class="n">Building</span><span class="p">)</span>
			<span class="o">||</span> <span class="p">(</span><span class="n">unittype</span> <span class="o">==</span> <span class="n">ALL_BUILDINGS</span> <span class="o">&amp;&amp;</span> <span class="n">unit</span><span class="p">.</span><span class="n">Type</span><span class="o">-&gt;</span><span class="n">Building</span><span class="p">)</span>
			<span class="o">||</span> <span class="n">unittype</span> <span class="o">==</span> <span class="n">unit</span><span class="p">.</span><span class="n">Type</span><span class="p">)</span> <span class="p">{</span>
			<span class="k">if</span> <span class="p">((</span><span class="n">plynr</span> <span class="o">==</span> <span class="mi">-1</span> <span class="o">||</span> <span class="n">plynr</span> <span class="o">==</span> <span class="n">unit</span><span class="p">.</span><span class="n">Player</span><span class="o">-&gt;</span><span class="n">Index</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="n">unit</span><span class="p">.</span><span class="n">IsAlive</span><span class="p">())</span> <span class="p">{</span>
				<span class="n">LetUnitDie</span><span class="p">(</span><span class="n">unit</span><span class="p">);</span>
				<span class="o">++</span><span class="n">s</span><span class="p">;</span>
			<span class="p">}</span>
		<span class="p">}</span>
	<span class="p">}</span>
	<span class="n">lua_pushnumber</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">s</span><span class="p">);</span>
	<span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</p>
                          </details>
                        </details>
                        
                        <details>
                        <summary>GetUnits</summary>
                        <p><br> <b>Description</b><br><br>  Get a player's units<br><br>  @param l  Lua state.<br><br>  @return   Array of units.</p>
                          <details>
                          <summary>/unit/script_unit.cpp:1080 CclGetUnits</summary>
                          <p><div class="highlight"><pre><span></span><span class="k">static</span> <span class="kt">int</span> <span class="nf">CclGetUnits</span><span class="p">(</span><span class="n">lua_State</span> <span class="o">*</span><span class="n">l</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">LuaCheckArgs</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>

	<span class="k">const</span> <span class="kt">int</span> <span class="n">plynr</span> <span class="o">=</span> <span class="n">TriggerGetPlayer</span><span class="p">(</span><span class="n">l</span><span class="p">);</span>

	<span class="n">lua_newtable</span><span class="p">(</span><span class="n">l</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">plynr</span> <span class="o">==</span> <span class="mi">-1</span><span class="p">)</span> <span class="p">{</span>
		<span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
		<span class="k">for</span> <span class="p">(</span><span class="n">CUnitManager</span><span class="o">::</span><span class="n">Iterator</span> <span class="n">it</span> <span class="o">=</span> <span class="n">UnitManager</span><span class="p">.</span><span class="n">begin</span><span class="p">();</span> <span class="n">it</span> <span class="o">!=</span> <span class="n">UnitManager</span><span class="p">.</span><span class="n">end</span><span class="p">();</span> <span class="o">++</span><span class="n">it</span><span class="p">,</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span> <span class="p">{</span>
			<span class="k">const</span> <span class="n">CUnit</span> <span class="o">&amp;</span><span class="n">unit</span> <span class="o">=</span> <span class="o">**</span><span class="n">it</span><span class="p">;</span>
			<span class="n">lua_pushnumber</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">UnitNumber</span><span class="p">(</span><span class="n">unit</span><span class="p">));</span>
			<span class="n">lua_rawseti</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">-2</span><span class="p">,</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>
		<span class="p">}</span>
	<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
		<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">Players</span><span class="p">[</span><span class="n">plynr</span><span class="p">].</span><span class="n">GetUnitCount</span><span class="p">();</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span> <span class="p">{</span>
			<span class="n">lua_pushnumber</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">UnitNumber</span><span class="p">(</span><span class="n">Players</span><span class="p">[</span><span class="n">plynr</span><span class="p">].</span><span class="n">GetUnit</span><span class="p">(</span><span class="n">i</span><span class="p">)));</span>
			<span class="n">lua_rawseti</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">-2</span><span class="p">,</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>
		<span class="p">}</span>
	<span class="p">}</span>
	<span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</p>
                          </details>
                        </details>
                        
                        <details>
                        <summary>GetUnitsAroundUnit</summary>
                        <p><br>  Get a player's units in rectangle box specified with 2 coordinates<br><br>  @param l  Lua state.<br><br>  @return   Array of units.</p>
                          <details>
                          <summary>/unit/script_unit.cpp:1118 CclGetUnitsAroundUnit</summary>
                          <p><div class="highlight"><pre><span></span><span class="k">static</span> <span class="kt">int</span> <span class="nf">CclGetUnitsAroundUnit</span><span class="p">(</span><span class="n">lua_State</span> <span class="o">*</span><span class="n">l</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">const</span> <span class="kt">int</span> <span class="n">nargs</span> <span class="o">=</span> <span class="n">lua_gettop</span><span class="p">(</span><span class="n">l</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">nargs</span> <span class="o">!=</span> <span class="mi">2</span> <span class="o">&amp;&amp;</span> <span class="n">nargs</span> <span class="o">!=</span> <span class="mi">3</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">LuaError</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="s">&quot;incorrect argument</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
	<span class="p">}</span>

	<span class="k">const</span> <span class="kt">int</span> <span class="n">slot</span> <span class="o">=</span> <span class="n">LuaToNumber</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
	<span class="k">const</span> <span class="n">CUnit</span> <span class="o">&amp;</span><span class="n">unit</span> <span class="o">=</span> <span class="n">UnitManager</span><span class="p">.</span><span class="n">GetSlotUnit</span><span class="p">(</span><span class="n">slot</span><span class="p">);</span>
	<span class="k">const</span> <span class="kt">int</span> <span class="n">range</span> <span class="o">=</span> <span class="n">LuaToNumber</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">2</span><span class="p">);</span>
	<span class="kt">bool</span> <span class="n">allUnits</span> <span class="o">=</span> <span class="nb">false</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">nargs</span> <span class="o">==</span> <span class="mi">3</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">allUnits</span> <span class="o">=</span> <span class="n">LuaToBoolean</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">3</span><span class="p">);</span>
	<span class="p">}</span>
	<span class="n">lua_newtable</span><span class="p">(</span><span class="n">l</span><span class="p">);</span>
	<span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">CUnit</span> <span class="o">*&gt;</span> <span class="n">table</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">allUnits</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">SelectAroundUnit</span><span class="p">(</span><span class="n">unit</span><span class="p">,</span> <span class="n">range</span><span class="p">,</span> <span class="n">table</span><span class="p">,</span> <span class="n">HasNotSamePlayerAs</span><span class="p">(</span><span class="n">Players</span><span class="p">[</span><span class="n">PlayerNumNeutral</span><span class="p">]));</span>
	<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
		<span class="n">SelectAroundUnit</span><span class="p">(</span><span class="n">unit</span><span class="p">,</span> <span class="n">range</span><span class="p">,</span> <span class="n">table</span><span class="p">,</span> <span class="n">HasSamePlayerAs</span><span class="p">(</span><span class="o">*</span><span class="n">unit</span><span class="p">.</span><span class="n">Player</span><span class="p">));</span>
	<span class="p">}</span>
	<span class="kt">size_t</span> <span class="n">n</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="k">for</span> <span class="p">(</span><span class="kt">size_t</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">table</span><span class="p">.</span><span class="n">size</span><span class="p">();</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">table</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">-&gt;</span><span class="n">IsAliveOnMap</span><span class="p">())</span> <span class="p">{</span>
			<span class="n">lua_pushnumber</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">UnitNumber</span><span class="p">(</span><span class="o">*</span><span class="n">table</span><span class="p">[</span><span class="n">i</span><span class="p">]));</span>
			<span class="n">lua_rawseti</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">-2</span><span class="p">,</span> <span class="o">++</span><span class="n">n</span><span class="p">);</span>
		<span class="p">}</span>
	<span class="p">}</span>
	<span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</p>
                          </details>
                        </details>
                        
                        <details>
                        <summary>GetUnitBoolFlag</summary>
                        <p><br><br>  Get the value of the unit bool-flag.<br><br>  @param l  Lua state.<br><br>  @return   The value of the bool-flag of the unit.</p>
                          <details>
                          <summary>/unit/script_unit.cpp:1143 CclGetUnitBoolFlag</summary>
                          <p><div class="highlight"><pre><span></span><span class="k">static</span> <span class="kt">int</span> <span class="nf">CclGetUnitBoolFlag</span><span class="p">(</span><span class="n">lua_State</span> <span class="o">*</span><span class="n">l</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">LuaCheckArgs</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">2</span><span class="p">);</span>

	<span class="n">lua_pushvalue</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
	<span class="k">const</span> <span class="n">CUnit</span> <span class="o">*</span><span class="n">unit</span> <span class="o">=</span> <span class="n">CclGetUnit</span><span class="p">(</span><span class="n">l</span><span class="p">);</span>
	<span class="n">lua_pop</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>

	<span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="k">const</span> <span class="n">value</span> <span class="o">=</span> <span class="n">LuaToString</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">2</span><span class="p">);</span>
	<span class="kt">int</span> <span class="n">index</span> <span class="o">=</span> <span class="n">UnitTypeVar</span><span class="p">.</span><span class="n">BoolFlagNameLookup</span><span class="p">[</span><span class="n">value</span><span class="p">];</span><span class="c1">// User bool flags</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">index</span> <span class="o">==</span> <span class="mi">-1</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">LuaError</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="s">&quot;Bad bool-flag name &#39;%s&#39;</span><span class="se">\n</span><span class="s">&quot;</span> <span class="n">_C_</span> <span class="n">value</span><span class="p">);</span>
	<span class="p">}</span>
	<span class="n">lua_pushboolean</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">unit</span><span class="o">-&gt;</span><span class="n">Type</span><span class="o">-&gt;</span><span class="n">BoolFlag</span><span class="p">[</span><span class="n">index</span><span class="p">].</span><span class="n">value</span><span class="p">);</span>
	<span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</p>
                          </details>
                        </details>
                        
                        <details>
                        <summary>GetUnitVariable</summary>
                        <p><br> <b>Description</b><br><br>  Get the value of the unit variable.<br><br>  @param l  Lua state.<br><br>  @return   The value of the variable of the unit.<br><br> Example:<br><br> <div class="example"><code>-- Make a grunt for player 5<br>		grunt = CreateUnit("unit-grunt", 5, {58, 8})<br>		-- Take the name of the unit<br>		unit_name = <strong>GetUnitVariable</strong>(grunt,"Name")<br>		-- Take the player number based on the unit<br>		player_type = <strong>GetUnitVariable</strong>(grunt,"PlayerType")<br>		-- Take the value of the armor<br>		armor_value = <strong>GetUnitVariable</strong>(grunt,"Armor")<br>		-- Show the message in the game.<br>		AddMessage(unit_name .. " " .. player_type .. " " .. armor_value)</code></div></p>
                          <details>
                          <summary>/unit/script_unit.cpp:1249 CclGetUnitVariable</summary>
                          <p><div class="highlight"><pre><span></span><span class="k">static</span> <span class="kt">int</span> <span class="nf">CclGetUnitVariable</span><span class="p">(</span><span class="n">lua_State</span> <span class="o">*</span><span class="n">l</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">const</span> <span class="kt">int</span> <span class="n">nargs</span> <span class="o">=</span> <span class="n">lua_gettop</span><span class="p">(</span><span class="n">l</span><span class="p">);</span>
	<span class="n">Assert</span><span class="p">(</span><span class="n">nargs</span> <span class="o">==</span> <span class="mi">2</span> <span class="o">||</span> <span class="n">nargs</span> <span class="o">==</span> <span class="mi">3</span><span class="p">);</span>

	<span class="n">lua_pushvalue</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
	<span class="n">CUnit</span> <span class="o">*</span><span class="n">unit</span> <span class="o">=</span> <span class="n">CclGetUnit</span><span class="p">(</span><span class="n">l</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">unit</span> <span class="o">==</span> <span class="nb">NULL</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="n">UpdateUnitVariables</span><span class="p">(</span><span class="o">*</span><span class="n">unit</span><span class="p">);</span>
	<span class="n">lua_pop</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>

	<span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="k">const</span> <span class="n">value</span> <span class="o">=</span> <span class="n">LuaToString</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">2</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s">&quot;RegenerationRate&quot;</span><span class="p">))</span> <span class="p">{</span>
		<span class="n">lua_pushnumber</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">unit</span><span class="o">-&gt;</span><span class="n">Variable</span><span class="p">[</span><span class="n">HP_INDEX</span><span class="p">].</span><span class="n">Increase</span><span class="p">);</span>
	<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s">&quot;RegenerationFrequency&quot;</span><span class="p">))</span> <span class="p">{</span>
		<span class="n">lua_pushnumber</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">std</span><span class="o">::</span><span class="n">max</span><span class="p">((</span><span class="kt">int</span><span class="p">)</span><span class="n">unit</span><span class="o">-&gt;</span><span class="n">Variable</span><span class="p">[</span><span class="n">HP_INDEX</span><span class="p">].</span><span class="n">IncreaseFrequency</span><span class="p">,</span> <span class="mi">1</span><span class="p">));</span>
	<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s">&quot;Ident&quot;</span><span class="p">))</span> <span class="p">{</span>
		<span class="n">lua_pushstring</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">unit</span><span class="o">-&gt;</span><span class="n">Type</span><span class="o">-&gt;</span><span class="n">Ident</span><span class="p">.</span><span class="n">c_str</span><span class="p">());</span>
	<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s">&quot;ResourcesHeld&quot;</span><span class="p">))</span> <span class="p">{</span>
		<span class="n">lua_pushnumber</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">unit</span><span class="o">-&gt;</span><span class="n">ResourcesHeld</span><span class="p">);</span>
	<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s">&quot;GiveResourceType&quot;</span><span class="p">))</span> <span class="p">{</span>
		<span class="n">lua_pushnumber</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">unit</span><span class="o">-&gt;</span><span class="n">Type</span><span class="o">-&gt;</span><span class="n">GivesResource</span><span class="p">);</span>
	<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s">&quot;CurrentResource&quot;</span><span class="p">))</span> <span class="p">{</span>
		<span class="n">lua_pushnumber</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">unit</span><span class="o">-&gt;</span><span class="n">CurrentResource</span><span class="p">);</span>
	<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s">&quot;Name&quot;</span><span class="p">))</span> <span class="p">{</span>
		<span class="n">lua_pushstring</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">unit</span><span class="o">-&gt;</span><span class="n">Type</span><span class="o">-&gt;</span><span class="n">Name</span><span class="p">.</span><span class="n">c_str</span><span class="p">());</span>
	<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s">&quot;PlayerType&quot;</span><span class="p">))</span> <span class="p">{</span>
		<span class="n">lua_pushinteger</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">unit</span><span class="o">-&gt;</span><span class="n">Player</span><span class="o">-&gt;</span><span class="n">Type</span><span class="p">);</span>
	<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s">&quot;TTLPercent&quot;</span><span class="p">))</span> <span class="p">{</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">unit</span><span class="o">-&gt;</span><span class="n">Summoned</span> <span class="o">&amp;&amp;</span> <span class="n">unit</span><span class="o">-&gt;</span><span class="n">TTL</span><span class="p">)</span> <span class="p">{</span>
			<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">time_lived</span> <span class="o">=</span> <span class="n">GameCycle</span> <span class="o">-</span> <span class="n">unit</span><span class="o">-&gt;</span><span class="n">Summoned</span><span class="p">;</span>
			<span class="n">Assert</span><span class="p">(</span><span class="n">time_lived</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">);</span>
			<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">time_to_live</span> <span class="o">=</span> <span class="n">unit</span><span class="o">-&gt;</span><span class="n">TTL</span> <span class="o">-</span> <span class="n">unit</span><span class="o">-&gt;</span><span class="n">Summoned</span><span class="p">;</span>
			<span class="n">Assert</span><span class="p">(</span><span class="n">time_to_live</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">);</span>
			<span class="kt">double</span> <span class="n">pcnt</span> <span class="o">=</span> <span class="n">time_lived</span> <span class="o">*</span> <span class="mf">100.0</span> <span class="o">/</span> <span class="n">time_to_live</span><span class="p">;</span>
			<span class="kt">int</span> <span class="n">pcnt_i</span> <span class="o">=</span> <span class="p">(</span><span class="kt">int</span><span class="p">)</span><span class="n">round</span><span class="p">(</span><span class="n">pcnt</span><span class="p">);</span>
			<span class="n">lua_pushinteger</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">pcnt_i</span><span class="p">);</span>
		<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
			<span class="n">lua_pushinteger</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">-1</span><span class="p">);</span>
		<span class="p">}</span>
	<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s">&quot;IndividualUpgrade&quot;</span><span class="p">))</span> <span class="p">{</span>
		<span class="n">LuaCheckArgs</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">3</span><span class="p">);</span>
		<span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">upgrade_ident</span> <span class="o">=</span> <span class="n">LuaToString</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">3</span><span class="p">);</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">CUpgrade</span><span class="o">::</span><span class="n">Get</span><span class="p">(</span><span class="n">upgrade_ident</span><span class="p">))</span> <span class="p">{</span>
			<span class="n">lua_pushboolean</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">unit</span><span class="o">-&gt;</span><span class="n">IndividualUpgrades</span><span class="p">[</span><span class="n">CUpgrade</span><span class="o">::</span><span class="n">Get</span><span class="p">(</span><span class="n">upgrade_ident</span><span class="p">)</span><span class="o">-&gt;</span><span class="n">ID</span><span class="p">]);</span>
		<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
			<span class="n">LuaError</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="s">&quot;Individual upgrade </span><span class="se">\&quot;</span><span class="s">%s</span><span class="se">\&quot;</span><span class="s"> doesn&#39;t exist.&quot;</span> <span class="n">_C_</span> <span class="n">upgrade_ident</span><span class="p">.</span><span class="n">c_str</span><span class="p">());</span>
		<span class="p">}</span>
		<span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
	<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s">&quot;Active&quot;</span><span class="p">))</span> <span class="p">{</span>
		<span class="n">lua_pushboolean</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">unit</span><span class="o">-&gt;</span><span class="n">Active</span><span class="p">);</span>
		<span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
	<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s">&quot;Idle&quot;</span><span class="p">))</span> <span class="p">{</span>
		<span class="n">lua_pushboolean</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">unit</span><span class="o">-&gt;</span><span class="n">IsIdle</span><span class="p">());</span>
		<span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
	<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
		<span class="kt">int</span> <span class="n">index</span> <span class="o">=</span> <span class="n">UnitTypeVar</span><span class="p">.</span><span class="n">VariableNameLookup</span><span class="p">[</span><span class="n">value</span><span class="p">];</span><span class="c1">// User variables</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">index</span> <span class="o">==</span> <span class="mi">-1</span><span class="p">)</span> <span class="p">{</span>
			<span class="n">LuaError</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="s">&quot;Bad variable name &#39;%s&#39;</span><span class="se">\n</span><span class="s">&quot;</span> <span class="n">_C_</span> <span class="n">value</span><span class="p">);</span>
		<span class="p">}</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">nargs</span> <span class="o">==</span> <span class="mi">2</span><span class="p">)</span> <span class="p">{</span>
			<span class="n">lua_pushnumber</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">unit</span><span class="o">-&gt;</span><span class="n">Variable</span><span class="p">[</span><span class="n">index</span><span class="p">].</span><span class="n">Value</span><span class="p">);</span>
		<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
			<span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="k">const</span> <span class="n">type</span> <span class="o">=</span> <span class="n">LuaToString</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">3</span><span class="p">);</span>
			<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">type</span><span class="p">,</span> <span class="s">&quot;Value&quot;</span><span class="p">))</span> <span class="p">{</span>
				<span class="n">lua_pushnumber</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">unit</span><span class="o">-&gt;</span><span class="n">Variable</span><span class="p">[</span><span class="n">index</span><span class="p">].</span><span class="n">Value</span><span class="p">);</span>
			<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">type</span><span class="p">,</span> <span class="s">&quot;Max&quot;</span><span class="p">))</span> <span class="p">{</span>
				<span class="n">lua_pushnumber</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">unit</span><span class="o">-&gt;</span><span class="n">Variable</span><span class="p">[</span><span class="n">index</span><span class="p">].</span><span class="n">Max</span><span class="p">);</span>
			<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">type</span><span class="p">,</span> <span class="s">&quot;Increase&quot;</span><span class="p">))</span> <span class="p">{</span>
				<span class="n">lua_pushnumber</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">unit</span><span class="o">-&gt;</span><span class="n">Variable</span><span class="p">[</span><span class="n">index</span><span class="p">].</span><span class="n">Increase</span><span class="p">);</span>
			<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">type</span><span class="p">,</span> <span class="s">&quot;IncreaseFrequency&quot;</span><span class="p">))</span> <span class="p">{</span>
				<span class="n">lua_pushnumber</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">std</span><span class="o">::</span><span class="n">max</span><span class="p">((</span><span class="kt">int</span><span class="p">)</span><span class="n">unit</span><span class="o">-&gt;</span><span class="n">Variable</span><span class="p">[</span><span class="n">index</span><span class="p">].</span><span class="n">IncreaseFrequency</span><span class="p">,</span> <span class="mi">1</span><span class="p">));</span>
			<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">type</span><span class="p">,</span> <span class="s">&quot;Enable&quot;</span><span class="p">))</span> <span class="p">{</span>
				<span class="n">lua_pushnumber</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">unit</span><span class="o">-&gt;</span><span class="n">Variable</span><span class="p">[</span><span class="n">index</span><span class="p">].</span><span class="n">Enable</span><span class="p">);</span>
			<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
				<span class="n">LuaError</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="s">&quot;Bad variable type &#39;%s&#39;</span><span class="se">\n</span><span class="s">&quot;</span> <span class="n">_C_</span> <span class="n">type</span><span class="p">);</span>
			<span class="p">}</span>
		<span class="p">}</span>
	<span class="p">}</span>
	<span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</p>
                          </details>
                        </details>
                        
                        <details>
                        <summary>SetUnitVariable</summary>
                        <p><br> <b>Description</b><br><br>  Set the value of the unit variable.<br><br>  @param l  Lua state.<br><br>  @return The new value of the unit.<br><br> Example:<br><br> <div class="example"><code>-- Create a blacksmith for player 2<br>		blacksmith = CreateUnit("unit-human-blacksmith", 2, {66, 71})<br>		-- Specify the amount of hit points to assign to the blacksmith<br>		<strong>SetUnitVariable</strong>(blacksmith,"HitPoints",344)</code></div></p>
                          <details>
                          <summary>/unit/script_unit.cpp:1373 CclSetUnitVariable</summary>
                          <p><div class="highlight"><pre><span></span><span class="k">static</span> <span class="kt">int</span> <span class="nf">CclSetUnitVariable</span><span class="p">(</span><span class="n">lua_State</span> <span class="o">*</span><span class="n">l</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">const</span> <span class="kt">int</span> <span class="n">nargs</span> <span class="o">=</span> <span class="n">lua_gettop</span><span class="p">(</span><span class="n">l</span><span class="p">);</span>
	<span class="n">Assert</span><span class="p">(</span><span class="n">nargs</span> <span class="o">&gt;=</span> <span class="mi">3</span> <span class="o">&amp;&amp;</span> <span class="n">nargs</span> <span class="o">&lt;=</span> <span class="mi">5</span><span class="p">);</span>

	<span class="n">lua_pushvalue</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
	<span class="n">CUnit</span> <span class="o">*</span><span class="n">unit</span> <span class="o">=</span> <span class="n">CclGetUnit</span><span class="p">(</span><span class="n">l</span><span class="p">);</span>
	<span class="n">lua_pop</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
	<span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="k">const</span> <span class="n">name</span> <span class="o">=</span> <span class="n">LuaToString</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">2</span><span class="p">);</span>
	<span class="kt">int</span> <span class="n">value</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="s">&quot;Player&quot;</span><span class="p">))</span> <span class="p">{</span>
		<span class="n">value</span> <span class="o">=</span> <span class="n">LuaToNumber</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">3</span><span class="p">);</span>
		<span class="n">unit</span><span class="o">-&gt;</span><span class="n">AssignToPlayer</span><span class="p">(</span><span class="n">Players</span><span class="p">[</span><span class="n">value</span><span class="p">]);</span>
	<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="s">&quot;TTL&quot;</span><span class="p">))</span> <span class="p">{</span>
		<span class="n">value</span> <span class="o">=</span> <span class="n">LuaToNumber</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">3</span><span class="p">);</span>
		<span class="n">unit</span><span class="o">-&gt;</span><span class="n">TTL</span> <span class="o">=</span> <span class="n">GameCycle</span> <span class="o">+</span> <span class="n">value</span><span class="p">;</span>
	<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="s">&quot;Summoned&quot;</span><span class="p">))</span> <span class="p">{</span>
		<span class="n">value</span> <span class="o">=</span> <span class="n">LuaToNumber</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">3</span><span class="p">);</span>
		<span class="n">unit</span><span class="o">-&gt;</span><span class="n">Summoned</span> <span class="o">=</span> <span class="n">value</span><span class="p">;</span>
	<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="s">&quot;RegenerationRate&quot;</span><span class="p">))</span> <span class="p">{</span>
		<span class="n">value</span> <span class="o">=</span> <span class="n">LuaToNumber</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">3</span><span class="p">);</span>
		<span class="n">unit</span><span class="o">-&gt;</span><span class="n">Variable</span><span class="p">[</span><span class="n">HP_INDEX</span><span class="p">].</span><span class="n">Increase</span> <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="n">min</span><span class="p">(</span><span class="n">unit</span><span class="o">-&gt;</span><span class="n">Variable</span><span class="p">[</span><span class="n">HP_INDEX</span><span class="p">].</span><span class="n">Max</span><span class="p">,</span> <span class="n">value</span><span class="p">);</span>
	<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="s">&quot;RegenerationFrequency&quot;</span><span class="p">))</span> <span class="p">{</span>
		<span class="n">value</span> <span class="o">=</span> <span class="n">LuaToNumber</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">3</span><span class="p">);</span>
		<span class="n">unit</span><span class="o">-&gt;</span><span class="n">Variable</span><span class="p">[</span><span class="n">HP_INDEX</span><span class="p">].</span><span class="n">IncreaseFrequency</span> <span class="o">=</span> <span class="n">value</span><span class="p">;</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">unit</span><span class="o">-&gt;</span><span class="n">Variable</span><span class="p">[</span><span class="n">HP_INDEX</span><span class="p">].</span><span class="n">IncreaseFrequency</span> <span class="o">!=</span> <span class="n">value</span><span class="p">)</span> <span class="p">{</span>
			<span class="n">LuaError</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="s">&quot;RegenerationFrequency out of range!&quot;</span><span class="p">);</span>
		<span class="p">}</span>
	<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="s">&quot;IndividualUpgrade&quot;</span><span class="p">))</span> <span class="p">{</span>
		<span class="n">LuaCheckArgs</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">4</span><span class="p">);</span>
		<span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">upgrade_ident</span> <span class="o">=</span> <span class="n">LuaToString</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">3</span><span class="p">);</span>
		<span class="kt">bool</span> <span class="n">has_upgrade</span> <span class="o">=</span> <span class="n">LuaToBoolean</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">4</span><span class="p">);</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">CUpgrade</span><span class="o">::</span><span class="n">Get</span><span class="p">(</span><span class="n">upgrade_ident</span><span class="p">))</span> <span class="p">{</span>
			<span class="k">if</span> <span class="p">(</span><span class="n">has_upgrade</span> <span class="o">&amp;&amp;</span> <span class="n">unit</span><span class="o">-&gt;</span><span class="n">IndividualUpgrades</span><span class="p">[</span><span class="n">CUpgrade</span><span class="o">::</span><span class="n">Get</span><span class="p">(</span><span class="n">upgrade_ident</span><span class="p">)</span><span class="o">-&gt;</span><span class="n">ID</span><span class="p">]</span> <span class="o">==</span> <span class="nb">false</span><span class="p">)</span> <span class="p">{</span>
				<span class="n">IndividualUpgradeAcquire</span><span class="p">(</span><span class="o">*</span><span class="n">unit</span><span class="p">,</span> <span class="n">CUpgrade</span><span class="o">::</span><span class="n">Get</span><span class="p">(</span><span class="n">upgrade_ident</span><span class="p">));</span>
			<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">has_upgrade</span> <span class="o">&amp;&amp;</span> <span class="n">unit</span><span class="o">-&gt;</span><span class="n">IndividualUpgrades</span><span class="p">[</span><span class="n">CUpgrade</span><span class="o">::</span><span class="n">Get</span><span class="p">(</span><span class="n">upgrade_ident</span><span class="p">)</span><span class="o">-&gt;</span><span class="n">ID</span><span class="p">])</span> <span class="p">{</span>
				<span class="n">IndividualUpgradeLost</span><span class="p">(</span><span class="o">*</span><span class="n">unit</span><span class="p">,</span> <span class="n">CUpgrade</span><span class="o">::</span><span class="n">Get</span><span class="p">(</span><span class="n">upgrade_ident</span><span class="p">));</span>
			<span class="p">}</span>
		<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
			<span class="n">LuaError</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="s">&quot;Individual upgrade </span><span class="se">\&quot;</span><span class="s">%s</span><span class="se">\&quot;</span><span class="s"> doesn&#39;t exist.&quot;</span> <span class="n">_C_</span> <span class="n">upgrade_ident</span><span class="p">.</span><span class="n">c_str</span><span class="p">());</span>
		<span class="p">}</span>
	<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="s">&quot;Active&quot;</span><span class="p">))</span> <span class="p">{</span>
		<span class="kt">bool</span> <span class="n">ai_active</span> <span class="o">=</span> <span class="n">LuaToBoolean</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">3</span><span class="p">);</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">ai_active</span> <span class="o">!=</span> <span class="n">unit</span><span class="o">-&gt;</span><span class="n">Active</span><span class="p">)</span> <span class="p">{</span>
			<span class="k">if</span> <span class="p">(</span><span class="n">ai_active</span><span class="p">)</span> <span class="p">{</span>
				<span class="n">unit</span><span class="o">-&gt;</span><span class="n">Player</span><span class="o">-&gt;</span><span class="n">UnitTypesAiActiveCount</span><span class="p">[</span><span class="n">unit</span><span class="o">-&gt;</span><span class="n">Type</span><span class="o">-&gt;</span><span class="n">Slot</span><span class="p">]</span><span class="o">++</span><span class="p">;</span>
			<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
				<span class="n">unit</span><span class="o">-&gt;</span><span class="n">Player</span><span class="o">-&gt;</span><span class="n">UnitTypesAiActiveCount</span><span class="p">[</span><span class="n">unit</span><span class="o">-&gt;</span><span class="n">Type</span><span class="o">-&gt;</span><span class="n">Slot</span><span class="p">]</span><span class="o">--</span><span class="p">;</span>
				<span class="k">if</span> <span class="p">(</span><span class="n">unit</span><span class="o">-&gt;</span><span class="n">Player</span><span class="o">-&gt;</span><span class="n">UnitTypesAiActiveCount</span><span class="p">[</span><span class="n">unit</span><span class="o">-&gt;</span><span class="n">Type</span><span class="o">-&gt;</span><span class="n">Slot</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span> <span class="c1">// if unit AI active count is negative, something wrong happened</span>
					<span class="n">fprintf</span><span class="p">(</span><span class="n">stderr</span><span class="p">,</span> <span class="s">&quot;Player %d has a negative %s AI active count of %d.</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">unit</span><span class="o">-&gt;</span><span class="n">Player</span><span class="o">-&gt;</span><span class="n">Index</span><span class="p">,</span> <span class="n">unit</span><span class="o">-&gt;</span><span class="n">Type</span><span class="o">-&gt;</span><span class="n">Ident</span><span class="p">.</span><span class="n">c_str</span><span class="p">(),</span> <span class="n">unit</span><span class="o">-&gt;</span><span class="n">Player</span><span class="o">-&gt;</span><span class="n">UnitTypesAiActiveCount</span><span class="p">[</span><span class="n">unit</span><span class="o">-&gt;</span><span class="n">Type</span><span class="o">-&gt;</span><span class="n">Slot</span><span class="p">]);</span>
				<span class="p">}</span>
			<span class="p">}</span>
		<span class="p">}</span>
		<span class="n">unit</span><span class="o">-&gt;</span><span class="n">Active</span> <span class="o">=</span> <span class="n">ai_active</span><span class="p">;</span>
	<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
		<span class="k">const</span> <span class="kt">int</span> <span class="n">index</span> <span class="o">=</span> <span class="n">UnitTypeVar</span><span class="p">.</span><span class="n">VariableNameLookup</span><span class="p">[</span><span class="n">name</span><span class="p">];</span><span class="c1">// User variables</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">index</span> <span class="o">==</span> <span class="mi">-1</span><span class="p">)</span> <span class="p">{</span>
			<span class="n">LuaError</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="s">&quot;Bad variable name &#39;%s&#39;</span><span class="se">\n</span><span class="s">&quot;</span> <span class="n">_C_</span> <span class="n">name</span><span class="p">);</span>
		<span class="p">}</span>
		<span class="n">value</span> <span class="o">=</span> <span class="n">LuaToNumber</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">3</span><span class="p">);</span>
		<span class="kt">bool</span> <span class="n">stats</span> <span class="o">=</span> <span class="nb">false</span><span class="p">;</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">nargs</span> <span class="o">==</span> <span class="mi">5</span><span class="p">)</span> <span class="p">{</span>
			<span class="n">stats</span> <span class="o">=</span> <span class="n">LuaToBoolean</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">5</span><span class="p">);</span>
		<span class="p">}</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">stats</span><span class="p">)</span> <span class="p">{</span> <span class="c1">// stat variables</span>
			<span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="k">const</span> <span class="n">type</span> <span class="o">=</span> <span class="n">LuaToString</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">4</span><span class="p">);</span>
			<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">type</span><span class="p">,</span> <span class="s">&quot;Value&quot;</span><span class="p">))</span> <span class="p">{</span>
				<span class="n">unit</span><span class="o">-&gt;</span><span class="n">Stats</span><span class="o">-&gt;</span><span class="n">Variables</span><span class="p">[</span><span class="n">index</span><span class="p">].</span><span class="n">Value</span> <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="n">min</span><span class="p">(</span><span class="n">unit</span><span class="o">-&gt;</span><span class="n">Stats</span><span class="o">-&gt;</span><span class="n">Variables</span><span class="p">[</span><span class="n">index</span><span class="p">].</span><span class="n">Max</span><span class="p">,</span> <span class="n">value</span><span class="p">);</span>
			<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">type</span><span class="p">,</span> <span class="s">&quot;Max&quot;</span><span class="p">))</span> <span class="p">{</span>
				<span class="n">unit</span><span class="o">-&gt;</span><span class="n">Stats</span><span class="o">-&gt;</span><span class="n">Variables</span><span class="p">[</span><span class="n">index</span><span class="p">].</span><span class="n">Max</span> <span class="o">=</span> <span class="n">value</span><span class="p">;</span>
			<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">type</span><span class="p">,</span> <span class="s">&quot;Increase&quot;</span><span class="p">))</span> <span class="p">{</span>
				<span class="n">unit</span><span class="o">-&gt;</span><span class="n">Stats</span><span class="o">-&gt;</span><span class="n">Variables</span><span class="p">[</span><span class="n">index</span><span class="p">].</span><span class="n">Increase</span> <span class="o">=</span> <span class="n">value</span><span class="p">;</span>
			<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">type</span><span class="p">,</span> <span class="s">&quot;IncreaseFrequency&quot;</span><span class="p">))</span> <span class="p">{</span>
				<span class="n">unit</span><span class="o">-&gt;</span><span class="n">Stats</span><span class="o">-&gt;</span><span class="n">Variables</span><span class="p">[</span><span class="n">index</span><span class="p">].</span><span class="n">IncreaseFrequency</span> <span class="o">=</span> <span class="n">value</span><span class="p">;</span>
				<span class="k">if</span> <span class="p">(</span><span class="n">unit</span><span class="o">-&gt;</span><span class="n">Stats</span><span class="o">-&gt;</span><span class="n">Variables</span><span class="p">[</span><span class="n">index</span><span class="p">].</span><span class="n">IncreaseFrequency</span> <span class="o">!=</span> <span class="n">value</span><span class="p">)</span> <span class="p">{</span>
					<span class="n">LuaError</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="s">&quot;%s.IncreaseFrequency out of range!&quot;</span> <span class="n">_C_</span> <span class="n">type</span><span class="p">);</span>
				<span class="p">}</span>
			<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">type</span><span class="p">,</span> <span class="s">&quot;Enable&quot;</span><span class="p">))</span> <span class="p">{</span>
				<span class="n">unit</span><span class="o">-&gt;</span><span class="n">Stats</span><span class="o">-&gt;</span><span class="n">Variables</span><span class="p">[</span><span class="n">index</span><span class="p">].</span><span class="n">Enable</span> <span class="o">=</span> <span class="n">value</span><span class="p">;</span>
			<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
				<span class="n">LuaError</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="s">&quot;Bad variable type &#39;%s&#39;</span><span class="se">\n</span><span class="s">&quot;</span> <span class="n">_C_</span> <span class="n">type</span><span class="p">);</span>
			<span class="p">}</span>
		<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">nargs</span> <span class="o">==</span> <span class="mi">3</span><span class="p">)</span> <span class="p">{</span>
			<span class="n">unit</span><span class="o">-&gt;</span><span class="n">Variable</span><span class="p">[</span><span class="n">index</span><span class="p">].</span><span class="n">Value</span> <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="n">min</span><span class="p">(</span><span class="n">unit</span><span class="o">-&gt;</span><span class="n">Variable</span><span class="p">[</span><span class="n">index</span><span class="p">].</span><span class="n">Max</span><span class="p">,</span> <span class="n">value</span><span class="p">);</span>
		<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
			<span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="k">const</span> <span class="n">type</span> <span class="o">=</span> <span class="n">LuaToString</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">4</span><span class="p">);</span>
			<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">type</span><span class="p">,</span> <span class="s">&quot;Value&quot;</span><span class="p">))</span> <span class="p">{</span>
				<span class="n">unit</span><span class="o">-&gt;</span><span class="n">Variable</span><span class="p">[</span><span class="n">index</span><span class="p">].</span><span class="n">Value</span> <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="n">min</span><span class="p">(</span><span class="n">unit</span><span class="o">-&gt;</span><span class="n">Variable</span><span class="p">[</span><span class="n">index</span><span class="p">].</span><span class="n">Max</span><span class="p">,</span> <span class="n">value</span><span class="p">);</span>
			<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">type</span><span class="p">,</span> <span class="s">&quot;Max&quot;</span><span class="p">))</span> <span class="p">{</span>
				<span class="n">unit</span><span class="o">-&gt;</span><span class="n">Variable</span><span class="p">[</span><span class="n">index</span><span class="p">].</span><span class="n">Max</span> <span class="o">=</span> <span class="n">value</span><span class="p">;</span>
			<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">type</span><span class="p">,</span> <span class="s">&quot;Increase&quot;</span><span class="p">))</span> <span class="p">{</span>
				<span class="n">unit</span><span class="o">-&gt;</span><span class="n">Variable</span><span class="p">[</span><span class="n">index</span><span class="p">].</span><span class="n">Increase</span> <span class="o">=</span> <span class="n">value</span><span class="p">;</span>
			<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">type</span><span class="p">,</span> <span class="s">&quot;IncreaseFrequency&quot;</span><span class="p">))</span> <span class="p">{</span>
				<span class="n">unit</span><span class="o">-&gt;</span><span class="n">Variable</span><span class="p">[</span><span class="n">index</span><span class="p">].</span><span class="n">IncreaseFrequency</span> <span class="o">=</span> <span class="n">value</span><span class="p">;</span>
				<span class="k">if</span> <span class="p">(</span><span class="n">unit</span><span class="o">-&gt;</span><span class="n">Variable</span><span class="p">[</span><span class="n">index</span><span class="p">].</span><span class="n">IncreaseFrequency</span> <span class="o">!=</span> <span class="n">value</span><span class="p">)</span> <span class="p">{</span>
					<span class="n">LuaError</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="s">&quot;%s.IncreaseFrequency out of range!&quot;</span> <span class="n">_C_</span> <span class="n">type</span><span class="p">);</span>
				<span class="p">}</span>
			<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">type</span><span class="p">,</span> <span class="s">&quot;Enable&quot;</span><span class="p">))</span> <span class="p">{</span>
				<span class="n">unit</span><span class="o">-&gt;</span><span class="n">Variable</span><span class="p">[</span><span class="n">index</span><span class="p">].</span><span class="n">Enable</span> <span class="o">=</span> <span class="n">value</span><span class="p">;</span>
			<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
				<span class="n">LuaError</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="s">&quot;Bad variable type &#39;%s&#39;</span><span class="se">\n</span><span class="s">&quot;</span> <span class="n">_C_</span> <span class="n">type</span><span class="p">);</span>
			<span class="p">}</span>
		<span class="p">}</span>
	<span class="p">}</span>
	<span class="n">lua_pushnumber</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">value</span><span class="p">);</span>
	<span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</p>
                          </details>
                        </details>
                        
                        <details>
                        <summary>SlotUsage</summary>
                        <p><br>  Get the usage of unit slots during load to allocate memory<br><br>  @param l  Lua state.</p>
                          <details>
                          <summary>/unit/script_unit.cpp:1384 CclSlotUsage</summary>
                          <p><div class="highlight"><pre><span></span><span class="k">static</span> <span class="kt">int</span> <span class="nf">CclSlotUsage</span><span class="p">(</span><span class="n">lua_State</span> <span class="o">*</span><span class="n">l</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">UnitManager</span><span class="p">.</span><span class="n">Load</span><span class="p">(</span><span class="n">l</span><span class="p">);</span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</p>
                          </details>
                        </details>
                        
                        <details>
                        <summary>SelectSingleUnit</summary>
                        <p><br> <b>Description</b><br><br>  Select a single unit <br><br>  @param l  Lua state.<br><br>  @return 0, meaning the unit is selected.<br><br> Example:<br><br> <div class="example"><code>-- Make the hero unit Grom Hellscream for player 5<br>		grom = CreateUnit("unit-beast-cry", 5, {58, 8})<br>		-- Select only the unit Grom Hellscream<br>		<strong>SelectSingleUnit</strong>(grom)</code></div></p>
                          <details>
                          <summary>/unit/script_unit.cpp:1412 CclSelectSingleUnit</summary>
                          <p><div class="highlight"><pre><span></span><span class="k">static</span> <span class="kt">int</span> <span class="nf">CclSelectSingleUnit</span><span class="p">(</span><span class="n">lua_State</span> <span class="o">*</span><span class="n">l</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">const</span> <span class="kt">int</span> <span class="n">nargs</span> <span class="o">=</span> <span class="n">lua_gettop</span><span class="p">(</span><span class="n">l</span><span class="p">);</span>
	<span class="n">Assert</span><span class="p">(</span><span class="n">nargs</span> <span class="o">==</span> <span class="mi">1</span><span class="p">);</span>
	<span class="n">lua_pushvalue</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
	<span class="n">CUnit</span> <span class="o">*</span><span class="n">unit</span> <span class="o">=</span> <span class="n">CclGetUnit</span><span class="p">(</span><span class="n">l</span><span class="p">);</span>
	<span class="n">lua_pop</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
	<span class="n">SelectSingleUnit</span><span class="p">(</span><span class="o">*</span><span class="n">unit</span><span class="p">);</span>
	<span class="n">SelectionChanged</span><span class="p">();</span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</p>
                          </details>
                        </details>
                        
                        <details>
                        <summary>EnableSimplifiedAutoTargeting</summary>
                        <p><br>  Enable/disable simplified auto targeting <br><br>  @param l  Lua state.<br><br>  @return   0 for success, 1 for wrong type;</p>
                          <details>
                          <summary>/unit/script_unit.cpp:1432 CclEnableSimplifiedAutoTargeting</summary>
                          <p><div class="highlight"><pre><span></span><span class="k">static</span> <span class="kt">int</span> <span class="nf">CclEnableSimplifiedAutoTargeting</span><span class="p">(</span><span class="n">lua_State</span> <span class="o">*</span><span class="n">l</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">LuaCheckArgs</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
	<span class="k">const</span> <span class="kt">bool</span> <span class="n">isSimplified</span> <span class="o">=</span> <span class="n">LuaToBoolean</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">IsNetworkGame</span><span class="p">())</span> <span class="p">{</span>
		<span class="n">Preference</span><span class="p">.</span><span class="n">SimplifiedAutoTargeting</span> <span class="o">=</span> <span class="n">isSimplified</span><span class="p">;</span>
	<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
		<span class="n">NetworkSendExtendedCommand</span><span class="p">(</span><span class="n">ExtendedMessageAutoTargetingDB</span><span class="p">,</span> 
								   <span class="kt">int</span><span class="p">(</span><span class="n">isSimplified</span><span class="p">),</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
	<span class="p">}</span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</p>
                          </details>
                        </details>
                        <hr>/unit/unit_draw.cpp<hr>
                        <details>
                        <summary>DefineSprites</summary>
                        <p><br>  Define the sprite to show variables.<br><br>  @param l    Lua_state</p>
                          <details>
                          <summary>/unit/unit_draw.cpp:327 CclDefineSprites</summary>
                          <p><div class="highlight"><pre><span></span><span class="k">static</span> <span class="kt">int</span> <span class="nf">CclDefineSprites</span><span class="p">(</span><span class="n">lua_State</span> <span class="o">*</span><span class="n">l</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">const</span> <span class="kt">int</span> <span class="n">args</span> <span class="o">=</span> <span class="n">lua_gettop</span><span class="p">(</span><span class="n">l</span><span class="p">);</span>

	<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">args</span><span class="p">;</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">Decoration</span> <span class="n">deco</span><span class="p">;</span>

		<span class="n">lua_pushnil</span><span class="p">(</span><span class="n">l</span><span class="p">);</span>
		<span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">name</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">;</span><span class="c1">// name of the current sprite.</span>
		<span class="k">while</span> <span class="p">(</span><span class="n">lua_next</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span> <span class="p">{</span>
			<span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">key</span> <span class="o">=</span> <span class="n">LuaToString</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">-2</span><span class="p">);</span> <span class="c1">// key name</span>
			<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="s">&quot;Name&quot;</span><span class="p">))</span> <span class="p">{</span>
				<span class="n">name</span> <span class="o">=</span> <span class="n">LuaToString</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">-1</span><span class="p">);</span>
			<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="s">&quot;File&quot;</span><span class="p">))</span> <span class="p">{</span>
				<span class="n">deco</span><span class="p">.</span><span class="n">File</span> <span class="o">=</span> <span class="n">LuaToString</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">-1</span><span class="p">);</span>
			<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="s">&quot;Offset&quot;</span><span class="p">))</span> <span class="p">{</span>
				<span class="n">CclGetPos</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">deco</span><span class="p">.</span><span class="n">HotPos</span><span class="p">.</span><span class="n">x</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">deco</span><span class="p">.</span><span class="n">HotPos</span><span class="p">.</span><span class="n">y</span><span class="p">);</span>
			<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="s">&quot;Size&quot;</span><span class="p">))</span> <span class="p">{</span>
				<span class="n">CclGetPos</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">deco</span><span class="p">.</span><span class="n">Width</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">deco</span><span class="p">.</span><span class="n">Height</span><span class="p">);</span>
			<span class="p">}</span> <span class="k">else</span> <span class="p">{</span> <span class="c1">// Error.</span>
				<span class="n">LuaError</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="s">&quot;incorrect field &#39;%s&#39; for the DefineSprite.&quot;</span> <span class="n">_C_</span> <span class="n">key</span><span class="p">);</span>
			<span class="p">}</span>
			<span class="n">lua_pop</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span> <span class="c1">// pop the value;</span>
		<span class="p">}</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">name</span> <span class="o">==</span> <span class="nb">NULL</span><span class="p">)</span> <span class="p">{</span>
			<span class="n">LuaError</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="s">&quot;CclDefineSprites requires the Name flag for sprite.&quot;</span><span class="p">);</span>
		<span class="p">}</span>
		<span class="kt">int</span> <span class="n">index</span> <span class="o">=</span> <span class="n">GetSpriteIndex</span><span class="p">(</span><span class="n">name</span><span class="p">);</span> <span class="c1">// Index of the Sprite.</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">index</span> <span class="o">==</span> <span class="mi">-1</span><span class="p">)</span> <span class="p">{</span> <span class="c1">// new sprite.</span>
			<span class="n">index</span> <span class="o">=</span> <span class="n">DecoSprite</span><span class="p">.</span><span class="n">SpriteArray</span><span class="p">.</span><span class="n">size</span><span class="p">();</span>
			<span class="n">DecoSprite</span><span class="p">.</span><span class="n">Name</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">name</span><span class="p">);</span>
			<span class="n">DecoSprite</span><span class="p">.</span><span class="n">SpriteArray</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">deco</span><span class="p">);</span>
		<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
			<span class="n">DecoSprite</span><span class="p">.</span><span class="n">SpriteArray</span><span class="p">[</span><span class="n">index</span><span class="p">].</span><span class="n">File</span><span class="p">.</span><span class="n">clear</span><span class="p">();</span>
			<span class="n">DecoSprite</span><span class="p">.</span><span class="n">SpriteArray</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="o">=</span> <span class="n">deco</span><span class="p">;</span>
		<span class="p">}</span>
		<span class="c1">// Now verify validity.</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">DecoSprite</span><span class="p">.</span><span class="n">SpriteArray</span><span class="p">[</span><span class="n">index</span><span class="p">].</span><span class="n">File</span><span class="p">.</span><span class="n">empty</span><span class="p">())</span> <span class="p">{</span>
			<span class="n">LuaError</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="s">&quot;CclDefineSprites requires the File flag for sprite.&quot;</span><span class="p">);</span>
		<span class="p">}</span>
		<span class="c1">// FIXME check if file is valid with good size ?</span>
	<span class="p">}</span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</p>
                          </details>
                        </details>
                        <hr>/editor/script_editor.cpp<hr>
                        <details>
                        <summary>SetEditorSelectIcon</summary>
                        <p><br>  Set the editor's select icon<br><br>  @param l  Lua state.</p>
                          <details>
                          <summary>/editor/script_editor.cpp:59 CclSetEditorSelectIcon</summary>
                          <p><div class="highlight"><pre><span></span><span class="k">static</span> <span class="kt">int</span> <span class="nf">CclSetEditorSelectIcon</span><span class="p">(</span><span class="n">lua_State</span> <span class="o">*</span><span class="n">l</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">LuaCheckArgs</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
	<span class="n">Editor</span><span class="p">.</span><span class="n">Select</span><span class="p">.</span><span class="n">Name</span> <span class="o">=</span> <span class="n">LuaToString</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</p>
                          </details>
                        </details>
                        
                        <details>
                        <summary>SetEditorUnitsIcon</summary>
                        <p><br>  Set the editor's units icon<br><br>  @param l  Lua state.</p>
                          <details>
                          <summary>/editor/script_editor.cpp:71 CclSetEditorUnitsIcon</summary>
                          <p><div class="highlight"><pre><span></span><span class="k">static</span> <span class="kt">int</span> <span class="nf">CclSetEditorUnitsIcon</span><span class="p">(</span><span class="n">lua_State</span> <span class="o">*</span><span class="n">l</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">LuaCheckArgs</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
	<span class="n">Editor</span><span class="p">.</span><span class="n">Units</span><span class="p">.</span><span class="n">Name</span> <span class="o">=</span> <span class="n">LuaToString</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</p>
                          </details>
                        </details>
                        
                        <details>
                        <summary>SetEditorStartUnit</summary>
                        <p><br>  Set the editor's start location unit<br><br>  @param l  Lua state.</p>
                          <details>
                          <summary>/editor/script_editor.cpp:83 CclSetEditorStartUnit</summary>
                          <p><div class="highlight"><pre><span></span><span class="k">static</span> <span class="kt">int</span> <span class="nf">CclSetEditorStartUnit</span><span class="p">(</span><span class="n">lua_State</span> <span class="o">*</span><span class="n">l</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">LuaCheckArgs</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
	<span class="n">Editor</span><span class="p">.</span><span class="n">StartUnitName</span> <span class="o">=</span> <span class="n">LuaToString</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</p>
                          </details>
                        </details>
                        
                        <details>
                        <summary>EditorResizeMap</summary>
                        <p>/editor/script_editor.cpp:93 CclEditorResizeMap</p>
                        <p><div class="highlight"><pre><span></span><span class="k">static</span> <span class="kt">int</span> <span class="nf">CclEditorResizeMap</span><span class="p">(</span><span class="n">lua_State</span> <span class="o">*</span><span class="n">l</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">LuaCheckArgs</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">5</span><span class="p">);</span>
	<span class="kt">int</span> <span class="n">res</span> <span class="o">=</span> <span class="n">EditorSaveMapWithResize</span><span class="p">(</span><span class="n">LuaToString</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
							<span class="p">{(</span><span class="kt">short</span><span class="p">)</span><span class="n">LuaToNumber</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="p">(</span><span class="kt">short</span><span class="p">)</span><span class="n">LuaToNumber</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">3</span><span class="p">)},</span>
							<span class="p">{(</span><span class="kt">short</span><span class="p">)</span><span class="n">LuaToNumber</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">4</span><span class="p">),</span> <span class="p">(</span><span class="kt">short</span><span class="p">)</span><span class="n">LuaToNumber</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">5</span><span class="p">)});</span>
	<span class="n">lua_pushnumber</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">res</span><span class="p">);</span>
	<span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</p>
                        </details>
                        <hr>/ui/script_ui.cpp<hr>
                        <details>
                        <summary>AddMessage</summary>
                        <p><br> <b>Description</b><br><br>  Add a new message.<br><br> Example:<br><br> <div class="example"><code><strong>AddMessage</strong>("Hello World!")</code></div><br><br>  @param l  Lua state.</p>
                          <details>
                          <summary>/ui/script_ui.cpp:1226 CclAddMessage</summary>
                          <p><div class="highlight"><pre><span></span><span class="k">static</span> <span class="kt">int</span> <span class="nf">CclAddMessage</span><span class="p">(</span><span class="n">lua_State</span> <span class="o">*</span><span class="n">l</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">LuaCheckArgs</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
	<span class="n">SetMessage</span><span class="p">(</span><span class="s">&quot;%s&quot;</span><span class="p">,</span> <span class="n">LuaToString</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">1</span><span class="p">));</span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</p>
                          </details>
                        </details>
                        
                        <details>
                        <summary>SetKeyScrollSpeed</summary>
                        <p><br> <b>Description</b><br><br>  Set speed of key scroll<br><br>  @param l  Lua state.<br><br> Example:<br><br> <div class="example"><code><strong>SetKeyScrollSpeed</strong>(4)</code></div></p>
                          <details>
                          <summary>/ui/script_ui.cpp:87 CclSetKeyScrollSpeed</summary>
                          <p><div class="highlight"><pre><span></span><span class="k">static</span> <span class="kt">int</span> <span class="nf">CclSetKeyScrollSpeed</span><span class="p">(</span><span class="n">lua_State</span> <span class="o">*</span><span class="n">l</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">LuaCheckArgs</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
	<span class="n">UI</span><span class="p">.</span><span class="n">KeyScrollSpeed</span> <span class="o">=</span> <span class="n">LuaToNumber</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</p>
                          </details>
                        </details>
                        
                        <details>
                        <summary>GetKeyScrollSpeed</summary>
                        <p><br> <b>Description</b><br><br>  Get speed of key scroll<br><br>  @param l  Lua state.<br><br> Example:<br><br> <div class="example"><code>scroll_speed = <strong>GetKeyScrollSpeed</strong>()<br>		print(scroll_speed)</code></div></p>
                          <details>
                          <summary>/ui/script_ui.cpp:106 CclGetKeyScrollSpeed</summary>
                          <p><div class="highlight"><pre><span></span><span class="k">static</span> <span class="kt">int</span> <span class="nf">CclGetKeyScrollSpeed</span><span class="p">(</span><span class="n">lua_State</span> <span class="o">*</span><span class="n">l</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">LuaCheckArgs</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
	<span class="n">lua_pushnumber</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">UI</span><span class="p">.</span><span class="n">KeyScrollSpeed</span><span class="p">);</span>
	<span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</p>
                          </details>
                        </details>
                        
                        <details>
                        <summary>SetMouseScrollSpeed</summary>
                        <p><br> <b>Description</b><br><br>  Set speed of mouse scroll<br><br>  @param l  Lua state.<br><br> Example:<br><br> <div class="example"><code><strong>SetMouseScrollSpeed</strong>(2)</code></div></p>
                          <details>
                          <summary>/ui/script_ui.cpp:124 CclSetMouseScrollSpeed</summary>
                          <p><div class="highlight"><pre><span></span><span class="k">static</span> <span class="kt">int</span> <span class="nf">CclSetMouseScrollSpeed</span><span class="p">(</span><span class="n">lua_State</span> <span class="o">*</span><span class="n">l</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">LuaCheckArgs</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
	<span class="n">UI</span><span class="p">.</span><span class="n">MouseScrollSpeed</span> <span class="o">=</span> <span class="n">LuaToNumber</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</p>
                          </details>
                        </details>
                        
                        <details>
                        <summary>GetMouseScrollSpeed</summary>
                        <p><br> <b>Description</b><br><br>  Get speed of mouse scroll<br><br>  @param l  Lua state.<br><br> Example:<br><br> <div class="example"><code>scroll_speed = <strong>GetMouseScrollSpeed</strong>()<br>		print(scroll_speed)</code></div></p>
                          <details>
                          <summary>/ui/script_ui.cpp:143 CclGetMouseScrollSpeed</summary>
                          <p><div class="highlight"><pre><span></span><span class="k">static</span> <span class="kt">int</span> <span class="nf">CclGetMouseScrollSpeed</span><span class="p">(</span><span class="n">lua_State</span> <span class="o">*</span><span class="n">l</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">LuaCheckArgs</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
	<span class="n">lua_pushnumber</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">UI</span><span class="p">.</span><span class="n">MouseScrollSpeed</span><span class="p">);</span>
	<span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</p>
                          </details>
                        </details>
                        
                        <details>
                        <summary>SetMouseScrollSpeedDefault</summary>
                        <p><br>  Set speed of middle-mouse scroll<br><br>  @param l  Lua state.</p>
                          <details>
                          <summary>/ui/script_ui.cpp:155 CclSetMouseScrollSpeedDefault</summary>
                          <p><div class="highlight"><pre><span></span><span class="k">static</span> <span class="kt">int</span> <span class="nf">CclSetMouseScrollSpeedDefault</span><span class="p">(</span><span class="n">lua_State</span> <span class="o">*</span><span class="n">l</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">LuaCheckArgs</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
	<span class="n">UI</span><span class="p">.</span><span class="n">MouseScrollSpeedDefault</span> <span class="o">=</span> <span class="n">LuaToNumber</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</p>
                          </details>
                        </details>
                        
                        <details>
                        <summary>GetMouseScrollSpeedDefault</summary>
                        <p><br>  Get speed of middle-mouse scroll<br><br>  @param l  Lua state.</p>
                          <details>
                          <summary>/ui/script_ui.cpp:167 CclGetMouseScrollSpeedDefault</summary>
                          <p><div class="highlight"><pre><span></span><span class="k">static</span> <span class="kt">int</span> <span class="nf">CclGetMouseScrollSpeedDefault</span><span class="p">(</span><span class="n">lua_State</span> <span class="o">*</span><span class="n">l</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">LuaCheckArgs</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
	<span class="n">lua_pushnumber</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">UI</span><span class="p">.</span><span class="n">MouseScrollSpeedDefault</span><span class="p">);</span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</p>
                          </details>
                        </details>
                        
                        <details>
                        <summary>SetMouseScrollSpeedControl</summary>
                        <p><br>  Set speed of ctrl-middle-mouse scroll<br><br>  @param l  Lua state.</p>
                          <details>
                          <summary>/ui/script_ui.cpp:179 CclSetMouseScrollSpeedControl</summary>
                          <p><div class="highlight"><pre><span></span><span class="k">static</span> <span class="kt">int</span> <span class="nf">CclSetMouseScrollSpeedControl</span><span class="p">(</span><span class="n">lua_State</span> <span class="o">*</span><span class="n">l</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">LuaCheckArgs</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
	<span class="n">UI</span><span class="p">.</span><span class="n">MouseScrollSpeedControl</span> <span class="o">=</span> <span class="n">LuaToNumber</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</p>
                          </details>
                        </details>
                        
                        <details>
                        <summary>GetMouseScrollSpeedControl</summary>
                        <p><br>  Get speed of ctrl-middle-mouse scroll<br><br>  @param l  Lua state.</p>
                          <details>
                          <summary>/ui/script_ui.cpp:191 CclGetMouseScrollSpeedControl</summary>
                          <p><div class="highlight"><pre><span></span><span class="k">static</span> <span class="kt">int</span> <span class="nf">CclGetMouseScrollSpeedControl</span><span class="p">(</span><span class="n">lua_State</span> <span class="o">*</span><span class="n">l</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">LuaCheckArgs</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
	<span class="n">lua_pushnumber</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">UI</span><span class="p">.</span><span class="n">MouseScrollSpeedControl</span><span class="p">);</span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</p>
                          </details>
                        </details>
                        
                        <details>
                        <summary>SetClickMissile</summary>
                        <p><br>  Set which missile is used for right click<br><br>  @param l  Lua state.</p>
                          <details>
                          <summary>/ui/script_ui.cpp:209 CclSetClickMissile</summary>
                          <p><div class="highlight"><pre><span></span><span class="k">static</span> <span class="kt">int</span> <span class="nf">CclSetClickMissile</span><span class="p">(</span><span class="n">lua_State</span> <span class="o">*</span><span class="n">l</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">const</span> <span class="kt">int</span> <span class="n">args</span> <span class="o">=</span> <span class="n">lua_gettop</span><span class="p">(</span><span class="n">l</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">args</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="o">||</span> <span class="p">(</span><span class="n">args</span> <span class="o">==</span> <span class="mi">1</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="o">!</span><span class="n">lua_isnil</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="n">lua_isstring</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">1</span><span class="p">))))</span> <span class="p">{</span>
		<span class="n">LuaError</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="s">&quot;incorrect argument&quot;</span><span class="p">);</span>
	<span class="p">}</span>
	<span class="n">ClickMissile</span><span class="p">.</span><span class="n">clear</span><span class="p">();</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">args</span> <span class="o">==</span> <span class="mi">1</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="n">lua_isnil</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span> <span class="p">{</span>
		<span class="n">ClickMissile</span> <span class="o">=</span> <span class="n">lua_tostring</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
	<span class="p">}</span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</p>
                          </details>
                        </details>
                        
                        <details>
                        <summary>SetDamageMissile</summary>
                        <p><br>  Set which missile shows Damage<br><br>  @param l  Lua state.</p>
                          <details>
                          <summary>/ui/script_ui.cpp:228 CclSetDamageMissile</summary>
                          <p><div class="highlight"><pre><span></span><span class="k">static</span> <span class="kt">int</span> <span class="nf">CclSetDamageMissile</span><span class="p">(</span><span class="n">lua_State</span> <span class="o">*</span><span class="n">l</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">const</span> <span class="kt">int</span> <span class="n">args</span> <span class="o">=</span> <span class="n">lua_gettop</span><span class="p">(</span><span class="n">l</span><span class="p">);</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">args</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="o">||</span> <span class="p">(</span><span class="n">args</span> <span class="o">==</span> <span class="mi">1</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="o">!</span><span class="n">lua_isnil</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="n">lua_isstring</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">1</span><span class="p">))))</span> <span class="p">{</span>
		<span class="n">LuaError</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="s">&quot;incorrect argument&quot;</span><span class="p">);</span>
	<span class="p">}</span>
	<span class="n">DamageMissile</span><span class="p">.</span><span class="n">clear</span><span class="p">();</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">args</span> <span class="o">==</span> <span class="mi">1</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="n">lua_isnil</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span> <span class="p">{</span>
		<span class="n">DamageMissile</span> <span class="o">=</span> <span class="n">lua_tostring</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
	<span class="p">}</span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</p>
                          </details>
                        </details>
                        
                        <details>
                        <summary>SetVideoResolution</summary>
                        <p><br> <b>Description</b><br><br>  Set the video resolution.<br><br>  @param l  Lua state.<br><br> Example:<br><br> <div class="example"><code><strong>SetVideoResolution</strong>(640,480)</code></div></p>
                          <details>
                          <summary>/ui/script_ui.cpp:252 CclSetVideoResolution</summary>
                          <p><div class="highlight"><pre><span></span><span class="k">static</span> <span class="kt">int</span> <span class="nf">CclSetVideoResolution</span><span class="p">(</span><span class="n">lua_State</span> <span class="o">*</span><span class="n">l</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">LuaCheckArgs</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">2</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">CclInConfigFile</span><span class="p">)</span> <span class="p">{</span>
		<span class="c1">// May have been set from the command line</span>
		<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">Video</span><span class="p">.</span><span class="n">Width</span> <span class="o">||</span> <span class="o">!</span><span class="n">Video</span><span class="p">.</span><span class="n">Height</span><span class="p">)</span> <span class="p">{</span>
			<span class="n">Video</span><span class="p">.</span><span class="n">Width</span> <span class="o">=</span> <span class="n">LuaToNumber</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
			<span class="n">Video</span><span class="p">.</span><span class="n">Height</span> <span class="o">=</span> <span class="n">LuaToNumber</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">2</span><span class="p">);</span>
		<span class="p">}</span>
	<span class="p">}</span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</p>
                          </details>
                        </details>
                        
                        <details>
                        <summary>GetVideoResolution</summary>
                        <p><br> <b>Description</b><br><br>  Get the video resolution.<br><br>  @param l  Lua state.<br><br> Example:<br><br> <div class="example"><code>width,height = <strong>GetVideoResolution</strong>()<br>		print("Resolution  is " .. width .. "x" .. height)</code></div></p>
                          <details>
                          <summary>/ui/script_ui.cpp:272 CclGetVideoResolution</summary>
                          <p><div class="highlight"><pre><span></span><span class="k">static</span> <span class="kt">int</span> <span class="nf">CclGetVideoResolution</span><span class="p">(</span><span class="n">lua_State</span> <span class="o">*</span><span class="n">l</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">LuaCheckArgs</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
	<span class="n">lua_pushnumber</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">Video</span><span class="p">.</span><span class="n">Width</span><span class="p">);</span>
	<span class="n">lua_pushnumber</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">Video</span><span class="p">.</span><span class="n">Height</span><span class="p">);</span>
	<span class="k">return</span> <span class="mi">2</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</p>
                          </details>
                        </details>
                        
                        <details>
                        <summary>SetVideoFullScreen</summary>
                        <p><br> <b>Description</b><br><br>  Set the video fullscreen mode.<br><br>  @param l  Lua state.<br><br> Example:<br><br> <div class="example"><code>-- Full Screen mode enabled<br>		<strong>SetVideoFullScreen</strong>(true)<br>		-- Full Screen mode disabled<br>		<strong>SetVideoFullScreen</strong>(false)</code></div></p>
                          <details>
                          <summary>/ui/script_ui.cpp:298 CclSetVideoFullScreen</summary>
                          <p><div class="highlight"><pre><span></span><span class="k">static</span> <span class="kt">int</span> <span class="nf">CclSetVideoFullScreen</span><span class="p">(</span><span class="n">lua_State</span> <span class="o">*</span><span class="n">l</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">LuaCheckArgs</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">CclInConfigFile</span><span class="p">)</span> <span class="p">{</span>
		<span class="c1">// May have been set from the command line</span>
		<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">VideoForceFullScreen</span><span class="p">)</span> <span class="p">{</span>
			<span class="n">Video</span><span class="p">.</span><span class="n">FullScreen</span> <span class="o">=</span> <span class="n">LuaToBoolean</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
		<span class="p">}</span>
	<span class="p">}</span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</p>
                          </details>
                        </details>
                        
                        <details>
                        <summary>GetVideoFullScreen</summary>
                        <p><br> <b>Description</b><br><br>  Get the video fullscreen mode.<br><br>  @param l  Lua state.<br><br> Example:<br><br> <div class="example"><code>fullscreenmode = <strong>GetVideoFullScreen</strong>()<br>		print(fullscreenmode)</code></div></p>
                          <details>
                          <summary>/ui/script_ui.cpp:317 CclGetVideoFullScreen</summary>
                          <p><div class="highlight"><pre><span></span><span class="k">static</span> <span class="kt">int</span> <span class="nf">CclGetVideoFullScreen</span><span class="p">(</span><span class="n">lua_State</span> <span class="o">*</span><span class="n">l</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">LuaCheckArgs</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
	<span class="n">lua_pushboolean</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">Video</span><span class="p">.</span><span class="n">FullScreen</span><span class="p">);</span>
	<span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</p>
                          </details>
                        </details>
                        
                        <details>
                        <summary>SetWindowSize</summary>
                        <p><br> Request a specific initial window size</p>
                          <details>
                          <summary>/ui/script_ui.cpp:333 CclSetWindowSize</summary>
                          <p><div class="highlight"><pre><span></span><span class="k">static</span> <span class="kt">int</span> <span class="nf">CclSetWindowSize</span><span class="p">(</span><span class="n">lua_State</span> <span class="o">*</span><span class="n">l</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">LuaCheckArgs</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">2</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">CclInConfigFile</span><span class="p">)</span> <span class="p">{</span>
		<span class="c1">// May have been set from the command line</span>
		<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">Video</span><span class="p">.</span><span class="n">WindowWidth</span> <span class="o">||</span> <span class="o">!</span><span class="n">Video</span><span class="p">.</span><span class="n">WindowHeight</span><span class="p">)</span> <span class="p">{</span>
			<span class="n">Video</span><span class="p">.</span><span class="n">WindowWidth</span> <span class="o">=</span> <span class="n">LuaToNumber</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
			<span class="n">Video</span><span class="p">.</span><span class="n">WindowHeight</span> <span class="o">=</span> <span class="n">LuaToNumber</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">2</span><span class="p">);</span>
		<span class="p">}</span>
	<span class="p">}</span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</p>
                          </details>
                        </details>
                        
                        <details>
                        <summary>SetVerticalPixelSize</summary>
                        <p><br> For games with non-square pixels, this sets the scale of vertical pixels versus horizontal pixels.<br> e.g., if your assets are 320x200, but you render at 320x240, this is 1.2.</p>
                          <details>
                          <summary>/ui/script_ui.cpp:347 CclSetVerticalPixelSize</summary>
                          <p><div class="highlight"><pre><span></span><span class="k">static</span> <span class="kt">int</span> <span class="nf">CclSetVerticalPixelSize</span><span class="p">(</span><span class="n">lua_State</span> <span class="o">*</span><span class="n">l</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">LuaCheckArgs</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">CclInConfigFile</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">luaL_checktype</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">LUA_TNUMBER</span><span class="p">);</span>
		<span class="n">Video</span><span class="p">.</span><span class="n">VerticalPixelSize</span> <span class="o">=</span> <span class="k">static_cast</span><span class="o">&lt;</span><span class="kt">double</span><span class="o">&gt;</span><span class="p">(</span><span class="n">lua_tonumber</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">1</span><span class="p">));</span>
	<span class="p">}</span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</p>
                          </details>
                        </details>
                        
                        <details>
                        <summary>SetTitleScreens</summary>
                        <p><br>  Default title screens.<br><br>  @param l  Lua state.</p>
                          <details>
                          <summary>/ui/script_ui.cpp:444 CclSetTitleScreens</summary>
                          <p><div class="highlight"><pre><span></span><span class="k">static</span> <span class="kt">int</span> <span class="nf">CclSetTitleScreens</span><span class="p">(</span><span class="n">lua_State</span> <span class="o">*</span><span class="n">l</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">TitleScreens</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">TitleScreens</span><span class="p">[</span><span class="n">i</span><span class="p">];</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span> <span class="p">{</span>
			<span class="k">delete</span> <span class="n">TitleScreens</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
		<span class="p">}</span>
		<span class="k">delete</span><span class="p">[]</span> <span class="n">TitleScreens</span><span class="p">;</span>
		<span class="n">TitleScreens</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="k">const</span> <span class="kt">int</span> <span class="n">args</span> <span class="o">=</span> <span class="n">lua_gettop</span><span class="p">(</span><span class="n">l</span><span class="p">);</span>
	<span class="n">TitleScreens</span> <span class="o">=</span> <span class="k">new</span> <span class="n">TitleScreen</span> <span class="o">*</span><span class="p">[</span><span class="n">args</span> <span class="o">+</span> <span class="mi">1</span><span class="p">];</span>
	<span class="n">memset</span><span class="p">(</span><span class="n">TitleScreens</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="p">(</span><span class="n">args</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">TitleScreen</span> <span class="o">*</span><span class="p">));</span>

	<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="n">args</span><span class="p">;</span> <span class="o">++</span><span class="n">j</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">lua_istable</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span> <span class="p">{</span>
			<span class="n">LuaError</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="s">&quot;incorrect argument&quot;</span><span class="p">);</span>
		<span class="p">}</span>
		<span class="n">TitleScreens</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="k">new</span> <span class="n">TitleScreen</span><span class="p">;</span>
		<span class="n">TitleScreens</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">-&gt;</span><span class="n">Iterations</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
		<span class="n">lua_pushnil</span><span class="p">(</span><span class="n">l</span><span class="p">);</span>
		<span class="k">while</span> <span class="p">(</span><span class="n">lua_next</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span> <span class="p">{</span>
			<span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">value</span> <span class="o">=</span> <span class="n">LuaToString</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">-2</span><span class="p">);</span>
			<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s">&quot;Image&quot;</span><span class="p">))</span> <span class="p">{</span>
				<span class="n">TitleScreens</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">-&gt;</span><span class="n">File</span> <span class="o">=</span> <span class="n">LuaToString</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">-1</span><span class="p">);</span>
			<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s">&quot;Music&quot;</span><span class="p">))</span> <span class="p">{</span>
				<span class="n">TitleScreens</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">-&gt;</span><span class="n">Music</span> <span class="o">=</span> <span class="n">LuaToString</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">-1</span><span class="p">);</span>
			<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s">&quot;Timeout&quot;</span><span class="p">))</span> <span class="p">{</span>
				<span class="n">TitleScreens</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">-&gt;</span><span class="n">Timeout</span> <span class="o">=</span> <span class="n">LuaToNumber</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">-1</span><span class="p">);</span>
			<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s">&quot;Iterations&quot;</span><span class="p">))</span> <span class="p">{</span>
				<span class="n">TitleScreens</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">-&gt;</span><span class="n">Iterations</span> <span class="o">=</span> <span class="n">LuaToNumber</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">-1</span><span class="p">);</span>
			<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s">&quot;Editor&quot;</span><span class="p">))</span> <span class="p">{</span>
				<span class="n">TitleScreens</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">-&gt;</span><span class="n">Editor</span> <span class="o">=</span> <span class="n">LuaToNumber</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">-1</span><span class="p">);</span>
			<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s">&quot;Labels&quot;</span><span class="p">))</span> <span class="p">{</span>
				<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">lua_istable</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">-1</span><span class="p">))</span> <span class="p">{</span>
					<span class="n">LuaError</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="s">&quot;incorrect argument&quot;</span><span class="p">);</span>
				<span class="p">}</span>
				<span class="k">const</span> <span class="kt">int</span> <span class="n">subargs</span> <span class="o">=</span> <span class="n">lua_rawlen</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">-1</span><span class="p">);</span>
				<span class="n">TitleScreens</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">-&gt;</span><span class="n">Labels</span> <span class="o">=</span> <span class="k">new</span> <span class="n">TitleScreenLabel</span> <span class="o">*</span><span class="p">[</span><span class="n">subargs</span> <span class="o">+</span> <span class="mi">1</span><span class="p">];</span>
				<span class="n">memset</span><span class="p">(</span><span class="n">TitleScreens</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">-&gt;</span><span class="n">Labels</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="p">(</span><span class="n">subargs</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">TitleScreenLabel</span> <span class="o">*</span><span class="p">));</span>
				<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">k</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">k</span> <span class="o">&lt;</span> <span class="n">subargs</span><span class="p">;</span> <span class="o">++</span><span class="n">k</span><span class="p">)</span> <span class="p">{</span>
					<span class="n">lua_rawgeti</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">-1</span><span class="p">,</span> <span class="n">k</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>
					<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">lua_istable</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">-1</span><span class="p">))</span> <span class="p">{</span>
						<span class="n">LuaError</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="s">&quot;incorrect argument&quot;</span><span class="p">);</span>
					<span class="p">}</span>
					<span class="n">TitleScreens</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">-&gt;</span><span class="n">Labels</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="k">new</span> <span class="n">TitleScreenLabel</span><span class="p">;</span>
					<span class="n">lua_pushnil</span><span class="p">(</span><span class="n">l</span><span class="p">);</span>
					<span class="k">while</span> <span class="p">(</span><span class="n">lua_next</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">-2</span><span class="p">))</span> <span class="p">{</span>
						<span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">value</span> <span class="o">=</span> <span class="n">LuaToString</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">-2</span><span class="p">);</span>
						<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s">&quot;Text&quot;</span><span class="p">))</span> <span class="p">{</span>
							<span class="n">TitleScreens</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">-&gt;</span><span class="n">Labels</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">-&gt;</span><span class="n">Text</span> <span class="o">=</span> <span class="n">LuaToString</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">-1</span><span class="p">);</span>
						<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s">&quot;Font&quot;</span><span class="p">))</span> <span class="p">{</span>
							<span class="n">TitleScreens</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">-&gt;</span><span class="n">Labels</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">-&gt;</span><span class="n">Font</span> <span class="o">=</span> <span class="n">CFont</span><span class="o">::</span><span class="n">Get</span><span class="p">(</span><span class="n">LuaToString</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">-1</span><span class="p">));</span>
						<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s">&quot;Pos&quot;</span><span class="p">))</span> <span class="p">{</span>
							<span class="n">CclGetPos</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">TitleScreens</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">-&gt;</span><span class="n">Labels</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">-&gt;</span><span class="n">Xofs</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">TitleScreens</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">-&gt;</span><span class="n">Labels</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">-&gt;</span><span class="n">Yofs</span><span class="p">);</span>
						<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s">&quot;Flags&quot;</span><span class="p">))</span> <span class="p">{</span>
							<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">lua_istable</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">-1</span><span class="p">))</span> <span class="p">{</span>
								<span class="n">LuaError</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="s">&quot;incorrect argument&quot;</span><span class="p">);</span>
							<span class="p">}</span>
							<span class="k">const</span> <span class="kt">int</span> <span class="n">subsubargs</span> <span class="o">=</span> <span class="n">lua_rawlen</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">-1</span><span class="p">);</span>
							<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">subk</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">subk</span> <span class="o">&lt;</span> <span class="n">subsubargs</span><span class="p">;</span> <span class="o">++</span><span class="n">subk</span><span class="p">)</span> <span class="p">{</span>
								<span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">value</span> <span class="o">=</span> <span class="n">LuaToString</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">-1</span><span class="p">,</span> <span class="n">subk</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>
								<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s">&quot;center&quot;</span><span class="p">))</span> <span class="p">{</span>
									<span class="n">TitleScreens</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">-&gt;</span><span class="n">Labels</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">-&gt;</span><span class="n">Flags</span> <span class="o">|=</span> <span class="n">TitleFlagCenter</span><span class="p">;</span>
								<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
									<span class="n">LuaError</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="s">&quot;incorrect flag&quot;</span><span class="p">);</span>
								<span class="p">}</span>
							<span class="p">}</span>
						<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
							<span class="n">LuaError</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="s">&quot;Unsupported key: %s&quot;</span> <span class="n">_C_</span> <span class="n">value</span><span class="p">);</span>
						<span class="p">}</span>
						<span class="n">lua_pop</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
					<span class="p">}</span>
					<span class="n">lua_pop</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
				<span class="p">}</span>
			<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
				<span class="n">LuaError</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="s">&quot;Unsupported key: %s&quot;</span> <span class="n">_C_</span> <span class="n">value</span><span class="p">);</span>
			<span class="p">}</span>
			<span class="n">lua_pop</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
		<span class="p">}</span>
	<span class="p">}</span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</p>
                          </details>
                        </details>
                        
                        <details>
                        <summary>ShowTitleScreens</summary>
                        <p>/ui/script_ui.cpp:355 CclShowTitleScreens</p>
                        <p><div class="highlight"><pre><span></span><span class="k">static</span> <span class="kt">int</span> <span class="nf">CclShowTitleScreens</span><span class="p">(</span><span class="n">lua_State</span> <span class="o">*</span><span class="n">l</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">LuaCheckArgs</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
	<span class="n">ShowTitleScreens</span><span class="p">();</span>
	<span class="n">lua_pushboolean</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
	<span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</p>
                        </details>
                        
                        <details>
                        <summary>DefinePanelContents</summary>
                        <p><br>  Define the Panels.<br>  Define what is shown in the panel(text, icon, variables)<br><br>  @param l  Lua state.<br>  @return   0.</p>
                          <details>
                          <summary>/ui/script_ui.cpp:628 CclDefinePanelContents</summary>
                          <p><div class="highlight"><pre><span></span><span class="k">static</span> <span class="kt">int</span> <span class="nf">CclDefinePanelContents</span><span class="p">(</span><span class="n">lua_State</span> <span class="o">*</span><span class="n">l</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">const</span> <span class="kt">int</span> <span class="n">nargs</span> <span class="o">=</span> <span class="n">lua_gettop</span><span class="p">(</span><span class="n">l</span><span class="p">);</span>

	<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">nargs</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">Assert</span><span class="p">(</span><span class="n">lua_istable</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">));</span>
		<span class="n">CUnitInfoPanel</span> <span class="o">*</span><span class="n">infopanel</span> <span class="o">=</span> <span class="k">new</span> <span class="n">CUnitInfoPanel</span><span class="p">;</span>

		<span class="k">for</span> <span class="p">(</span><span class="n">lua_pushnil</span><span class="p">(</span><span class="n">l</span><span class="p">);</span> <span class="n">lua_next</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span> <span class="n">lua_pop</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span> <span class="p">{</span>
			<span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">key</span> <span class="o">=</span> <span class="n">LuaToString</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">-2</span><span class="p">);</span>

			<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="s">&quot;Ident&quot;</span><span class="p">))</span> <span class="p">{</span>
				<span class="n">infopanel</span><span class="o">-&gt;</span><span class="n">Name</span> <span class="o">=</span> <span class="n">LuaToString</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">-1</span><span class="p">);</span>
			<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="s">&quot;Pos&quot;</span><span class="p">))</span> <span class="p">{</span>
				<span class="n">CclGetPos</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">infopanel</span><span class="o">-&gt;</span><span class="n">PosX</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">infopanel</span><span class="o">-&gt;</span><span class="n">PosY</span><span class="p">);</span>
			<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="s">&quot;DefaultFont&quot;</span><span class="p">))</span> <span class="p">{</span>
				<span class="n">infopanel</span><span class="o">-&gt;</span><span class="n">DefaultFont</span> <span class="o">=</span> <span class="n">CFont</span><span class="o">::</span><span class="n">Get</span><span class="p">(</span><span class="n">LuaToString</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">-1</span><span class="p">));</span>
			<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="s">&quot;Condition&quot;</span><span class="p">))</span> <span class="p">{</span>
				<span class="n">infopanel</span><span class="o">-&gt;</span><span class="n">Condition</span> <span class="o">=</span> <span class="n">ParseConditionPanel</span><span class="p">(</span><span class="n">l</span><span class="p">);</span>
			<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="s">&quot;Contents&quot;</span><span class="p">))</span> <span class="p">{</span>
				<span class="n">Assert</span><span class="p">(</span><span class="n">lua_istable</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">-1</span><span class="p">));</span>
				<span class="k">for</span> <span class="p">(</span><span class="kt">size_t</span> <span class="n">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="n">lua_rawlen</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">-1</span><span class="p">);</span> <span class="n">j</span><span class="o">++</span><span class="p">,</span> <span class="n">lua_pop</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span> <span class="p">{</span>
					<span class="n">lua_rawgeti</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">-1</span><span class="p">,</span> <span class="n">j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>
					<span class="n">infopanel</span><span class="o">-&gt;</span><span class="n">Contents</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">CclParseContent</span><span class="p">(</span><span class="n">l</span><span class="p">));</span>
				<span class="p">}</span>
			<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
				<span class="n">LuaError</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="s">&quot;&#39;%s&#39; invalid for DefinePanelContents&quot;</span> <span class="n">_C_</span> <span class="n">key</span><span class="p">);</span>
			<span class="p">}</span>
		<span class="p">}</span>
		<span class="k">for</span> <span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">CContentType</span> <span class="o">*&gt;::</span><span class="n">iterator</span> <span class="n">content</span> <span class="o">=</span> <span class="n">infopanel</span><span class="o">-&gt;</span><span class="n">Contents</span><span class="p">.</span><span class="n">begin</span><span class="p">();</span>
			 <span class="n">content</span> <span class="o">!=</span> <span class="n">infopanel</span><span class="o">-&gt;</span><span class="n">Contents</span><span class="p">.</span><span class="n">end</span><span class="p">();</span> <span class="o">++</span><span class="n">content</span><span class="p">)</span> <span class="p">{</span> <span class="c1">// Default value for invalid value.</span>
			<span class="p">(</span><span class="o">*</span><span class="n">content</span><span class="p">)</span><span class="o">-&gt;</span><span class="n">Pos</span><span class="p">.</span><span class="n">x</span> <span class="o">+=</span> <span class="n">infopanel</span><span class="o">-&gt;</span><span class="n">PosX</span><span class="p">;</span>
			<span class="p">(</span><span class="o">*</span><span class="n">content</span><span class="p">)</span><span class="o">-&gt;</span><span class="n">Pos</span><span class="p">.</span><span class="n">y</span> <span class="o">+=</span> <span class="n">infopanel</span><span class="o">-&gt;</span><span class="n">PosY</span><span class="p">;</span>
		<span class="p">}</span>
		<span class="kt">size_t</span> <span class="n">j</span><span class="p">;</span>
		<span class="k">for</span> <span class="p">(</span><span class="n">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="n">UI</span><span class="p">.</span><span class="n">InfoPanelContents</span><span class="p">.</span><span class="n">size</span><span class="p">();</span> <span class="o">++</span><span class="n">j</span><span class="p">)</span> <span class="p">{</span>
			<span class="k">if</span> <span class="p">(</span><span class="n">infopanel</span><span class="o">-&gt;</span><span class="n">Name</span> <span class="o">==</span> <span class="n">UI</span><span class="p">.</span><span class="n">InfoPanelContents</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">-&gt;</span><span class="n">Name</span><span class="p">)</span> <span class="p">{</span>
				<span class="n">DebugPrint</span><span class="p">(</span><span class="s">&quot;Redefinition of Panel &#39;%s&#39;</span><span class="se">\n</span><span class="s">&quot;</span> <span class="n">_C_</span> <span class="n">infopanel</span><span class="o">-&gt;</span><span class="n">Name</span><span class="p">.</span><span class="n">c_str</span><span class="p">());</span>
				<span class="k">delete</span> <span class="n">UI</span><span class="p">.</span><span class="n">InfoPanelContents</span><span class="p">[</span><span class="n">j</span><span class="p">];</span>
				<span class="n">UI</span><span class="p">.</span><span class="n">InfoPanelContents</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">infopanel</span><span class="p">;</span>
				<span class="k">break</span><span class="p">;</span>
			<span class="p">}</span>
		<span class="p">}</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">j</span> <span class="o">==</span> <span class="n">UI</span><span class="p">.</span><span class="n">InfoPanelContents</span><span class="p">.</span><span class="n">size</span><span class="p">())</span> <span class="p">{</span>
			<span class="n">UI</span><span class="p">.</span><span class="n">InfoPanelContents</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">infopanel</span><span class="p">);</span>
		<span class="p">}</span>
	<span class="p">}</span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</p>
                          </details>
                        </details>
                        
                        <details>
                        <summary>DefinePopup</summary>
                        <p><br>  Define the Panels.<br>  Define what is shown in the panel(text, icon, variables)<br><br>  @param l  Lua state.<br>  @return   0.</p>
                          <details>
                          <summary>/ui/script_ui.cpp:680 CclDefinePopup</summary>
                          <p><div class="highlight"><pre><span></span><span class="k">static</span> <span class="kt">int</span> <span class="nf">CclDefinePopup</span><span class="p">(</span><span class="n">lua_State</span> <span class="o">*</span><span class="n">l</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">Assert</span><span class="p">(</span><span class="n">lua_istable</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">1</span><span class="p">));</span>

	<span class="n">CPopup</span> <span class="o">*</span><span class="n">popup</span> <span class="o">=</span> <span class="k">new</span> <span class="n">CPopup</span><span class="p">;</span>

	<span class="k">for</span> <span class="p">(</span><span class="n">lua_pushnil</span><span class="p">(</span><span class="n">l</span><span class="p">);</span> <span class="n">lua_next</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span> <span class="n">lua_pop</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span> <span class="p">{</span>
		<span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">key</span> <span class="o">=</span> <span class="n">LuaToString</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">-2</span><span class="p">);</span>

		<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="s">&quot;Ident&quot;</span><span class="p">))</span> <span class="p">{</span>
			<span class="n">popup</span><span class="o">-&gt;</span><span class="n">Ident</span> <span class="o">=</span> <span class="n">LuaToString</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">-1</span><span class="p">);</span>
		<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="s">&quot;DefaultFont&quot;</span><span class="p">))</span> <span class="p">{</span>
			<span class="n">popup</span><span class="o">-&gt;</span><span class="n">DefaultFont</span> <span class="o">=</span> <span class="n">CFont</span><span class="o">::</span><span class="n">Get</span><span class="p">(</span><span class="n">LuaToString</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">-1</span><span class="p">));</span>
		<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="s">&quot;BackgroundColor&quot;</span><span class="p">))</span> <span class="p">{</span>
			<span class="n">popup</span><span class="o">-&gt;</span><span class="n">BackgroundColor</span> <span class="o">=</span> <span class="n">LuaToUnsignedNumber</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">-1</span><span class="p">);</span>
		<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="s">&quot;BorderColor&quot;</span><span class="p">))</span> <span class="p">{</span>
			<span class="n">popup</span><span class="o">-&gt;</span><span class="n">BorderColor</span> <span class="o">=</span> <span class="n">LuaToUnsignedNumber</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">-1</span><span class="p">);</span>
		<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="s">&quot;Margin&quot;</span><span class="p">))</span> <span class="p">{</span>
			<span class="n">CclGetPos</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">popup</span><span class="o">-&gt;</span><span class="n">MarginX</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">popup</span><span class="o">-&gt;</span><span class="n">MarginY</span><span class="p">);</span>
		<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="s">&quot;MinWidth&quot;</span><span class="p">))</span> <span class="p">{</span>
			<span class="n">popup</span><span class="o">-&gt;</span><span class="n">MinWidth</span> <span class="o">=</span> <span class="n">LuaToNumber</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">-1</span><span class="p">);</span>
		<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="s">&quot;MinHeight&quot;</span><span class="p">))</span> <span class="p">{</span>
			<span class="n">popup</span><span class="o">-&gt;</span><span class="n">MinHeight</span> <span class="o">=</span> <span class="n">LuaToNumber</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">-1</span><span class="p">);</span>
		<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="s">&quot;Contents&quot;</span><span class="p">))</span> <span class="p">{</span>
			<span class="n">Assert</span><span class="p">(</span><span class="n">lua_istable</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">-1</span><span class="p">));</span>
			<span class="k">for</span> <span class="p">(</span><span class="kt">size_t</span> <span class="n">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="n">lua_rawlen</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">-1</span><span class="p">);</span> <span class="n">j</span><span class="o">++</span><span class="p">,</span> <span class="n">lua_pop</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span> <span class="p">{</span>
				<span class="n">lua_rawgeti</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">-1</span><span class="p">,</span> <span class="n">j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>
				<span class="n">popup</span><span class="o">-&gt;</span><span class="n">Contents</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">CPopupContentType</span><span class="o">::</span><span class="n">ParsePopupContent</span><span class="p">(</span><span class="n">l</span><span class="p">));</span>
			<span class="p">}</span>
		<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
			<span class="n">LuaError</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="s">&quot;&#39;%s&#39; invalid for DefinePopups&quot;</span> <span class="n">_C_</span> <span class="n">key</span><span class="p">);</span>
		<span class="p">}</span>
	<span class="p">}</span>
	<span class="k">for</span> <span class="p">(</span><span class="kt">size_t</span> <span class="n">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="n">UI</span><span class="p">.</span><span class="n">ButtonPopups</span><span class="p">.</span><span class="n">size</span><span class="p">();</span> <span class="o">++</span><span class="n">j</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">popup</span><span class="o">-&gt;</span><span class="n">Ident</span> <span class="o">==</span> <span class="n">UI</span><span class="p">.</span><span class="n">ButtonPopups</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">-&gt;</span><span class="n">Ident</span><span class="p">)</span> <span class="p">{</span>
			<span class="n">DebugPrint</span><span class="p">(</span><span class="s">&quot;Redefinition of Popup &#39;%s&#39;</span><span class="se">\n</span><span class="s">&quot;</span> <span class="n">_C_</span> <span class="n">popup</span><span class="o">-&gt;</span><span class="n">Ident</span><span class="p">.</span><span class="n">c_str</span><span class="p">());</span>
			<span class="k">delete</span> <span class="n">UI</span><span class="p">.</span><span class="n">ButtonPopups</span><span class="p">[</span><span class="n">j</span><span class="p">];</span>
			<span class="n">UI</span><span class="p">.</span><span class="n">ButtonPopups</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">popup</span><span class="p">;</span>
			<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
		<span class="p">}</span>
	<span class="p">}</span>
	<span class="n">UI</span><span class="p">.</span><span class="n">ButtonPopups</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">popup</span><span class="p">);</span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</p>
                          </details>
                        </details>
                        
                        <details>
                        <summary>DefineViewports</summary>
                        <p><br>  Define the viewports.<br><br>  @param l  Lua state.</p>
                          <details>
                          <summary>/ui/script_ui.cpp:714 CclDefineViewports</summary>
                          <p><div class="highlight"><pre><span></span><span class="k">static</span> <span class="kt">int</span> <span class="nf">CclDefineViewports</span><span class="p">(</span><span class="n">lua_State</span> <span class="o">*</span><span class="n">l</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="k">const</span> <span class="kt">int</span> <span class="n">args</span> <span class="o">=</span> <span class="n">lua_gettop</span><span class="p">(</span><span class="n">l</span><span class="p">);</span>

	<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="n">args</span><span class="p">;</span> <span class="o">++</span><span class="n">j</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">value</span> <span class="o">=</span> <span class="n">LuaToString</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>
		<span class="o">++</span><span class="n">j</span><span class="p">;</span>
		<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s">&quot;mode&quot;</span><span class="p">))</span> <span class="p">{</span>
			<span class="n">UI</span><span class="p">.</span><span class="n">ViewportMode</span> <span class="o">=</span> <span class="p">(</span><span class="n">ViewportModeType</span><span class="p">)</span><span class="n">LuaToNumber</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>
		<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s">&quot;viewport&quot;</span><span class="p">))</span> <span class="p">{</span>
			<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">lua_istable</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="n">lua_rawlen</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">3</span><span class="p">)</span> <span class="p">{</span>
				<span class="n">LuaError</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="s">&quot;incorrect argument&quot;</span><span class="p">);</span>
			<span class="p">}</span>
			<span class="n">UI</span><span class="p">.</span><span class="n">Viewports</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">MapPos</span><span class="p">.</span><span class="n">x</span> <span class="o">=</span> <span class="n">LuaToNumber</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
			<span class="n">UI</span><span class="p">.</span><span class="n">Viewports</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">MapPos</span><span class="p">.</span><span class="n">y</span> <span class="o">=</span> <span class="n">LuaToNumber</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">);</span>
			<span class="k">const</span> <span class="kt">int</span> <span class="n">slot</span> <span class="o">=</span> <span class="n">LuaToNumber</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">);</span>
			<span class="k">if</span> <span class="p">(</span><span class="n">slot</span> <span class="o">!=</span> <span class="mi">-1</span><span class="p">)</span> <span class="p">{</span>
				<span class="n">UI</span><span class="p">.</span><span class="n">Viewports</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">Unit</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">UnitManager</span><span class="p">.</span><span class="n">GetSlotUnit</span><span class="p">(</span><span class="n">slot</span><span class="p">);</span>
			<span class="p">}</span>
			<span class="o">++</span><span class="n">i</span><span class="p">;</span>
		<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
			<span class="n">LuaError</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="s">&quot;Unsupported tag: %s&quot;</span> <span class="n">_C_</span> <span class="n">value</span><span class="p">);</span>
		<span class="p">}</span>
	<span class="p">}</span>
	<span class="n">UI</span><span class="p">.</span><span class="n">NumViewports</span> <span class="o">=</span> <span class="n">i</span><span class="p">;</span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</p>
                          </details>
                        </details>
                        
                        <details>
                        <summary>RightButtonAttacks</summary>
                        <p><br>  Fighter right button attacks as default.<br><br>  @param l  Lua state.</p>
                          <details>
                          <summary>/ui/script_ui.cpp:726 CclRightButtonAttacks</summary>
                          <p><div class="highlight"><pre><span></span><span class="k">static</span> <span class="kt">int</span> <span class="nf">CclRightButtonAttacks</span><span class="p">(</span><span class="n">lua_State</span> <span class="o">*</span><span class="n">l</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">LuaCheckArgs</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
	<span class="n">RightButtonAttacks</span> <span class="o">=</span> <span class="nb">true</span><span class="p">;</span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</p>
                          </details>
                        </details>
                        
                        <details>
                        <summary>RightButtonMoves</summary>
                        <p><br>  Fighter right button moves as default.<br><br>  @param l  Lua state.</p>
                          <details>
                          <summary>/ui/script_ui.cpp:738 CclRightButtonMoves</summary>
                          <p><div class="highlight"><pre><span></span><span class="k">static</span> <span class="kt">int</span> <span class="nf">CclRightButtonMoves</span><span class="p">(</span><span class="n">lua_State</span> <span class="o">*</span><span class="n">l</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">LuaCheckArgs</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
	<span class="n">RightButtonAttacks</span> <span class="o">=</span> <span class="nb">false</span><span class="p">;</span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</p>
                          </details>
                        </details>
                        
                        <details>
                        <summary>SetFancyBuildings</summary>
                        <p><br> <b>Description</b><br><br>  Enable/disable the fancy buildings.<br><br>  @param l  Lua state.<br><br> Example:<br><br> <div class="example"><code>-- Enable fancy buildings<br>		  <strong>SetFancyBuildings</strong>(true)<br>		  -- Disable fancy buildings<br>		  <strong>SetFancyBuildings</strong>(false)</code></div></p>
                          <details>
                          <summary>/ui/script_ui.cpp:759 CclSetFancyBuildings</summary>
                          <p><div class="highlight"><pre><span></span><span class="k">static</span> <span class="kt">int</span> <span class="nf">CclSetFancyBuildings</span><span class="p">(</span><span class="n">lua_State</span> <span class="o">*</span><span class="n">l</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">LuaCheckArgs</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
	<span class="n">FancyBuildings</span> <span class="o">=</span> <span class="n">LuaToBoolean</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</p>
                          </details>
                        </details>
                        
                        <details>
                        <summary>DefineButton</summary>
                        <p><br>  Define a button.<br><br>  @param l  Lua state.</p>
                          <details>
                          <summary>/ui/script_ui.cpp:1156 CclDefineButton</summary>
                          <p><div class="highlight"><pre><span></span><span class="k">static</span> <span class="kt">int</span> <span class="nf">CclDefineButton</span><span class="p">(</span><span class="n">lua_State</span> <span class="o">*</span><span class="n">l</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">LuaCheckArgs</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">lua_istable</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span> <span class="p">{</span>
		<span class="n">LuaError</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="s">&quot;incorrect argument&quot;</span><span class="p">);</span>
	<span class="p">}</span>
	<span class="n">ButtonAction</span> <span class="n">ba</span><span class="p">;</span>

	<span class="c1">//</span>
	<span class="c1">// Parse the arguments</span>
	<span class="c1">//</span>
	<span class="n">lua_pushnil</span><span class="p">(</span><span class="n">l</span><span class="p">);</span>
	<span class="k">while</span> <span class="p">(</span><span class="n">lua_next</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span> <span class="p">{</span>
		<span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">value</span> <span class="o">=</span> <span class="n">LuaToString</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">-2</span><span class="p">);</span>
		<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s">&quot;Pos&quot;</span><span class="p">))</span> <span class="p">{</span>
			<span class="n">ba</span><span class="p">.</span><span class="n">Pos</span> <span class="o">=</span> <span class="n">LuaToNumber</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">-1</span><span class="p">);</span>
		<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s">&quot;Level&quot;</span><span class="p">))</span> <span class="p">{</span>
			<span class="n">ba</span><span class="p">.</span><span class="n">Level</span> <span class="o">=</span> <span class="n">LuaToNumber</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">-1</span><span class="p">);</span>
		<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s">&quot;AlwaysShow&quot;</span><span class="p">))</span> <span class="p">{</span>
			<span class="n">ba</span><span class="p">.</span><span class="n">AlwaysShow</span> <span class="o">=</span> <span class="n">LuaToBoolean</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">-1</span><span class="p">);</span>
		<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s">&quot;Icon&quot;</span><span class="p">))</span> <span class="p">{</span>
			<span class="n">ba</span><span class="p">.</span><span class="n">Icon</span><span class="p">.</span><span class="n">Name</span> <span class="o">=</span> <span class="n">LuaToString</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">-1</span><span class="p">);</span>
		<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s">&quot;Action&quot;</span><span class="p">))</span> <span class="p">{</span>
			<span class="n">value</span> <span class="o">=</span> <span class="n">LuaToString</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">-1</span><span class="p">);</span>
			<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s">&quot;move&quot;</span><span class="p">))</span> <span class="p">{</span>
				<span class="n">ba</span><span class="p">.</span><span class="n">Action</span> <span class="o">=</span> <span class="n">ButtonMove</span><span class="p">;</span>
			<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s">&quot;stop&quot;</span><span class="p">))</span> <span class="p">{</span>
				<span class="n">ba</span><span class="p">.</span><span class="n">Action</span> <span class="o">=</span> <span class="n">ButtonStop</span><span class="p">;</span>
			<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s">&quot;attack&quot;</span><span class="p">))</span> <span class="p">{</span>
				<span class="n">ba</span><span class="p">.</span><span class="n">Action</span> <span class="o">=</span> <span class="n">ButtonAttack</span><span class="p">;</span>
			<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s">&quot;repair&quot;</span><span class="p">))</span> <span class="p">{</span>
				<span class="n">ba</span><span class="p">.</span><span class="n">Action</span> <span class="o">=</span> <span class="n">ButtonRepair</span><span class="p">;</span>
			<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s">&quot;harvest&quot;</span><span class="p">))</span> <span class="p">{</span>
				<span class="n">ba</span><span class="p">.</span><span class="n">Action</span> <span class="o">=</span> <span class="n">ButtonHarvest</span><span class="p">;</span>
			<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s">&quot;button&quot;</span><span class="p">))</span> <span class="p">{</span>
				<span class="n">ba</span><span class="p">.</span><span class="n">Action</span> <span class="o">=</span> <span class="n">ButtonButton</span><span class="p">;</span>
			<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s">&quot;build&quot;</span><span class="p">))</span> <span class="p">{</span>
				<span class="n">ba</span><span class="p">.</span><span class="n">Action</span> <span class="o">=</span> <span class="n">ButtonBuild</span><span class="p">;</span>
			<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s">&quot;train-unit&quot;</span><span class="p">))</span> <span class="p">{</span>
				<span class="n">ba</span><span class="p">.</span><span class="n">Action</span> <span class="o">=</span> <span class="n">ButtonTrain</span><span class="p">;</span>
			<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s">&quot;patrol&quot;</span><span class="p">))</span> <span class="p">{</span>
				<span class="n">ba</span><span class="p">.</span><span class="n">Action</span> <span class="o">=</span> <span class="n">ButtonPatrol</span><span class="p">;</span>
			<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s">&quot;explore&quot;</span><span class="p">))</span> <span class="p">{</span>
				<span class="n">ba</span><span class="p">.</span><span class="n">Action</span> <span class="o">=</span> <span class="n">ButtonExplore</span><span class="p">;</span>
			<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s">&quot;stand-ground&quot;</span><span class="p">))</span> <span class="p">{</span>
				<span class="n">ba</span><span class="p">.</span><span class="n">Action</span> <span class="o">=</span> <span class="n">ButtonStandGround</span><span class="p">;</span>
			<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s">&quot;attack-ground&quot;</span><span class="p">))</span> <span class="p">{</span>
				<span class="n">ba</span><span class="p">.</span><span class="n">Action</span> <span class="o">=</span> <span class="n">ButtonAttackGround</span><span class="p">;</span>
			<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s">&quot;return-goods&quot;</span><span class="p">))</span> <span class="p">{</span>
				<span class="n">ba</span><span class="p">.</span><span class="n">Action</span> <span class="o">=</span> <span class="n">ButtonReturn</span><span class="p">;</span>
			<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s">&quot;cast-spell&quot;</span><span class="p">))</span> <span class="p">{</span>
				<span class="n">ba</span><span class="p">.</span><span class="n">Action</span> <span class="o">=</span> <span class="n">ButtonSpellCast</span><span class="p">;</span>
			<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s">&quot;research&quot;</span><span class="p">))</span> <span class="p">{</span>
				<span class="n">ba</span><span class="p">.</span><span class="n">Action</span> <span class="o">=</span> <span class="n">ButtonResearch</span><span class="p">;</span>
			<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s">&quot;upgrade-to&quot;</span><span class="p">))</span> <span class="p">{</span>
				<span class="n">ba</span><span class="p">.</span><span class="n">Action</span> <span class="o">=</span> <span class="n">ButtonUpgradeTo</span><span class="p">;</span>
			<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s">&quot;unload&quot;</span><span class="p">))</span> <span class="p">{</span>
				<span class="n">ba</span><span class="p">.</span><span class="n">Action</span> <span class="o">=</span> <span class="n">ButtonUnload</span><span class="p">;</span>
			<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s">&quot;cancel&quot;</span><span class="p">))</span> <span class="p">{</span>
				<span class="n">ba</span><span class="p">.</span><span class="n">Action</span> <span class="o">=</span> <span class="n">ButtonCancel</span><span class="p">;</span>
			<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s">&quot;cancel-upgrade&quot;</span><span class="p">))</span> <span class="p">{</span>
				<span class="n">ba</span><span class="p">.</span><span class="n">Action</span> <span class="o">=</span> <span class="n">ButtonCancelUpgrade</span><span class="p">;</span>
			<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s">&quot;cancel-train-unit&quot;</span><span class="p">))</span> <span class="p">{</span>
				<span class="n">ba</span><span class="p">.</span><span class="n">Action</span> <span class="o">=</span> <span class="n">ButtonCancelTrain</span><span class="p">;</span>
			<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s">&quot;cancel-build&quot;</span><span class="p">))</span> <span class="p">{</span>
				<span class="n">ba</span><span class="p">.</span><span class="n">Action</span> <span class="o">=</span> <span class="n">ButtonCancelBuild</span><span class="p">;</span>
			<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s">&quot;callback&quot;</span><span class="p">))</span> <span class="p">{</span>
				<span class="n">ba</span><span class="p">.</span><span class="n">Action</span> <span class="o">=</span> <span class="n">ButtonCallbackAction</span><span class="p">;</span>
			<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
				<span class="n">LuaError</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="s">&quot;Unsupported button action: %s&quot;</span> <span class="n">_C_</span> <span class="n">value</span><span class="p">);</span>
			<span class="p">}</span>
		<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s">&quot;Value&quot;</span><span class="p">))</span> <span class="p">{</span>
			<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">lua_isnumber</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">-1</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="n">lua_isstring</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">-1</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="n">lua_isfunction</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">-1</span><span class="p">))</span> <span class="p">{</span>
				<span class="n">LuaError</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="s">&quot;incorrect argument&quot;</span><span class="p">);</span>
			<span class="p">}</span>

			<span class="k">if</span> <span class="p">(</span><span class="n">lua_isfunction</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">-1</span><span class="p">))</span> <span class="p">{</span>
				<span class="n">ba</span><span class="p">.</span><span class="n">Payload</span> <span class="o">=</span> <span class="k">new</span> <span class="n">LuaCallback</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">-1</span><span class="p">);</span>
			<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
				<span class="kt">char</span> <span class="n">buf</span><span class="p">[</span><span class="mi">64</span><span class="p">];</span>
				<span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">s2</span><span class="p">;</span>

				<span class="k">if</span> <span class="p">(</span><span class="n">lua_isnumber</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">-1</span><span class="p">))</span> <span class="p">{</span>
					<span class="n">snprintf</span><span class="p">(</span><span class="n">buf</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">buf</span><span class="p">),</span> <span class="s">&quot;%ld&quot;</span><span class="p">,</span> <span class="p">(</span><span class="kt">long</span> <span class="kt">int</span><span class="p">)</span><span class="n">lua_tonumber</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">-1</span><span class="p">));</span>
					<span class="n">s2</span> <span class="o">=</span> <span class="n">buf</span><span class="p">;</span>
				<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
					<span class="n">s2</span> <span class="o">=</span> <span class="n">lua_tostring</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">-1</span><span class="p">);</span>
				<span class="p">}</span>
				<span class="n">ba</span><span class="p">.</span><span class="n">ValueStr</span> <span class="o">=</span> <span class="n">s2</span><span class="p">;</span>
			<span class="p">}</span>
		<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s">&quot;Allowed&quot;</span><span class="p">))</span> <span class="p">{</span>
			<span class="n">value</span> <span class="o">=</span> <span class="n">LuaToString</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">-1</span><span class="p">);</span>
			<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s">&quot;check-true&quot;</span><span class="p">))</span> <span class="p">{</span>
				<span class="n">ba</span><span class="p">.</span><span class="n">Allowed</span> <span class="o">=</span> <span class="n">ButtonCheckTrue</span><span class="p">;</span>
			<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s">&quot;check-false&quot;</span><span class="p">))</span> <span class="p">{</span>
				<span class="n">ba</span><span class="p">.</span><span class="n">Allowed</span> <span class="o">=</span> <span class="n">ButtonCheckFalse</span><span class="p">;</span>
			<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s">&quot;check-upgrade&quot;</span><span class="p">))</span> <span class="p">{</span>
				<span class="n">ba</span><span class="p">.</span><span class="n">Allowed</span> <span class="o">=</span> <span class="n">ButtonCheckUpgrade</span><span class="p">;</span>
			<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s">&quot;check-individual-upgrade&quot;</span><span class="p">))</span> <span class="p">{</span>
				<span class="n">ba</span><span class="p">.</span><span class="n">Allowed</span> <span class="o">=</span> <span class="n">ButtonCheckIndividualUpgrade</span><span class="p">;</span>
			<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s">&quot;check-unit-variable&quot;</span><span class="p">))</span> <span class="p">{</span>
				<span class="n">ba</span><span class="p">.</span><span class="n">Allowed</span> <span class="o">=</span> <span class="n">ButtonCheckUnitVariable</span><span class="p">;</span>
			<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s">&quot;check-units-or&quot;</span><span class="p">))</span> <span class="p">{</span>
				<span class="n">ba</span><span class="p">.</span><span class="n">Allowed</span> <span class="o">=</span> <span class="n">ButtonCheckUnitsOr</span><span class="p">;</span>
			<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s">&quot;check-units-and&quot;</span><span class="p">))</span> <span class="p">{</span>
				<span class="n">ba</span><span class="p">.</span><span class="n">Allowed</span> <span class="o">=</span> <span class="n">ButtonCheckUnitsAnd</span><span class="p">;</span>
			<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s">&quot;check-units-not&quot;</span><span class="p">))</span> <span class="p">{</span>
				<span class="n">ba</span><span class="p">.</span><span class="n">Allowed</span> <span class="o">=</span> <span class="n">ButtonCheckUnitsNot</span><span class="p">;</span>
			<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s">&quot;check-network&quot;</span><span class="p">))</span> <span class="p">{</span>
				<span class="n">ba</span><span class="p">.</span><span class="n">Allowed</span> <span class="o">=</span> <span class="n">ButtonCheckNetwork</span><span class="p">;</span>
			<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s">&quot;check-no-network&quot;</span><span class="p">))</span> <span class="p">{</span>
				<span class="n">ba</span><span class="p">.</span><span class="n">Allowed</span> <span class="o">=</span> <span class="n">ButtonCheckNoNetwork</span><span class="p">;</span>
			<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s">&quot;check-no-work&quot;</span><span class="p">))</span> <span class="p">{</span>
				<span class="n">ba</span><span class="p">.</span><span class="n">Allowed</span> <span class="o">=</span> <span class="n">ButtonCheckNoWork</span><span class="p">;</span>
			<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s">&quot;check-no-research&quot;</span><span class="p">))</span> <span class="p">{</span>
				<span class="n">ba</span><span class="p">.</span><span class="n">Allowed</span> <span class="o">=</span> <span class="n">ButtonCheckNoResearch</span><span class="p">;</span>
			<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s">&quot;check-attack&quot;</span><span class="p">))</span> <span class="p">{</span>
				<span class="n">ba</span><span class="p">.</span><span class="n">Allowed</span> <span class="o">=</span> <span class="n">ButtonCheckAttack</span><span class="p">;</span>
			<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s">&quot;check-upgrade-to&quot;</span><span class="p">))</span> <span class="p">{</span>
				<span class="n">ba</span><span class="p">.</span><span class="n">Allowed</span> <span class="o">=</span> <span class="n">ButtonCheckUpgradeTo</span><span class="p">;</span>
			<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s">&quot;check-research&quot;</span><span class="p">))</span> <span class="p">{</span>
				<span class="n">ba</span><span class="p">.</span><span class="n">Allowed</span> <span class="o">=</span> <span class="n">ButtonCheckResearch</span><span class="p">;</span>
			<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s">&quot;check-single-research&quot;</span><span class="p">))</span> <span class="p">{</span>
				<span class="n">ba</span><span class="p">.</span><span class="n">Allowed</span> <span class="o">=</span> <span class="n">ButtonCheckSingleResearch</span><span class="p">;</span>
			<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s">&quot;check-debug&quot;</span><span class="p">))</span> <span class="p">{</span>
				<span class="n">ba</span><span class="p">.</span><span class="n">Allowed</span> <span class="o">=</span> <span class="n">ButtonCheckDebug</span><span class="p">;</span>
			<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
				<span class="n">LuaError</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="s">&quot;Unsupported action: %s&quot;</span> <span class="n">_C_</span> <span class="n">value</span><span class="p">);</span>
			<span class="p">}</span>
		<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s">&quot;AllowArg&quot;</span><span class="p">))</span> <span class="p">{</span>
			<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">lua_istable</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">-1</span><span class="p">))</span> <span class="p">{</span>
				<span class="n">LuaError</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="s">&quot;incorrect argument&quot;</span><span class="p">);</span>
			<span class="p">}</span>
			<span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">allowstr</span><span class="p">;</span>
			<span class="k">const</span> <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">subargs</span> <span class="o">=</span> <span class="n">lua_rawlen</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">-1</span><span class="p">);</span>

			<span class="k">for</span> <span class="p">(</span><span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">k</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">k</span> <span class="o">&lt;</span> <span class="n">subargs</span><span class="p">;</span> <span class="o">++</span><span class="n">k</span><span class="p">)</span> <span class="p">{</span>
				<span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">s2</span> <span class="o">=</span> <span class="n">LuaToString</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">-1</span><span class="p">,</span> <span class="n">k</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>
				<span class="n">allowstr</span> <span class="o">+=</span> <span class="n">s2</span><span class="p">;</span>
				<span class="k">if</span> <span class="p">(</span><span class="n">k</span> <span class="o">!=</span> <span class="n">subargs</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
					<span class="n">allowstr</span> <span class="o">+=</span> <span class="s">&quot;,&quot;</span><span class="p">;</span>
				<span class="p">}</span>
			<span class="p">}</span>
			<span class="n">ba</span><span class="p">.</span><span class="n">AllowStr</span> <span class="o">=</span> <span class="n">allowstr</span><span class="p">;</span>
		<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s">&quot;Key&quot;</span><span class="p">))</span> <span class="p">{</span>
			<span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">key</span><span class="p">(</span><span class="n">LuaToString</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">-1</span><span class="p">));</span>
			<span class="n">ba</span><span class="p">.</span><span class="n">Key</span> <span class="o">=</span> <span class="n">GetHotKey</span><span class="p">(</span><span class="n">key</span><span class="p">);</span>
		<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s">&quot;Hint&quot;</span><span class="p">))</span> <span class="p">{</span>
			<span class="n">ba</span><span class="p">.</span><span class="n">Hint</span> <span class="o">=</span> <span class="n">LuaToString</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">-1</span><span class="p">);</span>
		<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s">&quot;Description&quot;</span><span class="p">))</span> <span class="p">{</span>
			<span class="n">ba</span><span class="p">.</span><span class="n">Description</span> <span class="o">=</span> <span class="n">LuaToString</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">-1</span><span class="p">);</span>
		<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s">&quot;CommentSound&quot;</span><span class="p">))</span> <span class="p">{</span>
			<span class="n">ba</span><span class="p">.</span><span class="n">CommentSound</span><span class="p">.</span><span class="n">Name</span> <span class="o">=</span> <span class="n">LuaToString</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">-1</span><span class="p">);</span>
		<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s">&quot;ButtonCursor&quot;</span><span class="p">))</span> <span class="p">{</span>
			<span class="n">ba</span><span class="p">.</span><span class="n">ButtonCursor</span> <span class="o">=</span> <span class="n">LuaToString</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">-1</span><span class="p">);</span>
		<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s">&quot;Popup&quot;</span><span class="p">))</span> <span class="p">{</span>
			<span class="n">ba</span><span class="p">.</span><span class="n">Popup</span> <span class="o">=</span> <span class="n">LuaToString</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">-1</span><span class="p">);</span>
		<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s">&quot;ForUnit&quot;</span><span class="p">))</span> <span class="p">{</span>
			<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">lua_istable</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">-1</span><span class="p">))</span> <span class="p">{</span>
				<span class="n">LuaError</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="s">&quot;incorrect argument&quot;</span><span class="p">);</span>
			<span class="p">}</span>
			<span class="c1">// FIXME: ba.UnitMask shouldn&#39;t be a string</span>
			<span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">umask</span> <span class="o">=</span> <span class="s">&quot;,&quot;</span><span class="p">;</span>
			<span class="k">const</span> <span class="kt">unsigned</span> <span class="n">subargs</span> <span class="o">=</span> <span class="n">lua_rawlen</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">-1</span><span class="p">);</span>
			<span class="k">for</span> <span class="p">(</span><span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">k</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">k</span> <span class="o">&lt;</span> <span class="n">subargs</span><span class="p">;</span> <span class="o">++</span><span class="n">k</span><span class="p">)</span> <span class="p">{</span>
				<span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">s2</span> <span class="o">=</span> <span class="n">LuaToString</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">-1</span><span class="p">,</span> <span class="n">k</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>
				<span class="n">umask</span> <span class="o">+=</span> <span class="n">s2</span><span class="p">;</span>
				<span class="n">umask</span> <span class="o">+=</span> <span class="s">&quot;,&quot;</span><span class="p">;</span>
			<span class="p">}</span>
			<span class="n">ba</span><span class="p">.</span><span class="n">UnitMask</span> <span class="o">=</span> <span class="n">umask</span><span class="p">;</span>
			<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strncmp</span><span class="p">(</span><span class="n">ba</span><span class="p">.</span><span class="n">UnitMask</span><span class="p">.</span><span class="n">c_str</span><span class="p">(),</span> <span class="s">&quot;,*,&quot;</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span> <span class="p">{</span>
				<span class="n">ba</span><span class="p">.</span><span class="n">UnitMask</span> <span class="o">=</span> <span class="s">&quot;*&quot;</span><span class="p">;</span>
			<span class="p">}</span>
		<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
			<span class="n">LuaError</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="s">&quot;Unsupported tag: %s&quot;</span> <span class="n">_C_</span> <span class="n">value</span><span class="p">);</span>
		<span class="p">}</span>
		<span class="n">lua_pop</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
	<span class="p">}</span>
	<span class="n">AddButton</span><span class="p">(</span><span class="n">ba</span><span class="p">.</span><span class="n">Pos</span><span class="p">,</span> <span class="n">ba</span><span class="p">.</span><span class="n">Level</span><span class="p">,</span> <span class="n">ba</span><span class="p">.</span><span class="n">Icon</span><span class="p">.</span><span class="n">Name</span><span class="p">,</span> <span class="n">ba</span><span class="p">.</span><span class="n">Action</span><span class="p">,</span> <span class="n">ba</span><span class="p">.</span><span class="n">ValueStr</span><span class="p">,</span> <span class="n">ba</span><span class="p">.</span><span class="n">Payload</span><span class="p">,</span>
			  <span class="n">ba</span><span class="p">.</span><span class="n">Allowed</span><span class="p">,</span> <span class="n">ba</span><span class="p">.</span><span class="n">AllowStr</span><span class="p">,</span> <span class="n">ba</span><span class="p">.</span><span class="n">Key</span><span class="p">,</span> <span class="n">ba</span><span class="p">.</span><span class="n">Hint</span><span class="p">,</span> <span class="n">ba</span><span class="p">.</span><span class="n">Description</span><span class="p">,</span> <span class="n">ba</span><span class="p">.</span><span class="n">CommentSound</span><span class="p">.</span><span class="n">Name</span><span class="p">,</span>
			  <span class="n">ba</span><span class="p">.</span><span class="n">ButtonCursor</span><span class="p">,</span> <span class="n">ba</span><span class="p">.</span><span class="n">UnitMask</span><span class="p">,</span> <span class="n">ba</span><span class="p">.</span><span class="n">Popup</span><span class="p">,</span> <span class="n">ba</span><span class="p">.</span><span class="n">AlwaysShow</span><span class="p">);</span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</p>
                          </details>
                        </details>
                        
                        <details>
                        <summary>ClearButtons</summary>
                        <p><br>  Clear all buttons<br><br>  @param l  Lua state.</p>
                          <details>
                          <summary>/ui/script_ui.cpp:967 CclClearButtons</summary>
                          <p><div class="highlight"><pre><span></span><span class="k">static</span> <span class="kt">int</span> <span class="nf">CclClearButtons</span><span class="p">(</span><span class="n">lua_State</span> <span class="o">*</span><span class="n">l</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">LuaCheckArgs</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
	<span class="n">CleanButtons</span><span class="p">();</span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</p>
                          </details>
                        </details>
                        
                        <details>
                        <summary>DefineButtonStyle</summary>
                        <p><br>  Define a button style<br><br>  @param l  Lua state.</p>
                          <details>
                          <summary>/ui/script_ui.cpp:923 CclDefineButtonStyle</summary>
                          <p><div class="highlight"><pre><span></span><span class="k">static</span> <span class="kt">int</span> <span class="nf">CclDefineButtonStyle</span><span class="p">(</span><span class="n">lua_State</span> <span class="o">*</span><span class="n">l</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">LuaCheckArgs</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">2</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">lua_istable</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span> <span class="p">{</span>
		<span class="n">LuaError</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="s">&quot;incorrect argument&quot;</span><span class="p">);</span>
	<span class="p">}</span>
	<span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">style</span> <span class="o">=</span> <span class="n">LuaToString</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
	<span class="n">ButtonStyle</span> <span class="o">*&amp;</span><span class="n">b</span> <span class="o">=</span> <span class="n">ButtonStyleHash</span><span class="p">[</span><span class="n">style</span><span class="p">];</span>
	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">b</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">b</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ButtonStyle</span><span class="p">;</span>
		<span class="c1">// Set to bogus value to see if it was set later</span>
		<span class="n">b</span><span class="o">-&gt;</span><span class="n">Default</span><span class="p">.</span><span class="n">TextPos</span><span class="p">.</span><span class="n">x</span> <span class="o">=</span> <span class="n">b</span><span class="o">-&gt;</span><span class="n">Hover</span><span class="p">.</span><span class="n">TextPos</span><span class="p">.</span><span class="n">x</span> <span class="o">=</span> <span class="n">b</span><span class="o">-&gt;</span><span class="n">Clicked</span><span class="p">.</span><span class="n">TextPos</span><span class="p">.</span><span class="n">x</span> <span class="o">=</span> <span class="mh">0xFFFFFF</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="n">lua_pushnil</span><span class="p">(</span><span class="n">l</span><span class="p">);</span>
	<span class="k">while</span> <span class="p">(</span><span class="n">lua_next</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span> <span class="p">{</span>
		<span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">value</span> <span class="o">=</span> <span class="n">LuaToString</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">-2</span><span class="p">);</span>

		<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s">&quot;Size&quot;</span><span class="p">))</span> <span class="p">{</span>
			<span class="n">CclGetPos</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">b</span><span class="o">-&gt;</span><span class="n">Width</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">b</span><span class="o">-&gt;</span><span class="n">Height</span><span class="p">);</span>
		<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s">&quot;Font&quot;</span><span class="p">))</span> <span class="p">{</span>
			<span class="n">b</span><span class="o">-&gt;</span><span class="n">Font</span> <span class="o">=</span> <span class="n">CFont</span><span class="o">::</span><span class="n">Get</span><span class="p">(</span><span class="n">LuaToString</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">-1</span><span class="p">));</span>
		<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s">&quot;TextNormalColor&quot;</span><span class="p">))</span> <span class="p">{</span>
			<span class="n">b</span><span class="o">-&gt;</span><span class="n">TextNormalColor</span> <span class="o">=</span> <span class="n">LuaToString</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">-1</span><span class="p">);</span>
		<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s">&quot;TextReverseColor&quot;</span><span class="p">))</span> <span class="p">{</span>
			<span class="n">b</span><span class="o">-&gt;</span><span class="n">TextReverseColor</span> <span class="o">=</span> <span class="n">LuaToString</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">-1</span><span class="p">);</span>
		<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s">&quot;TextPos&quot;</span><span class="p">))</span> <span class="p">{</span>
			<span class="n">CclGetPos</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">b</span><span class="o">-&gt;</span><span class="n">TextX</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">b</span><span class="o">-&gt;</span><span class="n">TextY</span><span class="p">);</span>
		<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s">&quot;TextAlign&quot;</span><span class="p">))</span> <span class="p">{</span>
			<span class="n">value</span> <span class="o">=</span> <span class="n">LuaToString</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">-1</span><span class="p">);</span>
			<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s">&quot;Center&quot;</span><span class="p">))</span> <span class="p">{</span>
				<span class="n">b</span><span class="o">-&gt;</span><span class="n">TextAlign</span> <span class="o">=</span> <span class="n">TextAlignCenter</span><span class="p">;</span>
			<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s">&quot;Right&quot;</span><span class="p">))</span> <span class="p">{</span>
				<span class="n">b</span><span class="o">-&gt;</span><span class="n">TextAlign</span> <span class="o">=</span> <span class="n">TextAlignRight</span><span class="p">;</span>
			<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s">&quot;Left&quot;</span><span class="p">))</span> <span class="p">{</span>
				<span class="n">b</span><span class="o">-&gt;</span><span class="n">TextAlign</span> <span class="o">=</span> <span class="n">TextAlignLeft</span><span class="p">;</span>
			<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
				<span class="n">LuaError</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="s">&quot;Invalid text alignment: %s&quot;</span> <span class="n">_C_</span> <span class="n">value</span><span class="p">);</span>
			<span class="p">}</span>
		<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s">&quot;Default&quot;</span><span class="p">))</span> <span class="p">{</span>
			<span class="n">ParseButtonStyleProperties</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">b</span><span class="o">-&gt;</span><span class="n">Default</span><span class="p">);</span>
		<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s">&quot;Hover&quot;</span><span class="p">))</span> <span class="p">{</span>
			<span class="n">ParseButtonStyleProperties</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">b</span><span class="o">-&gt;</span><span class="n">Hover</span><span class="p">);</span>
		<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s">&quot;Clicked&quot;</span><span class="p">))</span> <span class="p">{</span>
			<span class="n">ParseButtonStyleProperties</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">b</span><span class="o">-&gt;</span><span class="n">Clicked</span><span class="p">);</span>
		<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
			<span class="n">LuaError</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="s">&quot;Unsupported tag: %s&quot;</span> <span class="n">_C_</span> <span class="n">value</span><span class="p">);</span>
		<span class="p">}</span>
		<span class="n">lua_pop</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
	<span class="p">}</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">b</span><span class="o">-&gt;</span><span class="n">Default</span><span class="p">.</span><span class="n">TextPos</span><span class="p">.</span><span class="n">x</span> <span class="o">==</span> <span class="mh">0xFFFFFF</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">b</span><span class="o">-&gt;</span><span class="n">Default</span><span class="p">.</span><span class="n">TextPos</span><span class="p">.</span><span class="n">x</span> <span class="o">=</span> <span class="n">b</span><span class="o">-&gt;</span><span class="n">TextX</span><span class="p">;</span>
		<span class="n">b</span><span class="o">-&gt;</span><span class="n">Default</span><span class="p">.</span><span class="n">TextPos</span><span class="p">.</span><span class="n">y</span> <span class="o">=</span> <span class="n">b</span><span class="o">-&gt;</span><span class="n">TextY</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">b</span><span class="o">-&gt;</span><span class="n">Hover</span><span class="p">.</span><span class="n">TextPos</span><span class="p">.</span><span class="n">x</span> <span class="o">==</span> <span class="mh">0xFFFFFF</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">b</span><span class="o">-&gt;</span><span class="n">Hover</span><span class="p">.</span><span class="n">TextPos</span><span class="p">.</span><span class="n">x</span> <span class="o">=</span> <span class="n">b</span><span class="o">-&gt;</span><span class="n">TextX</span><span class="p">;</span>
		<span class="n">b</span><span class="o">-&gt;</span><span class="n">Hover</span><span class="p">.</span><span class="n">TextPos</span><span class="p">.</span><span class="n">y</span> <span class="o">=</span> <span class="n">b</span><span class="o">-&gt;</span><span class="n">TextY</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">b</span><span class="o">-&gt;</span><span class="n">Clicked</span><span class="p">.</span><span class="n">TextPos</span><span class="p">.</span><span class="n">x</span> <span class="o">==</span> <span class="mh">0xFFFFFF</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">b</span><span class="o">-&gt;</span><span class="n">Clicked</span><span class="p">.</span><span class="n">TextPos</span><span class="p">.</span><span class="n">x</span> <span class="o">=</span> <span class="n">b</span><span class="o">-&gt;</span><span class="n">TextX</span><span class="p">;</span>
		<span class="n">b</span><span class="o">-&gt;</span><span class="n">Clicked</span><span class="p">.</span><span class="n">TextPos</span><span class="p">.</span><span class="n">y</span> <span class="o">=</span> <span class="n">b</span><span class="o">-&gt;</span><span class="n">TextY</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">b</span><span class="o">-&gt;</span><span class="n">Default</span><span class="p">.</span><span class="n">TextAlign</span> <span class="o">==</span> <span class="n">TextAlignUndefined</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">b</span><span class="o">-&gt;</span><span class="n">Default</span><span class="p">.</span><span class="n">TextAlign</span> <span class="o">=</span> <span class="n">b</span><span class="o">-&gt;</span><span class="n">TextAlign</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">b</span><span class="o">-&gt;</span><span class="n">Hover</span><span class="p">.</span><span class="n">TextAlign</span> <span class="o">==</span> <span class="n">TextAlignUndefined</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">b</span><span class="o">-&gt;</span><span class="n">Hover</span><span class="p">.</span><span class="n">TextAlign</span> <span class="o">=</span> <span class="n">b</span><span class="o">-&gt;</span><span class="n">TextAlign</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">b</span><span class="o">-&gt;</span><span class="n">Clicked</span><span class="p">.</span><span class="n">TextAlign</span> <span class="o">==</span> <span class="n">TextAlignUndefined</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">b</span><span class="o">-&gt;</span><span class="n">Clicked</span><span class="p">.</span><span class="n">TextAlign</span> <span class="o">=</span> <span class="n">b</span><span class="o">-&gt;</span><span class="n">TextAlign</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</p>
                          </details>
                        </details>
                        
                        <details>
                        <summary>PresentMap</summary>
                        <p><br> <b>Description</b><br><br> Set basic map caracteristics.<br><br>  @param l  Lua state.<br><br> Example:<br><br> <div class="example"><code><strong>PresentMap</strong>("Map description", 1, 128, 128, 17)</code></div></p>
                          <details>
                          <summary>/ui/script_ui.cpp:1262 CclPresentMap</summary>
                          <p><div class="highlight"><pre><span></span><span class="k">static</span> <span class="kt">int</span> <span class="nf">CclPresentMap</span><span class="p">(</span><span class="n">lua_State</span> <span class="o">*</span><span class="n">l</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">LuaCheckArgs</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">5</span><span class="p">);</span>

	<span class="n">Map</span><span class="p">.</span><span class="n">Info</span><span class="p">.</span><span class="n">Description</span> <span class="o">=</span> <span class="n">LuaToString</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
	<span class="c1">// Number of players in LuaToNumber(l, 3); // Not used yet.</span>
	<span class="n">Map</span><span class="p">.</span><span class="n">Info</span><span class="p">.</span><span class="n">MapWidth</span> <span class="o">=</span> <span class="n">LuaToNumber</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">3</span><span class="p">);</span>
	<span class="n">Map</span><span class="p">.</span><span class="n">Info</span><span class="p">.</span><span class="n">MapHeight</span> <span class="o">=</span> <span class="n">LuaToNumber</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">4</span><span class="p">);</span>
	<span class="n">Map</span><span class="p">.</span><span class="n">Info</span><span class="p">.</span><span class="n">MapUID</span> <span class="o">=</span> <span class="n">LuaToNumber</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">5</span><span class="p">);</span>

	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</p>
                          </details>
                        </details>
                        
                        <details>
                        <summary>DefineMapSetup</summary>
                        <p><br> <b>Description</b><br><br> Define the lua file that will build the map<br><br>  @param l  Lua state.<br><br> Example:<br><br> <div class="example"><code>-- Load map setup from file<br>		<strong>DefineMapSetup</strong>("Setup.sms")</code></div></p>
                          <details>
                          <summary>/ui/script_ui.cpp:1282 CclDefineMapSetup</summary>
                          <p><div class="highlight"><pre><span></span><span class="k">static</span> <span class="kt">int</span> <span class="nf">CclDefineMapSetup</span><span class="p">(</span><span class="n">lua_State</span> <span class="o">*</span><span class="n">l</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">LuaCheckArgs</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
	<span class="n">Map</span><span class="p">.</span><span class="n">Info</span><span class="p">.</span><span class="n">Filename</span> <span class="o">=</span> <span class="n">LuaToString</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>

	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</p>
                          </details>
                        </details>
                        
                        <details>
                        <summary>SetSelectionStyle</summary>
                        <p><br>  Set selection style.<br><br>  @param l  Lua state.</p>
                          <details>
                          <summary>/ui/script_ui.cpp:1208 CclSetSelectionStyle</summary>
                          <p><div class="highlight"><pre><span></span><span class="k">static</span> <span class="kt">int</span> <span class="nf">CclSetSelectionStyle</span><span class="p">(</span><span class="n">lua_State</span> <span class="o">*</span><span class="n">l</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">LuaCheckArgs</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>

	<span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">style</span> <span class="o">=</span> <span class="n">LuaToString</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">style</span><span class="p">,</span> <span class="s">&quot;rectangle&quot;</span><span class="p">))</span> <span class="p">{</span>
		<span class="n">DrawSelection</span> <span class="o">=</span> <span class="n">DrawSelectionRectangle</span><span class="p">;</span>
	<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">style</span><span class="p">,</span> <span class="s">&quot;alpha-rectangle&quot;</span><span class="p">))</span> <span class="p">{</span>
		<span class="n">DrawSelection</span> <span class="o">=</span> <span class="n">DrawSelectionRectangleWithTrans</span><span class="p">;</span>
	<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">style</span><span class="p">,</span> <span class="s">&quot;circle&quot;</span><span class="p">))</span> <span class="p">{</span>
		<span class="n">DrawSelection</span> <span class="o">=</span> <span class="n">DrawSelectionCircle</span><span class="p">;</span>
	<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">style</span><span class="p">,</span> <span class="s">&quot;alpha-circle&quot;</span><span class="p">))</span> <span class="p">{</span>
		<span class="n">DrawSelection</span> <span class="o">=</span> <span class="n">DrawSelectionCircleWithTrans</span><span class="p">;</span>
	<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">style</span><span class="p">,</span> <span class="s">&quot;corners&quot;</span><span class="p">))</span> <span class="p">{</span>
		<span class="n">DrawSelection</span> <span class="o">=</span> <span class="n">DrawSelectionCorners</span><span class="p">;</span>
	<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
		<span class="n">LuaError</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="s">&quot;Unsupported selection style&quot;</span><span class="p">);</span>
	<span class="p">}</span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</p>
                          </details>
                        </details>
                        
                        <details>
                        <summary>SetGroupKeys</summary>
                        <p><br>  Set the keys which are use for grouping units, helpful for other keyboards<br><br>  @param l  Lua state.</p>
                          <details>
                          <summary>/ui/script_ui.cpp:1238 CclSetGroupKeys</summary>
                          <p><div class="highlight"><pre><span></span><span class="k">static</span> <span class="kt">int</span> <span class="nf">CclSetGroupKeys</span><span class="p">(</span><span class="n">lua_State</span> <span class="o">*</span><span class="n">l</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">LuaCheckArgs</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
	<span class="n">UiGroupKeys</span> <span class="o">=</span> <span class="n">LuaToString</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</p>
                          </details>
                        </details>
                        <hr>/ai/script_ai.cpp<hr>
                        <details>
                        <summary>DefineAiHelper</summary>
                        <p><br>  Define helper for AI.<br><br>  @param l  Lua state.<br><br>  @todo  FIXME: the first unit could be a list see ../doc/ccl/ai.html</p>
                          <details>
                          <summary>/ai/script_ai.cpp:350 CclDefineAiHelper</summary>
                          <p><div class="highlight"><pre><span></span><span class="k">static</span> <span class="kt">int</span> <span class="nf">CclDefineAiHelper</span><span class="p">(</span><span class="n">lua_State</span> <span class="o">*</span><span class="n">l</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">InitAiHelper</span><span class="p">(</span><span class="n">AiHelpers</span><span class="p">);</span>

	<span class="k">const</span> <span class="kt">int</span> <span class="n">args</span> <span class="o">=</span> <span class="n">lua_gettop</span><span class="p">(</span><span class="n">l</span><span class="p">);</span>
	<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="n">args</span><span class="p">;</span> <span class="o">++</span><span class="n">j</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">lua_istable</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span> <span class="p">{</span>
			<span class="n">LuaError</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="s">&quot;incorrect argument&quot;</span><span class="p">);</span>
		<span class="p">}</span>
		<span class="k">const</span> <span class="kt">int</span> <span class="n">subargs</span> <span class="o">=</span> <span class="n">lua_rawlen</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>
		<span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">value</span> <span class="o">=</span> <span class="n">LuaToString</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
		<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s">&quot;build&quot;</span><span class="p">)</span>
			<span class="o">||</span> <span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s">&quot;train&quot;</span><span class="p">)</span>
			<span class="o">||</span> <span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s">&quot;upgrade&quot;</span><span class="p">)</span>
			<span class="o">||</span> <span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s">&quot;research&quot;</span><span class="p">)</span>
			<span class="o">||</span> <span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s">&quot;unit-limit&quot;</span><span class="p">)</span>
			<span class="o">||</span> <span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s">&quot;repair&quot;</span><span class="p">))</span> <span class="p">{</span>
<span class="cp">#ifdef DEBUG</span>
			<span class="n">fprintf</span><span class="p">(</span><span class="n">stderr</span><span class="p">,</span> <span class="s">&quot;DefineAiHelper: Relation is computed from buttons, you may remove safely the block beginning with &#39;</span><span class="se">\&quot;</span><span class="s">%s</span><span class="se">\&quot;</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">value</span><span class="p">);</span>
<span class="cp">#endif</span>
			<span class="k">continue</span><span class="p">;</span>
		<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s">&quot;unit-equiv&quot;</span><span class="p">))</span> <span class="p">{</span>
		<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
			<span class="n">LuaError</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="s">&quot;unknown tag: %s&quot;</span> <span class="n">_C_</span> <span class="n">value</span><span class="p">);</span>
		<span class="p">}</span>
		<span class="c1">// Get the base unit type, which could handle the action.</span>
		<span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">baseTypeName</span> <span class="o">=</span> <span class="n">LuaToString</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">);</span>
		<span class="k">const</span> <span class="n">CUnitType</span> <span class="o">*</span><span class="n">base</span> <span class="o">=</span> <span class="n">UnitTypeByIdent</span><span class="p">(</span><span class="n">baseTypeName</span><span class="p">);</span>
		<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">base</span><span class="p">)</span> <span class="p">{</span>
			<span class="n">LuaError</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="s">&quot;unknown unittype: %s&quot;</span> <span class="n">_C_</span> <span class="n">baseTypeName</span><span class="p">);</span>
		<span class="p">}</span>

		<span class="c1">// Get the unit types, which could be produced</span>
		<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">k</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span> <span class="n">k</span> <span class="o">&lt;</span> <span class="n">subargs</span><span class="p">;</span> <span class="o">++</span><span class="n">k</span><span class="p">)</span> <span class="p">{</span>
			<span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">equivTypeName</span> <span class="o">=</span> <span class="n">LuaToString</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">k</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>
			<span class="n">CUnitType</span> <span class="o">*</span><span class="n">type</span> <span class="o">=</span> <span class="n">UnitTypeByIdent</span><span class="p">(</span><span class="n">equivTypeName</span><span class="p">);</span>
			<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">type</span><span class="p">)</span> <span class="p">{</span>
				<span class="n">LuaError</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="s">&quot;unknown unittype: %s&quot;</span> <span class="n">_C_</span> <span class="n">equivTypeName</span><span class="p">);</span>
			<span class="p">}</span>
			<span class="n">AiHelperInsert</span><span class="p">(</span><span class="n">AiHelpers</span><span class="p">.</span><span class="n">Equiv</span><span class="p">,</span> <span class="n">base</span><span class="o">-&gt;</span><span class="n">Slot</span><span class="p">,</span> <span class="o">*</span><span class="n">type</span><span class="p">);</span>
			<span class="n">AiNewUnitTypeEquiv</span><span class="p">(</span><span class="o">*</span><span class="n">base</span><span class="p">,</span> <span class="o">*</span><span class="n">type</span><span class="p">);</span>
		<span class="p">}</span>
	<span class="p">}</span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</p>
                          </details>
                        </details>
                        
                        <details>
                        <summary>DefineAi</summary>
                        <p><br> <b>Description</b><br><br>  Define an AI engine.<br><br>  @param l  Lua state.<br><br>  @return   FIXME: docu<br><br> Example:<br><br> <div class="example"><code>-- Those instructions will be executed forever<br>		local simple_ai_loop = {<br>			-- Sleep for 5 in game minutes<br>			function() return AiSleep(9000) end,<br>			-- Repeat the functions from start.<br>			function() stratagus.gameData.AIState.loop_index[1 + AiPlayer()] = 0; return false; end,<br>		}<br><br>		-- The initial instructions the A.I has to execute<br>		local simple_ai = {<br>			function() return AiSleep(1800) end, -- Sleep for 1 in game minute<br>			function() return AiNeed("unit-town-hall") end, -- One Town Hall is needed<br>			function() return AiWait("unit-town-hall") end, -- Wait until the Town Hall is completed<br>			function() return AiSet("unit-peasant", 4) end, -- Make 4 peasants<br>			-- Basic buildings<br>			function() return AiSet("unit-farm", 4) end, -- Make 4 farms<br>			function() return AiWait("unit-farm") end, -- Wait until all 4 farms are build.<br>			function() return AiNeed("unit-human-barracks") end, -- Need a Barracks<br>			function() return AiWait("unit-human-barracks") end, -- Wait until the Barracks has been built<br>			-- Defense force for the base<br>			function() return AiForce(1, {"unit-footman", 3}) end, -- Make a force of 3 footmen<br>			function() return AiWaitForce(1) end, -- Wait until the 3 footmen are trained<br>			function() return AiForceRole(1,"defend") end, -- Make this force as a defense force<br>			-- Execute the instructions in simple_ai_loop<br>			function() return AiLoop(simple_ai_loop, stratagus.gameData.AIState.loop_index) end,<br>		}<br><br>		-- function that calls the instructions in simple_ai inside DefineAi<br>		function custom_ai() return AiLoop(simple_ai,stratagus.gameData.AIState.index) end<br>		-- Make an A.I for the human race that calls the function custom_ai<br>		<strong>DefineAi</strong>("example_ai","human","class_ai",custom_ai)</code></div></p>
                          <details>
                          <summary>/ai/script_ai.cpp:452 CclDefineAi</summary>
                          <p><div class="highlight"><pre><span></span><span class="k">static</span> <span class="kt">int</span> <span class="nf">CclDefineAi</span><span class="p">(</span><span class="n">lua_State</span> <span class="o">*</span><span class="n">l</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">LuaCheckArgs</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">4</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">lua_isfunction</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span> <span class="p">{</span>
		<span class="n">LuaError</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="s">&quot;incorrect argument&quot;</span><span class="p">);</span>
	<span class="p">}</span>

	<span class="n">CAiType</span> <span class="o">*</span><span class="n">aitype</span> <span class="o">=</span> <span class="k">new</span> <span class="n">CAiType</span><span class="p">;</span>

	<span class="c1">// AI Name</span>
	<span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">aiName</span> <span class="o">=</span> <span class="n">LuaToString</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
	<span class="n">aitype</span><span class="o">-&gt;</span><span class="n">Name</span> <span class="o">=</span> <span class="n">aiName</span><span class="p">;</span>

<span class="cp">#ifdef DEBUG</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">GetAiTypesByName</span><span class="p">(</span><span class="n">aiName</span><span class="p">))</span> <span class="p">{</span>
		<span class="n">DebugPrint</span><span class="p">(</span><span class="s">&quot;Warning two or more AI&#39;s with the same name &#39;%s&#39;</span><span class="se">\n</span><span class="s">&quot;</span> <span class="n">_C_</span> <span class="n">aiName</span><span class="p">);</span>
	<span class="p">}</span>
<span class="cp">#endif</span>
	<span class="n">AiTypes</span><span class="p">.</span><span class="n">insert</span><span class="p">(</span><span class="n">AiTypes</span><span class="p">.</span><span class="n">begin</span><span class="p">(),</span> <span class="n">aitype</span><span class="p">);</span>

	<span class="c1">// AI Race</span>
	<span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">value</span> <span class="o">=</span> <span class="n">LuaToString</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">2</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="o">*</span><span class="n">value</span> <span class="o">!=</span> <span class="sc">&#39;*&#39;</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">aitype</span><span class="o">-&gt;</span><span class="n">Race</span> <span class="o">=</span> <span class="n">value</span><span class="p">;</span>
	<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
		<span class="n">aitype</span><span class="o">-&gt;</span><span class="n">Race</span><span class="p">.</span><span class="n">clear</span><span class="p">();</span>
	<span class="p">}</span>

	<span class="c1">// AI Class</span>
	<span class="n">aitype</span><span class="o">-&gt;</span><span class="n">Class</span> <span class="o">=</span> <span class="n">LuaToString</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">3</span><span class="p">);</span>

	<span class="c1">// AI Script</span>
	<span class="n">lua_getglobal</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="s">&quot;_ai_scripts_&quot;</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">lua_isnil</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">-1</span><span class="p">))</span> <span class="p">{</span>
		<span class="n">lua_pop</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
		<span class="n">lua_newtable</span><span class="p">(</span><span class="n">l</span><span class="p">);</span>
		<span class="n">lua_setglobal</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="s">&quot;_ai_scripts_&quot;</span><span class="p">);</span>
		<span class="n">lua_getglobal</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="s">&quot;_ai_scripts_&quot;</span><span class="p">);</span>
	<span class="p">}</span>
	<span class="n">aitype</span><span class="o">-&gt;</span><span class="n">Script</span> <span class="o">=</span> <span class="n">aitype</span><span class="o">-&gt;</span><span class="n">Name</span> <span class="o">+</span> <span class="n">aitype</span><span class="o">-&gt;</span><span class="n">Race</span> <span class="o">+</span> <span class="n">aitype</span><span class="o">-&gt;</span><span class="n">Class</span><span class="p">;</span>
	<span class="n">lua_pushstring</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">aitype</span><span class="o">-&gt;</span><span class="n">Script</span><span class="p">.</span><span class="n">c_str</span><span class="p">());</span>
	<span class="n">lua_pushvalue</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">4</span><span class="p">);</span>
	<span class="n">lua_rawset</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">5</span><span class="p">);</span>
	<span class="n">lua_pop</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>

	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</p>
                          </details>
                        </details>
                        
                        <details>
                        <summary>AiGetRace</summary>
                        <p><br>  Get the race of the current AI player.<br><br>  @param l  Lua state.</p>
                          <details>
                          <summary>/ai/script_ai.cpp:539 CclAiGetRace</summary>
                          <p><div class="highlight"><pre><span></span><span class="k">static</span> <span class="kt">int</span> <span class="nf">CclAiGetRace</span><span class="p">(</span><span class="n">lua_State</span> <span class="o">*</span><span class="n">l</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">LuaCheckArgs</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
	<span class="n">lua_pushstring</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">PlayerRaces</span><span class="p">.</span><span class="n">Name</span><span class="p">[</span><span class="n">AiPlayer</span><span class="o">-&gt;</span><span class="n">Player</span><span class="o">-&gt;</span><span class="n">Race</span><span class="p">].</span><span class="n">c_str</span><span class="p">());</span>
	<span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</p>
                          </details>
                        </details>
                        
                        <details>
                        <summary>AiGetSleepCycles</summary>
                        <p><br> <b>Description</b><br><br>  Get the number of cycles to sleep.<br><br>  @param l  Lua state<br><br>  @return   Number of return values<br><br> Example:<br><br> <div class="example"><code>local simple_ai_loop = {<br>			-- Sleep for 5 in game minutes<br>			function() return AiSleep(9000) end,<br>			-- Repeat the instructions forever.<br>			function() stratagus.gameData.AIState.loop_index[1 + AiPlayer()] = 0; return false; end,<br>		}<br><br>		local simple_ai = {<br>			-- Get the number of cycles to sleep.<br>			function() return AiSleep(<strong>AiGetSleepCycles()</strong>) end,<br>			-- Execute the instructions in simple_ai_loop<br>			function() return AiLoop(simple_ai_loop, stratagus.gameData.AIState.loop_index) end,<br>		}<br><br>		function custom_ai() return AiLoop(simple_ai,stratagus.gameData.AIState.index) end<br>		DefineAi("example_ai","human","class_ai",custom_ai)</code></div></p>
                          <details>
                          <summary>/ai/script_ai.cpp:574 CclAiGetSleepCycles</summary>
                          <p><div class="highlight"><pre><span></span><span class="k">static</span> <span class="kt">int</span> <span class="nf">CclAiGetSleepCycles</span><span class="p">(</span><span class="n">lua_State</span> <span class="o">*</span><span class="n">l</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">LuaCheckArgs</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
	<span class="n">lua_pushnumber</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">AiSleepCycles</span><span class="p">);</span>
	<span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</p>
                          </details>
                        </details>
                        
                        <details>
                        <summary>AiDebug</summary>
                        <p><br>  Set debugging flag of AI script<br><br>  @param l  Lua state<br><br>  @return   Number of return values</p>
                          <details>
                          <summary>/ai/script_ai.cpp:590 CclAiDebug</summary>
                          <p><div class="highlight"><pre><span></span><span class="k">static</span> <span class="kt">int</span> <span class="nf">CclAiDebug</span><span class="p">(</span><span class="n">lua_State</span> <span class="o">*</span><span class="n">l</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">LuaCheckArgs</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
	<span class="n">AiPlayer</span><span class="o">-&gt;</span><span class="n">ScriptDebug</span> <span class="o">=</span> <span class="n">LuaToBoolean</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</p>
                          </details>
                        </details>
                        
                        <details>
                        <summary>AiDebugPlayer</summary>
                        <p><br>  Activate AI debugging for the given player(s)<br>  Player can be a number for a specific player<br>    "self" for current human player (ai me)<br>    "none" to disable<br><br>  @param l  Lua State<br><br>  @return   Number of return values</p>
                          <details>
                          <summary>/ai/script_ai.cpp:638 CclAiDebugPlayer</summary>
                          <p><div class="highlight"><pre><span></span><span class="k">static</span> <span class="kt">int</span> <span class="nf">CclAiDebugPlayer</span><span class="p">(</span><span class="n">lua_State</span> <span class="o">*</span><span class="n">l</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">const</span> <span class="kt">int</span> <span class="n">args</span> <span class="o">=</span> <span class="n">lua_gettop</span><span class="p">(</span><span class="n">l</span><span class="p">);</span>
	<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="n">args</span><span class="p">;</span> <span class="o">++</span><span class="n">j</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">item</span><span class="p">;</span>

		<span class="k">if</span> <span class="p">(</span><span class="n">lua_isstring</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span> <span class="p">{</span>
			<span class="n">item</span> <span class="o">=</span> <span class="n">LuaToString</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>
		<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
			<span class="n">item</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">;</span>
		<span class="p">}</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">item</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="s">&quot;none&quot;</span><span class="p">))</span> <span class="p">{</span>
			<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">!=</span> <span class="n">NumPlayers</span><span class="p">;</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span> <span class="p">{</span>
				<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">Players</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">AiEnabled</span> <span class="o">||</span> <span class="o">!</span><span class="n">Players</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">Ai</span><span class="p">)</span> <span class="p">{</span>
					<span class="k">continue</span><span class="p">;</span>
				<span class="p">}</span>
				<span class="n">Players</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">Ai</span><span class="o">-&gt;</span><span class="n">ScriptDebug</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
			<span class="p">}</span>
		<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
			<span class="kt">int</span> <span class="n">playerid</span><span class="p">;</span>
			<span class="k">if</span> <span class="p">(</span><span class="n">item</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="s">&quot;self&quot;</span><span class="p">))</span> <span class="p">{</span>
				<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">ThisPlayer</span><span class="p">)</span> <span class="p">{</span>
					<span class="k">continue</span><span class="p">;</span>
				<span class="p">}</span>
				<span class="n">playerid</span> <span class="o">=</span> <span class="n">ThisPlayer</span><span class="o">-&gt;</span><span class="n">Index</span><span class="p">;</span>
			<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
				<span class="n">playerid</span> <span class="o">=</span> <span class="n">LuaToNumber</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>
			<span class="p">}</span>

			<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">Players</span><span class="p">[</span><span class="n">playerid</span><span class="p">].</span><span class="n">AiEnabled</span> <span class="o">||</span> <span class="o">!</span><span class="n">Players</span><span class="p">[</span><span class="n">playerid</span><span class="p">].</span><span class="n">Ai</span><span class="p">)</span> <span class="p">{</span>
				<span class="k">continue</span><span class="p">;</span>
			<span class="p">}</span>
			<span class="n">Players</span><span class="p">[</span><span class="n">playerid</span><span class="p">].</span><span class="n">Ai</span><span class="o">-&gt;</span><span class="n">ScriptDebug</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
		<span class="p">}</span>
	<span class="p">}</span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</p>
                          </details>
                        </details>
                        
                        <details>
                        <summary>AiNeed</summary>
                        <p><br> <b>Description</b><br><br>  Need a unit.<br><br>  @param l  Lua state.<br><br>  @return   Number of return values<br><br> Example:<br><br> <div class="example"><code>local simple_ai_loop = {<br>			-- Sleep for 5 in game minutes<br>			function() return AiSleep(9000) end,<br>			-- Repeat the instructions forever.<br>			function() stratagus.gameData.AIState.loop_index[1 + AiPlayer()] = 0; return false; end,<br>		}<br><br>		local simple_ai = {<br>			function() return AiSleep(AiGetSleepCycles()) end,<br>			-- Tell to the A.I that it needs a Town Hall.<br>			function() return <strong>AiNeed</strong>("unit-town-hall") end,<br>			-- Execute the instructions in simple_ai_loop<br>			function() return AiLoop(simple_ai_loop, stratagus.gameData.AIState.loop_index) end,<br>		}<br><br>		function custom_ai() return AiLoop(simple_ai,stratagus.gameData.AIState.index) end<br>		DefineAi("example_ai","human","class_ai",custom_ai)</code></div></p>
                          <details>
                          <summary>/ai/script_ai.cpp:676 CclAiNeed</summary>
                          <p><div class="highlight"><pre><span></span><span class="k">static</span> <span class="kt">int</span> <span class="nf">CclAiNeed</span><span class="p">(</span><span class="n">lua_State</span> <span class="o">*</span><span class="n">l</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">LuaCheckArgs</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
	<span class="n">InsertUnitTypeRequests</span><span class="p">(</span><span class="n">CclGetUnitType</span><span class="p">(</span><span class="n">l</span><span class="p">),</span> <span class="mi">1</span><span class="p">);</span>

	<span class="n">lua_pushboolean</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
	<span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</p>
                          </details>
                        </details>
                        
                        <details>
                        <summary>AiSet</summary>
                        <p><br> <b>Description</b><br><br>  Set the number of units.<br><br>  @param l  Lua state<br><br>  @return   Number of return values<br><br> Example:<br><br> <div class="example"><code>local simple_ai_loop = {<br>		-- Sleep for 5 in game minutes<br>		function() return AiSleep(9000) end,<br>		-- Repeat the instructions forever.<br>		function() stratagus.gameData.AIState.loop_index[1 + AiPlayer()] = 0; return false; end,<br>	}<br><br>	local simple_ai = {<br>		function() return AiSleep(AiGetSleepCycles()) end,<br>		-- Tell to the A.I that it needs a Town Hall.<br>		function() return AiNeed("unit-town-hall") end,<br>		-- Wait until the town-hall has been built.<br>		function() return AiWait("unit-town-hall") end,<br>		-- Tell to the A.I that it needs 4 peasants<br>		function() return <strong>AiSet</strong>("unit-peasant",4) end,<br>		-- Execute the instructions in simple_ai_loop<br>		function() return AiLoop(simple_ai_loop, stratagus.gameData.AIState.loop_index) end,<br>	}<br><br>	function custom_ai() return AiLoop(simple_ai,stratagus.gameData.AIState.index) end<br>	DefineAi("example_ai","human","class_ai",custom_ai)</code></div></p>
                          <details>
                          <summary>/ai/script_ai.cpp:727 CclAiSet</summary>
                          <p><div class="highlight"><pre><span></span><span class="k">static</span> <span class="kt">int</span> <span class="nf">CclAiSet</span><span class="p">(</span><span class="n">lua_State</span> <span class="o">*</span><span class="n">l</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">LuaCheckArgs</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">2</span><span class="p">);</span>
	<span class="n">lua_pushvalue</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
	<span class="n">CUnitType</span> <span class="o">*</span><span class="n">type</span> <span class="o">=</span> <span class="n">CclGetUnitType</span><span class="p">(</span><span class="n">l</span><span class="p">);</span>
	<span class="n">lua_pop</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>

	<span class="n">AiRequestType</span> <span class="o">*</span><span class="n">autt</span> <span class="o">=</span> <span class="n">FindInUnitTypeRequests</span><span class="p">(</span><span class="n">type</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">autt</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">autt</span><span class="o">-&gt;</span><span class="n">Count</span> <span class="o">=</span> <span class="n">LuaToNumber</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">2</span><span class="p">);</span>
		<span class="c1">// FIXME: 0 should remove it.</span>
	<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
		<span class="n">InsertUnitTypeRequests</span><span class="p">(</span><span class="n">type</span><span class="p">,</span> <span class="n">LuaToNumber</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">2</span><span class="p">));</span>
	<span class="p">}</span>
	<span class="n">lua_pushboolean</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
	<span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</p>
                          </details>
                        </details>
                        
                        <details>
                        <summary>AiWait</summary>
                        <p><br> <b>Description</b><br><br>  Wait for a unit.<br><br>  @param l  Lua State.<br><br>  @return   Number of return values<br><br> Example:<br><br> <div class="example"><code>local simple_ai_loop = {<br>		-- Sleep for 5 in game minutes<br>		function() return AiSleep(9000) end,<br>		-- Repeat the instructions forever.<br>		function() stratagus.gameData.AIState.loop_index[1 + AiPlayer()] = 0; return false; end,<br>	}<br><br>	local simple_ai = {<br>		function() return AiSleep(AiGetSleepCycles()) end,<br>		-- Tell to the A.I that it needs a Town Hall.<br>		function() return AiNeed("unit-town-hall") end,<br>		-- Wait until the Town Hall has been built.<br>		function() return <strong>AiWait</strong>("unit-town-hall") end,<br>		-- Execute the instructions in simple_ai_loop<br>		function() return AiLoop(simple_ai_loop, stratagus.gameData.AIState.loop_index) end,<br>	}<br><br>	function custom_ai() return AiLoop(simple_ai,stratagus.gameData.AIState.index) end<br>	DefineAi("example_ai","human","class_ai",custom_ai)</code></div></p>
                          <details>
                          <summary>/ai/script_ai.cpp:807 CclAiWait</summary>
                          <p><div class="highlight"><pre><span></span><span class="k">static</span> <span class="kt">int</span> <span class="nf">CclAiWait</span><span class="p">(</span><span class="n">lua_State</span> <span class="o">*</span><span class="n">l</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">LuaCheckArgs</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
	<span class="k">const</span> <span class="n">CUnitType</span> <span class="o">*</span><span class="n">type</span> <span class="o">=</span> <span class="n">CclGetUnitType</span><span class="p">(</span><span class="n">l</span><span class="p">);</span>
	<span class="k">const</span> <span class="kt">int</span> <span class="o">*</span><span class="n">unit_types_count</span> <span class="o">=</span> <span class="n">AiPlayer</span><span class="o">-&gt;</span><span class="n">Player</span><span class="o">-&gt;</span><span class="n">UnitTypesAiActiveCount</span><span class="p">;</span>
	<span class="k">const</span> <span class="n">AiRequestType</span> <span class="o">*</span><span class="n">autt</span> <span class="o">=</span> <span class="n">FindInUnitTypeRequests</span><span class="p">(</span><span class="n">type</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">autt</span><span class="p">)</span> <span class="p">{</span>
		<span class="c1">// Look if we have this unit-type.</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">unit_types_count</span><span class="p">[</span><span class="n">type</span><span class="o">-&gt;</span><span class="n">Slot</span><span class="p">])</span> <span class="p">{</span>
			<span class="n">lua_pushboolean</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
			<span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
		<span class="p">}</span>

		<span class="c1">// Look if we have equivalent unit-types.</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">type</span><span class="o">-&gt;</span><span class="n">Slot</span> <span class="o">&lt;</span> <span class="p">(</span><span class="kt">int</span><span class="p">)</span><span class="n">AiHelpers</span><span class="p">.</span><span class="n">Equiv</span><span class="p">.</span><span class="n">size</span><span class="p">())</span> <span class="p">{</span>
			<span class="k">for</span> <span class="p">(</span><span class="kt">size_t</span> <span class="n">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="n">AiHelpers</span><span class="p">.</span><span class="n">Equiv</span><span class="p">[</span><span class="n">type</span><span class="o">-&gt;</span><span class="n">Slot</span><span class="p">].</span><span class="n">size</span><span class="p">();</span> <span class="o">++</span><span class="n">j</span><span class="p">)</span> <span class="p">{</span>
				<span class="k">if</span> <span class="p">(</span><span class="n">unit_types_count</span><span class="p">[</span><span class="n">AiHelpers</span><span class="p">.</span><span class="n">Equiv</span><span class="p">[</span><span class="n">type</span><span class="o">-&gt;</span><span class="n">Slot</span><span class="p">][</span><span class="n">j</span><span class="p">]</span><span class="o">-&gt;</span><span class="n">Slot</span><span class="p">])</span> <span class="p">{</span>
					<span class="n">lua_pushboolean</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
					<span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
				<span class="p">}</span>
			<span class="p">}</span>
		<span class="p">}</span>
		<span class="c1">// Look if we have an upgrade-to request.</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">FindInUpgradeToRequests</span><span class="p">(</span><span class="n">type</span><span class="p">))</span> <span class="p">{</span>
			<span class="n">lua_pushboolean</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
			<span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
		<span class="p">}</span>
		<span class="n">DebugPrint</span><span class="p">(</span><span class="s">&quot;Broken? waiting on %s which wasn&#39;t requested.</span><span class="se">\n</span><span class="s">&quot;</span> <span class="n">_C_</span> <span class="n">type</span><span class="o">-&gt;</span><span class="n">Ident</span><span class="p">.</span><span class="n">c_str</span><span class="p">());</span>
		<span class="n">lua_pushboolean</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
		<span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="c1">//</span>
	<span class="c1">// Add equivalent units</span>
	<span class="c1">//</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">n</span> <span class="o">=</span> <span class="n">unit_types_count</span><span class="p">[</span><span class="n">type</span><span class="o">-&gt;</span><span class="n">Slot</span><span class="p">];</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">type</span><span class="o">-&gt;</span><span class="n">Slot</span> <span class="o">&lt;</span> <span class="p">(</span><span class="kt">int</span><span class="p">)</span><span class="n">AiHelpers</span><span class="p">.</span><span class="n">Equiv</span><span class="p">.</span><span class="n">size</span><span class="p">())</span> <span class="p">{</span>
		<span class="k">for</span> <span class="p">(</span><span class="kt">size_t</span> <span class="n">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="n">AiHelpers</span><span class="p">.</span><span class="n">Equiv</span><span class="p">[</span><span class="n">type</span><span class="o">-&gt;</span><span class="n">Slot</span><span class="p">].</span><span class="n">size</span><span class="p">();</span> <span class="o">++</span><span class="n">j</span><span class="p">)</span> <span class="p">{</span>
			<span class="n">n</span> <span class="o">+=</span> <span class="n">unit_types_count</span><span class="p">[</span><span class="n">AiHelpers</span><span class="p">.</span><span class="n">Equiv</span><span class="p">[</span><span class="n">type</span><span class="o">-&gt;</span><span class="n">Slot</span><span class="p">][</span><span class="n">j</span><span class="p">]</span><span class="o">-&gt;</span><span class="n">Slot</span><span class="p">];</span>
		<span class="p">}</span>
	<span class="p">}</span>
	<span class="c1">// units available?</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">n</span> <span class="o">&gt;=</span> <span class="n">autt</span><span class="o">-&gt;</span><span class="n">Count</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">lua_pushboolean</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
		<span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="n">lua_pushboolean</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
	<span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</p>
                          </details>
                        </details>
                        
                        <details>
                        <summary>AiGetPendingBuilds</summary>
                        <p><br>  Get number of active build requests for a unit type.<br><br>  @param l  Lua State.<br><br>  @return   Number of return values</p>
                          <details>
                          <summary>/ai/script_ai.cpp:831 CclAiPendingBuildCount</summary>
                          <p><div class="highlight"><pre><span></span><span class="k">static</span> <span class="kt">int</span> <span class="nf">CclAiPendingBuildCount</span><span class="p">(</span><span class="n">lua_State</span> <span class="o">*</span><span class="n">l</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">LuaCheckArgs</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
	<span class="k">const</span> <span class="n">CUnitType</span> <span class="o">*</span><span class="n">type</span> <span class="o">=</span> <span class="n">CclGetUnitType</span><span class="p">(</span><span class="n">l</span><span class="p">);</span>

	<span class="c1">// The assumption of this function is that UnitTypeBuilt will be always be</span>
	<span class="c1">// fairly small so we iterate each time instead of doing any caching</span>
	<span class="k">for</span> <span class="p">(</span><span class="k">auto</span> <span class="nl">b</span> <span class="p">:</span> <span class="n">AiPlayer</span><span class="o">-&gt;</span><span class="n">UnitTypeBuilt</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">b</span><span class="p">.</span><span class="n">Type</span> <span class="o">==</span> <span class="n">type</span><span class="p">)</span> <span class="p">{</span>
			<span class="n">lua_pushinteger</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">b</span><span class="p">.</span><span class="n">Want</span><span class="p">);</span>
			<span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
		<span class="p">}</span>
	<span class="p">}</span>
	<span class="n">lua_pushinteger</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
	<span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</p>
                          </details>
                        </details>
                        
                        <details>
                        <summary>AiForce</summary>
                        <p><br> <b>Description</b><br><br>  Define a force, a groups of units.<br><br>  @param l  Lua state.<br><br> Example:<br><br> <div class="example"><code>local simple_ai_loop = {<br>		-- Sleep for 5 in game minutes<br>		function() return AiSleep(9000) end,<br>		-- Repeat the instructions forever.<br>		function() stratagus.gameData.AIState.loop_index[1 + AiPlayer()] = 0; return false; end,<br>	}<br><br>	local simple_ai = {<br>		function() return AiSleep(AiGetSleepCycles()) end,<br>		-- Tell to the A.I that it needs a Town Hall.<br>		function() return AiNeed("unit-town-hall") end,<br>		-- Wait until the Town Hall has been built.<br>		function() return AiWait("unit-town-hall") end,<br>		-- Tell to the A.I that it needs 4 peasants<br>		function() return AiSet("unit-peasant",4) end,<br>		-- Tell to the A.I that it needs a Barracks.<br>		function() return AiNeed("unit-human-barracks") end,<br>		-- Tell to the A.I that it needs a Lumbermill.<br>		function() return AiNeed("unit-elven-lumber-mill") end,<br>		-- Wait until the Barracks has been built.<br>		function() return AiWait("unit-human-barracks") end,<br>		-- Wait until the Lumbermill has been built.<br>		function() return AiWait("unit-elven-lumber-mill") end,<br>		-- Specify the force number 1 made only of 3 footmen<br>		function() return <strong>AiForce</strong>(1,{"unit-footman", 3}) end,<br>		-- Specify the force number 2 made only of 2 archers<br>		function() return <strong>AiForce</strong>(2,{"unit-archer", 2}) end,<br>		-- Specify the force number 3 made of 2 footmen and 1 archer<br>		function() return <strong>AiForce</strong>(3,{"unit-footman", 2, "unit-archer", 1}) end,<br>		-- Wait for all three forces<br>		function() return AiWaitForce(1) end,<br>		function() return AiWaitForce(2) end,<br>		function() return AiWaitForce(3) end,<br>		-- Execute the instructions in simple_ai_loop<br>		function() return AiLoop(simple_ai_loop, stratagus.gameData.AIState.loop_index) end,<br>	}<br><br>	function custom_ai() return AiLoop(simple_ai,stratagus.gameData.AIState.index) end<br>	DefineAi("example_ai","human","class_ai",custom_ai)</code></div></p>
                          <details>
                          <summary>/ai/script_ai.cpp:953 CclAiForce</summary>
                          <p><div class="highlight"><pre><span></span><span class="k">static</span> <span class="kt">int</span> <span class="nf">CclAiForce</span><span class="p">(</span><span class="n">lua_State</span> <span class="o">*</span><span class="n">l</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">bool</span> <span class="n">resetForce</span> <span class="o">=</span> <span class="nb">false</span><span class="p">;</span>
	<span class="k">const</span> <span class="kt">int</span> <span class="n">arg</span> <span class="o">=</span> <span class="n">lua_gettop</span><span class="p">(</span><span class="n">l</span><span class="p">);</span>
	<span class="n">Assert</span><span class="p">(</span><span class="mi">0</span> <span class="o">&lt;</span> <span class="n">arg</span> <span class="o">&amp;&amp;</span> <span class="n">arg</span> <span class="o">&lt;=</span> <span class="mi">3</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">lua_istable</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span> <span class="p">{</span>
		<span class="n">LuaError</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="s">&quot;incorrect argument&quot;</span><span class="p">);</span>
	<span class="p">}</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">arg</span> <span class="o">==</span> <span class="mi">3</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">resetForce</span> <span class="o">=</span> <span class="n">LuaToBoolean</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">3</span><span class="p">);</span>
	<span class="p">}</span>
	<span class="kt">int</span> <span class="n">force</span> <span class="o">=</span> <span class="n">LuaToNumber</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">force</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="o">||</span> <span class="n">force</span> <span class="o">&gt;=</span> <span class="n">AI_MAX_FORCE_INTERNAL</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">LuaError</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="s">&quot;Force out of range: %d&quot;</span> <span class="n">_C_</span> <span class="n">force</span><span class="p">);</span>
	<span class="p">}</span>
	<span class="n">AiForce</span> <span class="o">&amp;</span><span class="n">aiforce</span> <span class="o">=</span> <span class="n">AiPlayer</span><span class="o">-&gt;</span><span class="n">Force</span><span class="p">[</span><span class="n">AiPlayer</span><span class="o">-&gt;</span><span class="n">Force</span><span class="p">.</span><span class="n">getScriptForce</span><span class="p">(</span><span class="n">force</span><span class="p">)];</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">resetForce</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">aiforce</span><span class="p">.</span><span class="n">Reset</span><span class="p">(</span><span class="nb">true</span><span class="p">);</span>
	<span class="p">}</span>
	<span class="n">AiForceRole</span> <span class="n">role</span> <span class="o">=</span> <span class="n">aiforce</span><span class="p">.</span><span class="n">Role</span><span class="p">;</span>
	<span class="n">aiforce</span><span class="p">.</span><span class="n">State</span> <span class="o">=</span> <span class="n">AiForceAttackingState_Waiting</span><span class="p">;</span>
	<span class="n">aiforce</span><span class="p">.</span><span class="n">Role</span> <span class="o">=</span> <span class="n">role</span><span class="p">;</span>

	<span class="kt">int</span> <span class="n">args</span> <span class="o">=</span> <span class="n">lua_rawlen</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">2</span><span class="p">);</span>
	<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="n">args</span><span class="p">;</span> <span class="o">++</span><span class="n">j</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">lua_rawgeti</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>
		<span class="n">CUnitType</span> <span class="o">*</span><span class="n">type</span> <span class="o">=</span> <span class="n">CclGetUnitType</span><span class="p">(</span><span class="n">l</span><span class="p">);</span>
		<span class="n">lua_pop</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
		<span class="o">++</span><span class="n">j</span><span class="p">;</span>
		<span class="kt">int</span> <span class="n">count</span> <span class="o">=</span> <span class="n">LuaToNumber</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>

		<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">type</span><span class="p">)</span> <span class="p">{</span> <span class="c1">// bulletproof</span>
			<span class="k">continue</span><span class="p">;</span>
		<span class="p">}</span>

		<span class="c1">// Use the equivalent unittype.</span>
		<span class="n">type</span> <span class="o">=</span> <span class="n">UnitTypes</span><span class="p">[</span><span class="n">UnitTypeEquivs</span><span class="p">[</span><span class="n">type</span><span class="o">-&gt;</span><span class="n">Slot</span><span class="p">]];</span>

		<span class="k">if</span> <span class="p">(</span><span class="n">resetForce</span><span class="p">)</span> <span class="p">{</span>
			<span class="c1">// Append it.</span>
			<span class="n">AiUnitType</span> <span class="n">newaiut</span><span class="p">;</span>
			<span class="n">newaiut</span><span class="p">.</span><span class="n">Want</span> <span class="o">=</span> <span class="n">count</span><span class="p">;</span>
			<span class="n">newaiut</span><span class="p">.</span><span class="n">Type</span> <span class="o">=</span> <span class="n">type</span><span class="p">;</span>
			<span class="n">aiforce</span><span class="p">.</span><span class="n">UnitTypes</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">newaiut</span><span class="p">);</span>
		<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
			<span class="c1">// Look if already in force.</span>
			<span class="kt">size_t</span> <span class="n">i</span><span class="p">;</span>
			<span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">aiforce</span><span class="p">.</span><span class="n">UnitTypes</span><span class="p">.</span><span class="n">size</span><span class="p">();</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span> <span class="p">{</span>
				<span class="n">AiUnitType</span> <span class="o">*</span><span class="n">aiut</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">aiforce</span><span class="p">.</span><span class="n">UnitTypes</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
				<span class="k">if</span> <span class="p">(</span><span class="n">aiut</span><span class="o">-&gt;</span><span class="n">Type</span><span class="o">-&gt;</span><span class="n">Slot</span> <span class="o">==</span> <span class="n">type</span><span class="o">-&gt;</span><span class="n">Slot</span><span class="p">)</span> <span class="p">{</span> <span class="c1">// found</span>
					<span class="k">if</span> <span class="p">(</span><span class="n">count</span><span class="p">)</span> <span class="p">{</span>
						<span class="n">aiut</span><span class="o">-&gt;</span><span class="n">Want</span> <span class="o">=</span> <span class="n">count</span><span class="p">;</span>
					<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
						<span class="n">aiforce</span><span class="p">.</span><span class="n">UnitTypes</span><span class="p">.</span><span class="n">erase</span><span class="p">(</span><span class="n">aiforce</span><span class="p">.</span><span class="n">UnitTypes</span><span class="p">.</span><span class="n">begin</span><span class="p">()</span> <span class="o">+</span> <span class="n">i</span><span class="p">);</span>
					<span class="p">}</span>
					<span class="k">break</span><span class="p">;</span>
				<span class="p">}</span>
			<span class="p">}</span>
			<span class="c1">// New type append it.</span>
			<span class="k">if</span> <span class="p">(</span><span class="n">i</span> <span class="o">==</span> <span class="n">aiforce</span><span class="p">.</span><span class="n">UnitTypes</span><span class="p">.</span><span class="n">size</span><span class="p">())</span> <span class="p">{</span>
				<span class="n">AiUnitType</span> <span class="n">newaiut</span><span class="p">;</span>
				<span class="n">newaiut</span><span class="p">.</span><span class="n">Want</span> <span class="o">=</span> <span class="n">count</span><span class="p">;</span>
				<span class="n">newaiut</span><span class="p">.</span><span class="n">Type</span> <span class="o">=</span> <span class="n">type</span><span class="p">;</span>
				<span class="n">aiforce</span><span class="p">.</span><span class="n">UnitTypes</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">newaiut</span><span class="p">);</span>
			<span class="p">}</span>
		<span class="p">}</span>

	<span class="p">}</span>
	<span class="n">AiAssignFreeUnitsToForce</span><span class="p">(</span><span class="n">force</span><span class="p">);</span>
	<span class="n">lua_pushboolean</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
	<span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</p>
                          </details>
                        </details>
                        
                        <details>
                        <summary>AiReleaseForce</summary>
                        <p><br>  Release force.<br><br>  @param l  Lua state.</p>
                          <details>
                          <summary>/ai/script_ai.cpp:1038 CclAiReleaseForce</summary>
                          <p><div class="highlight"><pre><span></span><span class="k">static</span> <span class="kt">int</span> <span class="nf">CclAiReleaseForce</span><span class="p">(</span><span class="n">lua_State</span> <span class="o">*</span><span class="n">l</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">LuaCheckArgs</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
	<span class="kt">int</span> <span class="n">force</span> <span class="o">=</span> <span class="n">LuaToNumber</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">force</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="o">||</span> <span class="n">force</span> <span class="o">&gt;=</span> <span class="n">AI_MAX_FORCE_INTERNAL</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">LuaError</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="s">&quot;Force out of range: %d&quot;</span> <span class="n">_C_</span> <span class="n">force</span><span class="p">);</span>
	<span class="p">}</span>
	<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="n">AI_MAX_FORCE_INTERNAL</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">AI_MAX_FORCES</span><span class="p">;</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">AiPlayer</span><span class="o">-&gt;</span><span class="n">Force</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">FormerForce</span> <span class="o">!=</span> <span class="mi">-1</span> <span class="o">&amp;&amp;</span> <span class="n">AiPlayer</span><span class="o">-&gt;</span><span class="n">Force</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">FormerForce</span> <span class="o">==</span> <span class="n">force</span><span class="p">)</span> <span class="p">{</span>
			<span class="k">while</span> <span class="p">(</span><span class="n">AiPlayer</span><span class="o">-&gt;</span><span class="n">Force</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">Size</span><span class="p">())</span> <span class="p">{</span>
				<span class="n">CUnit</span> <span class="o">&amp;</span><span class="n">aiunit</span> <span class="o">=</span> <span class="o">*</span><span class="n">AiPlayer</span><span class="o">-&gt;</span><span class="n">Force</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">Units</span><span class="p">[</span><span class="n">AiPlayer</span><span class="o">-&gt;</span><span class="n">Force</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">Size</span><span class="p">()</span> <span class="o">-</span> <span class="mi">1</span><span class="p">];</span>
				<span class="n">aiunit</span><span class="p">.</span><span class="n">GroupId</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
				<span class="n">AiPlayer</span><span class="o">-&gt;</span><span class="n">Force</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">Units</span><span class="p">.</span><span class="n">Remove</span><span class="p">(</span><span class="o">&amp;</span><span class="n">aiunit</span><span class="p">);</span>
			<span class="p">}</span>
			<span class="n">AiPlayer</span><span class="o">-&gt;</span><span class="n">Force</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">Reset</span><span class="p">(</span><span class="nb">false</span><span class="p">);</span>
		<span class="p">}</span>
	<span class="p">}</span>

	<span class="n">lua_pushboolean</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
	<span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</p>
                          </details>
                        </details>
                        
                        <details>
                        <summary>AiForceRole</summary>
                        <p><br> <b>Description</b><br><br>  Define the role of a force.<br><br>  @param l  Lua state.<br><br> Example:<br><br> <div class="example"><code>local simple_ai_loop = {<br>		function() return AiSleep(9000) end,<br>		function() stratagus.gameData.AIState.loop_index[1 + AiPlayer()] = 0; return false; end,<br>	}<br><br>	local simple_ai = {<br>		function() return AiSleep(AiGetSleepCycles()) end,<br>		function() return AiNeed("unit-town-hall") end,<br>		function() return AiWait("unit-town-hall") end,<br>		function() return AiSet("unit-peasant",4) end,<br>		function() return AiNeed("unit-human-barracks") end,<br>		function() return AiNeed("unit-elven-lumber-mill") end,<br>		-- Force 1 has the role of attacker<br>		function() return <strong>AiForceRole</strong>(1,"<u>attack</u>") end,<br>		-- Force 2 has the role of defender<br>		function() return <strong>AiForceRole</strong>(2,"<u>defend</u>") end,<br>		function() return AiForce(1,{"unit-footman", 3}) end,<br>		function() return AiForce(2,{"unit-archer", 2}) end,<br>		function() return AiWaitForce(1) end,<br>		function() return AiWaitForce(2) end,<br>		-- Execute the instructions in simple_ai_loop<br>		function() return AiLoop(simple_ai_loop, stratagus.gameData.AIState.loop_index) end,<br>	}<br><br>	function custom_ai() return AiLoop(simple_ai,stratagus.gameData.AIState.index) end<br>	DefineAi("example_ai","human","class_ai",custom_ai)</code></div></p>
                          <details>
                          <summary>/ai/script_ai.cpp:1011 CclAiForceRole</summary>
                          <p><div class="highlight"><pre><span></span><span class="k">static</span> <span class="kt">int</span> <span class="nf">CclAiForceRole</span><span class="p">(</span><span class="n">lua_State</span> <span class="o">*</span><span class="n">l</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">LuaCheckArgs</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">2</span><span class="p">);</span>
	<span class="kt">int</span> <span class="n">force</span> <span class="o">=</span> <span class="n">LuaToNumber</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">force</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="o">||</span> <span class="n">force</span> <span class="o">&gt;=</span> <span class="n">AI_MAX_FORCE_INTERNAL</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">LuaError</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="s">&quot;Force %i out of range&quot;</span> <span class="n">_C_</span> <span class="n">force</span><span class="p">);</span>
	<span class="p">}</span>

	<span class="n">AiForce</span> <span class="o">&amp;</span><span class="n">aiforce</span> <span class="o">=</span> <span class="n">AiPlayer</span><span class="o">-&gt;</span><span class="n">Force</span><span class="p">[</span><span class="n">AiPlayer</span><span class="o">-&gt;</span><span class="n">Force</span><span class="p">.</span><span class="n">getScriptForce</span><span class="p">(</span><span class="n">force</span><span class="p">)];</span>

	<span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">flag</span> <span class="o">=</span> <span class="n">LuaToString</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">2</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">flag</span><span class="p">,</span> <span class="s">&quot;attack&quot;</span><span class="p">))</span> <span class="p">{</span>
		<span class="n">aiforce</span><span class="p">.</span><span class="n">Role</span> <span class="o">=</span> <span class="n">AiForceRoleAttack</span><span class="p">;</span>
	<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">flag</span><span class="p">,</span> <span class="s">&quot;defend&quot;</span><span class="p">))</span> <span class="p">{</span>
		<span class="n">aiforce</span><span class="p">.</span><span class="n">Role</span> <span class="o">=</span> <span class="n">AiForceRoleDefend</span><span class="p">;</span>
	<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
		<span class="n">LuaError</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="s">&quot;Unknown force role &#39;%s&#39;&quot;</span> <span class="n">_C_</span> <span class="n">flag</span><span class="p">);</span>
	<span class="p">}</span>
	<span class="n">lua_pushboolean</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
	<span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</p>
                          </details>
                        </details>
                        
                        <details>
                        <summary>AiCheckForce</summary>
                        <p><br>  Check if a force ready.<br><br>  @param l  Lua state.</p>
                          <details>
                          <summary>/ai/script_ai.cpp:1058 CclAiCheckForce</summary>
                          <p><div class="highlight"><pre><span></span><span class="k">static</span> <span class="kt">int</span> <span class="nf">CclAiCheckForce</span><span class="p">(</span><span class="n">lua_State</span> <span class="o">*</span><span class="n">l</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">LuaCheckArgs</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
	<span class="kt">int</span> <span class="n">force</span> <span class="o">=</span> <span class="n">LuaToNumber</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">force</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="o">||</span> <span class="n">force</span> <span class="o">&gt;=</span> <span class="n">AI_MAX_FORCE_INTERNAL</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">lua_pushfstring</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="s">&quot;Force out of range: %d&quot;</span><span class="p">,</span> <span class="n">force</span><span class="p">);</span>
	<span class="p">}</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">AiPlayer</span><span class="o">-&gt;</span><span class="n">Force</span><span class="p">[</span><span class="n">AiPlayer</span><span class="o">-&gt;</span><span class="n">Force</span><span class="p">.</span><span class="n">getScriptForce</span><span class="p">(</span><span class="n">force</span><span class="p">)].</span><span class="n">Completed</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">lua_pushboolean</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
		<span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="n">lua_pushboolean</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
	<span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</p>
                          </details>
                        </details>
                        
                        <details>
                        <summary>AiWaitForce</summary>
                        <p><br> <b>Description</b><br><br>  Wait for a force ready.<br><br>  @param l  Lua state.<br><br> Example:<br><br> <div class="example"><code>local simple_ai_loop = {<br>		function() return AiSleep(9000) end,<br>		function() stratagus.gameData.AIState.loop_index[1 + AiPlayer()] = 0; return false; end,<br>	}<br><br>	local simple_ai = {<br>		function() return AiSleep(AiGetSleepCycles()) end,<br>		function() return AiNeed("unit-town-hall") end,<br>		function() return AiWait("unit-town-hall") end,<br>		function() return AiSet("unit-peasant",4) end,<br>		function() return AiNeed("unit-human-barracks") end,<br>		function() return AiWait("unit-human-barracks") end,<br>		function() return AiForce(1,{"unit-footman", 3}) end,<br>		-- Wait until force 1 is completed<br>		function() return <strong>AiWaitForce</strong>(1) end,<br>		function() return AiLoop(simple_ai_loop, stratagus.gameData.AIState.loop_index) end,<br>	}<br><br>	function custom_ai() return AiLoop(simple_ai,stratagus.gameData.AIState.index) end<br>	DefineAi("example_ai","human","class_ai",custom_ai)</code></div></p>
                          <details>
                          <summary>/ai/script_ai.cpp:1108 CclAiWaitForce</summary>
                          <p><div class="highlight"><pre><span></span><span class="k">static</span> <span class="kt">int</span> <span class="nf">CclAiWaitForce</span><span class="p">(</span><span class="n">lua_State</span> <span class="o">*</span><span class="n">l</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">LuaCheckArgs</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
	<span class="kt">int</span> <span class="n">force</span> <span class="o">=</span> <span class="n">LuaToNumber</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">force</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="o">||</span> <span class="n">force</span> <span class="o">&gt;=</span> <span class="n">AI_MAX_FORCE_INTERNAL</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">lua_pushfstring</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="s">&quot;Force out of range: %d&quot;</span><span class="p">,</span> <span class="n">force</span><span class="p">);</span>
	<span class="p">}</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">AiPlayer</span><span class="o">-&gt;</span><span class="n">Force</span><span class="p">[</span><span class="n">AiPlayer</span><span class="o">-&gt;</span><span class="n">Force</span><span class="p">.</span><span class="n">getScriptForce</span><span class="p">(</span><span class="n">force</span><span class="p">)].</span><span class="n">Completed</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">lua_pushboolean</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
		<span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
	<span class="p">}</span>
<span class="cp">#if 0</span><span class="c"></span>
<span class="c">	// Debuging</span>
<span class="c">	AiRemoveDeadUnitInForces();</span>
<span class="c">	Assert(!AiPlayer-&gt;Force.getScriptForce(f).Completed);</span>
<span class="cp">#endif</span>
	<span class="n">lua_pushboolean</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
	<span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</p>
                          </details>
                        </details>
                        
                        <details>
                        <summary>AiAttackWithForce</summary>
                        <p><br> <b>Description</b><br><br>  Attack with one single force.<br><br>  @param l  Lua state.<br><br> Example:<br><br> <div class="example"><code>local simple_ai_loop = {<br>		function() return AiSleep(9000) end,<br>		function() stratagus.gameData.AIState.loop_index[1 + AiPlayer()] = 0; return false; end,<br>	}<br><br>	local simple_ai = {<br>		function() return AiSleep(AiGetSleepCycles()) end,<br>		function() return AiNeed("unit-town-hall") end,<br>		function() return AiWait("unit-town-hall") end,<br>		function() return AiSet("unit-peasant",4) end,<br>		function() return AiNeed("unit-human-barracks") end,<br>		function() return AiWait("unit-human-barracks") end,<br>		function() return AiForce(1,{"unit-footman", 3}) end,<br>		function() return AiWaitForce(1) end,<br>		-- Attack with Force 1<br>		function() return <strong>AiAttackWithForce</strong>(<u>1</u>) end,<br><br>		function() return AiForce(2,{"unit-footman",5}) end,<br>		function() return AiWaitForce(2) end,<br>		-- Attack with Force 2<br>		function() return <strong>AiAttackWithForce</strong>(<u>2</u>) end,<br>		function() return AiLoop(simple_ai_loop, stratagus.gameData.AIState.loop_index) end,<br>	}<br><br>	function custom_ai() return AiLoop(simple_ai,stratagus.gameData.AIState.index) end<br>	DefineAi("example_ai","human","class_ai",custom_ai)</code></div></p>
                          <details>
                          <summary>/ai/script_ai.cpp:1156 CclAiAttackWithForce</summary>
                          <p><div class="highlight"><pre><span></span><span class="k">static</span> <span class="kt">int</span> <span class="nf">CclAiAttackWithForce</span><span class="p">(</span><span class="n">lua_State</span> <span class="o">*</span><span class="n">l</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">LuaCheckArgs</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
	<span class="kt">int</span> <span class="n">force</span> <span class="o">=</span> <span class="n">LuaToNumber</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">force</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="o">||</span> <span class="n">force</span> <span class="o">&gt;=</span> <span class="n">AI_MAX_FORCE_INTERNAL</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">LuaError</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="s">&quot;Force out of range: %d&quot;</span> <span class="n">_C_</span> <span class="n">force</span><span class="p">);</span>
	<span class="p">}</span>
	<span class="n">AiAttackWithForce</span><span class="p">(</span><span class="n">force</span><span class="p">);</span>
	<span class="n">lua_pushboolean</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
	<span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</p>
                          </details>
                        </details>
                        
                        <details>
                        <summary>AiSleep</summary>
                        <p><br> <b>Description</b><br><br>  Sleep for n cycles.<br><br>  @param l  Lua state.<br><br> Example:<br><br> <div class="example"><code>local simple_ai_loop = {<br>			-- Sleep for 5 in game minutes<br>			function() return <strong>AiSleep</strong>(9000) end,<br>			function() stratagus.gameData.AIState.loop_index[1 + AiPlayer()] = 0; return false; end,<br>		}<br><br>		local simple_ai = {<br>			-- Get the number of cycles to sleep<br>			function() return <strong>AiSleep</strong>(AiGetSleepCycles()) end,<br>			function() return AiNeed("unit-town-hall") end,<br>			function() return AiWait("unit-town-hall") end,<br>			function() return AiSet("unit-peasant",4) end,<br>			-- Sleep for 1 in game minute<br>			function() return <strong>AiSleep</strong>(1800) end,<br>			function() return AiNeed("unit-human-blacksmith") end,<br>			function() return AiWait("unit-human-blacksmith") end,<br>			function() return AiLoop(simple_ai_loop, stratagus.gameData.AIState.loop_index) end,<br>		}<br><br>		function custom_ai() return AiLoop(simple_ai,stratagus.gameData.AIState.index) end<br>		DefineAi("example_ai","human","class_ai",custom_ai)</code></div></p>
                          <details>
                          <summary>/ai/script_ai.cpp:1319 CclAiSleep</summary>
                          <p><div class="highlight"><pre><span></span><span class="k">static</span> <span class="kt">int</span> <span class="nf">CclAiSleep</span><span class="p">(</span><span class="n">lua_State</span> <span class="o">*</span><span class="n">l</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">LuaCheckArgs</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
	<span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="n">LuaToNumber</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">AiPlayer</span><span class="o">-&gt;</span><span class="n">SleepCycles</span> <span class="o">||</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">AiPlayer</span><span class="o">-&gt;</span><span class="n">SleepCycles</span> <span class="o">&lt;</span> <span class="n">GameCycle</span><span class="p">)</span> <span class="p">{</span>
			<span class="n">AiPlayer</span><span class="o">-&gt;</span><span class="n">SleepCycles</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
			<span class="n">lua_pushboolean</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
			<span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
		<span class="p">}</span>
	<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
		<span class="n">AiPlayer</span><span class="o">-&gt;</span><span class="n">SleepCycles</span> <span class="o">=</span> <span class="n">GameCycle</span> <span class="o">+</span> <span class="n">i</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="n">lua_pushboolean</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
	<span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</p>
                          </details>
                        </details>
                        
                        <details>
                        <summary>AiResearch</summary>
                        <p><br> <b>Description</b><br><br>  Research an upgrade.<br><br>  @param l  Lua state.<br><br> Example:<br><br> <div class="example"><code>local simple_ai_loop = {<br>		function() return AiSleep(9000) end,<br>		function() stratagus.gameData.AIState.loop_index[1 + AiPlayer()] = 0; return false; end,<br>	}<br><br>	local simple_ai = {<br>		-- Get the number of cycles to sleep<br>		function() return AiSleep(AiGetSleepCycles()) end,<br>		function() return AiNeed("unit-town-hall") end,<br>		function() return AiWait("unit-town-hall") end,<br>		function() return AiSet("unit-peasant",4) end,<br>		function() return AiNeed("unit-human-barracks") end,<br>		function() return AiWait("unit-human-barracks") end,<br>		function() return AiNeed("unit-elven-lumber-mill") end,<br>		function() return AiWait("unit-elven-lumber-mill") end,<br>		function() return AiForce(1,{"unit-footman", 1, "unit-archer", 2}) end,<br>		function() return AiWaitForce(1) end,<br>		-- Upgrade the archers arrow.<br>		function() return <strong>AiResearch</strong>("upgrade-arrow1") end,<br>		function() return AiLoop(simple_ai_loop, stratagus.gameData.AIState.loop_index) end,<br>	}<br><br>	function custom_ai() return AiLoop(simple_ai,stratagus.gameData.AIState.index) end<br>	DefineAi("example_ai","human","class_ai",custom_ai)</code></div></p>
                          <details>
                          <summary>/ai/script_ai.cpp:1370 CclAiResearch</summary>
                          <p><div class="highlight"><pre><span></span><span class="k">static</span> <span class="kt">int</span> <span class="nf">CclAiResearch</span><span class="p">(</span><span class="n">lua_State</span> <span class="o">*</span><span class="n">l</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">LuaCheckArgs</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
	<span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">str</span> <span class="o">=</span> <span class="n">LuaToString</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
	<span class="n">CUpgrade</span> <span class="o">*</span><span class="n">upgrade</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">str</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">upgrade</span> <span class="o">=</span> <span class="n">CUpgrade</span><span class="o">::</span><span class="n">Get</span><span class="p">(</span><span class="n">str</span><span class="p">);</span>
	<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
		<span class="n">LuaError</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="s">&quot;Upgrade needed&quot;</span><span class="p">);</span>
		<span class="n">upgrade</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="n">InsertResearchRequests</span><span class="p">(</span><span class="n">upgrade</span><span class="p">);</span>
	<span class="n">lua_pushboolean</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
	<span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</p>
                          </details>
                        </details>
                        
                        <details>
                        <summary>AiUpgradeTo</summary>
                        <p><br> <b>Description</b><br><br>  Upgrade an unit to an new unit-type.<br><br>  @param l  Lua state.<br><br> Example:<br><br> <div class="example"><code>local simple_ai_loop = {<br>		function() return AiSleep(9000) end,<br>		function() stratagus.gameData.AIState.loop_index[1 + AiPlayer()] = 0; return false; end,<br>	}<br><br>	local simple_ai = {<br>		function() return AiSleep(AiGetSleepCycles()) end,<br>		function() return AiNeed("unit-town-hall") end,<br>		function() return AiWait("unit-town-hall") end,<br>		function() return AiSet("unit-peasant",4) end,<br>		function() return AiNeed("unit-human-barracks") end,<br>		function() return AiWait("unit-human-barracks") end,<br>		function() return AiNeed("unit-elven-lumber-mill") end,<br>		function() return AiWait("unit-elven-lumber-mill") end,<br>		function() return AiSleep(1800) end,<br>		-- Upgrade the Town Hall to Keep<br>		function() return <strong>AiUpgradeTo</strong>("unit-keep") end,<br>		function() return AiWait("unit-keep") end,<br>		function() return AiLoop(simple_ai_loop, stratagus.gameData.AIState.loop_index) end,<br>	}<br><br>	function custom_ai() return AiLoop(simple_ai,stratagus.gameData.AIState.index) end<br>	DefineAi("example_ai","human","class_ai",custom_ai)</code></div></p>
                          <details>
                          <summary>/ai/script_ai.cpp:1413 CclAiUpgradeTo</summary>
                          <p><div class="highlight"><pre><span></span><span class="k">static</span> <span class="kt">int</span> <span class="nf">CclAiUpgradeTo</span><span class="p">(</span><span class="n">lua_State</span> <span class="o">*</span><span class="n">l</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">LuaCheckArgs</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
	<span class="n">CUnitType</span> <span class="o">*</span><span class="n">type</span> <span class="o">=</span> <span class="n">CclGetUnitType</span><span class="p">(</span><span class="n">l</span><span class="p">);</span>
	<span class="n">InsertUpgradeToRequests</span><span class="p">(</span><span class="n">type</span><span class="p">);</span>

	<span class="n">lua_pushboolean</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
	<span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</p>
                          </details>
                        </details>
                        
                        <details>
                        <summary>AiPlayer</summary>
                        <p><br>  Return the player of the running AI.<br><br>  @param l  Lua state.<br><br>  @return  Player number of the AI.</p>
                          <details>
                          <summary>/ai/script_ai.cpp:1427 CclAiPlayer</summary>
                          <p><div class="highlight"><pre><span></span><span class="k">static</span> <span class="kt">int</span> <span class="nf">CclAiPlayer</span><span class="p">(</span><span class="n">lua_State</span> <span class="o">*</span><span class="n">l</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">LuaCheckArgs</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
	<span class="n">lua_pushnumber</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">AiPlayer</span><span class="o">-&gt;</span><span class="n">Player</span><span class="o">-&gt;</span><span class="n">Index</span><span class="p">);</span>
	<span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</p>
                          </details>
                        </details>
                        
                        <details>
                        <summary>AiSetReserve</summary>
                        <p><br>  Set AI player resource reserve.<br><br>  @param l  Lua state.<br><br>  @return     Old resource vector</p>
                          <details>
                          <summary>/ai/script_ai.cpp:1451 CclAiSetReserve</summary>
                          <p><div class="highlight"><pre><span></span><span class="k">static</span> <span class="kt">int</span> <span class="nf">CclAiSetReserve</span><span class="p">(</span><span class="n">lua_State</span> <span class="o">*</span><span class="n">l</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">LuaCheckArgs</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">lua_istable</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span> <span class="p">{</span>
		<span class="n">LuaError</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="s">&quot;incorrect argument&quot;</span><span class="p">);</span>
	<span class="p">}</span>
	<span class="n">lua_newtable</span><span class="p">(</span><span class="n">l</span><span class="p">);</span>
	<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">MaxCosts</span><span class="p">;</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">lua_pushnumber</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">AiPlayer</span><span class="o">-&gt;</span><span class="n">Reserve</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span>
		<span class="n">lua_rawseti</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">-2</span><span class="p">,</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>
	<span class="p">}</span>
	<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">MaxCosts</span><span class="p">;</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">AiPlayer</span><span class="o">-&gt;</span><span class="n">Reserve</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">LuaToNumber</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>
	<span class="p">}</span>
	<span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</p>
                          </details>
                        </details>
                        
                        <details>
                        <summary>AiSetCollect</summary>
                        <p><br> <b>Description</b><br><br>  Set AI player resource collect percent.<br><br>  @param l  Lua state.<br><br> Example:<br><br> <div class="example"><code>local simple_ai_loop = {<br>		function() return AiSleep(9000) end,<br>		function() stratagus.gameData.AIState.loop_index[1 + AiPlayer()] = 0; return false; end,<br>	}<br><br>	local simple_ai = {<br>		function() return AiSleep(AiGetSleepCycles()) end,<br>		function() return AiNeed("unit-town-hall") end,<br>		function() return AiWait("unit-town-hall") end,<br>		-- The peasants will focus only on gathering gold<br>		function() return <strong>AiSetCollect</strong>({0,100,0,0,0,0,0}) end,<br>		function() return AiSet("unit-peasant",4) end,<br>		function() return AiWait("unit-peasant") end,<br>		function() return AiSleep(1800) end,<br>		-- The peasants will now focus 50% on gathering gold and 50% on gathering lumber<br>		function() return <strong>AiSetCollect</strong>({0,50,50,0,0,0,0}) end,<br>		function() return AiLoop(simple_ai_loop, stratagus.gameData.AIState.loop_index) end,<br>	}<br><br>	function custom_ai() return AiLoop(simple_ai,stratagus.gameData.AIState.index) end<br>	DefineAi("example_ai","human","class_ai",custom_ai)</code></div></p>
                          <details>
                          <summary>/ai/script_ai.cpp:1494 CclAiSetCollect</summary>
                          <p><div class="highlight"><pre><span></span><span class="k">static</span> <span class="kt">int</span> <span class="nf">CclAiSetCollect</span><span class="p">(</span><span class="n">lua_State</span> <span class="o">*</span><span class="n">l</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">LuaCheckArgs</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">lua_istable</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span> <span class="p">{</span>
		<span class="n">LuaError</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="s">&quot;incorrect argument&quot;</span><span class="p">);</span>
	<span class="p">}</span>
	<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">MaxCosts</span><span class="p">;</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">AiPlayer</span><span class="o">-&gt;</span><span class="n">Collect</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">LuaToNumber</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>
	<span class="p">}</span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</p>
                          </details>
                        </details>
                        
                        <details>
                        <summary>AiSetBuildDepots</summary>
                        <p><br>  Set AI player build.<br><br>  @param l  Lua state.</p>
                          <details>
                          <summary>/ai/script_ai.cpp:1509 CclAiSetBuildDepots</summary>
                          <p><div class="highlight"><pre><span></span><span class="k">static</span> <span class="kt">int</span> <span class="nf">CclAiSetBuildDepots</span><span class="p">(</span><span class="n">lua_State</span> <span class="o">*</span><span class="n">l</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">LuaCheckArgs</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">lua_isboolean</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span> <span class="p">{</span>
		<span class="n">LuaError</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="s">&quot;incorrect argument&quot;</span><span class="p">);</span>
	<span class="p">}</span>
	<span class="n">AiPlayer</span><span class="o">-&gt;</span><span class="n">BuildDepots</span> <span class="o">=</span> <span class="n">LuaToBoolean</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</p>
                          </details>
                        </details>
                        
                        <details>
                        <summary>AiDump</summary>
                        <p><br> <b>Description</b><br><br>  Dump some AI debug information.<br><br>  @param l  Lua state.<br><br> Example:<br><br> <div class="example"><code>local simple_ai_loop = {<br>		function() return AiSleep(3600) end,<br>		-- Get the information from all the A.I players<br>		function() return <strong>AiDump</strong>() end,<br>		function() stratagus.gameData.AIState.loop_index[1 + AiPlayer()] = 0; return false; end,<br>	}<br><br>	local simple_ai = {<br>		function() return AiSleep(AiGetSleepCycles()) end,<br>		function() return AiNeed("unit-town-hall") end,<br>		function() return AiWait("unit-town-hall") end,<br>		function() return AiSet("unit-peasant",4) end,<br>		function() return AiWait("unit-peasant") end,<br>		function() return AiLoop(simple_ai_loop, stratagus.gameData.AIState.loop_index) end,<br>	}<br><br>	function custom_ai() return AiLoop(simple_ai,stratagus.gameData.AIState.index) end<br>	DefineAi("example_ai","human","class_ai",custom_ai)</code></div></p>
                          <details>
                          <summary>/ai/script_ai.cpp:1605 CclAiDump</summary>
                          <p><div class="highlight"><pre><span></span><span class="k">static</span> <span class="kt">int</span> <span class="nf">CclAiDump</span><span class="p">(</span><span class="n">lua_State</span> <span class="o">*</span><span class="n">l</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">LuaCheckArgs</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
	<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">p</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">p</span> <span class="o">&lt;</span> <span class="n">PlayerMax</span> <span class="o">-</span> <span class="mi">1</span><span class="p">;</span> <span class="o">++</span><span class="n">p</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">CPlayer</span> <span class="o">&amp;</span><span class="n">aip</span> <span class="o">=</span> <span class="n">Players</span><span class="p">[</span><span class="n">p</span><span class="p">];</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">aip</span><span class="p">.</span><span class="n">AiEnabled</span><span class="p">)</span> <span class="p">{</span>
			<span class="c1">//</span>
			<span class="c1">// Script</span>
			<span class="c1">//</span>

			<span class="n">printf</span><span class="p">(</span><span class="s">&quot;------</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
			<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">MaxCosts</span><span class="p">;</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span> <span class="p">{</span>
				<span class="n">printf</span><span class="p">(</span><span class="s">&quot;%s(%4d, %4d/%4d) &quot;</span><span class="p">,</span> <span class="n">DefaultResourceNames</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">c_str</span><span class="p">(),</span>
					   <span class="n">aip</span><span class="p">.</span><span class="n">Resources</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">aip</span><span class="p">.</span><span class="n">StoredResources</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">aip</span><span class="p">.</span><span class="n">MaxResources</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span>
			<span class="p">}</span>
			<span class="n">printf</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
			<span class="n">printf</span><span class="p">(</span><span class="s">&quot;Player %d:&quot;</span><span class="p">,</span> <span class="n">aip</span><span class="p">.</span><span class="n">Index</span><span class="p">);</span>
<span class="cp">#if 0</span><span class="c"></span>
<span class="c">			gh_display(gh_car(AiPlayer-&gt;Script));</span>
<span class="cp">#endif</span>
			<span class="c1">//</span>
			<span class="c1">// Requests</span>
			<span class="c1">//</span>
			<span class="kt">size_t</span> <span class="n">n</span> <span class="o">=</span> <span class="n">aip</span><span class="p">.</span><span class="n">Ai</span><span class="o">-&gt;</span><span class="n">UnitTypeRequests</span><span class="p">.</span><span class="n">size</span><span class="p">();</span>
			<span class="n">printf</span><span class="p">(</span><span class="s">&quot;UnitTypeRequests(%u):</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="k">static_cast</span><span class="o">&lt;</span><span class="kt">unsigned</span> <span class="kt">int</span><span class="o">&gt;</span><span class="p">(</span><span class="n">n</span><span class="p">));</span>
			<span class="k">for</span> <span class="p">(</span><span class="kt">size_t</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">n</span><span class="p">;</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span> <span class="p">{</span>
				<span class="n">printf</span><span class="p">(</span><span class="s">&quot;%s &quot;</span><span class="p">,</span> <span class="n">aip</span><span class="p">.</span><span class="n">Ai</span><span class="o">-&gt;</span><span class="n">UnitTypeRequests</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">Type</span><span class="o">-&gt;</span><span class="n">Ident</span><span class="p">.</span><span class="n">c_str</span><span class="p">());</span>
			<span class="p">}</span>
			<span class="n">printf</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
			<span class="n">n</span> <span class="o">=</span> <span class="n">aip</span><span class="p">.</span><span class="n">Ai</span><span class="o">-&gt;</span><span class="n">UpgradeToRequests</span><span class="p">.</span><span class="n">size</span><span class="p">();</span>
			<span class="n">printf</span><span class="p">(</span><span class="s">&quot;UpgradeToRequests(%u):</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="k">static_cast</span><span class="o">&lt;</span><span class="kt">unsigned</span> <span class="kt">int</span><span class="o">&gt;</span><span class="p">(</span><span class="n">n</span><span class="p">));</span>
			<span class="k">for</span> <span class="p">(</span><span class="kt">size_t</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">n</span><span class="p">;</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span> <span class="p">{</span>
				<span class="n">printf</span><span class="p">(</span><span class="s">&quot;%s &quot;</span><span class="p">,</span> <span class="n">aip</span><span class="p">.</span><span class="n">Ai</span><span class="o">-&gt;</span><span class="n">UpgradeToRequests</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">-&gt;</span><span class="n">Ident</span><span class="p">.</span><span class="n">c_str</span><span class="p">());</span>
			<span class="p">}</span>
			<span class="n">printf</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
			<span class="n">n</span> <span class="o">=</span> <span class="n">aip</span><span class="p">.</span><span class="n">Ai</span><span class="o">-&gt;</span><span class="n">ResearchRequests</span><span class="p">.</span><span class="n">size</span><span class="p">();</span>
			<span class="n">printf</span><span class="p">(</span><span class="s">&quot;ResearchRequests(%u):</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="k">static_cast</span><span class="o">&lt;</span><span class="kt">unsigned</span> <span class="kt">int</span><span class="o">&gt;</span><span class="p">(</span><span class="n">n</span><span class="p">));</span>
			<span class="k">for</span> <span class="p">(</span><span class="kt">size_t</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">n</span><span class="p">;</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span> <span class="p">{</span>
				<span class="n">printf</span><span class="p">(</span><span class="s">&quot;%s &quot;</span><span class="p">,</span> <span class="n">aip</span><span class="p">.</span><span class="n">Ai</span><span class="o">-&gt;</span><span class="n">ResearchRequests</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">-&gt;</span><span class="n">Ident</span><span class="p">.</span><span class="n">c_str</span><span class="p">());</span>
			<span class="p">}</span>
			<span class="n">printf</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>

			<span class="c1">// Building queue</span>
			<span class="n">printf</span><span class="p">(</span><span class="s">&quot;Building queue:</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
			<span class="k">for</span> <span class="p">(</span><span class="kt">size_t</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">aip</span><span class="p">.</span><span class="n">Ai</span><span class="o">-&gt;</span><span class="n">UnitTypeBuilt</span><span class="p">.</span><span class="n">size</span><span class="p">();</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span> <span class="p">{</span>
				<span class="k">const</span> <span class="n">AiBuildQueue</span> <span class="o">&amp;</span><span class="n">queue</span> <span class="o">=</span> <span class="n">aip</span><span class="p">.</span><span class="n">Ai</span><span class="o">-&gt;</span><span class="n">UnitTypeBuilt</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
				<span class="n">printf</span><span class="p">(</span><span class="s">&quot;%s(%d/%d) &quot;</span><span class="p">,</span> <span class="n">queue</span><span class="p">.</span><span class="n">Type</span><span class="o">-&gt;</span><span class="n">Ident</span><span class="p">.</span><span class="n">c_str</span><span class="p">(),</span> <span class="n">queue</span><span class="p">.</span><span class="n">Made</span><span class="p">,</span> <span class="n">queue</span><span class="p">.</span><span class="n">Want</span><span class="p">);</span>
			<span class="p">}</span>
			<span class="n">printf</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>

			<span class="c1">// PrintForce</span>
			<span class="k">for</span> <span class="p">(</span><span class="kt">size_t</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">aip</span><span class="p">.</span><span class="n">Ai</span><span class="o">-&gt;</span><span class="n">Force</span><span class="p">.</span><span class="n">Size</span><span class="p">();</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span> <span class="p">{</span>
				<span class="n">printf</span><span class="p">(</span><span class="s">&quot;Force(%u%s%s):</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="k">static_cast</span><span class="o">&lt;</span><span class="kt">unsigned</span> <span class="kt">int</span><span class="o">&gt;</span><span class="p">(</span><span class="n">i</span><span class="p">),</span>
					   <span class="n">aip</span><span class="p">.</span><span class="n">Ai</span><span class="o">-&gt;</span><span class="n">Force</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">Completed</span> <span class="o">?</span> <span class="s">&quot;,complete&quot;</span> <span class="o">:</span> <span class="s">&quot;,recruit&quot;</span><span class="p">,</span>
					   <span class="n">aip</span><span class="p">.</span><span class="n">Ai</span><span class="o">-&gt;</span><span class="n">Force</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">Attacking</span> <span class="o">?</span> <span class="s">&quot;,attack&quot;</span> <span class="o">:</span> <span class="s">&quot;&quot;</span><span class="p">);</span>
				<span class="k">for</span> <span class="p">(</span><span class="kt">size_t</span> <span class="n">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="n">aip</span><span class="p">.</span><span class="n">Ai</span><span class="o">-&gt;</span><span class="n">Force</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">UnitTypes</span><span class="p">.</span><span class="n">size</span><span class="p">();</span> <span class="o">++</span><span class="n">j</span><span class="p">)</span> <span class="p">{</span>
					<span class="k">const</span> <span class="n">AiUnitType</span> <span class="o">&amp;</span><span class="n">aut</span> <span class="o">=</span> <span class="n">aip</span><span class="p">.</span><span class="n">Ai</span><span class="o">-&gt;</span><span class="n">Force</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">UnitTypes</span><span class="p">[</span><span class="n">j</span><span class="p">];</span>
					<span class="n">printf</span><span class="p">(</span><span class="s">&quot;%s(%d) &quot;</span><span class="p">,</span> <span class="n">aut</span><span class="p">.</span><span class="n">Type</span><span class="o">-&gt;</span><span class="n">Ident</span><span class="p">.</span><span class="n">c_str</span><span class="p">(),</span> <span class="n">aut</span><span class="p">.</span><span class="n">Want</span><span class="p">);</span>
				<span class="p">}</span>
				<span class="n">printf</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
			<span class="p">}</span>
			<span class="n">printf</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
		<span class="p">}</span>
	<span class="p">}</span>
	<span class="n">lua_pushboolean</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
	<span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</p>
                          </details>
                        </details>
                        
                        <details>
                        <summary>DefineAiPlayer</summary>
                        <p><br> Define an AI player.<br><br>  @param l  Lua state.</p>
                          <details>
                          <summary>/ai/script_ai.cpp:1893 CclDefineAiPlayer</summary>
                          <p><div class="highlight"><pre><span></span><span class="k">static</span> <span class="kt">int</span> <span class="nf">CclDefineAiPlayer</span><span class="p">(</span><span class="n">lua_State</span> <span class="o">*</span><span class="n">l</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">const</span> <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">playerIdx</span> <span class="o">=</span> <span class="n">LuaToNumber</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">0</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>

	<span class="n">Assert</span><span class="p">(</span><span class="n">playerIdx</span> <span class="o">&lt;=</span> <span class="n">PlayerMax</span><span class="p">);</span>
	<span class="n">DebugPrint</span><span class="p">(</span><span class="s">&quot;%p %d</span><span class="se">\n</span><span class="s">&quot;</span> <span class="n">_C_</span><span class="p">(</span><span class="kt">void</span> <span class="o">*</span><span class="p">)</span><span class="n">Players</span><span class="p">[</span><span class="n">playerIdx</span><span class="p">].</span><span class="n">Ai</span> <span class="n">_C_</span> <span class="n">Players</span><span class="p">[</span><span class="n">playerIdx</span><span class="p">].</span><span class="n">AiEnabled</span><span class="p">);</span>
	<span class="c1">// FIXME: lose this:</span>
	<span class="c1">// Assert(!Players[playerIdx].Ai &amp;&amp; Players[playerIdx].AiEnabled);</span>

	<span class="n">PlayerAi</span> <span class="o">*</span><span class="n">ai</span> <span class="o">=</span> <span class="n">Players</span><span class="p">[</span><span class="n">playerIdx</span><span class="p">].</span><span class="n">Ai</span> <span class="o">=</span> <span class="k">new</span> <span class="n">PlayerAi</span><span class="p">;</span>
	<span class="n">ai</span><span class="o">-&gt;</span><span class="n">Player</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">Players</span><span class="p">[</span><span class="n">playerIdx</span><span class="p">];</span>

	<span class="c1">// Parse the list: (still everything could be changed!)</span>
	<span class="k">const</span> <span class="kt">int</span> <span class="n">args</span> <span class="o">=</span> <span class="n">lua_gettop</span><span class="p">(</span><span class="n">l</span><span class="p">);</span>
	<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">j</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="n">args</span><span class="p">;</span> <span class="o">++</span><span class="n">j</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">value</span> <span class="o">=</span> <span class="n">LuaToString</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>
		<span class="o">++</span><span class="n">j</span><span class="p">;</span>

		<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s">&quot;ai-type&quot;</span><span class="p">))</span> <span class="p">{</span>
			<span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">aiName</span> <span class="o">=</span> <span class="n">LuaToString</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>
			<span class="n">CAiType</span> <span class="o">*</span><span class="n">ait</span> <span class="o">=</span> <span class="n">GetAiTypesByName</span><span class="p">(</span><span class="n">aiName</span><span class="p">);</span>
			<span class="k">if</span> <span class="p">(</span><span class="n">ait</span> <span class="o">==</span> <span class="nb">NULL</span><span class="p">)</span> <span class="p">{</span>
				<span class="n">LuaError</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="s">&quot;ai-type not found: %s&quot;</span> <span class="n">_C_</span> <span class="n">aiName</span><span class="p">);</span>
			<span class="p">}</span>
			<span class="n">ai</span><span class="o">-&gt;</span><span class="n">AiType</span> <span class="o">=</span> <span class="n">ait</span><span class="p">;</span>
			<span class="n">ai</span><span class="o">-&gt;</span><span class="n">Script</span> <span class="o">=</span> <span class="n">ait</span><span class="o">-&gt;</span><span class="n">Script</span><span class="p">;</span>
		<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s">&quot;script&quot;</span><span class="p">))</span> <span class="p">{</span>
			<span class="n">ai</span><span class="o">-&gt;</span><span class="n">Script</span> <span class="o">=</span> <span class="n">LuaToString</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>
		<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s">&quot;script-debug&quot;</span><span class="p">))</span> <span class="p">{</span>
			<span class="n">ai</span><span class="o">-&gt;</span><span class="n">ScriptDebug</span> <span class="o">=</span> <span class="n">LuaToBoolean</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>
		<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s">&quot;sleep-cycles&quot;</span><span class="p">))</span> <span class="p">{</span>
			<span class="n">ai</span><span class="o">-&gt;</span><span class="n">SleepCycles</span> <span class="o">=</span> <span class="n">LuaToNumber</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>
		<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s">&quot;force&quot;</span><span class="p">))</span> <span class="p">{</span>
			<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">lua_istable</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span> <span class="p">{</span>
				<span class="n">LuaError</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="s">&quot;incorrect argument&quot;</span><span class="p">);</span>
			<span class="p">}</span>
			<span class="k">const</span> <span class="kt">int</span> <span class="n">subargs</span> <span class="o">=</span> <span class="n">lua_rawlen</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>
			<span class="k">const</span> <span class="kt">int</span> <span class="n">cclforceIdx</span> <span class="o">=</span> <span class="n">LuaToNumber</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
			<span class="n">UNUSED</span><span class="p">(</span><span class="n">cclforceIdx</span><span class="p">);</span>
			<span class="k">const</span> <span class="kt">int</span> <span class="n">forceIdx</span> <span class="o">=</span> <span class="n">ai</span><span class="o">-&gt;</span><span class="n">Force</span><span class="p">.</span><span class="n">FindFreeForce</span><span class="p">(</span><span class="n">AiForceRoleDefault</span><span class="p">);</span>

			<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">k</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="n">k</span> <span class="o">&lt;</span> <span class="n">subargs</span><span class="p">;</span> <span class="o">++</span><span class="n">k</span><span class="p">)</span> <span class="p">{</span>
				<span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">value</span> <span class="o">=</span> <span class="n">LuaToString</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">k</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>
				<span class="o">++</span><span class="n">k</span><span class="p">;</span>
				<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s">&quot;complete&quot;</span><span class="p">))</span> <span class="p">{</span>
					<span class="n">ai</span><span class="o">-&gt;</span><span class="n">Force</span><span class="p">[</span><span class="n">forceIdx</span><span class="p">].</span><span class="n">Completed</span> <span class="o">=</span> <span class="nb">true</span><span class="p">;</span>
					<span class="o">--</span><span class="n">k</span><span class="p">;</span>
				<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s">&quot;recruit&quot;</span><span class="p">))</span> <span class="p">{</span>
					<span class="n">ai</span><span class="o">-&gt;</span><span class="n">Force</span><span class="p">[</span><span class="n">forceIdx</span><span class="p">].</span><span class="n">Completed</span> <span class="o">=</span> <span class="nb">false</span><span class="p">;</span>
					<span class="o">--</span><span class="n">k</span><span class="p">;</span>
				<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s">&quot;attack&quot;</span><span class="p">))</span> <span class="p">{</span>
					<span class="n">ai</span><span class="o">-&gt;</span><span class="n">Force</span><span class="p">[</span><span class="n">forceIdx</span><span class="p">].</span><span class="n">Attacking</span> <span class="o">=</span> <span class="nb">true</span><span class="p">;</span>
					<span class="o">--</span><span class="n">k</span><span class="p">;</span>
				<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s">&quot;defend&quot;</span><span class="p">))</span> <span class="p">{</span>
					<span class="n">ai</span><span class="o">-&gt;</span><span class="n">Force</span><span class="p">[</span><span class="n">forceIdx</span><span class="p">].</span><span class="n">Defending</span> <span class="o">=</span> <span class="nb">true</span><span class="p">;</span>
					<span class="o">--</span><span class="n">k</span><span class="p">;</span>
				<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s">&quot;role&quot;</span><span class="p">))</span> <span class="p">{</span>
					<span class="n">value</span> <span class="o">=</span> <span class="n">LuaToString</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">k</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>
					<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s">&quot;attack&quot;</span><span class="p">))</span> <span class="p">{</span>
						<span class="n">ai</span><span class="o">-&gt;</span><span class="n">Force</span><span class="p">[</span><span class="n">forceIdx</span><span class="p">].</span><span class="n">Role</span> <span class="o">=</span> <span class="n">AiForceRoleAttack</span><span class="p">;</span>
					<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s">&quot;defend&quot;</span><span class="p">))</span> <span class="p">{</span>
						<span class="n">ai</span><span class="o">-&gt;</span><span class="n">Force</span><span class="p">[</span><span class="n">forceIdx</span><span class="p">].</span><span class="n">Role</span> <span class="o">=</span> <span class="n">AiForceRoleDefend</span><span class="p">;</span>
					<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
						<span class="n">LuaError</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="s">&quot;Unsupported force tag: %s&quot;</span> <span class="n">_C_</span> <span class="n">value</span><span class="p">);</span>
					<span class="p">}</span>
				<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s">&quot;types&quot;</span><span class="p">))</span> <span class="p">{</span>
					<span class="n">lua_rawgeti</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">k</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>
					<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">lua_istable</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">-1</span><span class="p">))</span> <span class="p">{</span>
						<span class="n">LuaError</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="s">&quot;incorrect argument&quot;</span><span class="p">);</span>
					<span class="p">}</span>
					<span class="k">const</span> <span class="kt">int</span> <span class="n">subsubargs</span> <span class="o">=</span> <span class="n">lua_rawlen</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">-1</span><span class="p">);</span>
					<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">subk</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">subk</span> <span class="o">&lt;</span> <span class="n">subsubargs</span><span class="p">;</span> <span class="o">++</span><span class="n">subk</span><span class="p">)</span> <span class="p">{</span>
						<span class="k">const</span> <span class="kt">int</span> <span class="n">num</span> <span class="o">=</span> <span class="n">LuaToNumber</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">-1</span><span class="p">,</span> <span class="n">subk</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>
						<span class="o">++</span><span class="n">subk</span><span class="p">;</span>
						<span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">ident</span> <span class="o">=</span> <span class="n">LuaToString</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">-1</span><span class="p">,</span> <span class="n">subk</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>
						<span class="n">AiUnitType</span> <span class="n">queue</span><span class="p">;</span>

						<span class="n">queue</span><span class="p">.</span><span class="n">Want</span> <span class="o">=</span> <span class="n">num</span><span class="p">;</span>
						<span class="n">queue</span><span class="p">.</span><span class="n">Type</span> <span class="o">=</span> <span class="n">UnitTypeByIdent</span><span class="p">(</span><span class="n">ident</span><span class="p">);</span>
						<span class="n">ai</span><span class="o">-&gt;</span><span class="n">Force</span><span class="p">[</span><span class="n">forceIdx</span><span class="p">].</span><span class="n">UnitTypes</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">queue</span><span class="p">);</span>
					<span class="p">}</span>
					<span class="n">lua_pop</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
				<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s">&quot;units&quot;</span><span class="p">))</span> <span class="p">{</span>
					<span class="n">lua_rawgeti</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">k</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>
					<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">lua_istable</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">-1</span><span class="p">))</span> <span class="p">{</span>
						<span class="n">LuaError</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="s">&quot;incorrect argument&quot;</span><span class="p">);</span>
					<span class="p">}</span>
					<span class="k">const</span> <span class="kt">int</span> <span class="n">subsubargs</span> <span class="o">=</span> <span class="n">lua_rawlen</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">-1</span><span class="p">);</span>
					<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">subk</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">subk</span> <span class="o">&lt;</span> <span class="n">subsubargs</span><span class="p">;</span> <span class="o">++</span><span class="n">subk</span><span class="p">)</span> <span class="p">{</span>
						<span class="k">const</span> <span class="kt">int</span> <span class="n">num</span> <span class="o">=</span> <span class="n">LuaToNumber</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">-1</span><span class="p">,</span> <span class="n">subk</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>
						<span class="o">++</span><span class="n">subk</span><span class="p">;</span>
<span class="cp">#if 0</span><span class="c"></span>
<span class="c">						const char *ident = LuaToString(l, -1, subk + 1);</span>
<span class="c">						UNUSED(ident);</span>
<span class="cp">#endif</span>
						<span class="n">ai</span><span class="o">-&gt;</span><span class="n">Force</span><span class="p">[</span><span class="n">forceIdx</span><span class="p">].</span><span class="n">Units</span><span class="p">.</span><span class="n">Insert</span><span class="p">(</span><span class="o">&amp;</span><span class="n">UnitManager</span><span class="p">.</span><span class="n">GetSlotUnit</span><span class="p">(</span><span class="n">num</span><span class="p">));</span>
					<span class="p">}</span>
					<span class="n">lua_pop</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
				<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s">&quot;state&quot;</span><span class="p">))</span> <span class="p">{</span>
					<span class="n">ai</span><span class="o">-&gt;</span><span class="n">Force</span><span class="p">[</span><span class="n">forceIdx</span><span class="p">].</span><span class="n">State</span> <span class="o">=</span> <span class="n">AiForceAttackingState</span><span class="p">(</span><span class="n">LuaToNumber</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">k</span> <span class="o">+</span> <span class="mi">1</span><span class="p">));</span>
				<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s">&quot;goalx&quot;</span><span class="p">))</span> <span class="p">{</span>
					<span class="n">ai</span><span class="o">-&gt;</span><span class="n">Force</span><span class="p">[</span><span class="n">forceIdx</span><span class="p">].</span><span class="n">GoalPos</span><span class="p">.</span><span class="n">x</span> <span class="o">=</span> <span class="n">LuaToNumber</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">k</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>
				<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s">&quot;goaly&quot;</span><span class="p">))</span> <span class="p">{</span>
					<span class="n">ai</span><span class="o">-&gt;</span><span class="n">Force</span><span class="p">[</span><span class="n">forceIdx</span><span class="p">].</span><span class="n">GoalPos</span><span class="p">.</span><span class="n">y</span> <span class="o">=</span> <span class="n">LuaToNumber</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">k</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>
				<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s">&quot;must-transport&quot;</span><span class="p">))</span> <span class="p">{</span>
					<span class="c1">// Keep for backward compatibility</span>
				<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
					<span class="n">LuaError</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="s">&quot;Unsupported tag: %s&quot;</span> <span class="n">_C_</span> <span class="n">value</span><span class="p">);</span>
				<span class="p">}</span>
			<span class="p">}</span>
		<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s">&quot;reserve&quot;</span><span class="p">))</span> <span class="p">{</span>
			<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">lua_istable</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span> <span class="p">{</span>
				<span class="n">LuaError</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="s">&quot;incorrect argument&quot;</span><span class="p">);</span>
			<span class="p">}</span>
			<span class="k">const</span> <span class="kt">int</span> <span class="n">subargs</span> <span class="o">=</span> <span class="n">lua_rawlen</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>
			<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">k</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">k</span> <span class="o">&lt;</span> <span class="n">subargs</span><span class="p">;</span> <span class="o">++</span><span class="n">k</span><span class="p">)</span> <span class="p">{</span>
				<span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">type</span> <span class="o">=</span> <span class="n">LuaToString</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">k</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>
				<span class="o">++</span><span class="n">k</span><span class="p">;</span>
				<span class="kt">int</span> <span class="n">num</span> <span class="o">=</span> <span class="n">LuaToNumber</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">k</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>
				<span class="k">const</span> <span class="kt">int</span> <span class="n">resId</span> <span class="o">=</span> <span class="n">GetResourceIdByName</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">type</span><span class="p">);</span>
				<span class="n">ai</span><span class="o">-&gt;</span><span class="n">Reserve</span><span class="p">[</span><span class="n">resId</span><span class="p">]</span> <span class="o">=</span> <span class="n">num</span><span class="p">;</span>
			<span class="p">}</span>
		<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s">&quot;used&quot;</span><span class="p">))</span> <span class="p">{</span>
			<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">lua_istable</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span> <span class="p">{</span>
				<span class="n">LuaError</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="s">&quot;incorrect argument&quot;</span><span class="p">);</span>
			<span class="p">}</span>
			<span class="k">const</span> <span class="kt">int</span> <span class="n">subargs</span> <span class="o">=</span> <span class="n">lua_rawlen</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>
			<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">k</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">k</span> <span class="o">&lt;</span> <span class="n">subargs</span><span class="p">;</span> <span class="o">++</span><span class="n">k</span><span class="p">)</span> <span class="p">{</span>
				<span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">type</span> <span class="o">=</span> <span class="n">LuaToString</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">k</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>
				<span class="o">++</span><span class="n">k</span><span class="p">;</span>
				<span class="k">const</span> <span class="kt">int</span> <span class="n">num</span> <span class="o">=</span> <span class="n">LuaToNumber</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">k</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>
				<span class="k">const</span> <span class="kt">int</span> <span class="n">resId</span> <span class="o">=</span> <span class="n">GetResourceIdByName</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">type</span><span class="p">);</span>
				<span class="n">ai</span><span class="o">-&gt;</span><span class="n">Used</span><span class="p">[</span><span class="n">resId</span><span class="p">]</span> <span class="o">=</span> <span class="n">num</span><span class="p">;</span>
			<span class="p">}</span>
		<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s">&quot;needed&quot;</span><span class="p">))</span> <span class="p">{</span>
			<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">lua_istable</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span> <span class="p">{</span>
				<span class="n">LuaError</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="s">&quot;incorrect argument&quot;</span><span class="p">);</span>
			<span class="p">}</span>
			<span class="k">const</span> <span class="kt">int</span> <span class="n">subargs</span> <span class="o">=</span> <span class="n">lua_rawlen</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>
			<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">k</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">k</span> <span class="o">&lt;</span> <span class="n">subargs</span><span class="p">;</span> <span class="o">++</span><span class="n">k</span><span class="p">)</span> <span class="p">{</span>
				<span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">type</span> <span class="o">=</span> <span class="n">LuaToString</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">k</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>
				<span class="o">++</span><span class="n">k</span><span class="p">;</span>
				<span class="k">const</span> <span class="kt">int</span> <span class="n">num</span> <span class="o">=</span> <span class="n">LuaToNumber</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">k</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>
				<span class="k">const</span> <span class="kt">int</span> <span class="n">resId</span> <span class="o">=</span> <span class="n">GetResourceIdByName</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">type</span><span class="p">);</span>
				<span class="n">ai</span><span class="o">-&gt;</span><span class="n">Needed</span><span class="p">[</span><span class="n">resId</span><span class="p">]</span> <span class="o">=</span> <span class="n">num</span><span class="p">;</span>
			<span class="p">}</span>
		<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s">&quot;collect&quot;</span><span class="p">))</span> <span class="p">{</span>
			<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">lua_istable</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span> <span class="p">{</span>
				<span class="n">LuaError</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="s">&quot;incorrect argument&quot;</span><span class="p">);</span>
			<span class="p">}</span>
			<span class="k">const</span> <span class="kt">int</span> <span class="n">subargs</span> <span class="o">=</span> <span class="n">lua_rawlen</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>
			<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">k</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">k</span> <span class="o">&lt;</span> <span class="n">subargs</span><span class="p">;</span> <span class="o">++</span><span class="n">k</span><span class="p">)</span> <span class="p">{</span>
				<span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">type</span> <span class="o">=</span> <span class="n">LuaToString</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">k</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>
				<span class="o">++</span><span class="n">k</span><span class="p">;</span>
				<span class="k">const</span> <span class="kt">int</span> <span class="n">num</span> <span class="o">=</span> <span class="n">LuaToNumber</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">k</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>
				<span class="k">const</span> <span class="kt">int</span> <span class="n">resId</span> <span class="o">=</span> <span class="n">GetResourceIdByName</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">type</span><span class="p">);</span>
				<span class="n">ai</span><span class="o">-&gt;</span><span class="n">Collect</span><span class="p">[</span><span class="n">resId</span><span class="p">]</span> <span class="o">=</span> <span class="n">num</span><span class="p">;</span>
			<span class="p">}</span>
		<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s">&quot;need-mask&quot;</span><span class="p">))</span> <span class="p">{</span>
			<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">lua_istable</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span> <span class="p">{</span>
				<span class="n">LuaError</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="s">&quot;incorrect argument&quot;</span><span class="p">);</span>
			<span class="p">}</span>
			<span class="k">const</span> <span class="kt">int</span> <span class="n">subargs</span> <span class="o">=</span> <span class="n">lua_rawlen</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>
			<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">k</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">k</span> <span class="o">&lt;</span> <span class="n">subargs</span><span class="p">;</span> <span class="o">++</span><span class="n">k</span><span class="p">)</span> <span class="p">{</span>
				<span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">type</span> <span class="o">=</span> <span class="n">LuaToString</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">k</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>
				<span class="k">const</span> <span class="kt">int</span> <span class="n">resId</span> <span class="o">=</span> <span class="n">GetResourceIdByName</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">type</span><span class="p">);</span>
				<span class="n">ai</span><span class="o">-&gt;</span><span class="n">NeededMask</span> <span class="o">|=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="n">resId</span><span class="p">);</span>
			<span class="p">}</span>
		<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s">&quot;need-supply&quot;</span><span class="p">))</span> <span class="p">{</span>
			<span class="n">ai</span><span class="o">-&gt;</span><span class="n">NeedSupply</span> <span class="o">=</span> <span class="nb">true</span><span class="p">;</span>
			<span class="o">--</span><span class="n">j</span><span class="p">;</span>
		<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s">&quot;exploration&quot;</span><span class="p">))</span> <span class="p">{</span>
			<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">lua_istable</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span> <span class="p">{</span>
				<span class="n">LuaError</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="s">&quot;incorrect argument&quot;</span><span class="p">);</span>
			<span class="p">}</span>
			<span class="k">const</span> <span class="kt">int</span> <span class="n">subargs</span> <span class="o">=</span> <span class="n">lua_rawlen</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>
			<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">k</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">k</span> <span class="o">&lt;</span> <span class="n">subargs</span><span class="p">;</span> <span class="o">++</span><span class="n">k</span><span class="p">)</span> <span class="p">{</span>
				<span class="n">Vec2i</span> <span class="n">pos</span><span class="p">;</span>

				<span class="n">lua_rawgeti</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">k</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>
				<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">lua_istable</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">-1</span><span class="p">)</span> <span class="o">||</span> <span class="n">lua_rawlen</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">-1</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">3</span><span class="p">)</span> <span class="p">{</span>
					<span class="n">LuaError</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="s">&quot;incorrect argument&quot;</span><span class="p">);</span>
				<span class="p">}</span>
				<span class="n">pos</span><span class="p">.</span><span class="n">x</span> <span class="o">=</span> <span class="n">LuaToNumber</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">-1</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
				<span class="n">pos</span><span class="p">.</span><span class="n">y</span> <span class="o">=</span> <span class="n">LuaToNumber</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">-1</span><span class="p">,</span> <span class="mi">2</span><span class="p">);</span>
				<span class="k">const</span> <span class="kt">int</span> <span class="n">mask</span> <span class="o">=</span> <span class="n">LuaToNumber</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">-1</span><span class="p">,</span> <span class="mi">3</span><span class="p">);</span>
				<span class="n">lua_pop</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
				<span class="n">AiExplorationRequest</span> <span class="n">queue</span><span class="p">(</span><span class="n">pos</span><span class="p">,</span> <span class="n">mask</span><span class="p">);</span>
				<span class="n">ai</span><span class="o">-&gt;</span><span class="n">FirstExplorationRequest</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">queue</span><span class="p">);</span>
			<span class="p">}</span>
		<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s">&quot;last-exploration-cycle&quot;</span><span class="p">))</span> <span class="p">{</span>
			<span class="n">ai</span><span class="o">-&gt;</span><span class="n">LastExplorationGameCycle</span> <span class="o">=</span> <span class="n">LuaToNumber</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>
		<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s">&quot;last-can-not-move-cycle&quot;</span><span class="p">))</span> <span class="p">{</span>
			<span class="n">ai</span><span class="o">-&gt;</span><span class="n">LastCanNotMoveGameCycle</span> <span class="o">=</span> <span class="n">LuaToNumber</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>
		<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s">&quot;unit-type&quot;</span><span class="p">))</span> <span class="p">{</span>
			<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">lua_istable</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span> <span class="p">{</span>
				<span class="n">LuaError</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="s">&quot;incorrect argument&quot;</span><span class="p">);</span>
			<span class="p">}</span>
			<span class="k">const</span> <span class="kt">int</span> <span class="n">subargs</span> <span class="o">=</span> <span class="n">lua_rawlen</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>
			<span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
			<span class="k">if</span> <span class="p">(</span><span class="n">subargs</span><span class="p">)</span> <span class="p">{</span>
				<span class="n">ai</span><span class="o">-&gt;</span><span class="n">UnitTypeRequests</span><span class="p">.</span><span class="n">resize</span><span class="p">(</span><span class="n">subargs</span> <span class="o">/</span> <span class="mi">2</span><span class="p">);</span>
			<span class="p">}</span>
			<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">k</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">k</span> <span class="o">&lt;</span> <span class="n">subargs</span><span class="p">;</span> <span class="o">++</span><span class="n">k</span><span class="p">)</span> <span class="p">{</span>
				<span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">ident</span> <span class="o">=</span> <span class="n">LuaToString</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">k</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>
				<span class="o">++</span><span class="n">k</span><span class="p">;</span>
				<span class="k">const</span> <span class="kt">int</span> <span class="n">count</span> <span class="o">=</span> <span class="n">LuaToNumber</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">k</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>
				<span class="n">ai</span><span class="o">-&gt;</span><span class="n">UnitTypeRequests</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">Type</span> <span class="o">=</span> <span class="n">UnitTypeByIdent</span><span class="p">(</span><span class="n">ident</span><span class="p">);</span>
				<span class="n">ai</span><span class="o">-&gt;</span><span class="n">UnitTypeRequests</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">Count</span> <span class="o">=</span> <span class="n">count</span><span class="p">;</span>
				<span class="o">++</span><span class="n">i</span><span class="p">;</span>
			<span class="p">}</span>
		<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s">&quot;upgrade&quot;</span><span class="p">))</span> <span class="p">{</span>
			<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">lua_istable</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span> <span class="p">{</span>
				<span class="n">LuaError</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="s">&quot;incorrect argument&quot;</span><span class="p">);</span>
			<span class="p">}</span>
			<span class="k">const</span> <span class="kt">int</span> <span class="n">subargs</span> <span class="o">=</span> <span class="n">lua_rawlen</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>
			<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">k</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">k</span> <span class="o">&lt;</span> <span class="n">subargs</span><span class="p">;</span> <span class="o">++</span><span class="n">k</span><span class="p">)</span> <span class="p">{</span>
				<span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">ident</span> <span class="o">=</span> <span class="n">LuaToString</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">k</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>
				<span class="n">ai</span><span class="o">-&gt;</span><span class="n">UpgradeToRequests</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">UnitTypeByIdent</span><span class="p">(</span><span class="n">ident</span><span class="p">));</span>
			<span class="p">}</span>
		<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s">&quot;research&quot;</span><span class="p">))</span> <span class="p">{</span>
			<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">lua_istable</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span> <span class="p">{</span>
				<span class="n">LuaError</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="s">&quot;incorrect argument&quot;</span><span class="p">);</span>
			<span class="p">}</span>
			<span class="k">const</span> <span class="kt">int</span> <span class="n">subargs</span> <span class="o">=</span> <span class="n">lua_rawlen</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>
			<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">k</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">k</span> <span class="o">&lt;</span> <span class="n">subargs</span><span class="p">;</span> <span class="o">++</span><span class="n">k</span><span class="p">)</span> <span class="p">{</span>
				<span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">ident</span> <span class="o">=</span> <span class="n">LuaToString</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">k</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>
				<span class="n">ai</span><span class="o">-&gt;</span><span class="n">ResearchRequests</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">CUpgrade</span><span class="o">::</span><span class="n">Get</span><span class="p">(</span><span class="n">ident</span><span class="p">));</span>
			<span class="p">}</span>
		<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s">&quot;building&quot;</span><span class="p">))</span> <span class="p">{</span>
			<span class="n">CclParseBuildQueue</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">ai</span><span class="p">,</span> <span class="n">j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>
		<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s">&quot;repair-building&quot;</span><span class="p">))</span> <span class="p">{</span>
			<span class="n">ai</span><span class="o">-&gt;</span><span class="n">LastRepairBuilding</span> <span class="o">=</span> <span class="n">LuaToNumber</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>
		<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
			<span class="n">LuaError</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="s">&quot;Unsupported tag: %s&quot;</span> <span class="n">_C_</span> <span class="n">value</span><span class="p">);</span>
		<span class="p">}</span>
	<span class="p">}</span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</p>
                          </details>
                        </details>
                        
                        <details>
                        <summary>AiAttackWithForces</summary>
                        <p><br> <b>Description</b><br><br>  Attack with forces.<br><br>  @param l  Lua state.<br><br> Example:<br><br> <div class="example"><code>local simple_ai_loop = {<br>		function() return AiSleep(9000) end,<br>		function() stratagus.gameData.AIState.loop_index[1 + AiPlayer()] = 0; return false; end,<br>	}<br><br>	local simple_ai = {<br>		function() return AiSleep(AiGetSleepCycles()) end,<br>		function() return AiNeed("unit-town-hall") end,<br>		function() return AiWait("unit-town-hall") end,<br>		function() return AiSet("unit-peasant",4) end,<br>		function() return AiNeed("unit-human-barracks") end,<br>		function() return AiWait("unit-human-barracks") end,<br>		function() return AiNeed("unit-elven-lumber-mill") end,<br>		function() return AiWait("unit-elven-lumber-mill") end,<br>		function() return AiForce(1,{"unit-footman", 2}) end,<br>		function() return AiForce(2,{"unit-archer",1}) end,<br>		function() return AiForce(3,{"unit-archer",1,"unit-footman",3}) end,<br>		-- Wait all three forces to be ready<br>		function() return AiWaitForces({1,2,3}) end,<br>		-- Attack with all three forces<br>		function() return <strong>AiAttackWithForces</strong>({1,2,3}) end,<br>		function() return AiLoop(simple_ai_loop, stratagus.gameData.AIState.loop_index) end,<br>	}<br><br>	function custom_ai() return AiLoop(simple_ai,stratagus.gameData.AIState.index) end<br>	DefineAi("example_ai","human","class_ai",custom_ai)</code></div></p>
                          <details>
                          <summary>/ai/script_ai.cpp:1271 CclAiAttackWithForces</summary>
                          <p><div class="highlight"><pre><span></span><span class="k">static</span> <span class="kt">int</span> <span class="nf">CclAiAttackWithForces</span><span class="p">(</span><span class="n">lua_State</span> <span class="o">*</span><span class="n">l</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">int</span> <span class="n">Forces</span><span class="p">[</span><span class="n">AI_MAX_FORCE_INTERNAL</span> <span class="o">+</span> <span class="mi">1</span><span class="p">];</span>

	<span class="n">LuaCheckArgs</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">lua_istable</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span> <span class="p">{</span>
		<span class="n">LuaError</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="s">&quot;incorrect argument&quot;</span><span class="p">);</span>
	<span class="p">}</span>
	<span class="kt">int</span> <span class="n">args</span> <span class="o">=</span> <span class="n">lua_rawlen</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
	<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">args</span><span class="p">;</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">const</span> <span class="kt">int</span> <span class="n">force</span> <span class="o">=</span> <span class="n">LuaToNumber</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>

		<span class="k">if</span> <span class="p">(</span><span class="n">force</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="o">||</span> <span class="n">force</span> <span class="o">&gt;=</span> <span class="n">AI_MAX_FORCE_INTERNAL</span><span class="p">)</span> <span class="p">{</span>
			<span class="n">lua_pushfstring</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="s">&quot;Force out of range: %d&quot;</span><span class="p">,</span> <span class="n">force</span><span class="p">);</span>
		<span class="p">}</span>
		<span class="n">Forces</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">AiPlayer</span><span class="o">-&gt;</span><span class="n">Force</span><span class="p">.</span><span class="n">getScriptForce</span><span class="p">(</span><span class="n">force</span><span class="p">);</span>
	<span class="p">}</span>
	<span class="n">Forces</span><span class="p">[</span><span class="n">args</span><span class="p">]</span> <span class="o">=</span> <span class="mi">-1</span><span class="p">;</span>
	<span class="n">AiAttackWithForces</span><span class="p">(</span><span class="n">Forces</span><span class="p">);</span>
	<span class="n">lua_pushboolean</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
	<span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</p>
                          </details>
                        </details>
                        
                        <details>
                        <summary>AiWaitForces</summary>
                        <p><br> <b>Description</b><br><br>  Wait for a forces ready.<br><br>  @param l  Lua state.<br><br> Example:<br><br> <div class="example"><code>local simple_ai_loop = {<br>		function() return AiSleep(9000) end,<br>		function() stratagus.gameData.AIState.loop_index[1 + AiPlayer()] = 0; return false; end,<br>	}<br><br>	local simple_ai = {<br>		function() return AiSleep(AiGetSleepCycles()) end,<br>		function() return AiNeed("unit-town-hall") end,<br>		function() return AiWait("unit-town-hall") end,<br>		function() return AiSet("unit-peasant",4) end,<br>		function() return AiNeed("unit-human-barracks") end,<br>		function() return AiWait("unit-human-barracks") end,<br>		function() return AiNeed("unit-elven-lumber-mill") end,<br>		function() return AiWait("unit-elven-lumber-mill") end,<br>		function() return AiForce(1,{"unit-footman", 2}) end,<br>		function() return AiForce(2,{"unit-archer",1}) end,<br>		function() return AiForce(3,{"unit-archer",1,"unit-footman",3}) end,<br>		-- Wait all three forces to be ready<br>		function() return <strong>AiWaitForces</strong>({1,2,3}) end,<br>		function() return AiLoop(simple_ai_loop, stratagus.gameData.AIState.loop_index) end,<br>	}<br><br>	function custom_ai() return AiLoop(simple_ai,stratagus.gameData.AIState.index) end<br>	DefineAi("example_ai","human","class_ai",custom_ai)</code></div></p>
                          <details>
                          <summary>/ai/script_ai.cpp:1212 CclAiWaitForces</summary>
                          <p><div class="highlight"><pre><span></span><span class="k">static</span> <span class="kt">int</span> <span class="nf">CclAiWaitForces</span><span class="p">(</span><span class="n">lua_State</span> <span class="o">*</span><span class="n">l</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">LuaCheckArgs</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">lua_istable</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span> <span class="p">{</span>
		<span class="n">LuaError</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="s">&quot;incorrect argument&quot;</span><span class="p">);</span>
	<span class="p">}</span>
	<span class="k">const</span> <span class="kt">int</span> <span class="n">args</span> <span class="o">=</span> <span class="n">lua_rawlen</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
	<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">args</span><span class="p">;</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">const</span> <span class="kt">int</span> <span class="n">force</span> <span class="o">=</span> <span class="n">LuaToNumber</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>

		<span class="k">if</span> <span class="p">(</span><span class="n">force</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="o">||</span> <span class="n">force</span> <span class="o">&gt;=</span> <span class="n">AI_MAX_FORCE_INTERNAL</span><span class="p">)</span> <span class="p">{</span>
			<span class="n">lua_pushfstring</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="s">&quot;Force out of range: %d&quot;</span><span class="p">,</span> <span class="n">force</span><span class="p">);</span>
		<span class="p">}</span>
		<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">AiPlayer</span><span class="o">-&gt;</span><span class="n">Force</span><span class="p">[</span><span class="n">AiPlayer</span><span class="o">-&gt;</span><span class="n">Force</span><span class="p">.</span><span class="n">getScriptForce</span><span class="p">(</span><span class="n">force</span><span class="p">)].</span><span class="n">Completed</span><span class="p">)</span> <span class="p">{</span>
			<span class="n">lua_pushboolean</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
			<span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
		<span class="p">}</span>
	<span class="p">}</span>
	<span class="n">lua_pushboolean</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
	<span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</p>
                          </details>
                        </details>
                        
                        <details>
                        <summary>AiProcessorSetup</summary>
                        <p><br> AiProcessorSetup(host, port, number_of_state_variables, number_of_actions)<br><br> Connect to an AI agent running at host:port, that will consume<br> number_of_state_variables every step and select one of number_of_actions.</p>
                          <details>
                          <summary>/ai/script_ai.cpp:1926 CclAiProcessorSetup</summary>
                          <p><div class="highlight"><pre><span></span><span class="k">static</span> <span class="kt">int</span> <span class="nf">CclAiProcessorSetup</span><span class="p">(</span><span class="n">lua_State</span> <span class="o">*</span><span class="n">l</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">InitNetwork1</span><span class="p">();</span>
	<span class="n">LuaCheckArgs</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">4</span><span class="p">);</span>
	<span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">host</span> <span class="o">=</span> <span class="n">LuaToString</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
	<span class="kt">int</span> <span class="n">port</span> <span class="o">=</span> <span class="n">LuaToNumber</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">2</span><span class="p">);</span>
	<span class="kt">int</span> <span class="n">stateDim</span> <span class="o">=</span> <span class="n">LuaToNumber</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">3</span><span class="p">);</span>
	<span class="kt">int</span> <span class="n">actionDim</span> <span class="o">=</span> <span class="n">LuaToNumber</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">4</span><span class="p">);</span>

	<span class="n">CHost</span> <span class="n">h</span><span class="p">(</span><span class="n">host</span><span class="p">.</span><span class="n">c_str</span><span class="p">(),</span> <span class="n">port</span><span class="p">);</span>
	<span class="n">CTCPSocket</span> <span class="o">*</span><span class="n">s</span> <span class="o">=</span> <span class="k">new</span> <span class="n">CTCPSocket</span><span class="p">();</span>
	<span class="n">s</span><span class="o">-&gt;</span><span class="n">Open</span><span class="p">(</span><span class="n">CHost</span><span class="p">());</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">s</span><span class="o">-&gt;</span><span class="n">Connect</span><span class="p">(</span><span class="n">h</span><span class="p">))</span> <span class="p">{</span>
		<span class="kt">char</span> <span class="n">buf</span><span class="p">[</span><span class="mi">3</span><span class="p">];</span>
		<span class="n">buf</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="sc">&#39;I&#39;</span><span class="p">;</span>
		<span class="n">buf</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="kt">uint8_t</span><span class="p">)</span><span class="n">stateDim</span><span class="p">;</span>
		<span class="n">buf</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="kt">uint8_t</span><span class="p">)</span><span class="n">actionDim</span><span class="p">;</span>
		<span class="n">s</span><span class="o">-&gt;</span><span class="n">Send</span><span class="p">(</span><span class="n">buf</span><span class="p">,</span> <span class="mi">3</span><span class="p">);</span>
		<span class="n">lua_pushlightuserdata</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">s</span><span class="p">);</span>
		<span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="k">delete</span> <span class="n">s</span><span class="p">;</span>
	<span class="n">lua_pushnil</span><span class="p">(</span><span class="n">l</span><span class="p">);</span>
	<span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</p>
                          </details>
                        </details>
                        
                        <details>
                        <summary>AiProcessorStep</summary>
                        <p><br> AiProcessorStep(handle, reward_since_last_call, table_of_state_variables)</p>
                          <details>
                          <summary>/ai/script_ai.cpp:1981 CclAiProcessorStep</summary>
                          <p><div class="highlight"><pre><span></span><span class="k">static</span> <span class="kt">int</span> <span class="nf">CclAiProcessorStep</span><span class="p">(</span><span class="n">lua_State</span> <span class="o">*</span><span class="n">l</span><span class="p">)</span>
<span class="p">{</span>
	<span class="c1">// A single step in a reinforcement learning network</span>

	<span class="c1">// We receive the current env and current reward in the arguments</span>

	<span class="c1">// We need to return the next action.</span>

	<span class="c1">// The next call to this function will be the updated state, reward for the</span>
	<span class="c1">// last action</span>

	<span class="n">CTCPSocket</span> <span class="o">*</span><span class="n">s</span> <span class="o">=</span> <span class="n">AiProcessorSendState</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="sc">&#39;S&#39;</span><span class="p">);</span>
	<span class="kt">int</span> <span class="n">action</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="n">s</span><span class="o">-&gt;</span><span class="n">Recv</span><span class="p">(</span><span class="o">&amp;</span><span class="n">action</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
	<span class="n">lua_pushnumber</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">action</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span> <span class="c1">// +1 since lua tables are 1-indexed</span>
	<span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</p>
                          </details>
                        </details>
                        
                        <details>
                        <summary>AiProcessorEnd</summary>
                        <p>/ai/script_ai.cpp:1989 CclAiProcessorEnd</p>
                        <p><div class="highlight"><pre><span></span><span class="k">static</span> <span class="kt">int</span> <span class="nf">CclAiProcessorEnd</span><span class="p">(</span><span class="n">lua_State</span> <span class="o">*</span><span class="n">l</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">CTCPSocket</span> <span class="o">*</span><span class="n">s</span> <span class="o">=</span> <span class="n">AiProcessorSendState</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="sc">&#39;E&#39;</span><span class="p">);</span>
	<span class="n">s</span><span class="o">-&gt;</span><span class="n">Close</span><span class="p">();</span>
	<span class="k">delete</span> <span class="n">s</span><span class="p">;</span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</p>
                        </details>
                        <hr>/missile/script_missile.cpp<hr>
                        <details>
                        <summary>DefineMissileType</summary>
                        <p><br>  Parse missile-type.<br><br>  @param l  Lua state.</p>
                          <details>
                          <summary>/missile/script_missile.cpp:234 CclDefineMissileType</summary>
                          <p><div class="highlight"><pre><span></span><span class="k">static</span> <span class="kt">int</span> <span class="nf">CclDefineMissileType</span><span class="p">(</span><span class="n">lua_State</span> <span class="o">*</span><span class="n">l</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">LuaCheckArgs</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">2</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">lua_istable</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span> <span class="p">{</span>
		<span class="n">LuaError</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="s">&quot;incorrect argument&quot;</span><span class="p">);</span>
	<span class="p">}</span>

	<span class="c1">// Slot identifier</span>
	<span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">str</span> <span class="o">=</span> <span class="n">LuaToString</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
	<span class="n">MissileType</span> <span class="o">*</span><span class="n">mtype</span> <span class="o">=</span> <span class="n">MissileTypeByIdent</span><span class="p">(</span><span class="n">str</span><span class="p">);</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">mtype</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">DebugPrint</span><span class="p">(</span><span class="s">&quot;Redefining missile-type &#39;%s&#39;</span><span class="se">\n</span><span class="s">&quot;</span> <span class="n">_C_</span> <span class="n">str</span><span class="p">);</span>
	<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
		<span class="n">mtype</span> <span class="o">=</span> <span class="n">NewMissileTypeSlot</span><span class="p">(</span><span class="n">str</span><span class="p">);</span>
	<span class="p">}</span>
	<span class="n">mtype</span><span class="o">-&gt;</span><span class="n">Load</span><span class="p">(</span><span class="n">l</span><span class="p">);</span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</p>
                          </details>
                        </details>
                        
                        <details>
                        <summary>Missile</summary>
                        <p><br>  Create a missile.<br><br>  @param l  Lua state.</p>
                          <details>
                          <summary>/missile/script_missile.cpp:332 CclMissile</summary>
                          <p><div class="highlight"><pre><span></span><span class="k">static</span> <span class="kt">int</span> <span class="nf">CclMissile</span><span class="p">(</span><span class="n">lua_State</span> <span class="o">*</span><span class="n">l</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">MissileType</span> <span class="o">*</span><span class="n">type</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">;</span>
	<span class="n">PixelPos</span> <span class="n">position</span><span class="p">(</span><span class="mi">-1</span><span class="p">,</span> <span class="mi">-1</span><span class="p">);</span>
	<span class="n">PixelPos</span> <span class="n">destination</span><span class="p">(</span><span class="mi">-1</span><span class="p">,</span> <span class="mi">-1</span><span class="p">);</span>
	<span class="n">PixelPos</span> <span class="n">source</span><span class="p">(</span><span class="mi">-1</span><span class="p">,</span> <span class="mi">-1</span><span class="p">);</span>
	<span class="n">Missile</span> <span class="o">*</span><span class="n">missile</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">;</span>

	<span class="n">DebugPrint</span><span class="p">(</span><span class="s">&quot;FIXME: not finished</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>

	<span class="k">const</span> <span class="kt">int</span> <span class="n">args</span> <span class="o">=</span> <span class="n">lua_gettop</span><span class="p">(</span><span class="n">l</span><span class="p">);</span>
	<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="n">args</span><span class="p">;</span> <span class="o">++</span><span class="n">j</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">value</span> <span class="o">=</span> <span class="n">LuaToString</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>
		<span class="o">++</span><span class="n">j</span><span class="p">;</span>

		<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s">&quot;type&quot;</span><span class="p">))</span> <span class="p">{</span>
			<span class="n">type</span> <span class="o">=</span> <span class="n">MissileTypeByIdent</span><span class="p">(</span><span class="n">LuaToString</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">));</span>
		<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s">&quot;pos&quot;</span><span class="p">))</span> <span class="p">{</span>
			<span class="n">CclGetPos</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">position</span><span class="p">.</span><span class="n">x</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">position</span><span class="p">.</span><span class="n">y</span><span class="p">,</span> <span class="n">j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>
		<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s">&quot;origin-pos&quot;</span><span class="p">))</span> <span class="p">{</span>
			<span class="n">CclGetPos</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">source</span><span class="p">.</span><span class="n">x</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">source</span><span class="p">.</span><span class="n">y</span><span class="p">,</span> <span class="n">j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>
		<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s">&quot;goal&quot;</span><span class="p">))</span> <span class="p">{</span>
			<span class="n">CclGetPos</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">destination</span><span class="p">.</span><span class="n">x</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">destination</span><span class="p">.</span><span class="n">y</span><span class="p">,</span> <span class="n">j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>
		<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s">&quot;local&quot;</span><span class="p">))</span> <span class="p">{</span>
			<span class="n">Assert</span><span class="p">(</span><span class="n">type</span><span class="p">);</span>
			<span class="n">missile</span> <span class="o">=</span> <span class="n">MakeLocalMissile</span><span class="p">(</span><span class="o">*</span><span class="n">type</span><span class="p">,</span> <span class="n">position</span><span class="p">,</span> <span class="n">destination</span><span class="p">);</span>
			<span class="n">missile</span><span class="o">-&gt;</span><span class="n">Local</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
			<span class="o">--</span><span class="n">j</span><span class="p">;</span>
		<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s">&quot;global&quot;</span><span class="p">))</span> <span class="p">{</span>
			<span class="n">Assert</span><span class="p">(</span><span class="n">type</span><span class="p">);</span>
			<span class="n">missile</span> <span class="o">=</span> <span class="n">MakeMissile</span><span class="p">(</span><span class="o">*</span><span class="n">type</span><span class="p">,</span> <span class="n">position</span><span class="p">,</span> <span class="n">destination</span><span class="p">);</span>
			<span class="n">missile</span><span class="o">-&gt;</span><span class="n">position</span> <span class="o">=</span> <span class="n">position</span><span class="p">;</span>
			<span class="n">missile</span><span class="o">-&gt;</span><span class="n">source</span> <span class="o">=</span> <span class="n">source</span><span class="p">;</span>
			<span class="n">missile</span><span class="o">-&gt;</span><span class="n">destination</span> <span class="o">=</span> <span class="n">destination</span><span class="p">;</span>
			<span class="n">missile</span><span class="o">-&gt;</span><span class="n">Local</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
			<span class="o">--</span><span class="n">j</span><span class="p">;</span>
		<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s">&quot;frame&quot;</span><span class="p">))</span> <span class="p">{</span>
			<span class="n">Assert</span><span class="p">(</span><span class="n">missile</span><span class="p">);</span>
			<span class="n">missile</span><span class="o">-&gt;</span><span class="n">SpriteFrame</span> <span class="o">=</span> <span class="n">LuaToNumber</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>
		<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s">&quot;state&quot;</span><span class="p">))</span> <span class="p">{</span>
			<span class="n">Assert</span><span class="p">(</span><span class="n">missile</span><span class="p">);</span>
			<span class="n">missile</span><span class="o">-&gt;</span><span class="n">State</span> <span class="o">=</span> <span class="n">LuaToNumber</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>
		<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s">&quot;anim-wait&quot;</span><span class="p">))</span> <span class="p">{</span>
			<span class="n">Assert</span><span class="p">(</span><span class="n">missile</span><span class="p">);</span>
			<span class="n">missile</span><span class="o">-&gt;</span><span class="n">AnimWait</span> <span class="o">=</span> <span class="n">LuaToNumber</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>
		<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s">&quot;wait&quot;</span><span class="p">))</span> <span class="p">{</span>
			<span class="n">Assert</span><span class="p">(</span><span class="n">missile</span><span class="p">);</span>
			<span class="n">missile</span><span class="o">-&gt;</span><span class="n">Wait</span> <span class="o">=</span> <span class="n">LuaToNumber</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>
		<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s">&quot;delay&quot;</span><span class="p">))</span> <span class="p">{</span>
			<span class="n">Assert</span><span class="p">(</span><span class="n">missile</span><span class="p">);</span>
			<span class="n">missile</span><span class="o">-&gt;</span><span class="n">Delay</span> <span class="o">=</span> <span class="n">LuaToNumber</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>
		<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s">&quot;source&quot;</span><span class="p">))</span> <span class="p">{</span>
			<span class="n">Assert</span><span class="p">(</span><span class="n">missile</span><span class="p">);</span>
			<span class="n">lua_pushvalue</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>
			<span class="n">missile</span><span class="o">-&gt;</span><span class="n">SourceUnit</span> <span class="o">=</span> <span class="n">CclGetUnitFromRef</span><span class="p">(</span><span class="n">l</span><span class="p">);</span>
			<span class="n">lua_pop</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
		<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s">&quot;target&quot;</span><span class="p">))</span> <span class="p">{</span>
			<span class="n">Assert</span><span class="p">(</span><span class="n">missile</span><span class="p">);</span>
			<span class="n">lua_pushvalue</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>
			<span class="n">missile</span><span class="o">-&gt;</span><span class="n">TargetUnit</span> <span class="o">=</span> <span class="n">CclGetUnitFromRef</span><span class="p">(</span><span class="n">l</span><span class="p">);</span>
			<span class="n">lua_pop</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
		<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s">&quot;damage&quot;</span><span class="p">))</span> <span class="p">{</span>
			<span class="n">Assert</span><span class="p">(</span><span class="n">missile</span><span class="p">);</span>
			<span class="n">missile</span><span class="o">-&gt;</span><span class="n">Damage</span> <span class="o">=</span> <span class="n">LuaToNumber</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>
		<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s">&quot;ttl&quot;</span><span class="p">))</span> <span class="p">{</span>
			<span class="n">Assert</span><span class="p">(</span><span class="n">missile</span><span class="p">);</span>
			<span class="n">missile</span><span class="o">-&gt;</span><span class="n">TTL</span> <span class="o">=</span> <span class="n">LuaToNumber</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>
		<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s">&quot;hidden&quot;</span><span class="p">))</span> <span class="p">{</span>
			<span class="n">Assert</span><span class="p">(</span><span class="n">missile</span><span class="p">);</span>
			<span class="n">missile</span><span class="o">-&gt;</span><span class="n">Hidden</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
			<span class="o">--</span><span class="n">j</span><span class="p">;</span>
		<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s">&quot;step&quot;</span><span class="p">))</span> <span class="p">{</span>
			<span class="n">Assert</span><span class="p">(</span><span class="n">missile</span><span class="p">);</span>
			<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">lua_istable</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">||</span> <span class="n">lua_rawlen</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">2</span><span class="p">)</span> <span class="p">{</span>
				<span class="n">LuaError</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="s">&quot;incorrect argument&quot;</span><span class="p">);</span>
			<span class="p">}</span>
			<span class="n">missile</span><span class="o">-&gt;</span><span class="n">CurrentStep</span> <span class="o">=</span> <span class="n">LuaToNumber</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
			<span class="n">missile</span><span class="o">-&gt;</span><span class="n">TotalStep</span> <span class="o">=</span> <span class="n">LuaToNumber</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">);</span>
		<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
			<span class="n">LuaError</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="s">&quot;Unsupported tag: %s&quot;</span> <span class="n">_C_</span> <span class="n">value</span><span class="p">);</span>
		<span class="p">}</span>
	<span class="p">}</span>

	<span class="c1">// we need to reinitialize position parameters - that&#39;s because of</span>
	<span class="c1">// the way InitMissile() (called from MakeLocalMissile()) computes</span>
	<span class="c1">// them - it works for creating a missile during a game but breaks</span>
	<span class="c1">// loading the missile from a file.</span>
	<span class="n">missile</span><span class="o">-&gt;</span><span class="n">position</span> <span class="o">=</span> <span class="n">position</span><span class="p">;</span>
	<span class="n">missile</span><span class="o">-&gt;</span><span class="n">source</span> <span class="o">=</span> <span class="n">source</span><span class="p">;</span>
	<span class="n">missile</span><span class="o">-&gt;</span><span class="n">destination</span> <span class="o">=</span> <span class="n">destination</span><span class="p">;</span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</p>
                          </details>
                        </details>
                        
                        <details>
                        <summary>DefineBurningBuilding</summary>
                        <p><br>  Define burning building missiles.<br><br>  @param l  Lua state.</p>
                          <details>
                          <summary>/missile/script_missile.cpp:368 CclDefineBurningBuilding</summary>
                          <p><div class="highlight"><pre><span></span><span class="k">static</span> <span class="kt">int</span> <span class="nf">CclDefineBurningBuilding</span><span class="p">(</span><span class="n">lua_State</span> <span class="o">*</span><span class="n">l</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">for</span> <span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">BurningBuildingFrame</span> <span class="o">*&gt;::</span><span class="n">iterator</span> <span class="n">i</span> <span class="o">=</span> <span class="n">BurningBuildingFrames</span><span class="p">.</span><span class="n">begin</span><span class="p">();</span>
		 <span class="n">i</span> <span class="o">!=</span> <span class="n">BurningBuildingFrames</span><span class="p">.</span><span class="n">end</span><span class="p">();</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">delete</span> <span class="o">*</span><span class="n">i</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="n">BurningBuildingFrames</span><span class="p">.</span><span class="n">clear</span><span class="p">();</span>

	<span class="k">const</span> <span class="kt">int</span> <span class="n">args</span> <span class="o">=</span> <span class="n">lua_gettop</span><span class="p">(</span><span class="n">l</span><span class="p">);</span>
	<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="n">args</span><span class="p">;</span> <span class="o">++</span><span class="n">j</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">lua_istable</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span> <span class="p">{</span>
			<span class="n">LuaError</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="s">&quot;incorrect argument&quot;</span><span class="p">);</span>
		<span class="p">}</span>
		<span class="n">BurningBuildingFrame</span> <span class="o">*</span><span class="n">ptr</span> <span class="o">=</span> <span class="k">new</span> <span class="n">BurningBuildingFrame</span><span class="p">;</span>
		<span class="k">const</span> <span class="kt">int</span> <span class="n">subargs</span> <span class="o">=</span> <span class="n">lua_rawlen</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>

		<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">k</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">k</span> <span class="o">&lt;</span> <span class="n">subargs</span><span class="p">;</span> <span class="o">++</span><span class="n">k</span><span class="p">)</span> <span class="p">{</span>
			<span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">value</span> <span class="o">=</span> <span class="n">LuaToString</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">k</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>
			<span class="o">++</span><span class="n">k</span><span class="p">;</span>

			<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s">&quot;percent&quot;</span><span class="p">))</span> <span class="p">{</span>
				<span class="n">ptr</span><span class="o">-&gt;</span><span class="n">Percent</span> <span class="o">=</span> <span class="n">LuaToNumber</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">k</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>
			<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s">&quot;missile&quot;</span><span class="p">))</span> <span class="p">{</span>
				<span class="n">ptr</span><span class="o">-&gt;</span><span class="n">Missile</span> <span class="o">=</span> <span class="n">MissileTypeByIdent</span><span class="p">(</span><span class="n">LuaToString</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">k</span> <span class="o">+</span> <span class="mi">1</span><span class="p">));</span>
			<span class="p">}</span>
		<span class="p">}</span>
		<span class="n">BurningBuildingFrames</span><span class="p">.</span><span class="n">insert</span><span class="p">(</span><span class="n">BurningBuildingFrames</span><span class="p">.</span><span class="n">begin</span><span class="p">(),</span> <span class="n">ptr</span><span class="p">);</span>
	<span class="p">}</span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</p>
                          </details>
                        </details>
                        
                        <details>
                        <summary>CreateMissile</summary>
                        <p><br>  Create a missile on the map<br><br>  @param l  Lua state.<br></p>
                          <details>
                          <summary>/missile/script_missile.cpp:417 CclCreateMissile</summary>
                          <p><div class="highlight"><pre><span></span><span class="k">static</span> <span class="kt">int</span> <span class="nf">CclCreateMissile</span><span class="p">(</span><span class="n">lua_State</span> <span class="o">*</span><span class="n">l</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">const</span> <span class="kt">int</span> <span class="n">arg</span> <span class="o">=</span> <span class="n">lua_gettop</span><span class="p">(</span><span class="n">l</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">arg</span> <span class="o">&lt;</span> <span class="mi">6</span> <span class="o">||</span> <span class="n">arg</span> <span class="o">&gt;</span> <span class="mi">7</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">LuaError</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="s">&quot;incorrect argument&quot;</span><span class="p">);</span>
	<span class="p">}</span>

	<span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">name</span> <span class="o">=</span> <span class="n">LuaToString</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
	<span class="k">const</span> <span class="n">MissileType</span> <span class="o">*</span><span class="n">mtype</span> <span class="o">=</span> <span class="n">MissileTypeByIdent</span><span class="p">(</span><span class="n">name</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">mtype</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">LuaError</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="s">&quot;Bad missile&quot;</span><span class="p">);</span>
	<span class="p">}</span>
	<span class="n">PixelPos</span> <span class="n">startpos</span><span class="p">,</span> <span class="n">endpos</span><span class="p">;</span>
	<span class="n">CclGetPos</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">startpos</span><span class="p">.</span><span class="n">x</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">startpos</span><span class="p">.</span><span class="n">y</span><span class="p">,</span> <span class="mi">2</span><span class="p">);</span>
	<span class="n">CclGetPos</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">endpos</span><span class="p">.</span><span class="n">x</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">endpos</span><span class="p">.</span><span class="n">y</span><span class="p">,</span> <span class="mi">3</span><span class="p">);</span>

	<span class="k">const</span> <span class="kt">int</span> <span class="n">sourceUnitId</span> <span class="o">=</span> <span class="n">LuaToNumber</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">4</span><span class="p">);</span>
	<span class="k">const</span> <span class="kt">int</span> <span class="n">destUnitId</span> <span class="o">=</span> <span class="n">LuaToNumber</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">5</span><span class="p">);</span>
	<span class="k">const</span> <span class="kt">bool</span> <span class="n">dealDamage</span> <span class="o">=</span> <span class="n">LuaToBoolean</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">6</span><span class="p">);</span>
	<span class="k">const</span> <span class="kt">bool</span> <span class="n">mapRelative</span> <span class="o">=</span> <span class="n">arg</span> <span class="o">==</span> <span class="mi">7</span> <span class="o">?</span> <span class="n">LuaToBoolean</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">7</span><span class="p">)</span> <span class="o">:</span> <span class="nb">false</span><span class="p">;</span>
	<span class="n">CUnit</span> <span class="o">*</span><span class="n">sourceUnit</span> <span class="o">=</span> <span class="n">sourceUnitId</span> <span class="o">!=</span> <span class="mi">-1</span> <span class="o">?</span> <span class="o">&amp;</span><span class="n">UnitManager</span><span class="p">.</span><span class="n">GetSlotUnit</span><span class="p">(</span><span class="n">sourceUnitId</span><span class="p">)</span> <span class="o">:</span> <span class="nb">NULL</span><span class="p">;</span>
	<span class="n">CUnit</span> <span class="o">*</span><span class="n">destUnit</span> <span class="o">=</span> <span class="n">destUnitId</span> <span class="o">!=</span> <span class="mi">-1</span> <span class="o">?</span> <span class="o">&amp;</span><span class="n">UnitManager</span><span class="p">.</span><span class="n">GetSlotUnit</span><span class="p">(</span><span class="n">destUnitId</span><span class="p">)</span> <span class="o">:</span> <span class="nb">NULL</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">mapRelative</span> <span class="o">==</span> <span class="nb">false</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">sourceUnit</span> <span class="o">!=</span> <span class="nb">NULL</span><span class="p">)</span> <span class="p">{</span>
			<span class="n">startpos</span> <span class="o">+=</span> <span class="n">sourceUnit</span><span class="o">-&gt;</span><span class="n">GetMapPixelPosTopLeft</span><span class="p">();</span>
		<span class="p">}</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">destUnit</span> <span class="o">!=</span> <span class="nb">NULL</span><span class="p">)</span> <span class="p">{</span>
			<span class="n">endpos</span> <span class="o">+=</span> <span class="n">destUnit</span><span class="o">-&gt;</span><span class="n">GetMapPixelPosTopLeft</span><span class="p">();</span>
		<span class="p">}</span>
	<span class="p">}</span>

	<span class="n">Missile</span> <span class="o">*</span><span class="n">missile</span> <span class="o">=</span> <span class="n">MakeMissile</span><span class="p">(</span><span class="o">*</span><span class="n">mtype</span><span class="p">,</span> <span class="n">startpos</span><span class="p">,</span> <span class="n">endpos</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">missile</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">dealDamage</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">missile</span><span class="o">-&gt;</span><span class="n">SourceUnit</span> <span class="o">=</span> <span class="n">sourceUnit</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="n">missile</span><span class="o">-&gt;</span><span class="n">TargetUnit</span> <span class="o">=</span> <span class="n">destUnit</span><span class="p">;</span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</p>
                          </details>
                        </details>
                        <hr>/animation/animation.cpp<hr>
                        <details>
                        <summary>DefineAnimations</summary>
                        <p><br>  Define a unit-type animation set.<br><br>  @param l  Lua state.</p>
                          <details>
                          <summary>/animation/animation.cpp:747 CclDefineAnimations</summary>
                          <p><div class="highlight"><pre><span></span><span class="k">static</span> <span class="kt">int</span> <span class="nf">CclDefineAnimations</span><span class="p">(</span><span class="n">lua_State</span> <span class="o">*</span><span class="n">l</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">LuaCheckArgs</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">2</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">lua_istable</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span> <span class="p">{</span>
		<span class="n">LuaError</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="s">&quot;incorrect argument&quot;</span><span class="p">);</span>
	<span class="p">}</span>

	<span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">name</span> <span class="o">=</span> <span class="n">LuaToString</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
	<span class="n">CAnimations</span> <span class="o">*</span><span class="n">anims</span> <span class="o">=</span> <span class="n">AnimationsByIdent</span><span class="p">(</span><span class="n">name</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">anims</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">anims</span> <span class="o">=</span> <span class="k">new</span> <span class="n">CAnimations</span><span class="p">;</span>
		<span class="n">AnimationMap</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">anims</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="n">lua_pushnil</span><span class="p">(</span><span class="n">l</span><span class="p">);</span>
	<span class="k">while</span> <span class="p">(</span><span class="n">lua_next</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span> <span class="p">{</span>
		<span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">value</span> <span class="o">=</span> <span class="n">LuaToString</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">-2</span><span class="p">);</span>

		<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s">&quot;Start&quot;</span><span class="p">))</span> <span class="p">{</span>
			<span class="n">anims</span><span class="o">-&gt;</span><span class="n">Start</span> <span class="o">=</span> <span class="n">ParseAnimation</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">-1</span><span class="p">);</span>
		<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strncmp</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s">&quot;Still&quot;</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span> <span class="p">{</span>
			<span class="n">anims</span><span class="o">-&gt;</span><span class="n">Still</span> <span class="o">=</span> <span class="n">ParseAnimation</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">-1</span><span class="p">);</span>
		<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strncmp</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s">&quot;Death&quot;</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span> <span class="p">{</span>
			<span class="n">anims</span><span class="o">-&gt;</span><span class="n">hasDeathAnimation</span> <span class="o">=</span> <span class="nb">true</span><span class="p">;</span>
			<span class="k">if</span> <span class="p">(</span><span class="n">strlen</span><span class="p">(</span><span class="n">value</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">5</span><span class="p">)</span> <span class="p">{</span>
				<span class="k">const</span> <span class="kt">int</span> <span class="n">death</span> <span class="o">=</span> <span class="n">ExtraDeathIndex</span><span class="p">(</span><span class="n">value</span> <span class="o">+</span> <span class="mi">6</span><span class="p">);</span>
				<span class="k">if</span> <span class="p">(</span><span class="n">death</span> <span class="o">==</span> <span class="n">ANIMATIONS_DEATHTYPES</span><span class="p">)</span> <span class="p">{</span>
					<span class="n">anims</span><span class="o">-&gt;</span><span class="n">Death</span><span class="p">[</span><span class="n">ANIMATIONS_DEATHTYPES</span><span class="p">]</span> <span class="o">=</span> <span class="n">ParseAnimation</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">-1</span><span class="p">);</span>
				<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
					<span class="n">anims</span><span class="o">-&gt;</span><span class="n">Death</span><span class="p">[</span><span class="n">death</span><span class="p">]</span> <span class="o">=</span> <span class="n">ParseAnimation</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">-1</span><span class="p">);</span>
				<span class="p">}</span>
			<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
				<span class="n">anims</span><span class="o">-&gt;</span><span class="n">Death</span><span class="p">[</span><span class="n">ANIMATIONS_DEATHTYPES</span><span class="p">]</span> <span class="o">=</span> <span class="n">ParseAnimation</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">-1</span><span class="p">);</span>
			<span class="p">}</span>
		<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s">&quot;Attack&quot;</span><span class="p">))</span> <span class="p">{</span>
			<span class="n">anims</span><span class="o">-&gt;</span><span class="n">Attack</span> <span class="o">=</span> <span class="n">ParseAnimation</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">-1</span><span class="p">);</span>
		<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s">&quot;RangedAttack&quot;</span><span class="p">))</span> <span class="p">{</span>
			<span class="n">anims</span><span class="o">-&gt;</span><span class="n">RangedAttack</span> <span class="o">=</span> <span class="n">ParseAnimation</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">-1</span><span class="p">);</span>
		<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s">&quot;SpellCast&quot;</span><span class="p">))</span> <span class="p">{</span>
			<span class="n">anims</span><span class="o">-&gt;</span><span class="n">SpellCast</span> <span class="o">=</span> <span class="n">ParseAnimation</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">-1</span><span class="p">);</span>
		<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s">&quot;Move&quot;</span><span class="p">))</span> <span class="p">{</span>
			<span class="n">anims</span><span class="o">-&gt;</span><span class="n">Move</span> <span class="o">=</span> <span class="n">ParseAnimation</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">-1</span><span class="p">);</span>
		<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s">&quot;Repair&quot;</span><span class="p">))</span> <span class="p">{</span>
			<span class="n">anims</span><span class="o">-&gt;</span><span class="n">Repair</span> <span class="o">=</span> <span class="n">ParseAnimation</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">-1</span><span class="p">);</span>
		<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s">&quot;Train&quot;</span><span class="p">))</span> <span class="p">{</span>
			<span class="n">anims</span><span class="o">-&gt;</span><span class="n">Train</span> <span class="o">=</span> <span class="n">ParseAnimation</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">-1</span><span class="p">);</span>
		<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s">&quot;Research&quot;</span><span class="p">))</span> <span class="p">{</span>
			<span class="n">anims</span><span class="o">-&gt;</span><span class="n">Research</span> <span class="o">=</span> <span class="n">ParseAnimation</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">-1</span><span class="p">);</span>
		<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s">&quot;Upgrade&quot;</span><span class="p">))</span> <span class="p">{</span>
			<span class="n">anims</span><span class="o">-&gt;</span><span class="n">Upgrade</span> <span class="o">=</span> <span class="n">ParseAnimation</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">-1</span><span class="p">);</span>
		<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s">&quot;Build&quot;</span><span class="p">))</span> <span class="p">{</span>
			<span class="n">anims</span><span class="o">-&gt;</span><span class="n">Build</span> <span class="o">=</span> <span class="n">ParseAnimation</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">-1</span><span class="p">);</span>
		<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strncmp</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s">&quot;Harvest_&quot;</span><span class="p">,</span> <span class="mi">8</span><span class="p">))</span> <span class="p">{</span>
			<span class="k">const</span> <span class="kt">int</span> <span class="n">res</span> <span class="o">=</span> <span class="n">GetResourceIdByName</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">value</span> <span class="o">+</span> <span class="mi">8</span><span class="p">);</span>
			<span class="n">anims</span><span class="o">-&gt;</span><span class="n">Harvest</span><span class="p">[</span><span class="n">res</span><span class="p">]</span> <span class="o">=</span> <span class="n">ParseAnimation</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">-1</span><span class="p">);</span>
		<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
			<span class="n">LuaError</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="s">&quot;Unsupported animation: %s&quot;</span> <span class="n">_C_</span> <span class="n">value</span><span class="p">);</span>
		<span class="p">}</span>
		<span class="n">lua_pop</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
	<span class="p">}</span>
	<span class="c1">// Must add to array in a fixed order for save games</span>
	<span class="n">AddAnimationToArray</span><span class="p">(</span><span class="n">anims</span><span class="o">-&gt;</span><span class="n">Start</span><span class="p">);</span>
	<span class="n">AddAnimationToArray</span><span class="p">(</span><span class="n">anims</span><span class="o">-&gt;</span><span class="n">Still</span><span class="p">);</span>
	<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">!=</span> <span class="n">ANIMATIONS_DEATHTYPES</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">AddAnimationToArray</span><span class="p">(</span><span class="n">anims</span><span class="o">-&gt;</span><span class="n">Death</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span>
	<span class="p">}</span>
	<span class="n">AddAnimationToArray</span><span class="p">(</span><span class="n">anims</span><span class="o">-&gt;</span><span class="n">Attack</span><span class="p">);</span>
	<span class="n">AddAnimationToArray</span><span class="p">(</span><span class="n">anims</span><span class="o">-&gt;</span><span class="n">RangedAttack</span><span class="p">);</span>
	<span class="n">AddAnimationToArray</span><span class="p">(</span><span class="n">anims</span><span class="o">-&gt;</span><span class="n">SpellCast</span><span class="p">);</span>
	<span class="n">AddAnimationToArray</span><span class="p">(</span><span class="n">anims</span><span class="o">-&gt;</span><span class="n">Move</span><span class="p">);</span>
	<span class="n">AddAnimationToArray</span><span class="p">(</span><span class="n">anims</span><span class="o">-&gt;</span><span class="n">Repair</span><span class="p">);</span>
	<span class="n">AddAnimationToArray</span><span class="p">(</span><span class="n">anims</span><span class="o">-&gt;</span><span class="n">Train</span><span class="p">);</span>
	<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">!=</span> <span class="n">MaxCosts</span><span class="p">;</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">AddAnimationToArray</span><span class="p">(</span><span class="n">anims</span><span class="o">-&gt;</span><span class="n">Harvest</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span>
	<span class="p">}</span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</p>
                          </details>
                        </details>
                        <hr>/tolua/upgrade.pkg<hr>
                    <details>
                    <summary>class CUpgrade</summary>
                    <p></p>
                    <p><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">CUpgrade</span>
<span class="p">{</span>
  <span class="k">static</span> <span class="n">CUpgrade</span> <span class="o">*</span><span class="nf">New</span><span class="p">(</span><span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">ident</span><span class="p">);</span>
  <span class="k">static</span> <span class="n">CUpgrade</span> <span class="o">*</span><span class="nf">Get</span><span class="p">(</span><span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">ident</span><span class="p">);</span>

  <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">Name</span><span class="p">;</span>
  <span class="kt">int</span> <span class="n">Costs</span><span class="p">[</span><span class="n">MaxCosts</span><span class="p">];</span>
  <span class="n">CIcon</span> <span class="o">*</span><span class="n">Icon</span><span class="p">;</span>
<span class="p">};</span>
</pre></div>
</p>
                    </details>
                    <hr>/tolua/particle.pkg<hr>
                    <details>
                    <summary>class GraphicAnimation</summary>
                    <p></p>
                    <p><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">GraphicAnimation</span>
<span class="p">{</span>
	<span class="n">GraphicAnimation</span><span class="p">(</span><span class="n">CGraphic</span> <span class="o">*</span><span class="n">g</span><span class="p">,</span> <span class="kt">int</span> <span class="n">ticksPerFrame</span><span class="p">);</span>
	<span class="k">virtual</span> <span class="n">GraphicAnimation</span> <span class="o">*</span> <span class="nf">clone</span><span class="p">();</span>
<span class="p">};</span>
</pre></div>
</p>
                    </details>
                    
                    <details>
                    <summary>class CParticle</summary>
                    <p></p>
                    <p><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">CParticle</span>
<span class="p">{</span>
	<span class="k">virtual</span> <span class="n">CParticle</span><span class="o">*</span> <span class="nf">clone</span><span class="p">();</span>
	<span class="kt">void</span> <span class="nf">setDrawLevel</span><span class="p">(</span><span class="kt">int</span> <span class="n">value</span><span class="p">);</span>
<span class="p">};</span>
</pre></div>
</p>
                    </details>
                    
                    <details>
                    <summary>class StaticParticle : public CParticle</summary>
                    <p></p>
                    <p><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">StaticParticle</span> <span class="o">:</span> <span class="k">public</span> <span class="n">CParticle</span>
<span class="p">{</span>
<span class="k">public</span><span class="o">:</span>
	<span class="n">StaticParticle</span><span class="p">(</span><span class="n">CPosition</span> <span class="n">position</span><span class="p">,</span> <span class="n">GraphicAnimation</span> <span class="o">*</span><span class="n">animation</span><span class="p">,</span> <span class="kt">int</span> <span class="n">drawlevel</span> <span class="o">=</span> <span class="mi">0</span><span class="p">);</span>
<span class="p">};</span>
</pre></div>
</p>
                    </details>
                    
                    <details>
                    <summary>class CChunkParticle : public CParticle</summary>
                    <p></p>
                    <p><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">CChunkParticle</span> <span class="o">:</span> <span class="k">public</span> <span class="n">CParticle</span>
<span class="p">{</span>
<span class="k">public</span><span class="o">:</span>
	<span class="n">CChunkParticle</span><span class="p">(</span><span class="n">CPosition</span> <span class="n">position</span><span class="p">,</span> <span class="n">GraphicAnimation</span> <span class="o">*</span><span class="n">smokeAnimation</span><span class="p">,</span> <span class="n">GraphicAnimation</span> <span class="o">*</span><span class="n">debrisAnimation</span><span class="p">,</span> <span class="n">GraphicAnimation</span> <span class="o">*</span><span class="n">destroyAnimation</span><span class="p">,</span> <span class="kt">int</span> <span class="n">minVelocity</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="kt">int</span> <span class="n">maxVelocity</span> <span class="o">=</span> <span class="mi">400</span><span class="p">,</span> <span class="kt">int</span> <span class="n">minTrajectoryAngle</span> <span class="o">=</span> <span class="mi">77</span><span class="p">,</span> <span class="kt">int</span> <span class="n">maxTTL</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="kt">int</span> <span class="n">drawlevel</span> <span class="o">=</span> <span class="mi">0</span><span class="p">);</span>
	<span class="kt">int</span> <span class="nf">getSmokeDrawLevel</span><span class="p">()</span> <span class="k">const</span><span class="p">;</span>
	<span class="kt">int</span> <span class="nf">getDestroyDrawLevel</span><span class="p">()</span> <span class="k">const</span><span class="p">;</span>
	<span class="kt">void</span> <span class="nf">setSmokeDrawLevel</span><span class="p">(</span><span class="kt">int</span> <span class="n">value</span><span class="p">);</span>
	<span class="kt">void</span> <span class="nf">setDestroyDrawLevel</span><span class="p">(</span><span class="kt">int</span> <span class="n">value</span><span class="p">);</span>
<span class="p">};</span>
</pre></div>
</p>
                    </details>
                    
                    <details>
                    <summary>class CSmokeParticle : public CParticle</summary>
                    <p></p>
                    <p><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">CSmokeParticle</span> <span class="o">:</span> <span class="k">public</span> <span class="n">CParticle</span>
<span class="p">{</span>
<span class="k">public</span><span class="o">:</span>
	<span class="n">CSmokeParticle</span><span class="p">(</span><span class="n">CPosition</span> <span class="n">position</span><span class="p">,</span> <span class="n">GraphicAnimation</span> <span class="o">*</span><span class="n">animation</span><span class="p">,</span> <span class="kt">float</span> <span class="n">speedx</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="kt">float</span> <span class="n">speedy</span> <span class="o">=</span> <span class="mf">-22.0</span><span class="p">,</span> <span class="kt">int</span> <span class="n">drawlevel</span> <span class="o">=</span> <span class="mi">0</span><span class="p">);</span>
<span class="p">};</span>
</pre></div>
</p>
                    </details>
                    
                    <details>
                    <summary>class CRadialParticle : public CParticle</summary>
                    <p></p>
                    <p><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">CRadialParticle</span> <span class="o">:</span> <span class="k">public</span> <span class="n">CParticle</span>
<span class="p">{</span>
<span class="k">public</span><span class="o">:</span>
	<span class="n">CRadialParticle</span><span class="p">(</span><span class="n">CPosition</span> <span class="n">position</span><span class="p">,</span> <span class="n">GraphicAnimation</span> <span class="o">*</span><span class="n">smokeAnimation</span><span class="p">,</span> <span class="kt">int</span> <span class="n">maxSpeed</span><span class="p">,</span> <span class="kt">int</span> <span class="n">drawlevel</span> <span class="o">=</span> <span class="mi">0</span><span class="p">);</span>
<span class="p">};</span>
</pre></div>
</p>
                    </details>
                    
                    <details>
                    <summary>class CParticleManager</summary>
                    <p></p>
                    <p><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">CParticleManager</span>
<span class="p">{</span>
<span class="k">public</span><span class="o">:</span>
	<span class="n">CParticleManager</span><span class="p">();</span>
	<span class="o">~</span><span class="n">CParticleManager</span><span class="p">();</span>

	<span class="kt">void</span> <span class="nf">add</span><span class="p">(</span><span class="n">CParticle</span> <span class="o">*</span><span class="n">particle</span><span class="p">);</span>
<span class="p">};</span>
</pre></div>
</p>
                    </details>
                    
                    <details>
                    <summary>CParticleManager ParticleManager</summary>
                    <p></p>
                    </details>
                    <hr>/tolua/ui.pkg<hr>
                    <details>
                    <summary>enum ViewportModeType {</summary>
                    <p></p>
                    <p><div class="highlight"><pre><span></span><span class="k">enum</span> <span class="nc">ViewportModeType</span> <span class="p">{</span>
	<span class="n">VIEWPORT_SINGLE</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
	<span class="n">VIEWPORT_SPLIT_HORIZ</span><span class="p">,</span>
	<span class="n">VIEWPORT_SPLIT_HORIZ3</span><span class="p">,</span>
	<span class="n">VIEWPORT_SPLIT_VERT</span><span class="p">,</span>
	<span class="n">VIEWPORT_QUAD</span>
<span class="p">};</span>
</pre></div>
</p>
                    </details>
                    
                    <details>
                    <summary>class LuaActionListener</summary>
                    <p></p>
                    <p><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">LuaActionListener</span>
<span class="p">{</span>
	<span class="n">LuaActionListener</span><span class="p">(</span><span class="n">lua_State</span> <span class="o">*</span><span class="n">lua</span><span class="p">,</span> <span class="n">lua_Object</span> <span class="n">luaref</span><span class="p">);</span>
<span class="p">};</span>
</pre></div>
</p>
                    </details>
                    
                    <details>
                    <summary>class CUIButton</summary>
                    <p></p>
                    <p><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">CUIButton</span>
<span class="p">{</span>
	<span class="n">CUIButton</span><span class="p">();</span>

	<span class="kt">int</span> <span class="n">X</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">Y</span><span class="p">;</span>
	<span class="n">string</span> <span class="n">Text</span><span class="p">;</span>
	<span class="n">ButtonStyle</span> <span class="o">*</span><span class="n">Style</span><span class="p">;</span>
	<span class="n">LuaActionListener</span> <span class="o">*</span><span class="n">Callback</span><span class="p">;</span>
<span class="p">};</span>
</pre></div>
</p>
                    </details>
                    
                    <details>
                    <summary>class CMapArea</summary>
                    <p></p>
                    <p><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">CMapArea</span>
<span class="p">{</span>
	<span class="kt">int</span> <span class="n">X</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">Y</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">EndX</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">EndY</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">ScrollPaddingLeft</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">ScrollPaddingRight</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">ScrollPaddingTop</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">ScrollPaddingBottom</span><span class="p">;</span>
<span class="p">};</span>
</pre></div>
</p>
                    </details>
                    
                    <details>
                    <summary>class CViewport</summary>
                    <p></p>
                    <p><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">CViewport</span>
<span class="p">{</span>
<span class="p">};</span>
</pre></div>
</p>
                    </details>
                    
                    <details>
                    <summary>class CFiller</summary>
                    <p></p>
                    <p><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">CFiller</span>
<span class="p">{</span>
	<span class="n">CFiller</span><span class="p">();</span>

	<span class="n">CGraphic</span> <span class="o">*</span><span class="n">G</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">X</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">Y</span><span class="p">;</span>
<span class="p">};</span>
</pre></div>
</p>
                    </details>
                    
                    <details>
                    <summary>class vector</summary>
                    <p></p>
                    <p><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">vector</span>
<span class="p">{</span>
	<span class="n">TOLUA_TEMPLATE_BIND</span><span class="p">(</span><span class="n">T</span><span class="p">,</span> <span class="n">CFiller</span><span class="p">,</span> <span class="n">CUIButton</span><span class="p">,</span> <span class="n">CUIUserButton</span><span class="p">,</span> <span class="n">string</span><span class="p">)</span>

	<span class="n">vector</span><span class="p">();</span>
	<span class="o">~</span><span class="n">vector</span><span class="p">();</span>

	<span class="k">const</span> <span class="n">T</span><span class="o">&amp;</span> <span class="k">operator</span><span class="p">[](</span><span class="kt">int</span> <span class="n">index</span><span class="p">)</span> <span class="k">const</span><span class="p">;</span>
	<span class="n">T</span><span class="o">&amp;</span> <span class="k">operator</span><span class="p">[](</span><span class="kt">int</span> <span class="n">index</span><span class="p">);</span>
	<span class="k">const</span> <span class="n">T</span><span class="o">&amp;</span> <span class="nf">at</span><span class="p">(</span><span class="kt">int</span> <span class="n">index</span><span class="p">)</span> <span class="k">const</span><span class="p">;</span>
	<span class="n">T</span><span class="o">&amp;</span> <span class="nf">at</span><span class="p">(</span><span class="kt">int</span> <span class="n">index</span><span class="p">);</span>

	<span class="k">const</span> <span class="n">T</span><span class="o">&amp;</span> <span class="nf">front</span><span class="p">()</span> <span class="k">const</span><span class="p">;</span>
	<span class="n">T</span><span class="o">&amp;</span> <span class="nf">front</span><span class="p">();</span>
	<span class="k">const</span> <span class="n">T</span><span class="o">&amp;</span> <span class="nf">back</span><span class="p">()</span> <span class="k">const</span><span class="p">;</span>
	<span class="n">T</span><span class="o">&amp;</span> <span class="nf">back</span><span class="p">();</span>

	<span class="kt">void</span> <span class="nf">push_back</span><span class="p">(</span><span class="n">T</span> <span class="n">val</span><span class="p">);</span>
	<span class="kt">void</span> <span class="nf">pop_back</span><span class="p">();</span>

	<span class="kt">void</span> <span class="nf">assign</span><span class="p">(</span><span class="kt">int</span> <span class="n">num</span><span class="p">,</span> <span class="k">const</span> <span class="n">T</span><span class="o">&amp;</span> <span class="n">val</span><span class="p">);</span>
	<span class="kt">void</span> <span class="nf">clear</span><span class="p">();</span>
	<span class="kt">bool</span> <span class="nf">empty</span><span class="p">()</span> <span class="k">const</span><span class="p">;</span>
	<span class="kt">int</span> <span class="nf">size</span><span class="p">()</span> <span class="k">const</span><span class="p">;</span>
<span class="p">};</span>
</pre></div>
</p>
                    </details>
                    
                    <details>
                    <summary>class CButtonPanel</summary>
                    <p></p>
                    <p><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">CButtonPanel</span>
<span class="p">{</span>
	<span class="kt">int</span> <span class="n">X</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">Y</span><span class="p">;</span>
	<span class="n">vector</span><span class="o">&lt;</span><span class="n">CUIButton</span><span class="o">&gt;</span> <span class="n">Buttons</span><span class="p">;</span>
	<span class="n">CColor</span> <span class="n">AutoCastBorderColorRGB</span><span class="p">;</span>
	<span class="kt">bool</span> <span class="n">ShowCommandKey</span><span class="p">;</span>
<span class="p">};</span>
</pre></div>
</p>
                    </details>
                    
                    <details>
                    <summary>class CPieMenu</summary>
                    <p></p>
                    <p><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">CPieMenu</span>
<span class="p">{</span>
	<span class="n">CGraphic</span> <span class="o">*</span><span class="n">G</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">MouseButton</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">X</span><span class="p">[</span><span class="mi">8</span><span class="p">];</span>
	<span class="kt">int</span> <span class="n">Y</span><span class="p">[</span><span class="mi">8</span><span class="p">];</span>

	<span class="kt">void</span> <span class="nf">SetRadius</span><span class="p">(</span><span class="kt">int</span> <span class="n">radius</span><span class="p">);</span>
<span class="p">};</span>
</pre></div>
</p>
                    </details>
                    
                    <details>
                    <summary>class CResourceInfo</summary>
                    <p></p>
                    <p><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">CResourceInfo</span>
<span class="p">{</span>
	<span class="n">CGraphic</span> <span class="o">*</span><span class="n">G</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">IconFrame</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">IconX</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">IconY</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">IconWidth</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">TextX</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">TextY</span><span class="p">;</span>
<span class="p">};</span>
</pre></div>
</p>
                    </details>
                    
                    <details>
                    <summary>class CInfoPanel</summary>
                    <p></p>
                    <p><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">CInfoPanel</span>
<span class="p">{</span>
	<span class="n">CGraphic</span> <span class="o">*</span><span class="n">G</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">X</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">Y</span><span class="p">;</span>
<span class="p">};</span>
</pre></div>
</p>
                    </details>
                    
                    <details>
                    <summary>class CUIUserButton</summary>
                    <p></p>
                    <p><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">CUIUserButton</span>
<span class="p">{</span>
	<span class="n">CUIUserButton</span><span class="p">();</span> 

	<span class="kt">bool</span> <span class="n">Clicked</span><span class="p">;</span>
	<span class="n">CUIButton</span> <span class="n">Button</span><span class="p">;</span>
<span class="p">};</span>
</pre></div>
</p>
                    </details>
                    
                    <details>
                    <summary>class CStatusLine</summary>
                    <p></p>
                    <p><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">CStatusLine</span>
<span class="p">{</span>
	<span class="kt">void</span> <span class="nf">Set</span><span class="p">(</span><span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">status</span><span class="p">);</span>
	<span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="o">&amp;</span><span class="nf">Get</span><span class="p">();</span>
	<span class="kt">void</span> <span class="nf">Clear</span><span class="p">();</span>

	<span class="kt">int</span> <span class="n">Width</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">TextX</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">TextY</span><span class="p">;</span>
	<span class="n">CFont</span> <span class="o">*</span><span class="n">Font</span><span class="p">;</span>
<span class="p">};</span>
</pre></div>
</p>
                    </details>
                    
                    <details>
                    <summary>class CUITimer</summary>
                    <p></p>
                    <p><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">CUITimer</span>
<span class="p">{</span>
	<span class="kt">int</span> <span class="n">X</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">Y</span><span class="p">;</span>
	<span class="n">CFont</span> <span class="o">*</span><span class="n">Font</span><span class="p">;</span>
<span class="p">};</span>
</pre></div>
</p>
                    </details>
                    
                    <details>
                    <summary>class CUserInterface</summary>
                    <p></p>
                    <p><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">CUserInterface</span>
<span class="p">{</span>
	<span class="n">string</span> <span class="n">NormalFontColor</span><span class="p">;</span>
	<span class="n">string</span> <span class="n">ReverseFontColor</span><span class="p">;</span>

	<span class="n">vector</span><span class="o">&lt;</span><span class="n">CFiller</span><span class="o">&gt;</span> <span class="n">Fillers</span><span class="p">;</span>

	<span class="n">CResourceInfo</span> <span class="n">Resources</span><span class="p">[</span><span class="n">MaxResourceInfo</span><span class="p">];</span>
	<span class="n">CInfoPanel</span> <span class="n">InfoPanel</span><span class="p">;</span>
	<span class="n">CUIButton</span> <span class="o">*</span><span class="n">SingleSelectedButton</span><span class="p">;</span>

	<span class="n">vector</span><span class="o">&lt;</span><span class="n">CUIButton</span><span class="o">&gt;</span> <span class="n">SelectedButtons</span><span class="p">;</span>
	<span class="n">CFont</span> <span class="o">*</span><span class="n">MaxSelectedFont</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">MaxSelectedTextX</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">MaxSelectedTextY</span><span class="p">;</span>

	<span class="n">CUIButton</span> <span class="o">*</span><span class="n">SingleTrainingButton</span><span class="p">;</span>
	<span class="n">vector</span><span class="o">&lt;</span><span class="n">CUIButton</span><span class="o">&gt;</span> <span class="n">TrainingButtons</span><span class="p">;</span>
	<span class="n">CUIButton</span> <span class="o">*</span><span class="n">UpgradingButton</span><span class="p">;</span>
	<span class="n">CUIButton</span> <span class="o">*</span><span class="n">ResearchingButton</span><span class="p">;</span>
	<span class="n">vector</span><span class="o">&lt;</span><span class="n">CUIButton</span><span class="o">&gt;</span> <span class="n">TransportingButtons</span><span class="p">;</span>

        <span class="n">vector</span><span class="o">&lt;</span><span class="n">string</span><span class="o">&gt;</span> <span class="n">LifeBarColorNames</span><span class="p">;</span>
        <span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span> <span class="n">LifeBarPercents</span><span class="p">;</span>
        <span class="kt">int</span> <span class="n">LifeBarYOffset</span><span class="p">;</span>
		<span class="kt">int</span> <span class="n">LifeBarPadding</span><span class="p">;</span>
        <span class="kt">bool</span> <span class="n">LifeBarBorder</span><span class="p">;</span>

	<span class="n">CColor</span> <span class="n">CompletedBarColorRGB</span><span class="p">;</span>
	<span class="kt">bool</span> <span class="n">CompletedBarShadow</span><span class="p">;</span>

	<span class="n">CButtonPanel</span> <span class="n">ButtonPanel</span><span class="p">;</span>

	<span class="n">CPieMenu</span> <span class="n">PieMenu</span><span class="p">;</span>

	<span class="n">CViewport</span> <span class="o">*</span><span class="n">MouseViewport</span><span class="p">;</span>
	<span class="n">CMapArea</span> <span class="n">MapArea</span><span class="p">;</span>

	<span class="n">CFont</span> <span class="o">*</span><span class="n">MessageFont</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">MessageScrollSpeed</span><span class="p">;</span>

	<span class="n">CUIButton</span> <span class="n">MenuButton</span><span class="p">;</span>
	<span class="n">CUIButton</span> <span class="n">NetworkMenuButton</span><span class="p">;</span>
	<span class="n">CUIButton</span> <span class="n">NetworkDiplomacyButton</span><span class="p">;</span>

	<span class="n">vector</span><span class="o">&lt;</span><span class="n">CUIUserButton</span><span class="o">&gt;</span> <span class="n">UserButtons</span><span class="p">;</span>

	<span class="n">CMinimap</span> <span class="n">Minimap</span><span class="p">;</span>
	<span class="n">CStatusLine</span> <span class="n">StatusLine</span><span class="p">;</span>
	<span class="n">CUITimer</span> <span class="n">Timer</span><span class="p">;</span>

	<span class="n">Vec2i</span> <span class="n">EditorSettingsAreaTopLeft</span><span class="p">;</span>
	<span class="n">Vec2i</span> <span class="n">EditorSettingsAreaBottomRight</span><span class="p">;</span>
	<span class="n">Vec2i</span> <span class="n">EditorButtonAreaTopLeft</span><span class="p">;</span>
	<span class="n">Vec2i</span> <span class="n">EditorButtonAreaBottomRight</span><span class="p">;</span>
<span class="p">};</span>
</pre></div>
</p>
                    </details>
                    
                    <details>
                    <summary>CUserInterface UI</summary>
                    <p></p>
                    </details>
                    
                    <details>
                    <summary>class CIcon</summary>
                    <p></p>
                    <p><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">CIcon</span>
<span class="p">{</span>
	<span class="k">static</span> <span class="n">CIcon</span> <span class="o">*</span><span class="nf">New</span><span class="p">(</span><span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">ident</span><span class="p">);</span>
	<span class="k">static</span> <span class="n">CIcon</span> <span class="o">*</span><span class="nf">Get</span><span class="p">(</span><span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">ident</span><span class="p">);</span>

	<span class="n">tolua_readonly</span> <span class="n">tolua_property__s</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">Ident</span><span class="p">;</span>
	<span class="n">CPlayerColorGraphic</span> <span class="o">*</span><span class="n">G</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">Frame</span><span class="p">;</span>
<span class="p">};</span>
</pre></div>
</p>
                    </details>
                    
                    <details>
                    <summary>ButtonStyle *FindButtonStyle(const std::string style)</summary>
                    <p></p>
                    </details>
                    
                    <details>
                    <summary>bool GetMouseScroll(void)</summary>
                    <p></p>
                    </details>
                    
                    <details>
                    <summary>SetMouseScroll(bool enabled)</summary>
                    <p></p>
                    </details>
                    
                    <details>
                    <summary>bool GetKeyScroll(void)</summary>
                    <p></p>
                    </details>
                    
                    <details>
                    <summary>SetKeyScroll(bool enabled)</summary>
                    <p></p>
                    </details>
                    
                    <details>
                    <summary>bool GetGrabMouse(void)</summary>
                    <p></p>
                    </details>
                    
                    <details>
                    <summary>SetGrabMouse(bool enabled)</summary>
                    <p></p>
                    </details>
                    
                    <details>
                    <summary>bool GetLeaveStops(void)</summary>
                    <p></p>
                    </details>
                    
                    <details>
                    <summary>SetLeaveStops(bool enabled)</summary>
                    <p></p>
                    </details>
                    
                    <details>
                    <summary>int GetDoubleClickDelay(void)</summary>
                    <p></p>
                    </details>
                    
                    <details>
                    <summary>SetDoubleClickDelay(int delay)</summary>
                    <p></p>
                    </details>
                    
                    <details>
                    <summary>int GetHoldClickDelay(void)</summary>
                    <p></p>
                    </details>
                    
                    <details>
                    <summary>SetHoldClickDelay(int delay)</summary>
                    <p></p>
                    </details>
                    
                    <details>
                    <summary>PixelPos CursorScreenPos</summary>
                    <p></p>
                    </details>
                    
                    <details>
                    <summary>class Color</summary>
                    <p></p>
                    <p><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Color</span>
<span class="p">{</span>
	<span class="n">Color</span><span class="p">(</span><span class="kt">int</span> <span class="n">r</span><span class="p">,</span> <span class="kt">int</span> <span class="n">g</span><span class="p">,</span> <span class="kt">int</span> <span class="n">b</span><span class="p">,</span> <span class="kt">int</span> <span class="n">a</span> <span class="o">=</span> <span class="mi">255</span><span class="p">);</span>
	<span class="kt">int</span> <span class="n">r</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">g</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">b</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">a</span><span class="p">;</span>
<span class="p">};</span>
</pre></div>
</p>
                    </details>
                    
                    <details>
                    <summary>class Graphics</summary>
                    <p></p>
                    <p><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Graphics</span>
<span class="p">{</span>
	<span class="k">enum</span> <span class="p">{</span>
		<span class="n">LEFT</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
		<span class="n">CENTER</span><span class="p">,</span>
		<span class="n">RIGHT</span>
	<span class="p">};</span>
</pre></div>
</p>
                    </details>
                    
                    <details>
                    <summary>class Widget</summary>
                    <p></p>
                    <p><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Widget</span>
<span class="p">{</span>
	<span class="k">virtual</span> <span class="kt">void</span> <span class="nf">setWidth</span><span class="p">(</span><span class="kt">int</span> <span class="n">width</span><span class="p">);</span>
	<span class="k">virtual</span> <span class="kt">int</span> <span class="nf">getWidth</span><span class="p">()</span> <span class="k">const</span><span class="p">;</span>
	<span class="k">virtual</span> <span class="kt">void</span> <span class="nf">setHeight</span><span class="p">(</span><span class="kt">int</span> <span class="n">height</span><span class="p">);</span>
	<span class="k">virtual</span> <span class="kt">int</span> <span class="nf">getHeight</span><span class="p">()</span> <span class="k">const</span><span class="p">;</span>
	<span class="k">virtual</span> <span class="kt">void</span> <span class="nf">setSize</span><span class="p">(</span><span class="kt">int</span> <span class="n">width</span><span class="p">,</span> <span class="kt">int</span> <span class="n">height</span><span class="p">);</span>
	<span class="k">virtual</span> <span class="kt">void</span> <span class="nf">setX</span><span class="p">(</span><span class="kt">int</span> <span class="n">x</span><span class="p">);</span>
	<span class="k">virtual</span> <span class="kt">int</span> <span class="nf">getX</span><span class="p">()</span> <span class="k">const</span><span class="p">;</span>
	<span class="k">virtual</span> <span class="kt">void</span> <span class="nf">setY</span><span class="p">(</span><span class="kt">int</span> <span class="n">y</span><span class="p">);</span>
	<span class="k">virtual</span> <span class="kt">int</span> <span class="nf">getY</span><span class="p">()</span> <span class="k">const</span><span class="p">;</span>
	<span class="k">virtual</span> <span class="kt">void</span> <span class="nf">setPosition</span><span class="p">(</span><span class="kt">int</span> <span class="n">x</span><span class="p">,</span> <span class="kt">int</span> <span class="n">y</span><span class="p">);</span>
	<span class="k">virtual</span> <span class="kt">void</span> <span class="nf">setBorderSize</span><span class="p">(</span><span class="kt">int</span> <span class="n">width</span><span class="p">);</span>
	<span class="k">virtual</span> <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">getBorderSize</span><span class="p">()</span> <span class="k">const</span><span class="p">;</span>
	<span class="k">virtual</span> <span class="kt">void</span> <span class="nf">setEnabled</span><span class="p">(</span><span class="kt">bool</span> <span class="n">enabled</span><span class="p">);</span>
	<span class="k">virtual</span> <span class="kt">bool</span> <span class="nf">isEnabled</span><span class="p">()</span> <span class="k">const</span><span class="p">;</span>
	<span class="k">virtual</span> <span class="kt">void</span> <span class="nf">setVisible</span><span class="p">(</span><span class="kt">bool</span> <span class="n">visible</span><span class="p">);</span>
	<span class="k">virtual</span> <span class="kt">bool</span> <span class="nf">isVisible</span><span class="p">()</span> <span class="k">const</span><span class="p">;</span>

	<span class="k">virtual</span> <span class="kt">void</span> <span class="nf">setBaseColor</span><span class="p">(</span><span class="k">const</span> <span class="n">Color</span> <span class="n">color</span><span class="p">);</span>
	<span class="k">virtual</span> <span class="k">const</span> <span class="n">Color</span> <span class="o">&amp;</span><span class="nf">getBaseColor</span><span class="p">()</span> <span class="k">const</span><span class="p">;</span>
	<span class="k">virtual</span> <span class="kt">void</span> <span class="nf">setForegroundColor</span><span class="p">(</span><span class="k">const</span> <span class="n">Color</span> <span class="n">color</span><span class="p">);</span>
	<span class="k">virtual</span> <span class="k">const</span> <span class="n">Color</span> <span class="o">&amp;</span><span class="nf">getForegroundColor</span><span class="p">()</span> <span class="k">const</span><span class="p">;</span>
	<span class="k">virtual</span> <span class="kt">void</span> <span class="nf">setBackgroundColor</span><span class="p">(</span><span class="k">const</span> <span class="n">Color</span> <span class="n">color</span><span class="p">);</span>
	<span class="k">virtual</span> <span class="k">const</span> <span class="n">Color</span> <span class="o">&amp;</span><span class="nf">getBackgroundColor</span><span class="p">()</span> <span class="k">const</span><span class="p">;</span>
	<span class="k">virtual</span> <span class="kt">void</span> <span class="nf">setDisabledColor</span><span class="p">(</span><span class="k">const</span> <span class="n">Color</span> <span class="n">color</span><span class="p">);</span>
	<span class="k">virtual</span> <span class="k">const</span> <span class="n">Color</span> <span class="o">&amp;</span><span class="nf">getDisabledColor</span><span class="p">()</span> <span class="k">const</span><span class="p">;</span>

	<span class="k">static</span> <span class="kt">void</span> <span class="nf">setGlobalFont</span><span class="p">(</span><span class="n">CFont</span> <span class="o">*</span><span class="n">font</span><span class="p">);</span>
	<span class="k">virtual</span> <span class="kt">void</span> <span class="nf">setForegroundColor</span><span class="p">(</span><span class="k">const</span> <span class="n">Color</span> <span class="n">color</span><span class="p">);</span>
	<span class="k">virtual</span> <span class="kt">void</span> <span class="nf">setBackgroundColor</span><span class="p">(</span><span class="k">const</span> <span class="n">Color</span> <span class="n">color</span><span class="p">);</span>
	<span class="k">virtual</span> <span class="kt">void</span> <span class="nf">setBaseColor</span><span class="p">(</span><span class="k">const</span> <span class="n">Color</span> <span class="n">color</span><span class="p">);</span>
	<span class="k">virtual</span> <span class="kt">void</span> <span class="nf">setSize</span><span class="p">(</span><span class="kt">int</span> <span class="n">width</span><span class="p">,</span> <span class="kt">int</span> <span class="n">height</span><span class="p">);</span>
	<span class="k">virtual</span> <span class="kt">void</span> <span class="nf">setBorderSize</span><span class="p">(</span><span class="kt">int</span> <span class="n">width</span><span class="p">);</span>
	<span class="k">virtual</span> <span class="kt">void</span> <span class="nf">setFont</span><span class="p">(</span><span class="n">CFont</span> <span class="o">*</span><span class="n">font</span><span class="p">);</span>

	<span class="k">virtual</span> <span class="kt">int</span> <span class="nf">getHotKey</span><span class="p">()</span> <span class="k">const</span><span class="p">;</span>
	<span class="k">virtual</span> <span class="kt">void</span> <span class="nf">setHotKey</span><span class="p">(</span><span class="k">const</span> <span class="kt">int</span> <span class="n">key</span><span class="p">);</span>
	<span class="k">virtual</span> <span class="kt">void</span> <span class="nf">setHotKey</span><span class="p">(</span><span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">key</span><span class="p">);</span>

        <span class="k">virtual</span> <span class="kt">void</span> <span class="nf">requestFocus</span><span class="p">();</span>

	<span class="k">virtual</span> <span class="kt">void</span> <span class="nf">addActionListener</span><span class="p">(</span><span class="n">LuaActionListener</span> <span class="o">*</span><span class="n">actionListener</span><span class="p">);</span>
        <span class="k">virtual</span> <span class="kt">void</span> <span class="nf">addMouseListener</span><span class="p">(</span><span class="n">LuaActionListener</span> <span class="o">*</span><span class="n">actionListener</span><span class="p">);</span>
        <span class="k">virtual</span> <span class="kt">void</span> <span class="nf">addKeyListener</span><span class="p">(</span><span class="n">LuaActionListener</span> <span class="o">*</span><span class="n">actionListener</span><span class="p">);</span>
<span class="p">};</span>
</pre></div>
</p>
                    </details>
                    
                    <details>
                    <summary>class BasicContainer : public Widget</summary>
                    <p></p>
                    <p><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">BasicContainer</span> <span class="o">:</span> <span class="k">public</span> <span class="n">Widget</span>
<span class="p">{</span>
<span class="p">};</span>
</pre></div>
</p>
                    </details>
                    
                    <details>
                    <summary>class ScrollArea : public BasicContainer</summary>
                    <p></p>
                    <p><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">ScrollArea</span> <span class="o">:</span> <span class="k">public</span> <span class="n">BasicContainer</span>
<span class="p">{</span>
	<span class="n">ScrollArea</span><span class="p">();</span>
	<span class="k">virtual</span> <span class="kt">void</span> <span class="nf">setContent</span><span class="p">(</span><span class="n">Widget</span> <span class="o">*</span><span class="n">widget</span><span class="p">);</span>
	<span class="k">virtual</span> <span class="n">Widget</span> <span class="o">*</span><span class="nf">getContent</span><span class="p">();</span>
	<span class="k">virtual</span> <span class="kt">void</span> <span class="nf">setScrollbarWidth</span><span class="p">(</span><span class="kt">int</span> <span class="n">width</span><span class="p">);</span>
	<span class="k">virtual</span> <span class="kt">int</span> <span class="nf">getScrollbarWidth</span><span class="p">();</span>
        <span class="k">virtual</span> <span class="kt">void</span> <span class="nf">scrollToBottom</span><span class="p">();</span>
        <span class="k">virtual</span> <span class="kt">void</span> <span class="nf">scrollToTop</span><span class="p">();</span>
<span class="p">};</span>
</pre></div>
</p>
                    </details>
                    
                    <details>
                    <summary>class ImageWidget : public Widget</summary>
                    <p></p>
                    <p><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">ImageWidget</span> <span class="o">:</span> <span class="k">public</span> <span class="n">Widget</span>
<span class="p">{</span>
	<span class="n">ImageWidget</span><span class="p">(</span><span class="n">CGraphic</span> <span class="o">*</span><span class="n">image</span><span class="p">);</span>
        <span class="n">ImageWidget</span><span class="p">(</span><span class="n">Mng</span> <span class="o">*</span><span class="n">image</span><span class="p">);</span>
        <span class="n">ImageWidget</span><span class="p">(</span><span class="n">Movie</span> <span class="o">*</span><span class="n">image</span><span class="p">);</span>
<span class="p">};</span>
</pre></div>
</p>
                    </details>
                    
                    <details>
                    <summary>class Button : public Widget</summary>
                    <p></p>
                    <p><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Button</span> <span class="o">:</span> <span class="k">public</span> <span class="n">Widget</span>
<span class="p">{</span>
<span class="p">};</span>
</pre></div>
</p>
                    </details>
                    
                    <details>
                    <summary>class ButtonWidget : public Button</summary>
                    <p></p>
                    <p><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">ButtonWidget</span> <span class="o">:</span> <span class="k">public</span> <span class="n">Button</span>
<span class="p">{</span>
	<span class="n">ButtonWidget</span><span class="p">(</span><span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">caption</span><span class="p">);</span>
	<span class="k">virtual</span> <span class="kt">void</span> <span class="nf">setCaption</span><span class="p">(</span><span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">caption</span><span class="p">);</span>
	<span class="k">virtual</span> <span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="o">&amp;</span><span class="nf">getCaption</span><span class="p">()</span> <span class="k">const</span><span class="p">;</span>
	<span class="k">virtual</span> <span class="kt">void</span> <span class="nf">adjustSize</span><span class="p">();</span>
<span class="p">};</span>
</pre></div>
</p>
                    </details>
                    
                    <details>
                    <summary>class ImageButton : public Button</summary>
                    <p></p>
                    <p><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">ImageButton</span> <span class="o">:</span> <span class="k">public</span> <span class="n">Button</span>
<span class="p">{</span>
	<span class="n">ImageButton</span><span class="p">();</span>
	<span class="n">ImageButton</span><span class="p">(</span><span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">caption</span><span class="p">);</span>

	<span class="kt">void</span> <span class="nf">setNormalImage</span><span class="p">(</span><span class="n">CGraphic</span> <span class="o">*</span><span class="n">image</span><span class="p">);</span>
	<span class="kt">void</span> <span class="nf">setPressedImage</span><span class="p">(</span><span class="n">CGraphic</span> <span class="o">*</span><span class="n">image</span><span class="p">);</span>
	<span class="kt">void</span> <span class="nf">setDisabledImage</span><span class="p">(</span><span class="n">CGraphic</span> <span class="o">*</span><span class="n">image</span><span class="p">);</span>
<span class="p">};</span>
</pre></div>
</p>
                    </details>
                    
                    <details>
                    <summary>class RadioButton : public Widget</summary>
                    <p></p>
                    <p><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">RadioButton</span> <span class="o">:</span> <span class="k">public</span> <span class="n">Widget</span>
<span class="p">{</span>
	<span class="n">RadioButton</span><span class="p">();</span>
	<span class="n">RadioButton</span><span class="p">(</span><span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">caption</span><span class="p">,</span> <span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">group</span><span class="p">,</span> <span class="kt">bool</span> <span class="n">marked</span> <span class="o">=</span> <span class="nb">false</span><span class="p">);</span>

	<span class="k">virtual</span> <span class="kt">bool</span> <span class="nf">isMarked</span><span class="p">();</span>
	<span class="k">virtual</span> <span class="kt">void</span> <span class="nf">setMarked</span><span class="p">(</span><span class="kt">bool</span> <span class="n">marked</span><span class="p">);</span>
	<span class="k">virtual</span> <span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="o">&amp;</span><span class="nf">getCaption</span><span class="p">()</span> <span class="k">const</span><span class="p">;</span>
	<span class="k">virtual</span> <span class="kt">void</span> <span class="nf">setCaption</span><span class="p">(</span><span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">caption</span><span class="p">);</span>
	<span class="k">virtual</span> <span class="kt">void</span> <span class="nf">setGroup</span><span class="p">(</span><span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">group</span><span class="p">);</span>
	<span class="k">virtual</span> <span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="o">&amp;</span><span class="nf">getGroup</span><span class="p">()</span> <span class="k">const</span><span class="p">;</span>
	<span class="k">virtual</span> <span class="kt">void</span> <span class="nf">adjustSize</span><span class="p">();</span>
<span class="p">};</span>
</pre></div>
</p>
                    </details>
                    
                    <details>
                    <summary>class ImageRadioButton : public RadioButton</summary>
                    <p></p>
                    <p><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">ImageRadioButton</span> <span class="o">:</span> <span class="k">public</span> <span class="n">RadioButton</span>
<span class="p">{</span>
	<span class="n">ImageRadioButton</span><span class="p">();</span>
	<span class="n">ImageRadioButton</span><span class="p">(</span><span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">caption</span><span class="p">,</span> <span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">group</span><span class="p">,</span> <span class="kt">bool</span> <span class="n">marked</span> <span class="o">=</span> <span class="nb">false</span><span class="p">);</span>

	<span class="kt">void</span> <span class="nf">setUncheckedNormalImage</span><span class="p">(</span><span class="n">CGraphic</span> <span class="o">*</span><span class="n">image</span><span class="p">);</span>
	<span class="kt">void</span> <span class="nf">setUncheckedPressedImage</span><span class="p">(</span><span class="n">CGraphic</span> <span class="o">*</span><span class="n">image</span><span class="p">);</span>
	<span class="kt">void</span> <span class="nf">setUncheckedDisabledImage</span><span class="p">(</span><span class="n">CGraphic</span> <span class="o">*</span><span class="n">image</span><span class="p">);</span>
	<span class="kt">void</span> <span class="nf">setCheckedNormalImage</span><span class="p">(</span><span class="n">CGraphic</span> <span class="o">*</span><span class="n">image</span><span class="p">);</span>
	<span class="kt">void</span> <span class="nf">setCheckedPressedImage</span><span class="p">(</span><span class="n">CGraphic</span> <span class="o">*</span><span class="n">image</span><span class="p">);</span>
	<span class="kt">void</span> <span class="nf">setCheckedDisabledImage</span><span class="p">(</span><span class="n">CGraphic</span> <span class="o">*</span><span class="n">image</span><span class="p">);</span>
<span class="p">};</span>
</pre></div>
</p>
                    </details>
                    
                    <details>
                    <summary>class CheckBox : public Widget</summary>
                    <p></p>
                    <p><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">CheckBox</span> <span class="o">:</span> <span class="k">public</span> <span class="n">Widget</span>
<span class="p">{</span>
	<span class="n">CheckBox</span><span class="p">();</span>
	<span class="n">CheckBox</span><span class="p">(</span><span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">caption</span><span class="p">,</span> <span class="kt">bool</span> <span class="n">marked</span> <span class="o">=</span> <span class="nb">false</span><span class="p">);</span>

	<span class="k">virtual</span> <span class="kt">bool</span> <span class="nf">isMarked</span><span class="p">()</span> <span class="k">const</span><span class="p">;</span>
	<span class="k">virtual</span> <span class="kt">void</span> <span class="nf">setMarked</span><span class="p">(</span><span class="kt">bool</span> <span class="n">marked</span><span class="p">);</span>
	<span class="k">virtual</span> <span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="o">&amp;</span><span class="nf">getCaption</span><span class="p">()</span> <span class="k">const</span><span class="p">;</span>
	<span class="k">virtual</span> <span class="kt">void</span> <span class="nf">setCaption</span><span class="p">(</span><span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">caption</span><span class="p">);</span>
	<span class="k">virtual</span> <span class="kt">void</span> <span class="nf">adjustSize</span><span class="p">();</span>
<span class="p">};</span>
</pre></div>
</p>
                    </details>
                    
                    <details>
                    <summary>class ImageCheckBox : public CheckBox</summary>
                    <p></p>
                    <p><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">ImageCheckBox</span> <span class="o">:</span> <span class="k">public</span> <span class="n">CheckBox</span>
<span class="p">{</span>
	<span class="n">ImageCheckBox</span><span class="p">();</span>
	<span class="n">ImageCheckBox</span><span class="p">(</span><span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">caption</span><span class="p">,</span> <span class="kt">bool</span> <span class="n">marked</span> <span class="o">=</span> <span class="nb">false</span><span class="p">);</span>

	<span class="kt">void</span> <span class="nf">setUncheckedNormalImage</span><span class="p">(</span><span class="n">CGraphic</span> <span class="o">*</span><span class="n">image</span><span class="p">);</span>
	<span class="kt">void</span> <span class="nf">setUncheckedPressedImage</span><span class="p">(</span><span class="n">CGraphic</span> <span class="o">*</span><span class="n">image</span><span class="p">);</span>
	<span class="kt">void</span> <span class="nf">setUncheckedDisabledImage</span><span class="p">(</span><span class="n">CGraphic</span> <span class="o">*</span><span class="n">image</span><span class="p">);</span>
	<span class="kt">void</span> <span class="nf">setCheckedNormalImage</span><span class="p">(</span><span class="n">CGraphic</span> <span class="o">*</span><span class="n">image</span><span class="p">);</span>
	<span class="kt">void</span> <span class="nf">setCheckedPressedImage</span><span class="p">(</span><span class="n">CGraphic</span> <span class="o">*</span><span class="n">image</span><span class="p">);</span>
	<span class="kt">void</span> <span class="nf">setCheckedDisabledImage</span><span class="p">(</span><span class="n">CGraphic</span> <span class="o">*</span><span class="n">image</span><span class="p">);</span>
<span class="p">};</span>
</pre></div>
</p>
                    </details>
                    
                    <details>
                    <summary>class Slider : public Widget</summary>
                    <p></p>
                    <p><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Slider</span> <span class="o">:</span> <span class="k">public</span> <span class="n">Widget</span>
<span class="p">{</span>
	<span class="n">Slider</span><span class="p">(</span><span class="kt">double</span> <span class="n">scaleEnd</span> <span class="o">=</span> <span class="mf">1.0</span><span class="p">);</span>
	<span class="n">Slider</span><span class="p">(</span><span class="kt">double</span> <span class="n">scaleStart</span><span class="p">,</span> <span class="kt">double</span> <span class="n">scaleEnd</span><span class="p">);</span>
	<span class="k">virtual</span> <span class="kt">void</span> <span class="nf">setScale</span><span class="p">(</span><span class="kt">double</span> <span class="n">scaleStart</span><span class="p">,</span> <span class="kt">double</span> <span class="n">scaleEnd</span><span class="p">);</span>
	<span class="k">virtual</span> <span class="kt">double</span> <span class="nf">getScaleStart</span><span class="p">()</span> <span class="k">const</span><span class="p">;</span>
	<span class="k">virtual</span> <span class="kt">void</span> <span class="nf">setScaleStart</span><span class="p">(</span><span class="kt">double</span> <span class="n">scaleStart</span><span class="p">);</span>
	<span class="k">virtual</span> <span class="kt">double</span> <span class="nf">getScaleEnd</span><span class="p">()</span> <span class="k">const</span><span class="p">;</span>
	<span class="k">virtual</span> <span class="kt">void</span> <span class="nf">setScaleEnd</span><span class="p">(</span><span class="kt">double</span> <span class="n">scaleEnd</span><span class="p">);</span>
	<span class="k">virtual</span> <span class="kt">double</span> <span class="nf">getValue</span><span class="p">();</span>
	<span class="k">virtual</span> <span class="kt">void</span> <span class="nf">setValue</span><span class="p">(</span><span class="kt">double</span> <span class="n">value</span><span class="p">);</span>
	<span class="k">virtual</span> <span class="kt">void</span> <span class="nf">setMarkerLength</span><span class="p">(</span><span class="kt">int</span> <span class="n">length</span><span class="p">);</span>
	<span class="k">virtual</span> <span class="kt">int</span> <span class="nf">getMarkerLength</span><span class="p">()</span> <span class="k">const</span><span class="p">;</span>
	<span class="k">virtual</span> <span class="kt">void</span> <span class="nf">setOrientation</span><span class="p">(</span><span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">orientation</span><span class="p">);</span>
	<span class="k">virtual</span> <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">getOrientation</span><span class="p">()</span> <span class="k">const</span><span class="p">;</span>
	<span class="k">virtual</span> <span class="kt">void</span> <span class="nf">setStepLength</span><span class="p">(</span><span class="kt">double</span> <span class="n">length</span><span class="p">);</span>
	<span class="k">virtual</span> <span class="kt">double</span> <span class="nf">getStepLength</span><span class="p">()</span> <span class="k">const</span><span class="p">;</span>

	<span class="k">enum</span> <span class="p">{</span> <span class="n">HORIZONTAL</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">VERTICAL</span> <span class="p">};</span>
<span class="p">};</span>
</pre></div>
</p>
                    </details>
                    
                    <details>
                    <summary>class ImageSlider : public Slider</summary>
                    <p></p>
                    <p><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">ImageSlider</span> <span class="o">:</span> <span class="k">public</span> <span class="n">Slider</span>
<span class="p">{</span>
	<span class="n">ImageSlider</span><span class="p">(</span><span class="kt">double</span> <span class="n">scaleEnd</span> <span class="o">=</span> <span class="mf">1.0</span><span class="p">);</span>
	<span class="n">ImageSlider</span><span class="p">(</span><span class="kt">double</span> <span class="n">scaleStart</span><span class="p">,</span> <span class="kt">double</span> <span class="n">scaleEnd</span><span class="p">);</span>
	<span class="kt">void</span> <span class="nf">setMarkerImage</span><span class="p">(</span><span class="n">CGraphic</span> <span class="o">*</span><span class="n">image</span><span class="p">);</span>
	<span class="kt">void</span> <span class="nf">setBackgroundImage</span><span class="p">(</span><span class="n">CGraphic</span> <span class="o">*</span><span class="n">image</span><span class="p">);</span>
	<span class="kt">void</span> <span class="nf">setDisabledBackgroundImage</span><span class="p">(</span><span class="n">CGraphic</span> <span class="o">*</span><span class="n">image</span><span class="p">);</span>
<span class="p">};</span>
</pre></div>
</p>
                    </details>
                    
                    <details>
                    <summary>class Label : public Widget</summary>
                    <p></p>
                    <p><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Label</span> <span class="o">:</span> <span class="k">public</span> <span class="n">Widget</span>
<span class="p">{</span>
	<span class="n">Label</span><span class="p">(</span><span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">caption</span><span class="p">);</span>
	<span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="o">&amp;</span><span class="nf">getCaption</span><span class="p">()</span> <span class="k">const</span><span class="p">;</span>
	<span class="kt">void</span> <span class="nf">setCaption</span><span class="p">(</span><span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">caption</span><span class="p">);</span>
	<span class="k">virtual</span> <span class="kt">void</span> <span class="nf">setAlignment</span><span class="p">(</span><span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">alignment</span><span class="p">);</span>
	<span class="k">virtual</span> <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">getAlignment</span><span class="p">();</span>
	<span class="k">virtual</span> <span class="kt">void</span> <span class="nf">adjustSize</span><span class="p">();</span>
<span class="p">};</span>
</pre></div>
</p>
                    </details>
                    
                    <details>
                    <summary>class MultiLineLabel : public Widget</summary>
                    <p></p>
                    <p><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">MultiLineLabel</span> <span class="o">:</span> <span class="k">public</span> <span class="n">Widget</span>
<span class="p">{</span>
	<span class="n">MultiLineLabel</span><span class="p">();</span>
	<span class="n">MultiLineLabel</span><span class="p">(</span><span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">caption</span><span class="p">);</span>

	<span class="k">virtual</span> <span class="kt">void</span> <span class="nf">setCaption</span><span class="p">(</span><span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">caption</span><span class="p">);</span>
	<span class="k">virtual</span> <span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="o">&amp;</span><span class="nf">getCaption</span><span class="p">()</span> <span class="k">const</span><span class="p">;</span>
	<span class="k">virtual</span> <span class="kt">void</span> <span class="nf">setAlignment</span><span class="p">(</span><span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">alignment</span><span class="p">);</span>
	<span class="k">virtual</span> <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">getAlignment</span><span class="p">();</span>
	<span class="k">virtual</span> <span class="kt">void</span> <span class="nf">setVerticalAlignment</span><span class="p">(</span><span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">alignment</span><span class="p">);</span>
	<span class="k">virtual</span> <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">getVerticalAlignment</span><span class="p">();</span>
	<span class="k">virtual</span> <span class="kt">void</span> <span class="nf">setLineWidth</span><span class="p">(</span><span class="kt">int</span> <span class="n">width</span><span class="p">);</span>
	<span class="k">virtual</span> <span class="kt">int</span> <span class="nf">getLineWidth</span><span class="p">();</span>
	<span class="k">virtual</span> <span class="kt">void</span> <span class="nf">adjustSize</span><span class="p">();</span>
	<span class="k">virtual</span> <span class="kt">void</span> <span class="nf">draw</span><span class="p">(</span><span class="n">gcn</span><span class="o">::</span><span class="n">Graphics</span> <span class="o">*</span><span class="n">graphics</span><span class="p">);</span>

	<span class="k">enum</span> <span class="p">{</span>
		<span class="n">LEFT</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
		<span class="n">CENTER</span><span class="p">,</span>
		<span class="n">RIGHT</span><span class="p">,</span>
		<span class="n">TOP</span><span class="p">,</span>
		<span class="n">BOTTOM</span>
	<span class="p">};</span>
</pre></div>
</p>
                    </details>
                    
                    <details>
                    <summary>class TextField : public Widget</summary>
                    <p></p>
                    <p><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">TextField</span> <span class="o">:</span> <span class="k">public</span> <span class="n">Widget</span>
<span class="p">{</span>
	<span class="n">TextField</span><span class="p">(</span><span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">text</span><span class="p">);</span>
	<span class="k">virtual</span> <span class="kt">void</span> <span class="nf">setText</span><span class="p">(</span><span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">text</span><span class="p">);</span>
	<span class="k">virtual</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="o">&amp;</span><span class="nf">getText</span><span class="p">();</span>
<span class="p">};</span>
</pre></div>
</p>
                    </details>
                    
                    <details>
                    <summary>class ImageTextField : public Widget</summary>
                    <p></p>
                    <p><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">ImageTextField</span> <span class="o">:</span> <span class="k">public</span> <span class="n">Widget</span>
<span class="p">{</span>
	<span class="n">ImageTextField</span><span class="p">(</span><span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">text</span><span class="p">);</span>
	<span class="k">virtual</span> <span class="kt">void</span> <span class="nf">setText</span><span class="p">(</span><span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">text</span><span class="p">);</span>
	<span class="k">virtual</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="o">&amp;</span><span class="nf">getText</span><span class="p">();</span>
	<span class="kt">void</span> <span class="nf">setItemImage</span><span class="p">(</span><span class="n">CGraphic</span> <span class="o">*</span><span class="n">image</span><span class="p">);</span>
<span class="p">};</span>
</pre></div>
</p>
                    </details>
                    
                    <details>
                    <summary>class ListBox : public Widget</summary>
                    <p></p>
                    <p><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">ListBox</span> <span class="o">:</span> <span class="k">public</span> <span class="n">Widget</span>
<span class="p">{</span>
<span class="p">};</span>
</pre></div>
</p>
                    </details>
                    
                    <details>
                    <summary>class ImageListBox : public ListBox</summary>
                    <p></p>
                    <p><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">ImageListBox</span> <span class="o">:</span> <span class="k">public</span> <span class="n">ListBox</span>
<span class="p">{</span>
<span class="p">};</span>
</pre></div>
</p>
                    </details>
                    
                    <details>
                    <summary>class ListBoxWidget : public ScrollArea</summary>
                    <p></p>
                    <p><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">ListBoxWidget</span> <span class="o">:</span> <span class="k">public</span> <span class="n">ScrollArea</span>
<span class="p">{</span>
	<span class="n">ListBoxWidget</span><span class="p">(</span><span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">width</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">height</span><span class="p">);</span>
	<span class="kt">void</span> <span class="nf">setList</span><span class="p">(</span><span class="n">lua_State</span> <span class="o">*</span><span class="n">lua</span><span class="p">,</span> <span class="n">lua_Object</span> <span class="o">*</span><span class="n">lo</span><span class="p">);</span>
	<span class="kt">void</span> <span class="nf">setSelected</span> <span class="p">(</span><span class="kt">int</span> <span class="n">selected</span><span class="p">);</span>
	<span class="kt">int</span> <span class="nf">getSelected</span><span class="p">();</span>
<span class="p">};</span>
</pre></div>
</p>
                    </details>
                    
                    <details>
                    <summary>class ImageListBoxWidget : public ListBoxWidget</summary>
                    <p></p>
                    <p><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">ImageListBoxWidget</span> <span class="o">:</span> <span class="k">public</span> <span class="n">ListBoxWidget</span>
<span class="p">{</span>
	<span class="n">ImageListBoxWidget</span><span class="p">(</span><span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">width</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">height</span><span class="p">);</span>
	<span class="kt">void</span> <span class="nf">setList</span><span class="p">(</span><span class="n">lua_State</span> <span class="o">*</span><span class="n">lua</span><span class="p">,</span> <span class="n">lua_Object</span> <span class="o">*</span><span class="n">lo</span><span class="p">);</span>
	<span class="kt">void</span> <span class="nf">setSelected</span> <span class="p">(</span><span class="kt">int</span> <span class="n">selected</span><span class="p">);</span>
	<span class="kt">int</span> <span class="nf">getSelected</span><span class="p">();</span>
	<span class="kt">void</span> <span class="nf">setItemImage</span><span class="p">(</span><span class="n">CGraphic</span> <span class="o">*</span><span class="n">image</span><span class="p">);</span>
	<span class="kt">void</span> <span class="nf">setUpButtonImage</span><span class="p">(</span><span class="n">CGraphic</span> <span class="o">*</span><span class="n">image</span><span class="p">);</span>
	<span class="kt">void</span> <span class="nf">setUpPressedButtonImage</span><span class="p">(</span><span class="n">CGraphic</span> <span class="o">*</span><span class="n">image</span><span class="p">);</span>
	<span class="kt">void</span> <span class="nf">setDownButtonImage</span><span class="p">(</span><span class="n">CGraphic</span> <span class="o">*</span><span class="n">image</span><span class="p">);</span>
	<span class="kt">void</span> <span class="nf">setDownPressedButtonImage</span><span class="p">(</span><span class="n">CGraphic</span> <span class="o">*</span><span class="n">image</span><span class="p">);</span>
	<span class="kt">void</span> <span class="nf">setLeftButtonImage</span><span class="p">(</span><span class="n">CGraphic</span> <span class="o">*</span><span class="n">image</span><span class="p">);</span>
	<span class="kt">void</span> <span class="nf">setLeftPressedButtonImage</span><span class="p">(</span><span class="n">CGraphic</span> <span class="o">*</span><span class="n">image</span><span class="p">);</span>
	<span class="kt">void</span> <span class="nf">setRightButtonImage</span><span class="p">(</span><span class="n">CGraphic</span> <span class="o">*</span><span class="n">image</span><span class="p">);</span>
	<span class="kt">void</span> <span class="nf">setRightPressedButtonImage</span><span class="p">(</span><span class="n">CGraphic</span> <span class="o">*</span><span class="n">image</span><span class="p">);</span>
	<span class="kt">void</span> <span class="nf">setHBarImage</span><span class="p">(</span><span class="n">CGraphic</span> <span class="o">*</span><span class="n">image</span><span class="p">);</span>
	<span class="kt">void</span> <span class="nf">setVBarImage</span><span class="p">(</span><span class="n">CGraphic</span> <span class="o">*</span><span class="n">image</span><span class="p">);</span>
	<span class="kt">void</span> <span class="nf">setMarkerImage</span><span class="p">(</span><span class="n">CGraphic</span> <span class="o">*</span><span class="n">image</span><span class="p">);</span>
<span class="p">};</span>
</pre></div>
</p>
                    </details>
                    
                    <details>
                    <summary>class Window : public BasicContainer</summary>
                    <p></p>
                    <p><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Window</span> <span class="o">:</span> <span class="k">public</span> <span class="n">BasicContainer</span>
<span class="p">{</span>
	<span class="n">Window</span><span class="p">();</span>
	<span class="n">Window</span><span class="p">(</span><span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">caption</span><span class="p">);</span>
	<span class="n">Window</span><span class="p">(</span><span class="n">Widget</span> <span class="o">*</span><span class="n">content</span><span class="p">,</span> <span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">caption</span> <span class="o">=</span> <span class="s">&quot;&quot;</span><span class="p">);</span>

	<span class="k">virtual</span> <span class="kt">void</span> <span class="nf">setCaption</span><span class="p">(</span><span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">caption</span><span class="p">);</span>
	<span class="k">virtual</span> <span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="o">&amp;</span><span class="nf">getCaption</span><span class="p">()</span> <span class="k">const</span><span class="p">;</span>
	<span class="k">virtual</span> <span class="kt">void</span> <span class="nf">setAlignment</span><span class="p">(</span><span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">alignment</span><span class="p">);</span>
	<span class="k">virtual</span> <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">getAlignment</span><span class="p">()</span> <span class="k">const</span><span class="p">;</span>
	<span class="k">virtual</span> <span class="kt">void</span> <span class="nf">setContent</span><span class="p">(</span><span class="n">Widget</span><span class="o">*</span> <span class="n">widget</span><span class="p">);</span>
	<span class="k">virtual</span> <span class="n">Widget</span><span class="o">*</span> <span class="nf">getContent</span><span class="p">()</span> <span class="k">const</span><span class="p">;</span>
	<span class="k">virtual</span> <span class="kt">void</span> <span class="nf">setPadding</span><span class="p">(</span><span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">padding</span><span class="p">);</span>
	<span class="k">virtual</span> <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">getPadding</span><span class="p">()</span> <span class="k">const</span><span class="p">;</span>
	<span class="k">virtual</span> <span class="kt">void</span> <span class="nf">setTitleBarHeight</span><span class="p">(</span><span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">height</span><span class="p">);</span>
	<span class="k">virtual</span> <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">getTitleBarHeight</span><span class="p">();</span>
	<span class="k">virtual</span> <span class="kt">void</span> <span class="nf">setMovable</span><span class="p">(</span><span class="kt">bool</span> <span class="n">movable</span><span class="p">);</span>
	<span class="k">virtual</span> <span class="kt">bool</span> <span class="nf">isMovable</span><span class="p">()</span> <span class="k">const</span><span class="p">;</span>
	<span class="k">virtual</span> <span class="kt">void</span> <span class="nf">resizeToContent</span><span class="p">();</span>
	<span class="k">virtual</span> <span class="kt">void</span> <span class="nf">setOpaque</span><span class="p">(</span><span class="kt">bool</span> <span class="n">opaque</span><span class="p">);</span>
	<span class="k">virtual</span> <span class="kt">bool</span> <span class="nf">isOpaque</span><span class="p">();</span>
<span class="p">};</span>
</pre></div>
</p>
                    </details>
                    
                    <details>
                    <summary>class Windows : public Window</summary>
                    <p></p>
                    <p><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Windows</span> <span class="o">:</span> <span class="k">public</span> <span class="n">Window</span>
<span class="p">{</span>
	<span class="n">Windows</span><span class="p">(</span><span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">text</span><span class="p">,</span> <span class="kt">int</span> <span class="n">width</span><span class="p">,</span> <span class="kt">int</span> <span class="n">height</span><span class="p">);</span>
	<span class="kt">void</span> <span class="nf">add</span><span class="p">(</span><span class="n">Widget</span> <span class="o">*</span><span class="n">widget</span><span class="p">,</span> <span class="kt">int</span> <span class="n">x</span><span class="p">,</span> <span class="kt">int</span> <span class="n">y</span><span class="p">);</span>
<span class="p">};</span>
</pre></div>
</p>
                    </details>
                    
                    <details>
                    <summary>class ScrollingWidget : public ScrollArea</summary>
                    <p></p>
                    <p><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">ScrollingWidget</span> <span class="o">:</span> <span class="k">public</span> <span class="n">ScrollArea</span>
<span class="p">{</span>
	<span class="n">ScrollingWidget</span><span class="p">(</span><span class="kt">int</span> <span class="n">width</span><span class="p">,</span> <span class="kt">int</span> <span class="n">height</span><span class="p">);</span>
	<span class="kt">void</span> <span class="nf">add</span><span class="p">(</span><span class="n">Widget</span> <span class="o">*</span><span class="n">widget</span><span class="p">,</span> <span class="kt">int</span> <span class="n">x</span><span class="p">,</span> <span class="kt">int</span> <span class="n">y</span><span class="p">);</span>
	<span class="kt">void</span> <span class="nf">restart</span><span class="p">();</span>
	<span class="kt">void</span> <span class="nf">setSpeed</span><span class="p">(</span><span class="kt">float</span> <span class="n">speed</span><span class="p">);</span>
	<span class="kt">float</span> <span class="nf">getSpeed</span><span class="p">();</span>
<span class="p">};</span>
</pre></div>
</p>
                    </details>
                    
                    <details>
                    <summary>class DropDown : public BasicContainer</summary>
                    <p></p>
                    <p><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">DropDown</span> <span class="o">:</span> <span class="k">public</span> <span class="n">BasicContainer</span>
<span class="p">{</span>
	<span class="k">virtual</span> <span class="kt">int</span> <span class="nf">getSelected</span><span class="p">();</span>
	<span class="k">virtual</span> <span class="kt">void</span> <span class="nf">setSelected</span><span class="p">(</span><span class="kt">int</span> <span class="n">selected</span><span class="p">);</span>
	<span class="k">virtual</span> <span class="kt">void</span> <span class="nf">setScrollArea</span><span class="p">(</span><span class="n">ScrollArea</span><span class="o">*</span> <span class="n">scrollArea</span><span class="p">);</span>
	<span class="k">virtual</span> <span class="n">ScrollArea</span> <span class="o">*</span><span class="nf">getScrollArea</span><span class="p">();</span>
	<span class="k">virtual</span> <span class="kt">void</span> <span class="nf">setListBox</span><span class="p">(</span><span class="n">ListBox</span><span class="o">*</span> <span class="n">listBox</span><span class="p">);</span>
	<span class="k">virtual</span> <span class="n">ListBox</span> <span class="o">*</span><span class="nf">getListBox</span><span class="p">();</span>
<span class="p">};</span>
</pre></div>
</p>
                    </details>
                    
                    <details>
                    <summary>class DropDownWidget : public DropDown</summary>
                    <p></p>
                    <p><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">DropDownWidget</span> <span class="o">:</span> <span class="k">public</span> <span class="n">DropDown</span>
<span class="p">{</span>
	<span class="n">DropDownWidget</span><span class="p">();</span>
	<span class="kt">void</span> <span class="nf">setList</span><span class="p">(</span><span class="n">lua_State</span> <span class="o">*</span><span class="n">lua</span><span class="p">,</span> <span class="n">lua_Object</span> <span class="o">*</span><span class="n">lo</span><span class="p">);</span>
	<span class="k">virtual</span> <span class="n">ListBox</span> <span class="o">*</span><span class="nf">getListBox</span><span class="p">();</span>
	<span class="k">virtual</span> <span class="kt">void</span> <span class="nf">setSize</span><span class="p">(</span><span class="kt">int</span> <span class="n">width</span><span class="p">,</span> <span class="kt">int</span> <span class="n">height</span><span class="p">);</span>
<span class="p">};</span>
</pre></div>
</p>
                    </details>
                    
                    <details>
                    <summary>class ImageDropDownWidget : public DropDown</summary>
                    <p></p>
                    <p><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">ImageDropDownWidget</span> <span class="o">:</span> <span class="k">public</span> <span class="n">DropDown</span>
<span class="p">{</span>
	<span class="n">ImageDropDownWidget</span><span class="p">();</span>
	<span class="kt">void</span> <span class="nf">setList</span><span class="p">(</span><span class="n">lua_State</span> <span class="o">*</span><span class="n">lua</span><span class="p">,</span> <span class="n">lua_Object</span> <span class="o">*</span><span class="n">lo</span><span class="p">);</span>
	<span class="k">virtual</span> <span class="n">ListBox</span> <span class="o">*</span><span class="nf">getListBox</span><span class="p">();</span>
	<span class="k">virtual</span> <span class="kt">void</span> <span class="nf">setSize</span><span class="p">(</span><span class="kt">int</span> <span class="n">width</span><span class="p">,</span> <span class="kt">int</span> <span class="n">height</span><span class="p">);</span>
	<span class="kt">void</span> <span class="nf">setItemImage</span><span class="p">(</span><span class="n">CGraphic</span> <span class="o">*</span><span class="n">image</span><span class="p">);</span>
	<span class="kt">void</span> <span class="nf">setDownNormalImage</span><span class="p">(</span><span class="n">CGraphic</span> <span class="o">*</span><span class="n">image</span><span class="p">);</span>
	<span class="kt">void</span> <span class="nf">setDownPressedImage</span><span class="p">(</span><span class="n">CGraphic</span> <span class="o">*</span><span class="n">image</span><span class="p">);</span>
<span class="p">};</span>
</pre></div>
</p>
                    </details>
                    
                    <details>
                    <summary>class StatBoxWidget : public Widget</summary>
                    <p></p>
                    <p><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">StatBoxWidget</span> <span class="o">:</span> <span class="k">public</span> <span class="n">Widget</span>
<span class="p">{</span>
	<span class="n">StatBoxWidget</span><span class="p">(</span><span class="kt">int</span> <span class="n">width</span><span class="p">,</span> <span class="kt">int</span> <span class="n">height</span><span class="p">);</span>

	<span class="kt">void</span> <span class="nf">setCaption</span><span class="p">(</span><span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">s</span><span class="p">);</span>
	<span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="o">&amp;</span><span class="nf">getCaption</span><span class="p">()</span> <span class="k">const</span><span class="p">;</span>
	<span class="kt">void</span> <span class="nf">setPercent</span><span class="p">(</span><span class="k">const</span> <span class="kt">int</span> <span class="n">percent</span><span class="p">);</span>
	<span class="kt">int</span> <span class="nf">getPercent</span><span class="p">()</span> <span class="k">const</span><span class="p">;</span>
<span class="p">};</span>
</pre></div>
</p>
                    </details>
                    
                    <details>
                    <summary>class Container : public BasicContainer</summary>
                    <p></p>
                    <p><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Container</span> <span class="o">:</span> <span class="k">public</span> <span class="n">BasicContainer</span>
<span class="p">{</span>
	<span class="n">Container</span><span class="p">();</span>
	<span class="k">virtual</span> <span class="kt">void</span> <span class="nf">setOpaque</span><span class="p">(</span><span class="kt">bool</span> <span class="n">opaque</span><span class="p">);</span>
	<span class="k">virtual</span> <span class="kt">bool</span> <span class="nf">isOpaque</span><span class="p">()</span> <span class="k">const</span><span class="p">;</span>
	<span class="k">virtual</span> <span class="kt">void</span> <span class="nf">add</span><span class="p">(</span><span class="n">Widget</span> <span class="o">*</span><span class="n">widget</span><span class="p">,</span> <span class="kt">int</span> <span class="n">x</span><span class="p">,</span> <span class="kt">int</span> <span class="n">y</span><span class="p">);</span>
	<span class="k">virtual</span> <span class="kt">void</span> <span class="nf">remove</span><span class="p">(</span><span class="n">Widget</span> <span class="o">*</span><span class="n">widget</span><span class="p">);</span>
	<span class="k">virtual</span> <span class="kt">void</span> <span class="nf">clear</span><span class="p">();</span>
<span class="p">};</span>
</pre></div>
</p>
                    </details>
                    
                    <details>
                    <summary>class MenuScreen : public Container</summary>
                    <p></p>
                    <p><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">MenuScreen</span> <span class="o">:</span> <span class="k">public</span> <span class="n">Container</span>
<span class="p">{</span>
	<span class="n">MenuScreen</span><span class="p">();</span>

	<span class="kt">int</span> <span class="nf">run</span><span class="p">(</span><span class="kt">bool</span> <span class="n">loop</span> <span class="o">=</span> <span class="nb">true</span><span class="p">);</span>
	<span class="kt">void</span> <span class="nf">stop</span><span class="p">(</span><span class="kt">int</span> <span class="n">result</span> <span class="o">=</span> <span class="mi">0</span><span class="p">);</span>
	<span class="kt">void</span> <span class="nf">stopAll</span><span class="p">(</span><span class="kt">int</span> <span class="n">result</span> <span class="o">=</span> <span class="mi">0</span><span class="p">);</span>
	<span class="kt">void</span> <span class="nf">addLogicCallback</span><span class="p">(</span><span class="n">LuaActionListener</span> <span class="o">*</span><span class="n">actionListener</span><span class="p">);</span>
	<span class="kt">void</span> <span class="nf">setDrawMenusUnder</span><span class="p">(</span><span class="kt">bool</span> <span class="n">drawunder</span><span class="p">);</span>
	<span class="kt">bool</span> <span class="nf">getDrawMenusUnder</span><span class="p">();</span>
<span class="p">};</span>
</pre></div>
</p>
                    </details>
                    
                    <details>
                    <summary>CycleViewportMode(int step)</summary>
                    <p></p>
                    </details>
                    
                    <details>
                    <summary>SetNewViewportMode(ViewportModeType new_mode)</summary>
                    <p></p>
                    </details>
                    
                    <details>
                    <summary>SetDefaultTextColors(const std::string &normal, const std::string &reverse)</summary>
                    <p></p>
                    </details>
                    <hr>/tolua/ai.pkg<hr>
                    <details>
                    <summary>AiAttackWithForceAt(unsigned int force, unsigned int x, unsigned int y)</summary>
                    <p>/// Attack with force at position<br></p>
                    </details>
                    
                    <details>
                    <summary>AiAttackWithForce(unsigned int force)</summary>
                    <p>/// Attack with force<br></p>
                    </details>
                    <hr>/tolua/unit.pkg<hr>
                    <details>
                    <summary>class Vec2i</summary>
                    <p></p>
                    <p><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Vec2i</span>
<span class="p">{</span>
	<span class="kt">short</span> <span class="kt">int</span> <span class="n">x</span><span class="p">;</span>
	<span class="kt">short</span> <span class="kt">int</span> <span class="n">y</span><span class="p">;</span>
<span class="p">};</span>
</pre></div>
</p>
                    </details>
                    
                    <details>
                    <summary>class CUnit</summary>
                    <p></p>
                    <p><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">CUnit</span>
<span class="p">{</span>
	<span class="n">tolua_readonly</span> <span class="n">Vec2i</span> <span class="n">tilePos</span><span class="p">;</span>

	<span class="n">tolua_readonly</span> <span class="n">CUnitType</span> <span class="o">*</span><span class="n">Type</span><span class="p">;</span>
	<span class="n">tolua_readonly</span> <span class="n">CPlayer</span> <span class="o">*</span><span class="n">Player</span><span class="p">;</span>
	<span class="n">CUnit</span> <span class="o">*</span><span class="n">Goal</span><span class="p">;</span>
	<span class="kt">bool</span> <span class="n">Active</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">ResourcesHeld</span><span class="p">;</span>
<span class="p">};</span>
</pre></div>
</p>
                    </details>
                    
                    <details>
                    <summary>class CPreference</summary>
                    <p></p>
                    <p><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">CPreference</span>
<span class="p">{</span>
	<span class="kt">bool</span> <span class="n">ShowSightRange</span><span class="p">;</span>
	<span class="kt">bool</span> <span class="n">ShowReactionRange</span><span class="p">;</span>
	<span class="kt">bool</span> <span class="n">ShowAttackRange</span><span class="p">;</span>
	<span class="kt">bool</span> <span class="n">ShowMessages</span><span class="p">;</span>
	<span class="kt">bool</span> <span class="n">BigScreen</span><span class="p">;</span>
	<span class="kt">bool</span> <span class="n">PauseOnLeave</span><span class="p">;</span>
	<span class="kt">bool</span> <span class="n">AiExplores</span><span class="p">;</span>
	<span class="kt">bool</span> <span class="n">GrayscaleIcons</span><span class="p">;</span>
	<span class="kt">bool</span> <span class="n">IconsShift</span><span class="p">;</span>
	<span class="kt">bool</span> <span class="n">StereoSound</span><span class="p">;</span>
	<span class="kt">bool</span> <span class="n">MineNotifications</span><span class="p">;</span>
	<span class="kt">bool</span> <span class="n">DeselectInMine</span><span class="p">;</span>
	<span class="kt">bool</span> <span class="n">NoStatusLineTooltips</span><span class="p">;</span>
	<span class="kt">bool</span> <span class="n">SimplifiedAutoTargeting</span><span class="p">;</span>
	<span class="kt">bool</span> <span class="n">AiChecksDependencies</span><span class="p">;</span>

	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">ShowOrders</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">ShowNameDelay</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">ShowNameTime</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">AutosaveMinutes</span><span class="p">;</span>

	<span class="n">CGraphic</span> <span class="o">*</span><span class="n">IconFrameG</span><span class="p">;</span>
	<span class="n">CGraphic</span> <span class="o">*</span><span class="n">PressedIconFrameG</span><span class="p">;</span>
<span class="p">};</span>
</pre></div>
</p>
                    </details>
                    
                    <details>
                    <summary>class CUnitManager</summary>
                    <p></p>
                    <p><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">CUnitManager</span>
<span class="p">{</span>
	<span class="n">CUnit</span> <span class="o">&amp;</span><span class="nf">GetSlotUnit</span><span class="p">(</span><span class="kt">int</span> <span class="n">index</span><span class="p">)</span> <span class="k">const</span><span class="p">;</span>
<span class="p">};</span>
</pre></div>
</p>
                    </details>
                    
                    <details>
                    <summary>CUnitManager UnitManager</summary>
                    <p></p>
                    </details>
                    
                    <details>
                    <summary>CPreference Preference</summary>
                    <p></p>
                    </details>
                    
                    <details>
                    <summary>int UnitNumber(CUnit &unit)</summary>
                    <p></p>
                    </details>
                    <hr>/tolua/stratagus.pkg<hr>
                    <details>
                    <summary>int SaveGame(const std::string filename)</summary>
                    <p></p>
                    </details>
                    
                    <details>
                    <summary>DeleteSaveGame(const std::string filename)</summary>
                    <p></p>
                    </details>
                    
                    <details>
                    <summary>int SyncRand(void)</summary>
                    <p></p>
                    </details>
                    
                    <details>
                    <summary>int SyncRand(int max)</summary>
                    <p></p>
                    </details>
                    
                    <details>
                    <summary>bool CanAccessFile(const char *filename)</summary>
                    <p></p>
                    </details>
                    
                    <details>
                    <summary>Exit(int err)</summary>
                    <p></p>
                    </details>
                    
                    <details>
                    <summary>bool IsDebugEnabled</summary>
                    <p></p>
                    </details>
                    <hr>/tolua/unittype.pkg<hr>
                    <details>
                    <summary>class CUnitType</summary>
                    <p></p>
                    <p><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">CUnitType</span>
<span class="p">{</span>
	<span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">Ident</span><span class="p">;</span>
	<span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">Name</span><span class="p">;</span>
	<span class="n">tolua_readonly</span> <span class="kt">int</span> <span class="n">Slot</span><span class="p">;</span>

	<span class="kt">int</span> <span class="n">MinAttackRange</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">ClicksToExplode</span><span class="p">;</span>

	<span class="kt">int</span> <span class="n">GivesResource</span><span class="p">;</span>

	<span class="kt">int</span> <span class="n">TileWidth</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">TileHeight</span><span class="p">;</span>
<span class="p">};</span>
</pre></div>
</p>
                    </details>
                    
                    <details>
                    <summary>CUnitType *UnitTypeByIdent(const std::string ident)</summary>
                    <p></p>
                    </details>
                    
                    <details>
                    <summary>CUnitType *UnitTypeHumanWall</summary>
                    <p></p>
                    </details>
                    
                    <details>
                    <summary>CUnitType *UnitTypeOrcWall</summary>
                    <p></p>
                    </details>
                    
                    <details>
                    <summary>SetMapStat(std::string ident, std::string variable_key, int value, std::string variable_type)</summary>
                    <p></p>
                    </details>
                    
                    <details>
                    <summary>SetMapSound(std::string ident, std::string sound, std::string sound_type, std::string sound_subtype = "")</summary>
                    <p></p>
                    </details>
                    <hr>/tolua/player.pkg<hr>
                    <details>
                    <summary>enum PlayerTypes {</summary>
                    <p></p>
                    <p><div class="highlight"><pre><span></span><span class="k">enum</span> <span class="nc">PlayerTypes</span> <span class="p">{</span>
	<span class="n">PlayerNeutral</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span>
	<span class="n">PlayerNobody</span>  <span class="o">=</span> <span class="mi">3</span><span class="p">,</span>
	<span class="n">PlayerComputer</span> <span class="o">=</span> <span class="mi">4</span><span class="p">,</span>
	<span class="n">PlayerPerson</span> <span class="o">=</span> <span class="mi">5</span><span class="p">,</span>
	<span class="n">PlayerRescuePassive</span> <span class="o">=</span> <span class="mi">6</span><span class="p">,</span>
	<span class="n">PlayerRescueActive</span> <span class="o">=</span> <span class="mi">7</span><span class="p">,</span>
<span class="p">};</span>
</pre></div>
</p>
                    </details>
                    
                    <details>
                    <summary>class CPlayer</summary>
                    <p></p>
                    <p><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">CPlayer</span>
<span class="p">{</span>
	<span class="kt">int</span> <span class="n">Index</span><span class="p">;</span>
	<span class="n">string</span> <span class="n">Name</span><span class="p">;</span>

	<span class="kt">int</span> <span class="n">Type</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">Race</span><span class="p">;</span>
	<span class="n">string</span> <span class="n">AiName</span><span class="p">;</span>

	<span class="n">Vec2i</span> <span class="n">StartPos</span><span class="p">;</span>

	<span class="kt">void</span> <span class="nf">SetStartView</span><span class="p">(</span><span class="k">const</span> <span class="n">Vec2i</span> <span class="o">&amp;</span><span class="n">pos</span><span class="p">);</span>

	<span class="kt">int</span> <span class="n">Resources</span><span class="p">[</span><span class="n">MaxCosts</span><span class="p">];</span>
	<span class="kt">int</span> <span class="n">StoredResources</span><span class="p">[</span><span class="n">MaxCosts</span><span class="p">];</span>
	<span class="kt">int</span> <span class="n">Incomes</span><span class="p">[</span><span class="n">MaxCosts</span><span class="p">];</span>
	<span class="k">const</span> <span class="kt">int</span> <span class="n">Revenue</span><span class="p">[</span><span class="n">MaxCosts</span><span class="p">];</span>

	<span class="k">const</span> <span class="kt">int</span> <span class="n">UnitTypesCount</span><span class="p">[</span><span class="n">UnitTypeMax</span><span class="p">];</span>
	<span class="k">const</span> <span class="kt">int</span> <span class="n">UnitTypesAiActiveCount</span><span class="p">[</span><span class="n">UnitTypeMax</span><span class="p">];</span>
	<span class="kt">bool</span> <span class="n">AiEnabled</span><span class="p">;</span>

	<span class="kt">int</span> <span class="n">NumBuildings</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">Supply</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">Demand</span><span class="p">;</span>

	<span class="kt">int</span> <span class="n">UnitLimit</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">BuildingLimit</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">TotalUnitLimit</span><span class="p">;</span>

	<span class="kt">int</span> <span class="n">Score</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">TotalUnits</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">TotalBuildings</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">TotalResources</span><span class="p">[</span><span class="n">MaxCosts</span><span class="p">];</span>
	<span class="kt">int</span> <span class="n">TotalRazings</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">TotalKills</span><span class="p">;</span>

	<span class="kt">int</span> <span class="n">SpeedResourcesHarvest</span><span class="p">[</span><span class="n">MaxCosts</span><span class="p">];</span>
	<span class="kt">int</span> <span class="n">SpeedResourcesReturn</span><span class="p">[</span><span class="n">MaxCosts</span><span class="p">];</span>
	<span class="kt">int</span> <span class="n">SpeedBuild</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">SpeedTrain</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">SpeedUpgrade</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">SpeedResearch</span><span class="p">;</span>

	<span class="n">CUnit</span><span class="o">&amp;</span> <span class="nf">GetUnit</span><span class="p">(</span><span class="kt">int</span> <span class="n">index</span><span class="p">)</span> <span class="k">const</span><span class="p">;</span>
	<span class="kt">int</span> <span class="nf">GetUnitCount</span><span class="p">()</span> <span class="k">const</span><span class="p">;</span>

	<span class="kt">bool</span> <span class="nf">IsEnemy</span><span class="p">(</span><span class="k">const</span> <span class="n">CPlayer</span> <span class="o">&amp;</span><span class="n">player</span><span class="p">)</span> <span class="k">const</span><span class="p">;</span>
	<span class="kt">bool</span> <span class="nf">IsEnemy</span><span class="p">(</span><span class="k">const</span> <span class="n">CUnit</span> <span class="o">&amp;</span><span class="n">unit</span><span class="p">)</span> <span class="k">const</span><span class="p">;</span>
	<span class="kt">bool</span> <span class="nf">IsAllied</span><span class="p">(</span><span class="k">const</span> <span class="n">CPlayer</span> <span class="o">&amp;</span><span class="n">player</span><span class="p">)</span> <span class="k">const</span><span class="p">;</span>
	<span class="kt">bool</span> <span class="nf">IsAllied</span><span class="p">(</span><span class="k">const</span> <span class="n">CUnit</span> <span class="o">&amp;</span><span class="n">unit</span><span class="p">)</span> <span class="k">const</span><span class="p">;</span>
	<span class="kt">bool</span> <span class="nf">HasSharedVisionWith</span><span class="p">(</span><span class="k">const</span> <span class="n">CPlayer</span> <span class="o">&amp;</span><span class="n">player</span><span class="p">)</span> <span class="k">const</span><span class="p">;</span>
	<span class="kt">bool</span> <span class="nf">IsTeamed</span><span class="p">(</span><span class="k">const</span> <span class="n">CPlayer</span> <span class="o">&amp;</span><span class="n">player</span><span class="p">)</span> <span class="k">const</span><span class="p">;</span>
	<span class="kt">bool</span> <span class="nf">IsTeamed</span><span class="p">(</span><span class="k">const</span> <span class="n">CUnit</span> <span class="o">&amp;</span><span class="n">unit</span><span class="p">)</span> <span class="k">const</span><span class="p">;</span>
<span class="p">};</span>
</pre></div>
</p>
                    </details>
                    
                    <details>
                    <summary>CPlayer Players[PlayerMax]</summary>
                    <p></p>
                    </details>
                    
                    <details>
                    <summary>CPlayer *ThisPlayer</summary>
                    <p></p>
                    </details>
                    <hr>/tolua/video.pkg<hr>
                    <details>
                    <summary>int PlayMovie(const std::string name)</summary>
                    <p></p>
                    </details>
                    
                    <details>
                    <summary>ShowFullImage(const std::string name, unsigned int timeOutInSecond)</summary>
                    <p></p>
                    </details>
                    
                    <details>
                    <summary>SaveMapPNG(const char *name)</summary>
                    <p></p>
                    </details>
                    
                    <details>
                    <summary>class CVideo</summary>
                    <p></p>
                    <p><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">CVideo</span>
<span class="p">{</span>
<span class="k">public</span><span class="o">:</span>
	<span class="kt">int</span> <span class="n">Width</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">Height</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">Depth</span><span class="p">;</span>
	<span class="kt">bool</span> <span class="n">FullScreen</span><span class="p">;</span>
	<span class="kt">bool</span> <span class="nf">ResizeScreen</span><span class="p">(</span><span class="kt">int</span> <span class="n">width</span><span class="p">,</span> <span class="kt">int</span> <span class="n">height</span><span class="p">);</span>
<span class="p">};</span>
</pre></div>
</p>
                    </details>
                    
                    <details>
                    <summary>CVideo Video</summary>
                    <p></p>
                    </details>
                    
                    <details>
                    <summary>ToggleFullScreen(void)</summary>
                    <p></p>
                    </details>
                    
                    <details>
                    <summary>class CGraphic</summary>
                    <p></p>
                    <p><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">CGraphic</span>
<span class="p">{</span>
<span class="k">public</span><span class="o">:</span>
	<span class="k">static</span> <span class="n">CGraphic</span> <span class="o">*</span><span class="n">New</span><span class="p">(</span><span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">file</span><span class="p">,</span> <span class="kt">int</span> <span class="n">w</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="kt">int</span> <span class="n">h</span> <span class="o">=</span> <span class="mi">0</span><span class="p">);</span>
	<span class="k">static</span> <span class="n">CGraphic</span> <span class="o">*</span><span class="nf">ForceNew</span><span class="p">(</span><span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">file</span><span class="p">,</span> <span class="kt">int</span> <span class="n">w</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="kt">int</span> <span class="n">h</span> <span class="o">=</span> <span class="mi">0</span><span class="p">);</span>
	<span class="k">static</span> <span class="n">CGraphic</span> <span class="o">*</span><span class="nf">Get</span><span class="p">(</span><span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">file</span><span class="p">);</span>
	<span class="k">static</span> <span class="kt">void</span> <span class="nf">Free</span><span class="p">(</span><span class="n">CGraphic</span> <span class="o">*</span><span class="p">);</span>
	<span class="kt">void</span> <span class="nf">Load</span><span class="p">();</span>
	<span class="kt">void</span> <span class="nf">Resize</span><span class="p">(</span><span class="kt">int</span> <span class="n">w</span><span class="p">,</span> <span class="kt">int</span> <span class="n">h</span><span class="p">);</span>
        <span class="kt">void</span> <span class="nf">SetPaletteColor</span><span class="p">(</span><span class="kt">int</span> <span class="n">idx</span><span class="p">,</span> <span class="kt">int</span> <span class="n">r</span><span class="p">,</span> <span class="kt">int</span> <span class="n">g</span><span class="p">,</span> <span class="kt">int</span> <span class="n">b</span><span class="p">);</span>
<span class="p">};</span>
</pre></div>
</p>
                    </details>
                    
                    <details>
                    <summary>class CPlayerColorGraphic : public CGraphic</summary>
                    <p></p>
                    <p><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">CPlayerColorGraphic</span> <span class="o">:</span> <span class="k">public</span> <span class="n">CGraphic</span>
<span class="p">{</span>
<span class="k">public</span><span class="o">:</span>
	<span class="k">static</span> <span class="n">CPlayerColorGraphic</span> <span class="o">*</span><span class="n">New</span><span class="p">(</span><span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">file</span><span class="p">,</span> <span class="kt">int</span> <span class="n">w</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="kt">int</span> <span class="n">h</span> <span class="o">=</span> <span class="mi">0</span><span class="p">);</span>
	<span class="k">static</span> <span class="n">CPlayerColorGraphic</span> <span class="o">*</span><span class="nf">Get</span><span class="p">(</span><span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">file</span><span class="p">);</span>
<span class="p">};</span>
</pre></div>
</p>
                    </details>
                    
                    <details>
                    <summary>class CColor {</summary>
                    <p></p>
                    <p><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">CColor</span> <span class="p">{</span>
	<span class="n">CColor</span><span class="p">(</span><span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">r</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">g</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">b</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
		<span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">a</span> <span class="o">=</span> <span class="mi">0</span><span class="p">);</span>

	<span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">R</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">G</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">B</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">A</span><span class="p">;</span>
<span class="p">};</span>
</pre></div>
</p>
                    </details>
                    
                    <details>
                    <summary>SetColorCycleAll(bool value)</summary>
                    <p></p>
                    </details>
                    
                    <details>
                    <summary>AddColorCyclingRange(unsigned int startColorIndex, unsigned int endColorIndex)</summary>
                    <p></p>
                    </details>
                    <hr>/tolua/game.pkg<hr>
                    <details>
                    <summary>StartMap(const string str, bool clean = true)</summary>
                    <p></p>
                    </details>
                    
                    <details>
                    <summary>StartReplay(const string str, bool reveal = false)</summary>
                    <p></p>
                    </details>
                    
                    <details>
                    <summary>StartSavedGame(const string str)</summary>
                    <p></p>
                    </details>
                    
                    <details>
                    <summary>int SaveReplay(const std::string filename)</summary>
                    <p></p>
                    </details>
                    
                    <details>
                    <summary>enum GameResults {</summary>
                    <p></p>
                    <p><div class="highlight"><pre><span></span><span class="k">enum</span> <span class="nc">GameResults</span> <span class="p">{</span>
    <span class="n">GameNoResult</span><span class="p">,</span>
    <span class="n">GameVictory</span><span class="p">,</span>
    <span class="n">GameDefeat</span><span class="p">,</span>
    <span class="n">GameDraw</span><span class="p">,</span>
    <span class="n">GameQuitToMenu</span><span class="p">,</span>
    <span class="n">GameRestart</span><span class="p">,</span>
<span class="p">};</span>
</pre></div>
</p>
                    </details>
                    
                    <details>
                    <summary>GameResults GameResult</summary>
                    <p></p>
                    </details>
                    
                    <details>
                    <summary>StopGame(GameResults result)</summary>
                    <p></p>
                    </details>
                    
                    <details>
                    <summary>bool GameRunning</summary>
                    <p></p>
                    </details>
                    
                    <details>
                    <summary>SetGamePaused(bool paused)</summary>
                    <p></p>
                    </details>
                    
                    <details>
                    <summary>SetGameSpeed(int speed)</summary>
                    <p></p>
                    </details>
                    
                    <details>
                    <summary>bool GameObserve</summary>
                    <p></p>
                    </details>
                    
                    <details>
                    <summary>bool GameEstablishing</summary>
                    <p></p>
                    </details>
                    
                    <details>
                    <summary>unsigned long GameCycle</summary>
                    <p></p>
                    </details>
                    
                    <details>
                    <summary>unsigned long FastForwardCycle</summary>
                    <p></p>
                    </details>
                    
                    <details>
                    <summary>class Settings {</summary>
                    <p></p>
                    <p><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Settings</span> <span class="p">{</span>
	<span class="kt">int</span> <span class="n">NetGameType</span><span class="p">;</span>

	<span class="n">SettingsPresets</span> <span class="n">Presets</span><span class="p">[</span><span class="n">PlayerMax</span><span class="p">];</span>

	<span class="kt">int</span> <span class="n">Resources</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">NumUnits</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">Opponents</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">Difficulty</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">GameType</span><span class="p">;</span>
	<span class="kt">bool</span> <span class="n">NoFogOfWar</span><span class="p">;</span>
	<span class="kt">bool</span> <span class="n">Inside</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">RevealMap</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">MapRichness</span><span class="p">;</span>
<span class="p">};</span>
</pre></div>
</p>
                    </details>
                    
                    <details>
                    <summary>Settings GameSettings</summary>
                    <p></p>
                    </details>
                    
                    <details>
                    <summary>enum GameTypes {</summary>
                    <p></p>
                    <p><div class="highlight"><pre><span></span><span class="k">enum</span> <span class="nc">GameTypes</span> <span class="p">{</span>
	<span class="n">SettingsGameTypeMapDefault</span> <span class="o">=</span> <span class="n">SettingsPresetMapDefault</span><span class="p">,</span>
	<span class="n">SettingsGameTypeMelee</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
	<span class="n">SettingsGameTypeFreeForAll</span><span class="p">,</span>
	<span class="n">SettingsGameTypeTopVsBottom</span><span class="p">,</span>
	<span class="n">SettingsGameTypeLeftVsRight</span><span class="p">,</span>
	<span class="n">SettingsGameTypeManVsMachine</span><span class="p">,</span>
	<span class="n">SettingsGameTypeManTeamVsMachine</span><span class="p">,</span>
	<span class="n">SettingsGameTypeMachineVsMachine</span><span class="p">,</span>
        <span class="n">SettingsGameTypeMachineVsMachineTraining</span><span class="p">,</span>
<span class="p">};</span>
</pre></div>
</p>
                    </details>
                    <hr>/tolua/sound.pkg<hr>
                    <details>
                    <summary>int GetEffectsVolume(void)</summary>
                    <p></p>
                    </details>
                    
                    <details>
                    <summary>SetEffectsVolume(int volume)</summary>
                    <p></p>
                    </details>
                    
                    <details>
                    <summary>int GetMusicVolume(void)</summary>
                    <p></p>
                    </details>
                    
                    <details>
                    <summary>SetMusicVolume(int volume)</summary>
                    <p></p>
                    </details>
                    
                    <details>
                    <summary>SetEffectsEnabled(bool enabled)</summary>
                    <p></p>
                    </details>
                    
                    <details>
                    <summary>bool IsEffectsEnabled(void)</summary>
                    <p></p>
                    </details>
                    
                    <details>
                    <summary>SetMusicEnabled(bool enabled)</summary>
                    <p></p>
                    </details>
                    
                    <details>
                    <summary>bool IsMusicEnabled(void)</summary>
                    <p></p>
                    </details>
                    
                    <details>
                    <summary>int PlayFile(const std::string name, LuaActionListener *listener = NULL)</summary>
                    <p></p>
                    </details>
                    
                    <details>
                    <summary>int PlayMusic(const std::string name)</summary>
                    <p></p>
                    </details>
                    
                    <details>
                    <summary>StopMusic(void)</summary>
                    <p></p>
                    </details>
                    
                    <details>
                    <summary>int SetChannelVolume(int channel, int volume)</summary>
                    <p></p>
                    </details>
                    
                    <details>
                    <summary>SetChannelStereo(int channel, int stereo)</summary>
                    <p></p>
                    </details>
                    
                    <details>
                    <summary>StopChannel(int channel)</summary>
                    <p></p>
                    </details>
                    <hr>/tolua/font.pkg<hr>
                    <details>
                    <summary>class CFont</summary>
                    <p></p>
                    <p><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">CFont</span>
<span class="p">{</span>
	<span class="k">static</span> <span class="n">CFont</span> <span class="o">*</span><span class="nf">New</span><span class="p">(</span><span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">ident</span><span class="p">,</span> <span class="n">CGraphic</span> <span class="o">*</span><span class="n">g</span><span class="p">);</span>
	<span class="k">static</span> <span class="n">CFont</span> <span class="o">*</span><span class="nf">Get</span><span class="p">(</span><span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">ident</span><span class="p">);</span>

	<span class="kt">int</span> <span class="nf">Height</span><span class="p">();</span>
	<span class="kt">int</span> <span class="nf">Width</span><span class="p">(</span><span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">text</span><span class="p">);</span>
<span class="p">};</span>
</pre></div>
</p>
                    </details>
                    
                    <details>
                    <summary>class CFontColor</summary>
                    <p></p>
                    <p><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">CFontColor</span>
<span class="p">{</span>
	<span class="k">static</span> <span class="n">CFontColor</span> <span class="o">*</span><span class="nf">New</span><span class="p">(</span><span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">ident</span><span class="p">);</span>
	<span class="k">static</span> <span class="n">CFontColor</span> <span class="o">*</span><span class="nf">Get</span><span class="p">(</span><span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">ident</span><span class="p">);</span>

	<span class="n">CColor</span> <span class="n">Colors</span><span class="p">[</span><span class="n">MaxFontColors</span><span class="p">];</span>
<span class="p">};</span>
</pre></div>
</p>
                    </details>
                    <hr>/tolua/network.pkg<hr>
                    <details>
                    <summary>InitNetwork1(void)</summary>
                    <p></p>
                    </details>
                    
                    <details>
                    <summary>ExitNetwork1(void)</summary>
                    <p></p>
                    </details>
                    
                    <details>
                    <summary>int NetworkSetupServerAddress(const std::string serveraddr, int port = 0)</summary>
                    <p></p>
                    </details>
                    
                    <details>
                    <summary>NetworkInitClientConnect(void)</summary>
                    <p></p>
                    </details>
                    
                    <details>
                    <summary>NetworkInitServerConnect(int openslots)</summary>
                    <p></p>
                    </details>
                    
                    <details>
                    <summary>NetworkServerStartGame(void)</summary>
                    <p></p>
                    </details>
                    
                    <details>
                    <summary>NetworkProcessClientRequest(void)</summary>
                    <p></p>
                    </details>
                    
                    <details>
                    <summary>NetworkServerResyncClients(void)</summary>
                    <p></p>
                    </details>
                    
                    <details>
                    <summary>NetworkDetachFromServer(void)</summary>
                    <p></p>
                    </details>
                    
                    <details>
                    <summary>class CServerSetup {</summary>
                    <p></p>
                    <p><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">CServerSetup</span> <span class="p">{</span>
	<span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">ResourcesOption</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">UnitsOption</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">FogOfWar</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">Inside</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">RevealMap</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">GameTypeOption</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">Difficulty</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">MapRichness</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">Opponents</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">CompOpt</span><span class="p">[</span><span class="n">PlayerMax</span><span class="p">];</span> <span class="c1">// cannot use char since tolua interpret variable as string else.</span>
	<span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">Ready</span><span class="p">[</span><span class="n">PlayerMax</span><span class="p">];</span>   <span class="c1">// cannot use char since tolua interpret variable as string else.</span>
	<span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">Race</span><span class="p">[</span><span class="n">PlayerMax</span><span class="p">];</span>    <span class="c1">// cannot use char since tolua interpret variable as string else.</span>
<span class="p">};</span>
</pre></div>
</p>
                    </details>
                    
                    <details>
                    <summary>CServerSetup LocalSetupState</summary>
                    <p></p>
                    </details>
                    
                    <details>
                    <summary>CServerSetup ServerSetupState</summary>
                    <p></p>
                    </details>
                    
                    <details>
                    <summary>int NetLocalHostsSlot</summary>
                    <p></p>
                    </details>
                    
                    <details>
                    <summary>CNetworkHost Hosts[PlayerMax]</summary>
                    <p></p>
                    </details>
                    
                    <details>
                    <summary>string NetworkMapName</summary>
                    <p></p>
                    </details>
                    
                    <details>
                    <summary>NetworkGamePrepareGameSettings(void)</summary>
                    <p></p>
                    </details>
                    <hr>/tolua/trigger.pkg<hr>
                    <details>
                    <summary>int GetNumOpponents(int player)</summary>
                    <p></p>
                    </details>
                    
                    <details>
                    <summary>ActionSetTimer(int cycles, bool increasing)</summary>
                    <p></p>
                    </details>
                    
                    <details>
                    <summary>SetTrigger(int trigger)</summary>
                    <p></p>
                    </details>
                    <hr>/tolua/minimap.pkg<hr>
                    <details>
                    <summary>class CMinimap</summary>
                    <p></p>
                    <p><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">CMinimap</span>
<span class="p">{</span>
	<span class="kt">int</span> <span class="n">X</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">Y</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">W</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">H</span><span class="p">;</span>
	<span class="kt">bool</span> <span class="n">WithTerrain</span><span class="p">;</span>
	<span class="kt">bool</span> <span class="n">ShowSelected</span><span class="p">;</span>
	<span class="kt">bool</span> <span class="n">Transparent</span><span class="p">;</span>
<span class="p">};</span>
</pre></div>
</p>
                    </details>
                    <hr>/tolua/pathfinder.pkg<hr>
                    <details>
                    <summary>bool AStarKnowUnseenTerrain</summary>
                    <p></p>
                    </details>
                    <hr>/tolua/editor.pkg<hr>
                    <details>
                    <summary>enum EditorRunningType {</summary>
                    <p></p>
                    <p><div class="highlight"><pre><span></span><span class="k">enum</span> <span class="nc">EditorRunningType</span> <span class="p">{</span>
	<span class="n">EditorNotRunning</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>    <span class="c1">/// Not Running</span>
	<span class="n">EditorStarted</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>       <span class="c1">/// Editor Enabled at all</span>
	<span class="n">EditorCommandLine</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span>   <span class="c1">/// Called from Command Line</span>
	<span class="n">EditorEditing</span> <span class="o">=</span> <span class="mi">4</span><span class="p">,</span>       <span class="c1">/// Editor is fully running</span>
<span class="p">};</span>
</pre></div>
</p>
                    </details>
                    
                    <details>
                    <summary>class CEditor</summary>
                    <p></p>
                    <p><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">CEditor</span>
<span class="p">{</span>
	<span class="n">vector</span><span class="o">&lt;</span><span class="n">string</span><span class="o">&gt;</span> <span class="n">UnitTypes</span><span class="p">;</span>
	<span class="kt">bool</span> <span class="n">TerrainEditable</span><span class="p">;</span>
	<span class="k">const</span> <span class="n">CUnitType</span> <span class="o">*</span><span class="n">StartUnit</span><span class="p">;</span>
	<span class="kt">bool</span> <span class="n">WriteCompressedMaps</span><span class="p">;</span>
	<span class="n">EditorRunningType</span> <span class="n">Running</span><span class="p">;</span>
<span class="p">};</span>
</pre></div>
</p>
                    </details>
                    
                    <details>
                    <summary>CEditor Editor</summary>
                    <p></p>
                    </details>
                    
                    <details>
                    <summary>StartEditor(const char *filename)</summary>
                    <p></p>
                    </details>
                    
                    <details>
                    <summary>int EditorSaveMap(const std::string &file)</summary>
                    <p></p>
                    </details>
                    <hr>/tolua/map.pkg<hr>
                    <details>
                    <summary>class CMapInfo</summary>
                    <p></p>
                    <p><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">CMapInfo</span>
<span class="p">{</span>
	<span class="n">string</span> <span class="n">Description</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">MapWidth</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">MapHeight</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">PlayerType</span><span class="p">[</span><span class="n">PlayerMax</span><span class="p">];</span>
<span class="p">};</span>
</pre></div>
</p>
                    </details>
                    
                    <details>
                    <summary>class CTileset</summary>
                    <p></p>
                    <p><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">CTileset</span>
<span class="p">{</span>
	<span class="n">string</span> <span class="n">Name</span><span class="p">;</span>
<span class="p">};</span>
</pre></div>
</p>
                    </details>
                    
                    <details>
                    <summary>class CMap</summary>
                    <p></p>
                    <p><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">CMap</span>
<span class="p">{</span>
	<span class="n">CMapInfo</span> <span class="n">Info</span><span class="p">;</span>
	<span class="n">CTileset</span> <span class="o">*</span><span class="n">Tileset</span><span class="p">;</span>
<span class="p">};</span>
</pre></div>
</p>
                    </details>
                    
                    <details>
                    <summary>CMap Map</summary>
                    <p></p>
                    </details>
                    
                    <details>
                    <summary>SetTile(int tile, int w, int h, int value = 0)</summary>
                    <p></p>
                    </details>
                    <hr>/tolua/translate.pkg<hr>
                    <details>
                    <summary>AddTranslation(const char *str1, const char *str2)</summary>
                    <p></p>
                    </details>
                    
                    <details>
                    <summary>LoadPO(const char *file)</summary>
                    <p></p>
                    </details>
                    
                    <details>
                    <summary>SetTranslationsFiles(const char *stratagusfile, const char *gamefile)</summary>
                    <p></p>
                    </details>
                    
        </body>
        </html>
        